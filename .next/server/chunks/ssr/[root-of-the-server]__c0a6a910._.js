module.exports=[88156,69304,57179,14834,a=>{"use strict";var b;let c,d,e=()=>void 0,f={NODE_CLIENT:!1},g=function(a){let b=[],c=0;for(let d=0;d<a.length;d++){let e=a.charCodeAt(d);e<128?b[c++]=e:(e<2048?b[c++]=e>>6|192:((64512&e)==55296&&d+1<a.length&&(64512&a.charCodeAt(d+1))==56320?(e=65536+((1023&e)<<10)+(1023&a.charCodeAt(++d)),b[c++]=e>>18|240,b[c++]=e>>12&63|128):b[c++]=e>>12|224,b[c++]=e>>6&63|128),b[c++]=63&e|128)}return b},h=function(a){let b=[],c=0,d=0;for(;c<a.length;){let e=a[c++];if(e<128)b[d++]=String.fromCharCode(e);else if(e>191&&e<224){let f=a[c++];b[d++]=String.fromCharCode((31&e)<<6|63&f)}else if(e>239&&e<365){let f=((7&e)<<18|(63&a[c++])<<12|(63&a[c++])<<6|63&a[c++])-65536;b[d++]=String.fromCharCode(55296+(f>>10)),b[d++]=String.fromCharCode(56320+(1023&f))}else{let f=a[c++],g=a[c++];b[d++]=String.fromCharCode((15&e)<<12|(63&f)<<6|63&g)}}return b.join("")},i={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(a,b){if(!Array.isArray(a))throw Error("encodeByteArray takes an array as a parameter");this.init_();let c=b?this.byteToCharMapWebSafe_:this.byteToCharMap_,d=[];for(let b=0;b<a.length;b+=3){let e=a[b],f=b+1<a.length,g=f?a[b+1]:0,h=b+2<a.length,i=h?a[b+2]:0,j=e>>2,k=(3&e)<<4|g>>4,l=(15&g)<<2|i>>6,m=63&i;!h&&(m=64,f||(l=64)),d.push(c[j],c[k],c[l],c[m])}return d.join("")},encodeString(a,b){return this.HAS_NATIVE_SUPPORT&&!b?btoa(a):this.encodeByteArray(g(a),b)},decodeString(a,b){return this.HAS_NATIVE_SUPPORT&&!b?atob(a):h(this.decodeStringToByteArray(a,b))},decodeStringToByteArray(a,b){this.init_();let c=b?this.charToByteMapWebSafe_:this.charToByteMap_,d=[];for(let b=0;b<a.length;){let e=c[a.charAt(b++)],f=b<a.length?c[a.charAt(b)]:0,g=++b<a.length?c[a.charAt(b)]:64,h=++b<a.length?c[a.charAt(b)]:64;if(++b,null==e||null==f||null==g||null==h)throw new j;let i=e<<2|f>>4;if(d.push(i),64!==g){let a=f<<4&240|g>>2;if(d.push(a),64!==h){let a=g<<6&192|h;d.push(a)}}}return d},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let a=0;a<this.ENCODED_VALS.length;a++)this.byteToCharMap_[a]=this.ENCODED_VALS.charAt(a),this.charToByteMap_[this.byteToCharMap_[a]]=a,this.byteToCharMapWebSafe_[a]=this.ENCODED_VALS_WEBSAFE.charAt(a),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[a]]=a,a>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(a)]=a,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(a)]=a)}}};class j extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let k=function(a){let b=g(a);return i.encodeByteArray(b,!0)},l=function(a){return k(a).replace(/\./g,"")},m=function(a){try{return i.decodeString(a,!0)}catch(a){console.error("base64Decode failed: ",a)}return null};function n(){return"u">typeof self?self:a.g}let o=()=>n().__FIREBASE_DEFAULTS__,p=()=>{if("u"<typeof process||void 0===process.env)return;let a=process.env.__FIREBASE_DEFAULTS__;if(a)return JSON.parse(a)},q=()=>{let a;if("u"<typeof document)return;try{a=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(a){return}let b=a&&m(a[1]);return b&&JSON.parse(b)},r=()=>{try{return e()||o()||p()||q()}catch(a){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${a}`);return}},s=a=>r()?.emulatorHosts?.[a],t=a=>{let b=s(a);if(!b)return;let c=b.lastIndexOf(":");if(c<=0||c+1===b.length)throw Error(`Invalid host ${b} with no separate hostname and port!`);let d=parseInt(b.substring(c+1),10);return"["===b[0]?[b.substring(1,c-1),d]:[b.substring(0,c),d]},u=()=>r()?.config;class v{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((a,b)=>{this.resolve=a,this.reject=b})}wrapCallback(a){return(b,c)=>{b?this.reject(b):this.resolve(c),"function"==typeof a&&(this.promise.catch(()=>{}),1===a.length?a(b):a(b,c))}}}function w(a){try{return(a.startsWith("http://")||a.startsWith("https://")?new URL(a).hostname:a).endsWith(".cloudworkstations.dev")}catch{return!1}}async function x(a){return(await fetch(a,{credentials:"include"})).ok}function y(a,b){if(a.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let c={alg:"none",type:"JWT"},d=b||"demo-project",e=a.iat||0,f=a.sub||a.user_id;if(!f)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let g={iss:`https://securetoken.google.com/${d}`,aud:d,iat:e,exp:e+3600,auth_time:e,sub:f,user_id:f,firebase:{sign_in_provider:"custom",identities:{}},...a},h="";return[l(JSON.stringify(c)),l(JSON.stringify(g)),h].join(".")}function z(a,b){}function A(){return"u">typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function B(){return!1}function C(){let b=r()?.forceEnvironment;if("node"===b)return!0;if("browser"===b)return!1;try{return"[object process]"===Object.prototype.toString.call(a.g.process)}catch(a){return!1}}function D(){return E()}function E(){return"u">typeof WorkerGlobalScope&&"u">typeof self&&self instanceof WorkerGlobalScope}function F(){return"u">typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function G(){let a="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof a&&void 0!==a.id}function H(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function I(){let a=A();return a.indexOf("MSIE ")>=0||a.indexOf("Trident/")>=0}function J(){return!C()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function K(){return!C()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function L(){try{return"object"==typeof indexedDB}catch(a){return!1}}function M(){return new Promise((a,b)=>{try{let c=!0,d="validate-browser-context-for-indexeddb-analytics-module",e=self.indexedDB.open(d);e.onsuccess=()=>{e.result.close(),c||self.indexedDB.deleteDatabase(d),a(!0)},e.onupgradeneeded=()=>{c=!1},e.onerror=()=>{b(e.error?.message||"")}}catch(a){b(a)}})}let N="FirebaseError";class O extends Error{constructor(a,b,c){super(b),this.code=a,this.customData=c,this.name=N,Object.setPrototypeOf(this,O.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,P.prototype.create)}}class P{constructor(a,b,c){this.service=a,this.serviceName=b,this.errors=c}create(a,...b){let c=b[0]||{},d=`${this.service}/${a}`,e=this.errors[a],f=e?Q(e,c):"Error",g=`${this.serviceName}: ${f} (${d}).`;return new O(d,g,c)}}function Q(a,b){return a.replace(R,(a,c)=>{let d=b[c];return null!=d?String(d):`<${c}?>`})}let R=/\{\$([^}]+)}/g;function S(a,b){if(a===b)return!0;let c=Object.keys(a),d=Object.keys(b);for(let e of c){if(!d.includes(e))return!1;let c=a[e],f=b[e];if(T(c)&&T(f)){if(!S(c,f))return!1}else if(c!==f)return!1}for(let a of d)if(!c.includes(a))return!1;return!0}function T(a){return null!==a&&"object"==typeof a}function U(a){let b=[];for(let[c,d]of Object.entries(a))Array.isArray(d)?d.forEach(a=>{b.push(encodeURIComponent(c)+"="+encodeURIComponent(a))}):b.push(encodeURIComponent(c)+"="+encodeURIComponent(d));return b.length?"&"+b.join("&"):""}function V(a){let b={};return a.replace(/^\?/,"").split("&").forEach(a=>{if(a){let[c,d]=a.split("=");b[decodeURIComponent(c)]=decodeURIComponent(d)}}),b}function W(a){let b=a.indexOf("?");if(!b)return"";let c=a.indexOf("#",b);return a.substring(b,c>0?c:void 0)}function X(a,b){let c=new Y(a,b);return c.subscribe.bind(c)}class Y{constructor(a,b){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=b,this.task.then(()=>{a(this)}).catch(a=>{this.error(a)})}next(a){this.forEachObserver(b=>{b.next(a)})}error(a){this.forEachObserver(b=>{b.error(a)}),this.close(a)}complete(){this.forEachObserver(a=>{a.complete()}),this.close()}subscribe(a,b,c){let d;if(void 0===a&&void 0===b&&void 0===c)throw Error("Missing Observer.");void 0===(d=Z(a,["next","error","complete"])?a:{next:a,error:b,complete:c}).next&&(d.next=$),void 0===d.error&&(d.error=$),void 0===d.complete&&(d.complete=$);let e=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?d.error(this.finalError):d.complete()}catch(a){}}),this.observers.push(d),e}unsubscribeOne(a){void 0!==this.observers&&void 0!==this.observers[a]&&(delete this.observers[a],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(a){if(!this.finalized)for(let b=0;b<this.observers.length;b++)this.sendOne(b,a)}sendOne(a,b){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[a])try{b(this.observers[a])}catch(a){"u">typeof console&&console.error&&console.error(a)}})}close(a){this.finalized||(this.finalized=!0,void 0!==a&&(this.finalError=a),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Z(a,b){if("object"!=typeof a||null===a)return!1;for(let c of b)if(c in a&&"function"==typeof a[c])return!0;return!1}function $(){}function _(a){return a&&a._delegate?a._delegate:a}f.NODE_CLIENT=!0,a.s(["Deferred",()=>v,"ErrorFactory",()=>P,"FirebaseError",()=>O,"base64Decode",()=>m,"base64urlEncodeWithoutPadding",()=>l,"createMockUserToken",()=>y,"createSubscribe",()=>X,"deepEqual",()=>S,"extractQuerystring",()=>W,"getDefaultAppConfig",()=>u,"getDefaultEmulatorHost",()=>s,"getDefaultEmulatorHostnameAndPort",()=>t,"getGlobal",()=>n,"getModularInstance",()=>_,"getUA",()=>A,"isBrowser",()=>D,"isBrowserExtension",()=>G,"isCloudWorkstation",()=>w,"isCloudflareWorker",()=>F,"isIE",()=>I,"isIndexedDBAvailable",()=>L,"isMobileCordova",()=>B,"isReactNative",()=>H,"isSafari",()=>J,"isSafariOrWebkit",()=>K,"isWebWorker",()=>E,"pingServer",()=>x,"querystring",()=>U,"querystringDecode",()=>V,"updateEmulatorBanner",()=>z,"validateIndexedDBOpenable",()=>M],69304);class aa{constructor(a,b,c){this.name=a,this.instanceFactory=b,this.type=c,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(a){return this.instantiationMode=a,this}setMultipleInstances(a){return this.multipleInstances=a,this}setServiceProps(a){return this.serviceProps=a,this}setInstanceCreatedCallback(a){return this.onInstanceCreated=a,this}}let ab="[DEFAULT]";class ac{constructor(a,b){this.name=a,this.container=b,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(a){let b=this.normalizeInstanceIdentifier(a);if(!this.instancesDeferred.has(b)){let a=new v;if(this.instancesDeferred.set(b,a),this.isInitialized(b)||this.shouldAutoInitialize())try{let c=this.getOrInitializeService({instanceIdentifier:b});c&&a.resolve(c)}catch(a){}}return this.instancesDeferred.get(b).promise}getImmediate(a){let b=this.normalizeInstanceIdentifier(a?.identifier),c=a?.optional??!1;if(this.isInitialized(b)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:b})}catch(a){if(c)return null;throw a}if(c)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(a){if(a.name!==this.name)throw Error(`Mismatching Component ${a.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=a,this.shouldAutoInitialize()){if(ae(a))try{this.getOrInitializeService({instanceIdentifier:ab})}catch(a){}for(let[a,b]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(a);try{let a=this.getOrInitializeService({instanceIdentifier:c});b.resolve(a)}catch(a){}}}}clearInstance(a=ab){this.instancesDeferred.delete(a),this.instancesOptions.delete(a),this.instances.delete(a)}async delete(){let a=Array.from(this.instances.values());await Promise.all([...a.filter(a=>"INTERNAL"in a).map(a=>a.INTERNAL.delete()),...a.filter(a=>"_delete"in a).map(a=>a._delete())])}isComponentSet(){return null!=this.component}isInitialized(a=ab){return this.instances.has(a)}getOptions(a=ab){return this.instancesOptions.get(a)||{}}initialize(a={}){let{options:b={}}=a,c=this.normalizeInstanceIdentifier(a.instanceIdentifier);if(this.isInitialized(c))throw Error(`${this.name}(${c}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let d=this.getOrInitializeService({instanceIdentifier:c,options:b});for(let[a,b]of this.instancesDeferred.entries())c===this.normalizeInstanceIdentifier(a)&&b.resolve(d);return d}onInit(a,b){let c=this.normalizeInstanceIdentifier(b),d=this.onInitCallbacks.get(c)??new Set;d.add(a),this.onInitCallbacks.set(c,d);let e=this.instances.get(c);return e&&a(e,c),()=>{d.delete(a)}}invokeOnInitCallbacks(a,b){let c=this.onInitCallbacks.get(b);if(c)for(let d of c)try{d(a,b)}catch{}}getOrInitializeService({instanceIdentifier:a,options:b={}}){let c=this.instances.get(a);if(!c&&this.component&&(c=this.component.instanceFactory(this.container,{instanceIdentifier:ad(a),options:b}),this.instances.set(a,c),this.instancesOptions.set(a,b),this.invokeOnInitCallbacks(c,a),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,a,c)}catch{}return c||null}normalizeInstanceIdentifier(a=ab){return this.component?this.component.multipleInstances?a:ab:a}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function ad(a){return a===ab?void 0:a}function ae(a){return"EAGER"===a.instantiationMode}class af{constructor(a){this.name=a,this.providers=new Map}addComponent(a){let b=this.getProvider(a.name);if(b.isComponentSet())throw Error(`Component ${a.name} has already been registered with ${this.name}`);b.setComponent(a)}addOrOverwriteComponent(a){this.getProvider(a.name).isComponentSet()&&this.providers.delete(a.name),this.addComponent(a)}getProvider(a){if(this.providers.has(a))return this.providers.get(a);let b=new ac(a,this);return this.providers.set(a,b),b}getProviders(){return Array.from(this.providers.values())}}a.s(["Component",()=>aa,"ComponentContainer",()=>af],57179);let ag=[];!function(a){a[a.DEBUG=0]="DEBUG",a[a.VERBOSE=1]="VERBOSE",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.SILENT=5]="SILENT"}(b||(b={}));let ah={debug:b.DEBUG,verbose:b.VERBOSE,info:b.INFO,warn:b.WARN,error:b.ERROR,silent:b.SILENT},ai=b.INFO,aj={[b.DEBUG]:"log",[b.VERBOSE]:"log",[b.INFO]:"info",[b.WARN]:"warn",[b.ERROR]:"error"},ak=(a,b,...c)=>{if(b<a.logLevel)return;let d=new Date().toISOString(),e=aj[b];if(e)console[e](`[${d}]  ${a.name}:`,...c);else throw Error(`Attempted to log a message with an invalid logType (value: ${b})`)};class al{constructor(a){this.name=a,this._logLevel=ai,this._logHandler=ak,this._userLogHandler=null,ag.push(this)}get logLevel(){return this._logLevel}set logLevel(a){if(!(a in b))throw TypeError(`Invalid value "${a}" assigned to \`logLevel\``);this._logLevel=a}setLogLevel(a){this._logLevel="string"==typeof a?ah[a]:a}get logHandler(){return this._logHandler}set logHandler(a){if("function"!=typeof a)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=a}get userLogHandler(){return this._userLogHandler}set userLogHandler(a){this._userLogHandler=a}debug(...a){this._userLogHandler&&this._userLogHandler(this,b.DEBUG,...a),this._logHandler(this,b.DEBUG,...a)}log(...a){this._userLogHandler&&this._userLogHandler(this,b.VERBOSE,...a),this._logHandler(this,b.VERBOSE,...a)}info(...a){this._userLogHandler&&this._userLogHandler(this,b.INFO,...a),this._logHandler(this,b.INFO,...a)}warn(...a){this._userLogHandler&&this._userLogHandler(this,b.WARN,...a),this._logHandler(this,b.WARN,...a)}error(...a){this._userLogHandler&&this._userLogHandler(this,b.ERROR,...a),this._logHandler(this,b.ERROR,...a)}}function am(a){ag.forEach(b=>{b.setLogLevel(a)})}function an(a,c){for(let d of ag){let e=null;c&&c.level&&(e=ah[c.level]),null===a?d.userLogHandler=null:d.userLogHandler=(c,d,...f)=>{let g=f.map(a=>{if(null==a)return null;if("string"==typeof a)return a;if("number"==typeof a||"boolean"==typeof a)return a.toString();if(a instanceof Error)return a.message;try{return JSON.stringify(a)}catch(a){return null}}).filter(a=>a).join(" ");d>=(e??c.logLevel)&&a({level:b[d].toLowerCase(),message:g,args:f,type:c.name})}}}a.s(["LogLevel",()=>b,"Logger",()=>al,"setLogLevel",()=>am,"setUserLogHandler",()=>an],14834);let ao=(a,b)=>b.some(b=>a instanceof b);function ap(){return c||(c=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function aq(){return d||(d=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}let ar=new WeakMap,as=new WeakMap,at=new WeakMap,au=new WeakMap,av=new WeakMap;function aw(a){let b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("success",e),a.removeEventListener("error",f)},e=()=>{b(aC(a.result)),d()},f=()=>{c(a.error),d()};a.addEventListener("success",e),a.addEventListener("error",f)});return b.then(b=>{b instanceof IDBCursor&&ar.set(b,a)}).catch(()=>{}),av.set(b,a),b}function ax(a){if(as.has(a))return;let b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("complete",e),a.removeEventListener("error",f),a.removeEventListener("abort",f)},e=()=>{b(),d()},f=()=>{c(a.error||new DOMException("AbortError","AbortError")),d()};a.addEventListener("complete",e),a.addEventListener("error",f),a.addEventListener("abort",f)});as.set(a,b)}let ay={get(a,b,c){if(a instanceof IDBTransaction){if("done"===b)return as.get(a);if("objectStoreNames"===b)return a.objectStoreNames||at.get(a);if("store"===b)return c.objectStoreNames[1]?void 0:c.objectStore(c.objectStoreNames[0])}return aC(a[b])},set:(a,b,c)=>(a[b]=c,!0),has:(a,b)=>a instanceof IDBTransaction&&("done"===b||"store"===b)||b in a};function az(a){ay=a(ay)}function aA(a){return a!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?aq().includes(a)?function(...b){return a.apply(aD(this),b),aC(ar.get(this))}:function(...b){return aC(a.apply(aD(this),b))}:function(b,...c){let d=a.call(aD(this),b,...c);return at.set(d,b.sort?b.sort():[b]),aC(d)}}function aB(a){return"function"==typeof a?aA(a):(a instanceof IDBTransaction&&ax(a),ao(a,ap()))?new Proxy(a,ay):a}function aC(a){if(a instanceof IDBRequest)return aw(a);if(au.has(a))return au.get(a);let b=aB(a);return b!==a&&(au.set(a,b),av.set(b,a)),b}let aD=a=>av.get(a);function aE(a,b,{blocked:c,upgrade:d,blocking:e,terminated:f}={}){let g=indexedDB.open(a,b),h=aC(g);return d&&g.addEventListener("upgradeneeded",a=>{d(aC(g.result),a.oldVersion,a.newVersion,aC(g.transaction),a)}),c&&g.addEventListener("blocked",a=>c(a.oldVersion,a.newVersion,a)),h.then(a=>{f&&a.addEventListener("close",()=>f()),e&&a.addEventListener("versionchange",a=>e(a.oldVersion,a.newVersion,a))}).catch(()=>{}),h}let aF=["get","getKey","getAll","getAllKeys","count"],aG=["put","add","delete","clear"],aH=new Map;function aI(a,b){if(!(a instanceof IDBDatabase&&!(b in a)&&"string"==typeof b))return;if(aH.get(b))return aH.get(b);let c=b.replace(/FromIndex$/,""),d=b!==c,e=aG.includes(c);if(!(c in(d?IDBIndex:IDBObjectStore).prototype)||!(e||aF.includes(c)))return;let f=async function(a,...b){let f=this.transaction(a,e?"readwrite":"readonly"),g=f.store;return d&&(g=g.index(b.shift())),(await Promise.all([g[c](...b),e&&f.done]))[0]};return aH.set(b,f),f}az(a=>({...a,get:(b,c,d)=>aI(b,c)||a.get(b,c,d),has:(b,c)=>!!aI(b,c)||a.has(b,c)}));class aJ{constructor(a){this.container=a}getPlatformInfoString(){return this.container.getProviders().map(a=>{if(!aK(a))return null;{let b=a.getImmediate();return`${b.library}/${b.version}`}}).filter(a=>a).join(" ")}}function aK(a){let b=a.getComponent();return b?.type==="VERSION"}let aL="@firebase/app",aM="0.14.8",aN=new al("@firebase/app"),aO="12.9.0",aP="[DEFAULT]",aQ={[aL]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},aR=new Map,aS=new Map,aT=new Map;function aU(a,b){try{a.container.addComponent(b)}catch(c){aN.debug(`Component ${b.name} failed to register with FirebaseApp ${a.name}`,c)}}function aV(a,b){a.container.addOrOverwriteComponent(b)}function aW(a){let b=a.name;if(aT.has(b))return aN.debug(`There were multiple attempts to register component ${b}.`),!1;for(let c of(aT.set(b,a),aR.values()))aU(c,a);for(let b of aS.values())aU(b,a);return!0}function aX(a,b){let c=a.container.getProvider("heartbeat").getImmediate({optional:!0});return c&&c.triggerHeartbeat(),a.container.getProvider(b)}function aY(a,b,c=aP){aX(a,b).clearInstance(c)}function aZ(a){return void 0!==a.options}function a$(a){return!aZ(a)&&("authIdToken"in a||"appCheckToken"in a||"releaseOnDeref"in a||"automaticDataCollectionEnabled"in a)}function a_(a){return null!=a&&void 0!==a.settings}function a0(){aT.clear()}let a1=new P("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class a2{constructor(a,b,c){this._isDeleted=!1,this._options={...a},this._config={...b},this._name=b.name,this._automaticDataCollectionEnabled=b.automaticDataCollectionEnabled,this._container=c,this.container.addComponent(new aa("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(a){this.checkDestroyed(),this._automaticDataCollectionEnabled=a}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(a){this._isDeleted=a}checkDestroyed(){if(this.isDeleted)throw a1.create("app-deleted",{appName:this._name})}}function a3(a,b){let c=m(a.split(".")[1]);null===c?console.error(`FirebaseServerApp ${b} is invalid: second part could not be parsed.`):void 0===JSON.parse(c).exp?console.error(`FirebaseServerApp ${b} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(c).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${b} is invalid: the token has expired.`)}class a4 extends a2{constructor(a,b,c,d){const e=void 0===b.automaticDataCollectionEnabled||b.automaticDataCollectionEnabled,f={name:c,automaticDataCollectionEnabled:e};void 0!==a.apiKey?super(a,f,d):super(a.options,f,d),this._serverConfig={automaticDataCollectionEnabled:e,...b},this._serverConfig.authIdToken&&a3(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&a3(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"u">typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,b.releaseOnDeref=void 0,bb(aL,aM,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(a){this.isDeleted||(this._refCount++,void 0!==a&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(a,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){ba(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw a1.create("server-app-deleted")}}let a5=aO;function a6(a,b={}){let c=a;"object"!=typeof b&&(b={name:b});let d={name:aP,automaticDataCollectionEnabled:!0,...b},e=d.name;if("string"!=typeof e||!e)throw a1.create("bad-app-name",{appName:String(e)});if(c||(c=u()),!c)throw a1.create("no-options");let f=aR.get(e);if(f)if(S(c,f.options)&&S(d,f.config))return f;else throw a1.create("duplicate-app",{appName:e});let g=new af(e);for(let a of aT.values())g.addComponent(a);let h=new a2(c,d,g);return aR.set(e,h),h}function a7(a,b={}){let c;if(D()&&!E())throw a1.create("invalid-server-app-environment");let d=b||{};if(a&&(aZ(a)?c=a.options:a$(a)?d=a:c=a),void 0===d.automaticDataCollectionEnabled&&(d.automaticDataCollectionEnabled=!0),c||(c=u()),!c)throw a1.create("no-options");let e={...d,...c};void 0!==e.releaseOnDeref&&delete e.releaseOnDeref;let f=a=>[...a].reduce((a,b)=>Math.imul(31,a)+b.charCodeAt(0)|0,0);if(void 0!==d.releaseOnDeref&&"u"<typeof FinalizationRegistry)throw a1.create("finalization-registry-not-supported",{});let g=""+f(JSON.stringify(e)),h=aS.get(g);if(h)return h.incRefCount(d.releaseOnDeref),h;let i=new af(g);for(let a of aT.values())i.addComponent(a);let j=new a4(c,d,g,i);return aS.set(g,j),j}function a8(a=aP){let b=aR.get(a);if(!b&&a===aP&&u())return a6();if(!b)throw a1.create("no-app",{appName:a});return b}function a9(){return Array.from(aR.values())}async function ba(a){let b=!1,c=a.name;aR.has(c)?(b=!0,aR.delete(c)):aS.has(c)&&0>=a.decRefCount()&&(aS.delete(c),b=!0),b&&(await Promise.all(a.container.getProviders().map(a=>a.delete())),a.isDeleted=!0)}function bb(a,b,c){let d=aQ[a]??a;c&&(d+=`-${c}`);let e=d.match(/\s|\//),f=b.match(/\s|\//);if(e||f){let a=[`Unable to register library "${d}" with version "${b}":`];e&&a.push(`library name "${d}" contains illegal characters (whitespace or "/")`),e&&f&&a.push("and"),f&&a.push(`version name "${b}" contains illegal characters (whitespace or "/")`),aN.warn(a.join(" "));return}aW(new aa(`${d}-version`,()=>({library:d,version:b}),"VERSION"))}function bc(a,b){if(null!==a&&"function"!=typeof a)throw a1.create("invalid-log-argument");an(a,b)}function bd(a){am(a)}let be="firebase-heartbeat-database",bf=1,bg="firebase-heartbeat-store",bh=null;function bi(){return bh||(bh=aE(be,bf,{upgrade:(a,b)=>{if(0===b)try{a.createObjectStore(bg)}catch(a){console.warn(a)}}}).catch(a=>{throw a1.create("idb-open",{originalErrorMessage:a.message})})),bh}async function bj(a){try{let b=(await bi()).transaction(bg),c=await b.objectStore(bg).get(bl(a));return await b.done,c}catch(a){if(a instanceof O)aN.warn(a.message);else{let b=a1.create("idb-get",{originalErrorMessage:a?.message});aN.warn(b.message)}}}async function bk(a,b){try{let c=(await bi()).transaction(bg,"readwrite"),d=c.objectStore(bg);await d.put(b,bl(a)),await c.done}catch(a){if(a instanceof O)aN.warn(a.message);else{let b=a1.create("idb-set",{originalErrorMessage:a?.message});aN.warn(b.message)}}}function bl(a){return`${a.name}!${a.options.appId}`}let bm=1024,bn=30;class bo{constructor(a){this.container=a,this._heartbeatsCache=null;const b=this.container.getProvider("app").getImmediate();this._storage=new br(b),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){try{let a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),b=bp();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===b||this._heartbeatsCache.heartbeats.some(a=>a.date===b))return;if(this._heartbeatsCache.heartbeats.push({date:b,agent:a}),this._heartbeatsCache.heartbeats.length>bn){let a=bt(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){aN.warn(a)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let a=bp(),{heartbeatsToSend:b,unsentEntries:c}=bq(this._heartbeatsCache.heartbeats),d=l(JSON.stringify({version:2,heartbeats:b}));return this._heartbeatsCache.lastSentHeartbeatDate=a,c.length>0?(this._heartbeatsCache.heartbeats=c,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(a){return aN.warn(a),""}}}function bp(){return new Date().toISOString().substring(0,10)}function bq(a,b=bm){let c=[],d=a.slice();for(let e of a){let a=c.find(a=>a.agent===e.agent);if(a){if(a.dates.push(e.date),bs(c)>b){a.dates.pop();break}}else if(c.push({agent:e.agent,dates:[e.date]}),bs(c)>b){c.pop();break}d=d.slice(1)}return{heartbeatsToSend:c,unsentEntries:d}}class br{constructor(a){this.app=a,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!L()&&M().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let a=await bj(this.app);return a?.heartbeats?a:{heartbeats:[]}}}async overwrite(a){if(await this._canUseIndexedDBPromise){let b=await this.read();return bk(this.app,{lastSentHeartbeatDate:a.lastSentHeartbeatDate??b.lastSentHeartbeatDate,heartbeats:a.heartbeats})}}async add(a){if(await this._canUseIndexedDBPromise){let b=await this.read();return bk(this.app,{lastSentHeartbeatDate:a.lastSentHeartbeatDate??b.lastSentHeartbeatDate,heartbeats:[...b.heartbeats,...a.heartbeats]})}}}function bs(a){return l(JSON.stringify({version:2,heartbeats:a})).length}function bt(a){if(0===a.length)return -1;let b=0,c=a[0].date;for(let d=1;d<a.length;d++)a[d].date<c&&(c=a[d].date,b=d);return b}(function(a){aW(new aa("platform-logger",a=>new aJ(a),"PRIVATE")),aW(new aa("heartbeat",a=>new bo(a),"PRIVATE")),bb(aL,aM,""),bb(aL,aM,"esm2020"),bb("fire-js","")})(""),a.s(["SDK_VERSION",()=>a5,"_DEFAULT_ENTRY_NAME",()=>aP,"_addComponent",()=>aU,"_addOrOverwriteComponent",()=>aV,"_apps",()=>aR,"_clearComponents",()=>a0,"_components",()=>aT,"_getProvider",()=>aX,"_isFirebaseApp",()=>aZ,"_isFirebaseServerApp",()=>a_,"_isFirebaseServerAppSettings",()=>a$,"_registerComponent",()=>aW,"_removeServiceInstance",()=>aY,"_serverApps",()=>aS,"deleteApp",()=>ba,"getApp",()=>a8,"getApps",()=>a9,"initializeApp",()=>a6,"initializeServerApp",()=>a7,"onLog",()=>bc,"registerVersion",()=>bb,"setLogLevel",()=>bd],88156)},1611,14692,a=>{"use strict";var b=a.i(88156),c="firebase",d="12.9.0";(0,b.registerVersion)(c,d,"app"),a.s([],1611);var e=b;a.i(69304),a.s(["getApp",()=>e.getApp,"getApps",()=>e.getApps,"initializeApp",()=>e.initializeApp],14692)},54799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},57982,(a,b,c)=>{"use strict";var d,e,f;Object.defineProperty(c,"__esModule",{value:!0}),c.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=c.DEFAULT_MAX_SEND_MESSAGE_LENGTH=c.Propagate=c.LogVerbosity=c.Status=void 0,function(a){a[a.OK=0]="OK",a[a.CANCELLED=1]="CANCELLED",a[a.UNKNOWN=2]="UNKNOWN",a[a.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",a[a.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",a[a.NOT_FOUND=5]="NOT_FOUND",a[a.ALREADY_EXISTS=6]="ALREADY_EXISTS",a[a.PERMISSION_DENIED=7]="PERMISSION_DENIED",a[a.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",a[a.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",a[a.ABORTED=10]="ABORTED",a[a.OUT_OF_RANGE=11]="OUT_OF_RANGE",a[a.UNIMPLEMENTED=12]="UNIMPLEMENTED",a[a.INTERNAL=13]="INTERNAL",a[a.UNAVAILABLE=14]="UNAVAILABLE",a[a.DATA_LOSS=15]="DATA_LOSS",a[a.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(d||(c.Status=d={})),function(a){a[a.DEBUG=0]="DEBUG",a[a.INFO=1]="INFO",a[a.ERROR=2]="ERROR",a[a.NONE=3]="NONE"}(e||(c.LogVerbosity=e={})),function(a){a[a.DEADLINE=1]="DEADLINE",a[a.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",a[a.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",a[a.CANCELLATION=8]="CANCELLATION",a[a.DEFAULTS=65535]="DEFAULTS"}(f||(c.Propagate=f={})),c.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,c.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},5365,(a,b,c)=>{b.exports=a.x("process",()=>require("process"))},17887,a=>{a.v({name:"@grpc/grpc-js",version:"1.9.15",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]})},11717,(a,b,c)=>{"use strict";var d,e,f,g;Object.defineProperty(c,"__esModule",{value:!0}),c.isTracerEnabled=c.trace=c.log=c.setLoggerVerbosity=c.setLogger=c.getLogger=void 0;let h=a.r(57982),i=a.r(5365),j=a.r(17887).version,k={error:(a,...b)=>{console.error("E "+a,...b)},info:(a,...b)=>{console.error("I "+a,...b)},debug:(a,...b)=>{console.error("D "+a,...b)}},l=h.LogVerbosity.ERROR;switch((null!=(e=null!=(d=process.env.GRPC_NODE_VERBOSITY)?d:process.env.GRPC_VERBOSITY)?e:"").toUpperCase()){case"DEBUG":l=h.LogVerbosity.DEBUG;break;case"INFO":l=h.LogVerbosity.INFO;break;case"ERROR":l=h.LogVerbosity.ERROR;break;case"NONE":l=h.LogVerbosity.NONE}c.getLogger=()=>k,c.setLogger=a=>{k=a},c.setLoggerVerbosity=a=>{l=a},c.log=(a,...b)=>{let c;if(a>=l){switch(a){case h.LogVerbosity.DEBUG:c=k.debug;break;case h.LogVerbosity.INFO:c=k.info;break;case h.LogVerbosity.ERROR:c=k.error}c||(c=k.error),c&&c.bind(k)(...b)}};let m=null!=(g=null!=(f=process.env.GRPC_NODE_TRACE)?f:process.env.GRPC_TRACE)?g:"",n=new Set,o=new Set;for(let a of m.split(","))a.startsWith("-")?o.add(a.substring(1)):n.add(a);let p=n.has("all");function q(a,b,d){r(b)&&(0,c.log)(a,new Date().toISOString()+" | v"+j+" "+i.pid+" | "+b+" | "+d)}function r(a){return!o.has(a)&&(p||n.has(a))}c.trace=q,c.isTracerEnabled=r},21015,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getErrorCode=c.getErrorMessage=void 0,c.getErrorMessage=function(a){return a instanceof Error?a.message:String(a)},c.getErrorCode=function(a){return"object"==typeof a&&null!==a&&"code"in a&&"number"==typeof a.code?a.code:null}},57904,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Metadata=void 0;let d=a.r(11717),e=a.r(57982),f=a.r(21015),g=/^[0-9a-z_.-]+$/,h=/^[ -~]*$/;function i(a){return g.test(a)}function j(a){return h.test(a)}function k(a){return a.endsWith("-bin")}function l(a){return!a.startsWith("grpc-")}function m(a){return a.toLowerCase()}function n(a,b){if(!i(a))throw Error('Metadata key "'+a+'" contains illegal characters');if(null!=b)if(k(a)){if(!Buffer.isBuffer(b))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(b))throw Error("keys that don't end with '-bin' must have String values");if(!j(b))throw Error('Metadata string value "'+b+'" contains illegal characters')}}class o{constructor(a={}){this.internalRepr=new Map,this.options=a}set(a,b){n(a=m(a),b),this.internalRepr.set(a,[b])}add(a,b){n(a=m(a),b);let c=this.internalRepr.get(a);void 0===c?this.internalRepr.set(a,[b]):c.push(b)}remove(a){a=m(a),this.internalRepr.delete(a)}get(a){return a=m(a),this.internalRepr.get(a)||[]}getMap(){let a={};for(let[b,c]of this.internalRepr)if(c.length>0){let d=c[0];a[b]=Buffer.isBuffer(d)?Buffer.from(d):d}return a}clone(){let a=new o(this.options),b=a.internalRepr;for(let[a,c]of this.internalRepr){let d=c.map(a=>Buffer.isBuffer(a)?Buffer.from(a):a);b.set(a,d)}return a}merge(a){for(let[b,c]of a.internalRepr){let a=(this.internalRepr.get(b)||[]).concat(c);this.internalRepr.set(b,a)}}setOptions(a){this.options=a}getOptions(){return this.options}toHttp2Headers(){let a={};for(let[b,c]of this.internalRepr)a[b]=c.map(p);return a}toJSON(){let a={};for(let[b,c]of this.internalRepr)a[b]=c;return a}static fromHttp2Headers(a){let b=new o;for(let c of Object.keys(a)){if(":"===c.charAt(0))continue;let g=a[c];try{k(c)?Array.isArray(g)?g.forEach(a=>{b.add(c,Buffer.from(a,"base64"))}):void 0!==g&&(l(c)?g.split(",").forEach(a=>{b.add(c,Buffer.from(a.trim(),"base64"))}):b.add(c,Buffer.from(g,"base64"))):Array.isArray(g)?g.forEach(a=>{b.add(c,a)}):void 0!==g&&b.add(c,g)}catch(b){let a=`Failed to add metadata entry ${c}: ${g}. ${(0,f.getErrorMessage)(b)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,d.log)(e.LogVerbosity.ERROR,a)}}return b}}c.Metadata=o;let p=a=>Buffer.isBuffer(a)?a.toString("base64"):a},20574,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CallCredentials=void 0;let d=a.r(57904);function e(a){return"getRequestHeaders"in a&&"function"==typeof a.getRequestHeaders}class f{static createFromMetadataGenerator(a){return new h(a)}static createFromGoogleCredential(a){return f.createFromMetadataGenerator((b,c)=>{let f;(f=e(a)?a.getRequestHeaders(b.service_url):new Promise((c,d)=>{a.getRequestMetadata(b.service_url,(a,b)=>{a?d(a):b?c(b):d(Error("Headers not set by metadata plugin"))})})).then(a=>{let b=new d.Metadata;for(let c of Object.keys(a))b.add(c,a[c]);c(null,b)},a=>{c(a)})})}static createEmpty(){return new i}}c.CallCredentials=f;class g extends f{constructor(a){super(),this.creds=a}async generateMetadata(a){let b=new d.Metadata;for(let c of(await Promise.all(this.creds.map(b=>b.generateMetadata(a)))))b.merge(c);return b}compose(a){return new g(this.creds.concat([a]))}_equals(a){return this===a||a instanceof g&&this.creds.every((b,c)=>b._equals(a.creds[c]))}}class h extends f{constructor(a){super(),this.metadataGenerator=a}generateMetadata(a){return new Promise((b,c)=>{this.metadataGenerator(a,(a,d)=>{void 0!==d?b(d):c(a)})})}compose(a){return new g([this,a])}_equals(a){return this===a||a instanceof h&&this.metadataGenerator===a.metadataGenerator}}class i extends f{generateMetadata(a){return Promise.resolve(new d.Metadata)}compose(a){return a}_equals(a){return a instanceof i}}},55004,(a,b,c)=>{b.exports=a.x("tls",()=>require("tls"))},22734,(a,b,c)=>{b.exports=a.x("fs",()=>require("fs"))},49229,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getDefaultRootsData=c.CIPHER_SUITES=void 0;let d=a.r(22734);c.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let e=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,f=null;c.getDefaultRootsData=function(){return e?(null===f&&(f=d.readFileSync(e)),f):null}},61591,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ChannelCredentials=void 0;let d=a.r(55004),e=a.r(20574),f=a.r(49229);function g(a,b){if(a&&!(a instanceof Buffer))throw TypeError(`${b}, if provided, must be a Buffer.`)}class h{constructor(a){this.callCredentials=a||e.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(a,b,c,e){var h;if(g(a,"Root certificate"),g(b,"Private key"),g(c,"Certificate chain"),b&&!c)throw Error("Private key must be given with accompanying certificate chain");if(!b&&c)throw Error("Certificate chain must be given with accompanying private key");return new j((0,d.createSecureContext)({ca:null!=(h=null!=a?a:(0,f.getDefaultRootsData)())?h:void 0,key:null!=b?b:void 0,cert:null!=c?c:void 0,ciphers:f.CIPHER_SUITES}),null!=e?e:{})}static createFromSecureContext(a,b){return new j(a,null!=b?b:{})}static createInsecure(){return new i}}c.ChannelCredentials=h;class i extends h{constructor(a){super(a)}compose(a){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(a){return a instanceof i}}class j extends h{constructor(a,b){super(),this.secureContext=a,this.verifyOptions=b,this.connectionOptions={secureContext:a},(null==b?void 0:b.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=b.checkServerIdentity)}compose(a){return new k(this,this.callCredentials.compose(a))}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(a){return this===a||a instanceof j&&this.secureContext===a.secureContext&&this.verifyOptions.checkServerIdentity===a.verifyOptions.checkServerIdentity}}class k extends h{constructor(a,b){super(b),this.channelCredentials=a}compose(a){let b=this.callCredentials.compose(a);return new k(this.channelCredentials,b)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(a){return this===a||a instanceof k&&this.channelCredentials._equals(a.channelCredentials)&&this.callCredentials._equals(a.callCredentials)}}},39071,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.validateLoadBalancingConfig=c.getFirstUsableConfig=c.isLoadBalancerNameRegistered=c.createLoadBalancer=c.registerDefaultLoadBalancerType=c.registerLoadBalancerType=c.createChildChannelControlHelper=void 0,c.createChildChannelControlHelper=function(a,b){var c,d,e,f,g,h,i,j,k,l;return{createSubchannel:null!=(d=null==(c=b.createSubchannel)?void 0:c.bind(b))?d:a.createSubchannel.bind(a),updateState:null!=(f=null==(e=b.updateState)?void 0:e.bind(b))?f:a.updateState.bind(a),requestReresolution:null!=(h=null==(g=b.requestReresolution)?void 0:g.bind(b))?h:a.requestReresolution.bind(a),addChannelzChild:null!=(j=null==(i=b.addChannelzChild)?void 0:i.bind(b))?j:a.addChannelzChild.bind(a),removeChannelzChild:null!=(l=null==(k=b.removeChannelzChild)?void 0:k.bind(b))?l:a.removeChannelzChild.bind(a)}};let d={},e=null;c.registerLoadBalancerType=function(a,b,c){d[a]={LoadBalancer:b,LoadBalancingConfig:c}},c.registerDefaultLoadBalancerType=function(a){e=a},c.createLoadBalancer=function(a,b){let c=a.getLoadBalancerName();return c in d?new d[c].LoadBalancer(b):null},c.isLoadBalancerNameRegistered=function(a){return a in d},c.getFirstUsableConfig=function(a,b=!1){for(let b of a)if(b.getLoadBalancerName()in d)return b;return b&&e?new d[e].LoadBalancingConfig:null},c.validateLoadBalancingConfig=function(a){if(null===a||"object"!=typeof a)throw Error("Load balancing config must be an object");let b=Object.keys(a);if(1!==b.length)throw Error("Provided load balancing config has multiple conflicting entries");let c=b[0];if(c in d)return d[c].LoadBalancingConfig.createFromJson(a[c]);throw Error(`Unrecognized load balancing config name ${c}`)}},46786,(a,b,c)=>{b.exports=a.x("os",()=>require("os"))},83931,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.extractAndSelectServiceConfig=c.validateServiceConfig=c.validateRetryThrottling=void 0;let d=a.r(46786),e=a.r(57982),f=a.r(39071),g=/^\d+(\.\d{1,9})?s$/,h="node";function i(a){if("service"in a&&""!==a.service){if("string"!=typeof a.service)throw Error(`Invalid method config name: invalid service: expected type string, got ${typeof a.service}`);if(!("method"in a)||""===a.method)return{service:a.service};if("string"!=typeof a.method)throw Error(`Invalid method config name: invalid method: expected type string, got ${typeof a.service}`);return{service:a.service,method:a.method}}if("method"in a&&void 0!==a.method)throw Error("Invalid method config name: method set with empty or unset service");return{}}function j(a){if(!("maxAttempts"in a)||!Number.isInteger(a.maxAttempts)||a.maxAttempts<2)throw Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in a)||"string"!=typeof a.initialBackoff||!g.test(a.initialBackoff))throw Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in a)||"string"!=typeof a.maxBackoff||!g.test(a.maxBackoff))throw Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in a)||"number"!=typeof a.backoffMultiplier||a.backoffMultiplier<=0)throw Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in a&&Array.isArray(a.retryableStatusCodes)))throw Error("Invalid method config retry policy: retryableStatusCodes is required");if(0===a.retryableStatusCodes.length)throw Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let b of a.retryableStatusCodes)if("number"==typeof b){if(!Object.values(e.Status).includes(b))throw Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if("string"==typeof b){if(!Object.values(e.Status).includes(b.toUpperCase()))throw Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:a.maxAttempts,initialBackoff:a.initialBackoff,maxBackoff:a.maxBackoff,backoffMultiplier:a.backoffMultiplier,retryableStatusCodes:a.retryableStatusCodes}}function k(a){if(!("maxAttempts"in a)||!Number.isInteger(a.maxAttempts)||a.maxAttempts<2)throw Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in a&&("string"!=typeof a.hedgingDelay||!g.test(a.hedgingDelay)))throw Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in a&&Array.isArray(a.nonFatalStatusCodes))for(let b of a.nonFatalStatusCodes)if("number"==typeof b){if(!Object.values(e.Status).includes(b))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if("string"==typeof b){if(!Object.values(e.Status).includes(b.toUpperCase()))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let b={maxAttempts:a.maxAttempts};return a.hedgingDelay&&(b.hedgingDelay=a.hedgingDelay),a.nonFatalStatusCodes&&(b.nonFatalStatusCodes=a.nonFatalStatusCodes),b}function l(a){var b;let c={name:[]};if(!("name"in a)||!Array.isArray(a.name))throw Error("Invalid method config: invalid name array");for(let b of a.name)c.name.push(i(b));if("waitForReady"in a){if("boolean"!=typeof a.waitForReady)throw Error("Invalid method config: invalid waitForReady");c.waitForReady=a.waitForReady}if("timeout"in a)if("object"==typeof a.timeout){if(!("seconds"in a.timeout)||"number"!=typeof a.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in a.timeout)||"number"!=typeof a.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");c.timeout=a.timeout}else if("string"==typeof a.timeout&&g.test(a.timeout)){let d=a.timeout.substring(0,a.timeout.length-1).split(".");c.timeout={seconds:0|d[0],nanos:(null!=(b=d[1])?b:0)|0}}else throw Error("Invalid method config: invalid timeout");if("maxRequestBytes"in a){if("number"!=typeof a.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");c.maxRequestBytes=a.maxRequestBytes}if("maxResponseBytes"in a){if("number"!=typeof a.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");c.maxResponseBytes=a.maxResponseBytes}if("retryPolicy"in a)if("hedgingPolicy"in a)throw Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");else c.retryPolicy=j(a.retryPolicy);else"hedgingPolicy"in a&&(c.hedgingPolicy=k(a.hedgingPolicy));return c}function m(a){if(!("maxTokens"in a)||"number"!=typeof a.maxTokens||a.maxTokens<=0||a.maxTokens>1e3)throw Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in a)||"number"!=typeof a.tokenRatio||a.tokenRatio<=0)throw Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+a.maxTokens.toFixed(3),tokenRatio:+a.tokenRatio.toFixed(3)}}function n(a){let b={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in a)if("string"==typeof a.loadBalancingPolicy)b.loadBalancingPolicy=a.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in a)if(Array.isArray(a.loadBalancingConfig))for(let c of a.loadBalancingConfig)b.loadBalancingConfig.push((0,f.validateLoadBalancingConfig)(c));else throw Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in a&&Array.isArray(a.methodConfig))for(let c of a.methodConfig)b.methodConfig.push(l(c));"retryThrottling"in a&&(b.retryThrottling=m(a.retryThrottling));let c=[];for(let a of b.methodConfig)for(let b of a.name){for(let a of c)if(b.service===a.service&&b.method===a.method)throw Error(`Invalid service config: duplicate name ${b.service}/${b.method}`);c.push(b)}return b}function o(a){if(!("serviceConfig"in a))throw Error("Invalid service config choice: missing service config");let b={serviceConfig:n(a.serviceConfig)};if("clientLanguage"in a)if(Array.isArray(a.clientLanguage))for(let c of(b.clientLanguage=[],a.clientLanguage))if("string"==typeof c)b.clientLanguage.push(c);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in a)if(Array.isArray(a.clientHostname))for(let c of(b.clientHostname=[],a.clientHostname))if("string"==typeof c)b.clientHostname.push(c);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname");if("percentage"in a)if("number"==typeof a.percentage&&0<=a.percentage&&a.percentage<=100)b.percentage=a.percentage;else throw Error("Invalid service config choice: invalid percentage");let c=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let b in a)if(!c.includes(b))throw Error(`Invalid service config choice: unexpected field ${b}`);return b}function p(a,b){if(!Array.isArray(a))throw Error("Invalid service config list");for(let c of a){let a=o(c);if("number"!=typeof a.percentage||!(b>a.percentage)){if(Array.isArray(a.clientHostname)){let b=!1;for(let c of a.clientHostname)c===d.hostname()&&(b=!0);if(!b)continue}if(Array.isArray(a.clientLanguage)){let b=!1;for(let c of a.clientLanguage)c===h&&(b=!0);if(!b)continue}return a.serviceConfig}}throw Error("No matching service config found")}c.validateRetryThrottling=m,c.validateServiceConfig=n,c.extractAndSelectServiceConfig=function(a,b){for(let c of a)if(c.length>0&&c[0].startsWith("grpc_config="))return p(JSON.parse(c.join("").substring(12)),b);return null}},56537,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.ConnectivityState=void 0,function(a){a[a.IDLE=0]="IDLE",a[a.CONNECTING=1]="CONNECTING",a[a.READY=2]="READY",a[a.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",a[a.SHUTDOWN=4]="SHUTDOWN"}(d||(c.ConnectivityState=d={}))},55647,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.uriToString=c.splitHostPort=c.parseUri=void 0;let d=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;c.parseUri=function(a){let b=d.exec(a);return null===b?null:{scheme:b[1],authority:b[2],path:b[3]}};let e=/^\d+$/;c.splitHostPort=function(a){if(a.startsWith("[")){let b=a.indexOf("]");if(-1===b)return null;let c=a.substring(1,b);if(-1===c.indexOf(":"))return null;if(!(a.length>b+1))return{host:c};if(":"!==a[b+1])return null;{let d=a.substring(b+2);return e.test(d)?{host:c,port:+d}:null}}{let b=a.split(":");return 2!==b.length?{host:a}:e.test(b[1])?{host:b[0],port:+b[1]}:null}},c.uriToString=function(a){let b="";return void 0!==a.scheme&&(b+=a.scheme+":"),void 0!==a.authority&&(b+="//"+a.authority+"/"),b+=a.path}},49845,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.mapUriDefaultScheme=c.getDefaultAuthority=c.createResolver=c.registerDefaultScheme=c.registerResolver=void 0;let d=a.r(55647),e={},f=null;c.registerResolver=function(a,b){e[a]=b},c.registerDefaultScheme=function(a){f=a},c.createResolver=function(a,b,c){if(void 0!==a.scheme&&a.scheme in e)return new e[a.scheme](a,b,c);throw Error(`No resolver could be created for target ${(0,d.uriToString)(a)}`)},c.getDefaultAuthority=function(a){if(void 0!==a.scheme&&a.scheme in e)return e[a.scheme].getDefaultAuthority(a);throw Error(`Invalid target ${(0,d.uriToString)(a)}`)},c.mapUriDefaultScheme=function(a){if(void 0===a.scheme||!(a.scheme in e))if(null!==f)return{scheme:f,authority:void 0,path:(0,d.uriToString)(a)};else return null;return a}},3681,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.QueuePicker=c.UnavailablePicker=c.PickResultType=void 0;let e=a.r(57904),f=a.r(57982);!function(a){a[a.COMPLETE=0]="COMPLETE",a[a.QUEUE=1]="QUEUE",a[a.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",a[a.DROP=3]="DROP"}(d||(c.PickResultType=d={}));class g{constructor(a){this.status=Object.assign({code:f.Status.UNAVAILABLE,details:"No connection established",metadata:new e.Metadata},a)}pick(a){return{pickResultType:d.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}}c.UnavailablePicker=g;class h{constructor(a){this.loadBalancer=a,this.calledExitIdle=!1}pick(a){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:d.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}}c.QueuePicker=h},57451,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BackoffTimeout=void 0;let d=1e3,e=1.6,f=12e4,g=.2;function h(a,b){return Math.random()*(b-a)+a}class i{constructor(a,b){this.callback=a,this.initialDelay=d,this.multiplier=e,this.maxDelay=f,this.jitter=g,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,b&&(b.initialDelay&&(this.initialDelay=b.initialDelay),b.multiplier&&(this.multiplier=b.multiplier),b.jitter&&(this.jitter=b.jitter),b.maxDelay&&(this.maxDelay=b.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(a){var b,c;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},a),this.hasRef||null==(c=(b=this.timerId).unref)||c.call(b)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let a=Math.min(this.nextDelay*this.multiplier,this.maxDelay),b=a*this.jitter;this.nextDelay=a+h(-b,b)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let a=new Date,b=this.startTime;b.setMilliseconds(b.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),a<b?this.runTimer(b.getTime()-a.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var a,b;this.hasRef=!0,null==(b=(a=this.timerId).ref)||b.call(a)}unref(){var a,b;this.hasRef=!1,null==(b=(a=this.timerId).unref)||b.call(a)}getEndTime(){return this.endTime}}c.BackoffTimeout=i},33140,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ChildLoadBalancerHandler=void 0;let d=a.r(39071),e=a.r(56537),f="child_load_balancer_helper";class g{constructor(a){this.channelControlHelper=a,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(a){this.parent=a,this.child=null}createSubchannel(a,b){return this.parent.channelControlHelper.createSubchannel(a,b)}updateState(a,b){var c;if(this.calledByPendingChild()){if(a===e.ConnectivityState.CONNECTING)return;null==(c=this.parent.currentChild)||c.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(a,b)}requestReresolution(){var a;let b=null!=(a=this.parent.pendingChild)?a:this.parent.currentChild;this.child===b&&this.parent.channelControlHelper.requestReresolution()}setChild(a){this.child=a}addChannelzChild(a){this.parent.channelControlHelper.addChannelzChild(a)}removeChannelzChild(a){this.parent.channelControlHelper.removeChannelzChild(a)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(a,b){return a.getLoadBalancerName()!==b.getLoadBalancerName()}updateAddressList(a,b,c){let e;if(null===this.currentChild||null===this.latestConfig||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,b)){let a=new this.ChildPolicyHelper(this),c=(0,d.createLoadBalancer)(b,a);a.setChild(c),null===this.currentChild?(this.currentChild=c,e=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=c,e=this.pendingChild)}else e=null===this.pendingChild?this.currentChild:this.pendingChild;this.latestConfig=b,e.updateAddressList(a,b,c)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return f}}c.ChildLoadBalancerHandler=g},74765,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ResolvingLoadBalancer=void 0;let d=a.r(39071),e=a.r(83931),f=a.r(56537),g=a.r(49845),h=a.r(3681),i=a.r(57451),j=a.r(57982),k=a.r(57904),l=a.r(11717),m=a.r(57982),n=a.r(55647),o=a.r(33140),p="resolving_load_balancer";function q(a){l.trace(m.LogVerbosity.DEBUG,p,a)}let r=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function s(a,b,c,d){for(let e of c.name)switch(d){case"EMPTY":if(!e.service&&!e.method)return!0;break;case"SERVICE":if(e.service===a&&!e.method)return!0;break;case"SERVICE_AND_METHOD":if(e.service===a&&e.method===b)return!0}return!1}function t(a,b,c,d){for(let e of c)if(s(a,b,e,d))return e;return null}function u(a){return function(b,c){var d,e;let f=b.split("/").filter(a=>a.length>0),g=null!=(d=f[0])?d:"",h=null!=(e=f[1])?e:"";if(a&&a.methodConfig)for(let b of r){let c=t(g,h,a.methodConfig,b);if(c)return{methodConfig:c,pickInformation:{},status:j.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:j.Status.OK,dynamicFilterFactories:[]}}}class v{constructor(a,b,c,l,m){this.target=a,this.channelControlHelper=b,this.onSuccessfulResolution=l,this.onFailedResolution=m,this.latestChildState=f.ConnectivityState.IDLE,this.latestChildPicker=new h.QueuePicker(this),this.currentState=f.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,c["grpc.service_config"]?this.defaultServiceConfig=(0,e.validateServiceConfig)(JSON.parse(c["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(f.ConnectivityState.IDLE,new h.QueuePicker(this)),this.childLoadBalancer=new o.ChildLoadBalancerHandler({createSubchannel:b.createSubchannel.bind(b),requestReresolution:()=>{this.backoffTimeout.isRunning()?(q("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,b)=>{this.latestChildState=a,this.latestChildPicker=b,this.updateState(a,b)},addChannelzChild:b.addChannelzChild.bind(b),removeChannelzChild:b.removeChannelzChild.bind(b)}),this.innerResolver=(0,g.createResolver)(a,{onSuccessfulResolution:(a,b,c,e,f)=>{var g;this.backoffTimeout.stop(),this.backoffTimeout.reset();let h=null;null===b?null===c?(this.previousServiceConfig=null,h=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(c):h=this.previousServiceConfig:(h=b,this.previousServiceConfig=b);let i=null!=(g=null==h?void 0:h.loadBalancingConfig)?g:[],l=(0,d.getFirstUsableConfig)(i,!0);if(null===l)return void this.handleResolutionFailure({code:j.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new k.Metadata});this.childLoadBalancer.updateAddressList(a,l,f);let m=null!=h?h:this.defaultServiceConfig;this.onSuccessfulResolution(m,null!=e?e:u(m))},onError:a=>{this.handleResolutionFailure(a)}},c);const n={initialDelay:c["grpc.initial_reconnect_backoff_ms"],maxDelay:c["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new i.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},n),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===f.ConnectivityState.IDLE&&this.updateState(f.ConnectivityState.CONNECTING,new h.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(a,b){q((0,n.uriToString)(this.target)+" "+f.ConnectivityState[this.currentState]+" -> "+f.ConnectivityState[a]),a===f.ConnectivityState.IDLE&&(b=new h.QueuePicker(this)),this.currentState=a,this.channelControlHelper.updateState(a,b)}handleResolutionFailure(a){this.latestChildState===f.ConnectivityState.IDLE&&(this.updateState(f.ConnectivityState.TRANSIENT_FAILURE,new h.UnavailablePicker(a)),this.onFailedResolution(a))}exitIdle(){(this.currentState===f.ConnectivityState.IDLE||this.currentState===f.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(a,b){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=f.ConnectivityState.IDLE,this.latestChildPicker=new h.QueuePicker(this),this.currentState=f.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}}c.ResolvingLoadBalancer=v},69359,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.channelOptionsEqual=c.recognizedOptions=void 0,c.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0},c.channelOptionsEqual=function(a,b){let c=Object.keys(a).sort(),d=Object.keys(b).sort();if(c.length!==d.length)return!1;for(let e=0;e<c.length;e+=1)if(c[e]!==d[e]||a[c[e]]!==b[d[e]])return!1;return!0}},4446,(a,b,c)=>{b.exports=a.x("net",()=>require("net"))},91177,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.stringToSubchannelAddress=c.subchannelAddressToString=c.subchannelAddressEqual=c.isTcpSubchannelAddress=void 0;let d=a.r(4446);function e(a){return"port"in a}c.isTcpSubchannelAddress=e,c.subchannelAddressEqual=function(a,b){return!a&&!b||!!a&&!!b&&(e(a)?e(b)&&a.host===b.host&&a.port===b.port:!e(b)&&a.path===b.path)},c.subchannelAddressToString=function(a){return e(a)?a.host+":"+a.port:a.path};let f=443;c.stringToSubchannelAddress=function(a,b){return(0,d.isIP)(a)?{host:a,port:null!=b?b:f}:{path:a}}},31509,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.addAdminServicesToServer=c.registerAdminService=void 0;let d=[];c.registerAdminService=function(a,b){d.push({getServiceDefinition:a,getHandlers:b})},c.addAdminServicesToServer=function(a){for(let{getServiceDefinition:b,getHandlers:c}of d)a.addService(b(),c())}},27699,(a,b,c)=>{b.exports=a.x("events",()=>require("events"))},88947,(a,b,c)=>{b.exports=a.x("stream",()=>require("stream"))},51985,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ClientDuplexStreamImpl=c.ClientWritableStreamImpl=c.ClientReadableStreamImpl=c.ClientUnaryCallImpl=c.callErrorFromStatus=void 0;let d=a.r(27699),e=a.r(88947),f=a.r(57982);c.callErrorFromStatus=function(a,b){let c=`${a.code} ${f.Status[a.code]}: ${a.details}`,d=Error(c),e=`${d.stack}
for call at
${b}`;return Object.assign(Error(c),a,{stack:e})};class g extends d.EventEmitter{constructor(){super()}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}}c.ClientUnaryCallImpl=g;class h extends e.Readable{constructor(a){super({objectMode:!0}),this.deserialize=a}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}_read(a){var b;null==(b=this.call)||b.startRead()}}c.ClientReadableStreamImpl=h;class i extends e.Writable{constructor(a){super({objectMode:!0}),this.serialize=a}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}_write(a,b,c){var d;let e={callback:c},f=Number(b);Number.isNaN(f)||(e.flags=f),null==(d=this.call)||d.sendMessageWithContext(e,a)}_final(a){var b;null==(b=this.call)||b.halfClose(),a()}}c.ClientWritableStreamImpl=i;class j extends e.Duplex{constructor(a,b){super({objectMode:!0}),this.serialize=a,this.deserialize=b}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}_read(a){var b;null==(b=this.call)||b.startRead()}_write(a,b,c){var d;let e={callback:c},f=Number(b);Number.isNaN(f)||(e.flags=f),null==(d=this.call)||d.sendMessageWithContext(e,a)}_final(a){var b;null==(b=this.call)||b.halfClose(),a()}}c.ClientDuplexStreamImpl=j},5628,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.InterceptingListenerImpl=c.isInterceptingListener=void 0,c.isInterceptingListener=function(a){return void 0!==a.onReceiveMetadata&&1===a.onReceiveMetadata.length};class d{constructor(a,b){this.listener=a,this.nextListener=b,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(a){this.processingMetadata=!0,this.listener.onReceiveMetadata(a,a=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(a),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(a){this.processingMessage=!0,this.listener.onReceiveMessage(a,a=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=a,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(a),this.processPendingStatus())})}onReceiveStatus(a){this.listener.onReceiveStatus(a,a=>{this.processingMetadata||this.processingMessage?this.pendingStatus=a:this.nextListener.onReceiveStatus(a)})}}c.InterceptingListenerImpl=d},83278,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getInterceptingCall=c.InterceptingCall=c.RequesterBuilder=c.ListenerBuilder=c.InterceptorConfigurationError=void 0;let d=a.r(57904),e=a.r(5628),f=a.r(57982),g=a.r(21015);class h extends Error{constructor(a){super(a),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,h)}}c.InterceptorConfigurationError=h;class i{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(a){return this.metadata=a,this}withOnReceiveMessage(a){return this.message=a,this}withOnReceiveStatus(a){return this.status=a,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}c.ListenerBuilder=i;class j{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(a){return this.start=a,this}withSendMessage(a){return this.message=a,this}withHalfClose(a){return this.halfClose=a,this}withCancel(a){return this.cancel=a,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}c.RequesterBuilder=j;let k=(a,b)=>{b(a)},l=(a,b)=>{b(a)},m=(a,b)=>{b(a)},n={start:(a,b,c)=>{c(a,b)},sendMessage:(a,b)=>{b(a)},halfClose:a=>{a()},cancel:a=>{a()}};class o{constructor(a,b){var c,d,e,f;this.nextCall=a,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,b?this.requester={start:null!=(c=b.start)?c:n.start,sendMessage:null!=(d=b.sendMessage)?d:n.sendMessage,halfClose:null!=(e=b.halfClose)?e:n.halfClose,cancel:null!=(f=b.cancel)?f:n.cancel}:this.requester=n}cancelWithStatus(a,b){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(a,b)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(a,b){var c,d,f,g,h,i;let j={onReceiveMetadata:null!=(d=null==(c=null==b?void 0:b.onReceiveMetadata)?void 0:c.bind(b))?d:a=>{},onReceiveMessage:null!=(g=null==(f=null==b?void 0:b.onReceiveMessage)?void 0:f.bind(b))?g:a=>{},onReceiveStatus:null!=(i=null==(h=null==b?void 0:b.onReceiveStatus)?void 0:h.bind(b))?i:a=>{}};this.processingMetadata=!0,this.requester.start(a,j,(a,b)=>{var c,d,f;let g;if(this.processingMetadata=!1,(0,e.isInterceptingListener)(b))g=b;else{let a={onReceiveMetadata:null!=(c=b.onReceiveMetadata)?c:k,onReceiveMessage:null!=(d=b.onReceiveMessage)?d:l,onReceiveStatus:null!=(f=b.onReceiveStatus)?f:m};g=new e.InterceptingListenerImpl(a,j)}this.nextCall.start(a,g),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(a,b){this.processingMessage=!0,this.requester.sendMessage(b,c=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=a,this.pendingMessage=b):(this.nextCall.sendMessageWithContext(a,c),this.processPendingHalfClose())})}sendMessage(a){this.sendMessageWithContext({},a)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}}function p(a,b,c){var d,e;let f=null!=(d=c.deadline)?d:1/0,g=c.host,h=null!=(e=c.parent)?e:null,i=c.propagate_flags,j=c.credentials,k=a.createCall(b,f,g,h,i);return j&&k.setCredentials(j),k}c.InterceptingCall=o;class q{constructor(a,b){this.call=a,this.methodDefinition=b}cancelWithStatus(a,b){this.call.cancelWithStatus(a,b)}getPeer(){return this.call.getPeer()}sendMessageWithContext(a,b){let c;try{c=this.methodDefinition.requestSerialize(b)}catch(a){this.call.cancelWithStatus(f.Status.INTERNAL,`Request message serialization failure: ${(0,g.getErrorMessage)(a)}`);return}this.call.sendMessageWithContext(a,c)}sendMessage(a){this.sendMessageWithContext({},a)}start(a,b){let c=null;this.call.start(a,{onReceiveMetadata:a=>{var c;null==(c=null==b?void 0:b.onReceiveMetadata)||c.call(b,a)},onReceiveMessage:a=>{var e;let h;try{h=this.methodDefinition.responseDeserialize(a)}catch(a){c={code:f.Status.INTERNAL,details:`Response message parsing error: ${(0,g.getErrorMessage)(a)}`,metadata:new d.Metadata},this.call.cancelWithStatus(c.code,c.details);return}null==(e=null==b?void 0:b.onReceiveMessage)||e.call(b,h)},onReceiveStatus:a=>{var d,e;c?null==(d=null==b?void 0:b.onReceiveStatus)||d.call(b,c):null==(e=null==b?void 0:b.onReceiveStatus)||e.call(b,a)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}}class r extends q{constructor(a,b){super(a,b)}start(a,b){var c,d;let e=!1,f={onReceiveMetadata:null!=(d=null==(c=null==b?void 0:b.onReceiveMetadata)?void 0:c.bind(b))?d:a=>{},onReceiveMessage:a=>{var c;e=!0,null==(c=null==b?void 0:b.onReceiveMessage)||c.call(b,a)},onReceiveStatus:a=>{var c,d;e||null==(c=null==b?void 0:b.onReceiveMessage)||c.call(b,null),null==(d=null==b?void 0:b.onReceiveStatus)||d.call(b,a)}};super.start(a,f),this.call.startRead()}}class s extends q{}function t(a,b,c){let d=p(a,c.path,b);return c.responseStream?new s(d,c):new r(d,c)}c.getInterceptingCall=function(a,b,c,d){if(a.clientInterceptors.length>0&&a.clientInterceptorProviders.length>0)throw new h("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(a.callInterceptors.length>0&&a.callInterceptorProviders.length>0)throw new h("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let e=[];e=a.callInterceptors.length>0||a.callInterceptorProviders.length>0?[].concat(a.callInterceptors,a.callInterceptorProviders.map(a=>a(b))).filter(a=>a):[].concat(a.clientInterceptors,a.clientInterceptorProviders.map(a=>a(b))).filter(a=>a);let f=Object.assign({},c,{method_definition:b});return e.reduceRight((a,b)=>c=>b(c,a),a=>t(d,a,b))(f)}},19856,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Client=void 0;let d=a.r(51985),e=a.r(61655),f=a.r(56537),g=a.r(57982),h=a.r(57904),i=a.r(83278),j=Symbol(),k=Symbol(),l=Symbol(),m=Symbol();function n(a){return"function"==typeof a}function o(a){return a.stack.split("\n").slice(1).join("\n")}class p{constructor(a,b,c={}){var d,f;if(c=Object.assign({},c),this[k]=null!=(d=c.interceptors)?d:[],delete c.interceptors,this[l]=null!=(f=c.interceptor_providers)?f:[],delete c.interceptor_providers,this[k].length>0&&this[l].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[m]=c.callInvocationTransformer,delete c.callInvocationTransformer,c.channelOverride)this[j]=c.channelOverride;else if(c.channelFactoryOverride){const d=c.channelFactoryOverride;delete c.channelFactoryOverride,this[j]=d(a,b,c)}else this[j]=new e.ChannelImplementation(a,b,c)}close(){this[j].close()}getChannel(){return this[j]}waitForReady(a,b){let c=d=>{let e;if(d)return void b(Error("Failed to connect before the deadline"));try{e=this[j].getConnectivityState(!0)}catch(a){b(Error("The channel has been closed"));return}if(e===f.ConnectivityState.READY)b();else try{this[j].watchConnectivityState(e,a,c)}catch(a){b(Error("The channel has been closed"))}};setImmediate(c)}checkOptionalUnaryResponseArguments(a,b,c){if(n(a))return{metadata:new h.Metadata,options:{},callback:a};if(n(b))if(a instanceof h.Metadata)return{metadata:a,options:{},callback:b};else return{metadata:new h.Metadata,options:a,callback:b};if(!(a instanceof h.Metadata&&b instanceof Object&&n(c)))throw Error("Incorrect arguments passed");return{metadata:a,options:b,callback:c}}makeUnaryRequest(a,b,c,e,f,h,n){var p,q;let r=this.checkOptionalUnaryResponseArguments(f,h,n),s={path:a,requestStream:!1,responseStream:!1,requestSerialize:b,responseDeserialize:c},t={argument:e,metadata:r.metadata,call:new d.ClientUnaryCallImpl,channel:this[j],methodDefinition:s,callOptions:r.options,callback:r.callback};this[m]&&(t=this[m](t));let u=t.call,v={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(p=t.callOptions.interceptors)?p:[],callInterceptorProviders:null!=(q=t.callOptions.interceptor_providers)?q:[]},w=(0,i.getInterceptingCall)(v,t.methodDefinition,t.callOptions,t.channel);u.call=w;let x=null,y=!1,z=Error();return w.start(t.metadata,{onReceiveMetadata:a=>{u.emit("metadata",a)},onReceiveMessage(a){null!==x&&w.cancelWithStatus(g.Status.INTERNAL,"Too many responses received"),x=a},onReceiveStatus(a){if(!y){if(y=!0,a.code===g.Status.OK)if(null===x){let b=o(z);t.callback((0,d.callErrorFromStatus)({code:g.Status.INTERNAL,details:"No message received",metadata:a.metadata},b))}else t.callback(null,x);else{let b=o(z);t.callback((0,d.callErrorFromStatus)(a,b))}z=null,u.emit("status",a)}}}),w.sendMessage(e),w.halfClose(),u}makeClientStreamRequest(a,b,c,e,f,h){var n,p;let q=this.checkOptionalUnaryResponseArguments(e,f,h),r={path:a,requestStream:!0,responseStream:!1,requestSerialize:b,responseDeserialize:c},s={metadata:q.metadata,call:new d.ClientWritableStreamImpl(b),channel:this[j],methodDefinition:r,callOptions:q.options,callback:q.callback};this[m]&&(s=this[m](s));let t=s.call,u={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(n=s.callOptions.interceptors)?n:[],callInterceptorProviders:null!=(p=s.callOptions.interceptor_providers)?p:[]},v=(0,i.getInterceptingCall)(u,s.methodDefinition,s.callOptions,s.channel);t.call=v;let w=null,x=!1,y=Error();return v.start(s.metadata,{onReceiveMetadata:a=>{t.emit("metadata",a)},onReceiveMessage(a){null!==w&&v.cancelWithStatus(g.Status.INTERNAL,"Too many responses received"),w=a},onReceiveStatus(a){if(!x){if(x=!0,a.code===g.Status.OK)if(null===w){let b=o(y);s.callback((0,d.callErrorFromStatus)({code:g.Status.INTERNAL,details:"No message received",metadata:a.metadata},b))}else s.callback(null,w);else{let b=o(y);s.callback((0,d.callErrorFromStatus)(a,b))}y=null,t.emit("status",a)}}}),t}checkMetadataAndOptions(a,b){let c,d;return a instanceof h.Metadata?(c=a,d=b||{}):(d=a||{},c=new h.Metadata),{metadata:c,options:d}}makeServerStreamRequest(a,b,c,e,f,h){var n,p;let q=this.checkMetadataAndOptions(f,h),r={path:a,requestStream:!1,responseStream:!0,requestSerialize:b,responseDeserialize:c},s={argument:e,metadata:q.metadata,call:new d.ClientReadableStreamImpl(c),channel:this[j],methodDefinition:r,callOptions:q.options};this[m]&&(s=this[m](s));let t=s.call,u={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(n=s.callOptions.interceptors)?n:[],callInterceptorProviders:null!=(p=s.callOptions.interceptor_providers)?p:[]},v=(0,i.getInterceptingCall)(u,s.methodDefinition,s.callOptions,s.channel);t.call=v;let w=!1,x=Error();return v.start(s.metadata,{onReceiveMetadata(a){t.emit("metadata",a)},onReceiveMessage(a){t.push(a)},onReceiveStatus(a){if(!w){if(w=!0,t.push(null),a.code!==g.Status.OK){let b=o(x);t.emit("error",(0,d.callErrorFromStatus)(a,b))}x=null,t.emit("status",a)}}}),v.sendMessage(e),v.halfClose(),t}makeBidiStreamRequest(a,b,c,e,f){var h,n;let p=this.checkMetadataAndOptions(e,f),q={path:a,requestStream:!0,responseStream:!0,requestSerialize:b,responseDeserialize:c},r={metadata:p.metadata,call:new d.ClientDuplexStreamImpl(b,c),channel:this[j],methodDefinition:q,callOptions:p.options};this[m]&&(r=this[m](r));let s=r.call,t={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(h=r.callOptions.interceptors)?h:[],callInterceptorProviders:null!=(n=r.callOptions.interceptor_providers)?n:[]},u=(0,i.getInterceptingCall)(t,r.methodDefinition,r.callOptions,r.channel);s.call=u;let v=!1,w=Error();return u.start(r.metadata,{onReceiveMetadata(a){s.emit("metadata",a)},onReceiveMessage(a){s.push(a)},onReceiveStatus(a){if(!v){if(v=!0,s.push(null),a.code!==g.Status.OK){let b=o(w);s.emit("error",(0,d.callErrorFromStatus)(a,b))}w=null,s.emit("status",a)}}}),s}}c.Client=p},80721,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.loadPackageDefinition=c.makeClientConstructor=void 0;let d=a.r(19856),e={unary:d.Client.prototype.makeUnaryRequest,server_stream:d.Client.prototype.makeServerStreamRequest,client_stream:d.Client.prototype.makeClientStreamRequest,bidi:d.Client.prototype.makeBidiStreamRequest};function f(a){return["__proto__","prototype","constructor"].includes(a)}function g(a,b,c){c||(c={});class g extends d.Client{}return Object.keys(a).forEach(b=>{let c;if(f(b))return;let d=a[b];if("string"==typeof b&&"$"===b.charAt(0))throw Error("Method names cannot start with $");c=d.requestStream?d.responseStream?"bidi":"client_stream":d.responseStream?"server_stream":"unary";let i=d.requestSerialize,j=d.responseDeserialize,k=h(e[c],d.path,i,j);g.prototype[b]=k,Object.assign(g.prototype[b],d),d.originalName&&!f(d.originalName)&&(g.prototype[d.originalName]=g.prototype[b])}),g.service=a,g.serviceName=b,g}function h(a,b,c,d){return function(...e){return a.call(this,b,c,d,...e)}}function i(a){return"format"in a}c.makeClientConstructor=g,c.loadPackageDefinition=function(a){let b={};for(let c in a)if(Object.prototype.hasOwnProperty.call(a,c)){let d=a[c],e=c.split(".");if(e.some(a=>f(a)))continue;let h=e[e.length-1],j=b;for(let a of e.slice(0,-1))j[a]||(j[a]={}),j=j[a];i(d)?j[h]=d:j[h]=g(d,h,{})}return b}},77802,(a,b,c)=>{var d=1/0,e="[object Symbol]",f=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,g=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,h="\\ud800-\\udfff",i="\\u0300-\\u036f\\ufe20-\\ufe23",j="\\u20d0-\\u20f0",k="\\u2700-\\u27bf",l="a-z\\xdf-\\xf6\\xf8-\\xff",m="A-Z\\xc0-\\xd6\\xd8-\\xde",n="\\ufe0e\\ufe0f",o="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",p="[']",q="["+h+"]",r="["+o+"]",s="["+i+j+"]",t="\\d+",u="["+k+"]",v="["+l+"]",w="[^"+h+o+t+k+l+m+"]",x="\\ud83c[\\udffb-\\udfff]",y="[^"+h+"]",z="(?:\\ud83c[\\udde6-\\uddff]){2}",A="[\\ud800-\\udbff][\\udc00-\\udfff]",B="["+m+"]",C="\\u200d",D="(?:"+v+"|"+w+")",E="(?:"+B+"|"+w+")",F="(?:"+p+"(?:d|ll|m|re|s|t|ve))?",G="(?:"+p+"(?:D|LL|M|RE|S|T|VE))?",H="(?:"+s+"|"+x+")?",I="["+n+"]?",J="(?:"+C+"(?:"+[y,z,A].join("|")+")"+I+H+")*",K=I+H+J,L="(?:"+[u,z,A].join("|")+")"+K,M="(?:"+[y+s+"?",s,z,A,q].join("|")+")",N=RegExp(p,"g"),O=RegExp(s,"g"),P=RegExp(x+"(?="+x+")|"+M+K,"g"),Q=RegExp([B+"?"+v+"+"+F+"(?="+[r,B,"$"].join("|")+")",E+"+"+G+"(?="+[r,B+D,"$"].join("|")+")",B+"?"+D+"+"+F,B+"+"+G,t,L].join("|"),"g"),R=RegExp("["+C+h+i+j+n+"]"),S=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,T={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"ss"},U=a.g&&a.g.Object===Object&&a.g,V="object"==typeof self&&self&&self.Object===Object&&self,W=U||V||Function("return this")();function X(a,b,c,d){var e=-1,f=a?a.length:0;for(d&&f&&(c=a[++e]);++e<f;)c=b(c,a[e],e,a);return c}function Y(a){return a.split("")}function Z(a){return a.match(f)||[]}var $=function(a){return function(b){return null==a?void 0:a[b]}}(T);function _(a){return R.test(a)}function aa(a){return S.test(a)}function ab(a){return _(a)?ac(a):Y(a)}function ac(a){return a.match(P)||[]}function ad(a){return a.match(Q)||[]}var ae=Object.prototype.toString,af=W.Symbol,ag=af?af.prototype:void 0,ah=ag?ag.toString:void 0;function ai(a,b,c){var d=-1,e=a.length;b<0&&(b=-b>e?0:e+b),(c=c>e?e:c)<0&&(c+=e),e=b>c?0:c-b>>>0,b>>>=0;for(var f=Array(e);++d<e;)f[d]=a[d+b];return f}function aj(a){if("string"==typeof a)return a;if(an(a))return ah?ah.call(a):"";var b=a+"";return"0"==b&&1/a==-d?"-0":b}function ak(a,b,c){var d=a.length;return c=void 0===c?d:c,!b&&c>=d?a:ai(a,b,c)}function al(a){return function(b){var c=_(b=ao(b))?ab(b):void 0,d=c?c[0]:b.charAt(0),e=c?ak(c,1).join(""):b.slice(1);return d[a]()+e}}function am(a){return!!a&&"object"==typeof a}function an(a){return"symbol"==typeof a||am(a)&&ae.call(a)==e}function ao(a){return null==a?"":aj(a)}var ap=function(a){return function(b){return X(at(ar(b).replace(N,"")),a,"")}}(function(a,b,c){return b=b.toLowerCase(),a+(c?aq(b):b)});function aq(a){return as(ao(a).toLowerCase())}function ar(a){return(a=ao(a))&&a.replace(g,$).replace(O,"")}var as=al("toUpperCase");function at(a,b,c){return(a=ao(a),void 0===(b=c?void 0:b))?aa(a)?ad(a):Z(a):a.match(b)||[]}b.exports=ap},96146,(a,b,c)=>{"use strict";b.exports=function a(a,b){for(var c=Array(arguments.length-1),d=0,e=2,f=!0;e<arguments.length;)c[d++]=arguments[e++];return new Promise(function(e,g){c[d]=function(a){if(f)if(f=!1,a)g(a);else{for(var b=Array(arguments.length-1),c=0;c<b.length;)b[c++]=arguments[c];e.apply(null,b)}};try{a.apply(b||null,c)}catch(a){f&&(f=!1,g(a))}})}},28344,(a,b,c)=>{"use strict";var d=c;d.length=function(a){var b=a.length;if(!b)return 0;for(var c=0;--b%4>1&&"="===a.charAt(b);)++c;return Math.ceil(3*a.length)/4-c};for(var e=Array(64),f=Array(123),g=0;g<64;)f[e[g]=g<26?g+65:g<52?g+71:g<62?g-4:g-59|43]=g++;d.encode=function(a,b,c){for(var d,f=null,g=[],h=0,i=0;b<c;){var j=a[b++];switch(i){case 0:g[h++]=e[j>>2],d=(3&j)<<4,i=1;break;case 1:g[h++]=e[d|j>>4],d=(15&j)<<2,i=2;break;case 2:g[h++]=e[d|j>>6],g[h++]=e[63&j],i=0}h>8191&&((f||(f=[])).push(String.fromCharCode.apply(String,g)),h=0)}return(i&&(g[h++]=e[d],g[h++]=61,1===i&&(g[h++]=61)),f)?(h&&f.push(String.fromCharCode.apply(String,g.slice(0,h))),f.join("")):String.fromCharCode.apply(String,g.slice(0,h))};var h="invalid encoding";d.decode=function(a,b,c){for(var d,e=c,g=0,i=0;i<a.length;){var j=a.charCodeAt(i++);if(61===j&&g>1)break;if(void 0===(j=f[j]))throw Error(h);switch(g){case 0:d=j,g=1;break;case 1:b[c++]=d<<2|(48&j)>>4,d=j,g=2;break;case 2:b[c++]=(15&d)<<4|(60&j)>>2,d=j,g=3;break;case 3:b[c++]=(3&d)<<6|j,g=0}}if(1===g)throw Error(h);return c-e},d.test=function(a){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(a)}},38588,(a,b,c)=>{"use strict";function d(){this._listeners={}}b.exports=d,d.prototype.on=function(a,b,c){return(this._listeners[a]||(this._listeners[a]=[])).push({fn:b,ctx:c||this}),this},d.prototype.off=function(a,b){if(void 0===a)this._listeners={};else if(void 0===b)this._listeners[a]=[];else for(var c=this._listeners[a],d=0;d<c.length;)c[d].fn===b?c.splice(d,1):++d;return this},d.prototype.emit=function(a){var b=this._listeners[a];if(b){for(var c=[],d=1;d<arguments.length;)c.push(arguments[d++]);for(d=0;d<b.length;)b[d].fn.apply(b[d++].ctx,c)}return this}},40830,(a,b,c)=>{"use strict";function d(a){return"u">typeof Float32Array?!function(){var b=new Float32Array([-0]),c=new Uint8Array(b.buffer),d=128===c[3];function e(a,d,e){b[0]=a,d[e]=c[0],d[e+1]=c[1],d[e+2]=c[2],d[e+3]=c[3]}function f(a,d,e){b[0]=a,d[e]=c[3],d[e+1]=c[2],d[e+2]=c[1],d[e+3]=c[0]}function g(a,d){return c[0]=a[d],c[1]=a[d+1],c[2]=a[d+2],c[3]=a[d+3],b[0]}function h(a,d){return c[3]=a[d],c[2]=a[d+1],c[1]=a[d+2],c[0]=a[d+3],b[0]}a.writeFloatLE=d?e:f,a.writeFloatBE=d?f:e,a.readFloatLE=d?g:h,a.readFloatBE=d?h:g}():!function(){function b(a,b,c,d){var e=+(b<0);if(e&&(b=-b),0===b)a(1/b>0?0:0x80000000,c,d);else if(isNaN(b))a(0x7fc00000,c,d);else if(b>34028234663852886e22)a((e<<31|0x7f800000)>>>0,c,d);else if(b<11754943508222875e-54)a((e<<31|Math.round(b/1401298464324817e-60))>>>0,c,d);else{var f=Math.floor(Math.log(b)/Math.LN2),g=8388607&Math.round(b*Math.pow(2,-f)*8388608);a((e<<31|f+127<<23|g)>>>0,c,d)}}function c(a,b,c){var d=a(b,c),e=(d>>31)*2+1,f=d>>>23&255,g=8388607&d;return 255===f?g?NaN:1/0*e:0===f?1401298464324817e-60*e*g:e*Math.pow(2,f-150)*(g+8388608)}a.writeFloatLE=b.bind(null,e),a.writeFloatBE=b.bind(null,f),a.readFloatLE=c.bind(null,g),a.readFloatBE=c.bind(null,h)}(),"u">typeof Float64Array?!function(){var b=new Float64Array([-0]),c=new Uint8Array(b.buffer),d=128===c[7];function e(a,d,e){b[0]=a,d[e]=c[0],d[e+1]=c[1],d[e+2]=c[2],d[e+3]=c[3],d[e+4]=c[4],d[e+5]=c[5],d[e+6]=c[6],d[e+7]=c[7]}function f(a,d,e){b[0]=a,d[e]=c[7],d[e+1]=c[6],d[e+2]=c[5],d[e+3]=c[4],d[e+4]=c[3],d[e+5]=c[2],d[e+6]=c[1],d[e+7]=c[0]}function g(a,d){return c[0]=a[d],c[1]=a[d+1],c[2]=a[d+2],c[3]=a[d+3],c[4]=a[d+4],c[5]=a[d+5],c[6]=a[d+6],c[7]=a[d+7],b[0]}function h(a,d){return c[7]=a[d],c[6]=a[d+1],c[5]=a[d+2],c[4]=a[d+3],c[3]=a[d+4],c[2]=a[d+5],c[1]=a[d+6],c[0]=a[d+7],b[0]}a.writeDoubleLE=d?e:f,a.writeDoubleBE=d?f:e,a.readDoubleLE=d?g:h,a.readDoubleBE=d?h:g}():!function(){function b(a,b,c,d,e,f){var g,h=+(d<0);if(h&&(d=-d),0===d)a(0,e,f+b),a(1/d>0?0:0x80000000,e,f+c);else if(isNaN(d))a(0,e,f+b),a(0x7ff80000,e,f+c);else if(d>17976931348623157e292)a(0,e,f+b),a((h<<31|0x7ff00000)>>>0,e,f+c);else if(d<22250738585072014e-324)a((g=d/5e-324)>>>0,e,f+b),a((h<<31|g/0x100000000)>>>0,e,f+c);else{var i=Math.floor(Math.log(d)/Math.LN2);1024===i&&(i=1023),a(0x10000000000000*(g=d*Math.pow(2,-i))>>>0,e,f+b),a((h<<31|i+1023<<20|1048576*g&1048575)>>>0,e,f+c)}}function c(a,b,c,d,e){var f=a(d,e+b),g=a(d,e+c),h=(g>>31)*2+1,i=g>>>20&2047,j=0x100000000*(1048575&g)+f;return 2047===i?j?NaN:1/0*h:0===i?5e-324*h*j:h*Math.pow(2,i-1075)*(j+0x10000000000000)}a.writeDoubleLE=b.bind(null,e,0,4),a.writeDoubleBE=b.bind(null,f,4,0),a.readDoubleLE=c.bind(null,g,0,4),a.readDoubleBE=c.bind(null,h,4,0)}(),a}function e(a,b,c){b[c]=255&a,b[c+1]=a>>>8&255,b[c+2]=a>>>16&255,b[c+3]=a>>>24}function f(a,b,c){b[c]=a>>>24,b[c+1]=a>>>16&255,b[c+2]=a>>>8&255,b[c+3]=255&a}function g(a,b){return(a[b]|a[b+1]<<8|a[b+2]<<16|a[b+3]<<24)>>>0}function h(a,b){return(a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3])>>>0}b.exports=d(d)},68754,(__turbopack_context__,module,exports)=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},66298,(a,b,c)=>{"use strict";var d=c;d.length=function(a){for(var b=0,c=0,d=0;d<a.length;++d)(c=a.charCodeAt(d))<128?b+=1:c<2048?b+=2:(64512&c)==55296&&(64512&a.charCodeAt(d+1))==56320?(++d,b+=4):b+=3;return b},d.read=function(a,b,c){if(c-b<1)return"";for(var d,e=null,f=[],g=0;b<c;)(d=a[b++])<128?f[g++]=d:d>191&&d<224?f[g++]=(31&d)<<6|63&a[b++]:d>239&&d<365?(d=((7&d)<<18|(63&a[b++])<<12|(63&a[b++])<<6|63&a[b++])-65536,f[g++]=55296+(d>>10),f[g++]=56320+(1023&d)):f[g++]=(15&d)<<12|(63&a[b++])<<6|63&a[b++],g>8191&&((e||(e=[])).push(String.fromCharCode.apply(String,f)),g=0);return e?(g&&e.push(String.fromCharCode.apply(String,f.slice(0,g))),e.join("")):String.fromCharCode.apply(String,f.slice(0,g))},d.write=function(a,b,c){for(var d,e,f=c,g=0;g<a.length;++g)(d=a.charCodeAt(g))<128?b[c++]=d:(d<2048?b[c++]=d>>6|192:((64512&d)==55296&&(64512&(e=a.charCodeAt(g+1)))==56320?(d=65536+((1023&d)<<10)+(1023&e),++g,b[c++]=d>>18|240,b[c++]=d>>12&63|128):b[c++]=d>>12|224,b[c++]=d>>6&63|128),b[c++]=63&d|128);return c-f}},82820,(a,b,c)=>{"use strict";b.exports=function a(a,b,c){var d=c||8192,e=d>>>1,f=null,g=d;return function(c){if(c<1||c>e)return a(c);g+c>d&&(f=a(d),g=0);var h=b.call(f,g,g+=c);return 7&g&&(g=(7|g)+1),h}}},48309,(a,b,c)=>{"use strict";b.exports=e;var d=a.r(85457);function e(a,b){this.lo=a>>>0,this.hi=b>>>0}var f=e.zero=new e(0,0);f.toNumber=function(){return 0},f.zzEncode=f.zzDecode=function(){return this},f.length=function(){return 1};var g=e.zeroHash="\0\0\0\0\0\0\0\0";e.fromNumber=function(a){if(0===a)return f;var b=a<0;b&&(a=-a);var c=a>>>0,d=(a-c)/0x100000000>>>0;return b&&(d=~d>>>0,c=~c>>>0,++c>0xffffffff&&(c=0,++d>0xffffffff&&(d=0))),new e(c,d)},e.from=function(a){if("number"==typeof a)return e.fromNumber(a);if(d.isString(a))if(!d.Long)return e.fromNumber(parseInt(a,10));else a=d.Long.fromString(a);return a.low||a.high?new e(a.low>>>0,a.high>>>0):f},e.prototype.toNumber=function(a){if(!a&&this.hi>>>31){var b=~this.lo+1>>>0,c=~this.hi>>>0;return b||(c=c+1>>>0),-(b+0x100000000*c)}return this.lo+0x100000000*this.hi},e.prototype.toLong=function(a){return d.Long?new d.Long(0|this.lo,0|this.hi,!!a):{low:0|this.lo,high:0|this.hi,unsigned:!!a}};var h=String.prototype.charCodeAt;e.fromHash=function(a){return a===g?f:new e((h.call(a,0)|h.call(a,1)<<8|h.call(a,2)<<16|h.call(a,3)<<24)>>>0,(h.call(a,4)|h.call(a,5)<<8|h.call(a,6)<<16|h.call(a,7)<<24)>>>0)},e.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},e.prototype.zzEncode=function(){var a=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^a)>>>0,this.lo=(this.lo<<1^a)>>>0,this},e.prototype.zzDecode=function(){var a=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^a)>>>0,this.hi=(this.hi>>>1^a)>>>0,this},e.prototype.length=function(){var a=this.lo,b=(this.lo>>>28|this.hi<<4)>>>0,c=this.hi>>>24;return 0===c?0===b?a<16384?a<128?1:2:a<2097152?3:4:b<16384?b<128?5:6:b<2097152?7:8:c<128?9:10}},85457,(a,b,c)=>{"use strict";var d=c;function e(a,b,c){for(var d=Object.keys(b),e=0;e<d.length;++e)void 0!==a[d[e]]&&c||(a[d[e]]=b[d[e]]);return a}function f(a){function b(a,c){if(!(this instanceof b))return new b(a,c);Object.defineProperty(this,"message",{get:function(){return a}}),Error.captureStackTrace?Error.captureStackTrace(this,b):Object.defineProperty(this,"stack",{value:Error().stack||""}),c&&e(this,c)}return b.prototype=Object.create(Error.prototype,{constructor:{value:b,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return a},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),b}d.asPromise=a.r(96146),d.base64=a.r(28344),d.EventEmitter=a.r(38588),d.float=a.r(40830),d.inquire=a.r(68754),d.utf8=a.r(66298),d.pool=a.r(82820),d.LongBits=a.r(48309),d.isNode=!!(a.g&&a.g.process&&a.g.process.versions&&a.g.process.versions.node),d.global=d.isNode&&a.g||"u">typeof self&&self||a.e,d.emptyArray=Object.freeze?Object.freeze([]):[],d.emptyObject=Object.freeze?Object.freeze({}):{},d.isInteger=Number.isInteger||function(a){return"number"==typeof a&&isFinite(a)&&Math.floor(a)===a},d.isString=function(a){return"string"==typeof a||a instanceof String},d.isObject=function(a){return a&&"object"==typeof a},d.isset=d.isSet=function(a,b){var c=a[b];return!!(null!=c&&a.hasOwnProperty(b))&&("object"!=typeof c||(Array.isArray(c)?c.length:Object.keys(c).length)>0)},d.Buffer=function(){try{var a=d.inquire("buffer").Buffer;return a.prototype.utf8Write?a:null}catch(a){return null}}(),d._Buffer_from=null,d._Buffer_allocUnsafe=null,d.newBuffer=function(a){return"number"==typeof a?d.Buffer?d._Buffer_allocUnsafe(a):new d.Array(a):d.Buffer?d._Buffer_from(a):"u"<typeof Uint8Array?a:new Uint8Array(a)},d.Array="u">typeof Uint8Array?Uint8Array:Array,d.Long=d.global.dcodeIO&&d.global.dcodeIO.Long||d.global.Long||d.inquire("long"),d.key2Re=/^true|false|0|1$/,d.key32Re=/^-?(?:0|[1-9][0-9]*)$/,d.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,d.longToHash=function(a){return a?d.LongBits.from(a).toHash():d.LongBits.zeroHash},d.longFromHash=function(a,b){var c=d.LongBits.fromHash(a);return d.Long?d.Long.fromBits(c.lo,c.hi,b):c.toNumber(!!b)},d.merge=e,d.lcFirst=function(a){return a.charAt(0).toLowerCase()+a.substring(1)},d.newError=f,d.ProtocolError=f("ProtocolError"),d.oneOfGetter=function(a){for(var b={},c=0;c<a.length;++c)b[a[c]]=1;return function(){for(var a=Object.keys(this),c=a.length-1;c>-1;--c)if(1===b[a[c]]&&void 0!==this[a[c]]&&null!==this[a[c]])return a[c]}},d.oneOfSetter=function(a){return function(b){for(var c=0;c<a.length;++c)a[c]!==b&&delete this[a[c]]}},d.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},d._configure=function(){var a=d.Buffer;if(!a){d._Buffer_from=d._Buffer_allocUnsafe=null;return}d._Buffer_from=a.from!==Uint8Array.from&&a.from||function(b,c){return new a(b,c)},d._Buffer_allocUnsafe=a.allocUnsafe||function(b){return new a(b)}}},23318,(a,b,c)=>{"use strict";b.exports={}},98873,(a,b,c)=>{"use strict";function d(a,b){"string"==typeof a&&(b=a,a=void 0);var c=[];function e(a){if("string"!=typeof a){var b=f();if(d.verbose&&console.log("codegen: "+b),b="return "+b,a){for(var g=Object.keys(a),h=Array(g.length+1),i=Array(g.length),j=0;j<g.length;)h[j]=g[j],i[j]=a[g[j++]];return h[j]=b,Function.apply(null,h).apply(null,i)}return Function(b)()}for(var k=Array(arguments.length-1),l=0;l<k.length;)k[l]=arguments[++l];if(l=0,a=a.replace(/%([%dfijs])/g,function(a,b){var c=k[l++];switch(b){case"d":case"f":return String(Number(c));case"i":return String(Math.floor(c));case"j":return JSON.stringify(c);case"s":return String(c)}return"%"}),l!==k.length)throw Error("parameter count mismatch");return c.push(a),e}function f(d){return"function "+(d||b||"")+"("+(a&&a.join(",")||"")+"){\n  "+c.join("\n  ")+"\n}"}return e.toString=f,e}b.exports=d,d.verbose=!1},6566,(a,b,c)=>{"use strict";b.exports=f;var d=a.r(96146),e=a.r(68754)("fs");function f(a,b,c){return("function"==typeof b?(c=b,b={}):b||(b={}),c)?!b.xhr&&e&&e.readFile?e.readFile(a,function(d,e){return d&&"u">typeof XMLHttpRequest?f.xhr(a,b,c):d?c(d):c(null,b.binary?e:e.toString("utf8"))}):f.xhr(a,b,c):d(f,this,a,b)}f.xhr=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4===d.readyState){if(0!==d.status&&200!==d.status)return c(Error("status "+d.status));if(b.binary){var a=d.response;if(!a){a=[];for(var e=0;e<d.responseText.length;++e)a.push(255&d.responseText.charCodeAt(e))}return c(null,"u">typeof Uint8Array?new Uint8Array(a):a)}return c(null,d.responseText)}},b.binary&&("overrideMimeType"in d&&d.overrideMimeType("text/plain; charset=x-user-defined"),d.responseType="arraybuffer"),d.open("GET",a),d.send()}},7176,(a,b,c)=>{"use strict";var d=c,e=d.isAbsolute=function(a){return/^(?:\/|\w+:)/.test(a)},f=d.normalize=function(a){var b=(a=a.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),c=e(a),d="";c&&(d=b.shift()+"/");for(var f=0;f<b.length;)".."===b[f]?f>0&&".."!==b[f-1]?b.splice(--f,2):c?b.splice(f,1):++f:"."===b[f]?b.splice(f,1):++f;return d+b.join("/")};d.resolve=function(a,b,c){return(c||(b=f(b)),e(b))?b:(c||(a=f(a)),(a=a.replace(/(?:\/|^)[^/]+$/,"")).length?f(a+"/"+b):b)}},42226,(a,b,c)=>{"use strict";b.exports=l;var d,e,f,g=a.r(77601);((l.prototype=Object.create(g.prototype)).constructor=l).className="Namespace";var h=a.r(52093),i=a.r(13793),j=a.r(13175);function k(a,b){if(a&&a.length){for(var c={},d=0;d<a.length;++d)c[a[d].name]=a[d].toJSON(b);return c}}function l(a,b){g.call(this,a,b),this.nested=void 0,this._nestedArray=null,this._lookupCache={},this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0}function m(a){a._nestedArray=null,a._lookupCache={};for(var b=a;b=b.parent;)b._lookupCache={};return a}l.fromJSON=function(a,b){return new l(a,b.options).addJSON(b.nested)},l.arrayToJSON=k,l.isReservedId=function(a,b){if(a){for(var c=0;c<a.length;++c)if("string"!=typeof a[c]&&a[c][0]<=b&&a[c][1]>b)return!0}return!1},l.isReservedName=function(a,b){if(a){for(var c=0;c<a.length;++c)if(a[c]===b)return!0}return!1},Object.defineProperty(l.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=i.toArray(this.nested))}}),l.prototype.toJSON=function(a){return i.toObject(["options",this.options,"nested",k(this.nestedArray,a)])},l.prototype.addJSON=function(a){var b=this;if(a)for(var c,g=Object.keys(a),i=0;i<g.length;++i)c=a[g[i]],b.add((void 0!==c.fields?d.fromJSON:void 0!==c.values?f.fromJSON:void 0!==c.methods?e.fromJSON:void 0!==c.id?h.fromJSON:l.fromJSON)(g[i],c));return this},l.prototype.get=function(a){return this.nested&&this.nested[a]||null},l.prototype.getEnum=function(a){if(this.nested&&this.nested[a]instanceof f)return this.nested[a].values;throw Error("no such enum: "+a)},l.prototype.add=function(a){if(!(a instanceof h&&void 0!==a.extend||a instanceof d||a instanceof j||a instanceof f||a instanceof e||a instanceof l))throw TypeError("object must be a valid nested object");if(this.nested){var b=this.get(a.name);if(b)if(b instanceof l&&a instanceof l&&!(b instanceof d||b instanceof e)){for(var c=b.nestedArray,g=0;g<c.length;++g)a.add(c[g]);this.remove(b),this.nested||(this.nested={}),a.setOptions(b.options,!0)}else throw Error("duplicate name '"+a.name+"' in "+this)}else this.nested={};this.nested[a.name]=a,this instanceof d||this instanceof e||this instanceof f||this instanceof h||a._edition||(a._edition=a._defaultEdition),this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0;for(var i=this;i=i.parent;)i._needsRecursiveFeatureResolution=!0,i._needsRecursiveResolve=!0;return a.onAdd(this),m(this)},l.prototype.remove=function(a){if(!(a instanceof g))throw TypeError("object must be a ReflectionObject");if(a.parent!==this)throw Error(a+" is not a member of "+this);return delete this.nested[a.name],Object.keys(this.nested).length||(this.nested=void 0),a.onRemove(this),m(this)},l.prototype.define=function(a,b){if(i.isString(a))a=a.split(".");else if(!Array.isArray(a))throw TypeError("illegal path");if(a&&a.length&&""===a[0])throw Error("path must be relative");for(var c=this;a.length>0;){var d=a.shift();if(c.nested&&c.nested[d]){if(!((c=c.nested[d])instanceof l))throw Error("path conflicts with non-namespace objects")}else c.add(c=new l(d))}return b&&c.addJSON(b),c},l.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;this._resolveFeaturesRecursive(this._edition);var a=this.nestedArray,b=0;for(this.resolve();b<a.length;)a[b]instanceof l?a[b++].resolveAll():a[b++].resolve();return this._needsRecursiveResolve=!1,this},l.prototype._resolveFeaturesRecursive=function(a){return this._needsRecursiveFeatureResolution&&(this._needsRecursiveFeatureResolution=!1,a=this._edition||a,g.prototype._resolveFeaturesRecursive.call(this,a),this.nestedArray.forEach(b=>{b._resolveFeaturesRecursive(a)})),this},l.prototype.lookup=function(a,b,c){if("boolean"==typeof b?(c=b,b=void 0):b&&!Array.isArray(b)&&(b=[b]),i.isString(a)&&a.length){if("."===a)return this.root;a=a.split(".")}else if(!a.length)return this;var d=a.join(".");if(""===a[0])return this.root.lookup(a.slice(1),b);var e=this.root._fullyQualifiedObjects&&this.root._fullyQualifiedObjects["."+d];if(e&&(!b||b.indexOf(e.constructor)>-1)||(e=this._lookupImpl(a,d))&&(!b||b.indexOf(e.constructor)>-1))return e;if(c)return null;for(var f=this;f.parent;){if((e=f.parent._lookupImpl(a,d))&&(!b||b.indexOf(e.constructor)>-1))return e;f=f.parent}return null},l.prototype._lookupImpl=function(a,b){if(Object.prototype.hasOwnProperty.call(this._lookupCache,b))return this._lookupCache[b];var c=this.get(a[0]),d=null;if(c)1===a.length?d=c:c instanceof l&&(a=a.slice(1),d=c._lookupImpl(a,a.join(".")));else for(var e=0;e<this.nestedArray.length;++e)this._nestedArray[e]instanceof l&&(c=this._nestedArray[e]._lookupImpl(a,b))&&(d=c);return this._lookupCache[b]=d,d},l.prototype.lookupType=function(a){var b=this.lookup(a,[d]);if(!b)throw Error("no such type: "+a);return b},l.prototype.lookupEnum=function(a){var b=this.lookup(a,[f]);if(!b)throw Error("no such Enum '"+a+"' in "+this);return b},l.prototype.lookupTypeOrEnum=function(a){var b=this.lookup(a,[d,f]);if(!b)throw Error("no such Type or Enum '"+a+"' in "+this);return b},l.prototype.lookupService=function(a){var b=this.lookup(a,[e]);if(!b)throw Error("no such Service '"+a+"' in "+this);return b},l._configure=function(a,b,c){d=a,e=b,f=c}},14325,(a,b,c)=>{"use strict";b.exports=g;var d=a.r(52093);((g.prototype=Object.create(d.prototype)).constructor=g).className="MapField";var e=a.r(73362),f=a.r(13793);function g(a,b,c,e,g,h){if(d.call(this,a,b,e,void 0,void 0,g,h),!f.isString(c))throw TypeError("keyType must be a string");this.keyType=c,this.resolvedKeyType=null,this.map=!0}g.fromJSON=function(a,b){return new g(a,b.id,b.keyType,b.type,b.options,b.comment)},g.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return f.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",b?this.comment:void 0])},g.prototype.resolve=function(){if(this.resolved)return this;if(void 0===e.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return d.prototype.resolve.call(this)},g.d=function(a,b,c){return"function"==typeof c?c=f.decorateType(c).name:c&&"object"==typeof c&&(c=f.decorateEnum(c).name),function(d,e){f.decorateType(d.constructor).add(new g(e,a,b,c))}}},36654,(a,b,c)=>{"use strict";b.exports=f;var d=a.r(77601);((f.prototype=Object.create(d.prototype)).constructor=f).className="Method";var e=a.r(13793);function f(a,b,c,f,g,h,i,j,k){if(e.isObject(g)?(i=g,g=h=void 0):e.isObject(h)&&(i=h,h=void 0),!(void 0===b||e.isString(b)))throw TypeError("type must be a string");if(!e.isString(c))throw TypeError("requestType must be a string");if(!e.isString(f))throw TypeError("responseType must be a string");d.call(this,a,i),this.type=b||"rpc",this.requestType=c,this.requestStream=!!g||void 0,this.responseType=f,this.responseStream=!!h||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=j,this.parsedOptions=k}f.fromJSON=function(a,b){return new f(a,b.type,b.requestType,b.responseType,b.requestStream,b.responseStream,b.options,b.comment,b.parsedOptions)},f.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return e.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",b?this.comment:void 0,"parsedOptions",this.parsedOptions])},f.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),d.prototype.resolve.call(this))}},61122,(a,b,c)=>{"use strict";b.exports=e;var d=a.r(85457);function e(a,b,c){if("function"!=typeof a)throw TypeError("rpcImpl must be a function");d.EventEmitter.call(this),this.rpcImpl=a,this.requestDelimited=!!b,this.responseDelimited=!!c}(e.prototype=Object.create(d.EventEmitter.prototype)).constructor=e,e.prototype.rpcCall=function a(b,c,e,f,g){if(!f)throw TypeError("request must be specified");var h=this;if(!g)return d.asPromise(a,h,b,c,e,f);if(!h.rpcImpl)return void setTimeout(function(){g(Error("already ended"))},0);try{return h.rpcImpl(b,c[h.requestDelimited?"encodeDelimited":"encode"](f).finish(),function(a,c){if(a)return h.emit("error",a,b),g(a);if(null===c)return void h.end(!0);if(!(c instanceof e))try{c=e[h.responseDelimited?"decodeDelimited":"decode"](c)}catch(a){return h.emit("error",a,b),g(a)}return h.emit("data",c,b),g(null,c)})}catch(a){h.emit("error",a,b),setTimeout(function(){g(a)},0);return}},e.prototype.end=function(a){return this.rpcImpl&&(a||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},34207,(a,b,c)=>{"use strict";c.Service=a.r(61122)},26819,(a,b,c)=>{"use strict";b.exports=h;var d=a.r(42226);((h.prototype=Object.create(d.prototype)).constructor=h).className="Service";var e=a.r(36654),f=a.r(13793),g=a.r(34207);function h(a,b){d.call(this,a,b),this.methods={},this._methodsArray=null}function i(a){return a._methodsArray=null,a}h.fromJSON=function(a,b){var c=new h(a,b.options);if(b.methods)for(var d=Object.keys(b.methods),f=0;f<d.length;++f)c.add(e.fromJSON(d[f],b.methods[d[f]]));return b.nested&&c.addJSON(b.nested),b.edition&&(c._edition=b.edition),c.comment=b.comment,c._defaultEdition="proto3",c},h.prototype.toJSON=function(a){var b=d.prototype.toJSON.call(this,a),c=!!a&&!!a.keepComments;return f.toObject(["edition",this._editionToJSON(),"options",b&&b.options||void 0,"methods",d.arrayToJSON(this.methodsArray,a)||{},"nested",b&&b.nested||void 0,"comment",c?this.comment:void 0])},Object.defineProperty(h.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=f.toArray(this.methods))}}),h.prototype.get=function(a){return this.methods[a]||d.prototype.get.call(this,a)},h.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;d.prototype.resolve.call(this);for(var a=this.methodsArray,b=0;b<a.length;++b)a[b].resolve();return this},h.prototype._resolveFeaturesRecursive=function(a){return this._needsRecursiveFeatureResolution&&(a=this._edition||a,d.prototype._resolveFeaturesRecursive.call(this,a),this.methodsArray.forEach(b=>{b._resolveFeaturesRecursive(a)})),this},h.prototype.add=function(a){if(this.get(a.name))throw Error("duplicate name '"+a.name+"' in "+this);return a instanceof e?(this.methods[a.name]=a,a.parent=this,i(this)):d.prototype.add.call(this,a)},h.prototype.remove=function(a){if(a instanceof e){if(this.methods[a.name]!==a)throw Error(a+" is not a member of "+this);return delete this.methods[a.name],a.parent=null,i(this)}return d.prototype.remove.call(this,a)},h.prototype.create=function(a,b,c){for(var d,e=new g.Service(a,b,c),h=0;h<this.methodsArray.length;++h){var i=f.lcFirst((d=this._methodsArray[h]).resolve().name).replace(/[^$\w_]/g,"");e[i]=f.codegen(["r","c"],f.isReserved(i)?i+"_":i)("return this.rpcCall(m,q,s,r,c)")({m:d,q:d.resolvedRequestType.ctor,s:d.resolvedResponseType.ctor})}return e}},83884,(a,b,c)=>{"use strict";b.exports=e;var d=a.r(85457);function e(a){if(a)for(var b=Object.keys(a),c=0;c<b.length;++c)this[b[c]]=a[b[c]]}e.create=function(a){return this.$type.create(a)},e.encode=function(a,b){return this.$type.encode(a,b)},e.encodeDelimited=function(a,b){return this.$type.encodeDelimited(a,b)},e.decode=function(a){return this.$type.decode(a)},e.decodeDelimited=function(a){return this.$type.decodeDelimited(a)},e.verify=function(a){return this.$type.verify(a)},e.fromObject=function(a){return this.$type.fromObject(a)},e.toObject=function(a,b){return this.$type.toObject(a,b)},e.prototype.toJSON=function(){return this.$type.toObject(this,d.toJSONOptions)}},72999,(a,b,c)=>{"use strict";b.exports=i;var d,e=a.r(85457),f=e.LongBits,g=e.utf8;function h(a,b){return RangeError("index out of range: "+a.pos+" + "+(b||1)+" > "+a.len)}function i(a){this.buf=a,this.pos=0,this.len=a.length}var j="u">typeof Uint8Array?function(a){if(a instanceof Uint8Array||Array.isArray(a))return new i(a);throw Error("illegal buffer")}:function(a){if(Array.isArray(a))return new i(a);throw Error("illegal buffer")},k=function(){return e.Buffer?function(a){return(i.create=function(a){return e.Buffer.isBuffer(a)?new d(a):j(a)})(a)}:j};function l(){var a=new f(0,0),b=0;if(this.len-this.pos>4){for(;b<4;++b)if(a.lo=(a.lo|(127&this.buf[this.pos])<<7*b)>>>0,this.buf[this.pos++]<128)return a;if(a.lo=(a.lo|(127&this.buf[this.pos])<<28)>>>0,a.hi=(a.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return a;b=0}else{for(;b<3;++b){if(this.pos>=this.len)throw h(this);if(a.lo=(a.lo|(127&this.buf[this.pos])<<7*b)>>>0,this.buf[this.pos++]<128)return a}return a.lo=(a.lo|(127&this.buf[this.pos++])<<7*b)>>>0,a}if(this.len-this.pos>4){for(;b<5;++b)if(a.hi=(a.hi|(127&this.buf[this.pos])<<7*b+3)>>>0,this.buf[this.pos++]<128)return a}else for(;b<5;++b){if(this.pos>=this.len)throw h(this);if(a.hi=(a.hi|(127&this.buf[this.pos])<<7*b+3)>>>0,this.buf[this.pos++]<128)return a}throw Error("invalid varint encoding")}function m(a,b){return(a[b-4]|a[b-3]<<8|a[b-2]<<16|a[b-1]<<24)>>>0}function n(){if(this.pos+8>this.len)throw h(this,8);return new f(m(this.buf,this.pos+=4),m(this.buf,this.pos+=4))}i.create=k(),i.prototype._slice=e.Array.prototype.subarray||e.Array.prototype.slice,i.prototype.uint32=function(){var a=0xffffffff;return function(){if(a=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(a=(a|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(a=(a|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(a=(a|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(a=(a|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return a;if((this.pos+=5)>this.len)throw this.pos=this.len,h(this,10);return a}}(),i.prototype.int32=function(){return 0|this.uint32()},i.prototype.sint32=function(){var a=this.uint32();return a>>>1^-(1&a)},i.prototype.bool=function(){return 0!==this.uint32()},i.prototype.fixed32=function(){if(this.pos+4>this.len)throw h(this,4);return m(this.buf,this.pos+=4)},i.prototype.sfixed32=function(){if(this.pos+4>this.len)throw h(this,4);return 0|m(this.buf,this.pos+=4)},i.prototype.float=function(){if(this.pos+4>this.len)throw h(this,4);var a=e.float.readFloatLE(this.buf,this.pos);return this.pos+=4,a},i.prototype.double=function(){if(this.pos+8>this.len)throw h(this,4);var a=e.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,a},i.prototype.bytes=function(){var a=this.uint32(),b=this.pos,c=this.pos+a;if(c>this.len)throw h(this,a);if(this.pos+=a,Array.isArray(this.buf))return this.buf.slice(b,c);if(b===c){var d=e.Buffer;return d?d.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,b,c)},i.prototype.string=function(){var a=this.bytes();return g.read(a,0,a.length)},i.prototype.skip=function(a){if("number"==typeof a){if(this.pos+a>this.len)throw h(this,a);this.pos+=a}else do if(this.pos>=this.len)throw h(this);while(128&this.buf[this.pos++])return this},i.prototype.skipType=function(a){switch(a){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(a=7&this.uint32());)this.skipType(a);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+a+" at offset "+this.pos)}return this},i._configure=function(a){d=a,i.create=k(),d._configure();var b=e.Long?"toLong":"toNumber";e.merge(i.prototype,{int64:function(){return l.call(this)[b](!1)},uint64:function(){return l.call(this)[b](!0)},sint64:function(){return l.call(this).zzDecode()[b](!1)},fixed64:function(){return n.call(this)[b](!0)},sfixed64:function(){return n.call(this)[b](!1)}})}},93548,(a,b,c)=>{"use strict";b.exports=l;var d,e=a.r(85457),f=e.LongBits,g=e.base64,h=e.utf8;function i(a,b,c){this.fn=a,this.len=b,this.next=void 0,this.val=c}function j(){}function k(a){this.head=a.head,this.tail=a.tail,this.len=a.len,this.next=a.states}function l(){this.len=0,this.head=new i(j,0,0),this.tail=this.head,this.states=null}var m=function(){return e.Buffer?function(){return(l.create=function(){return new d})()}:function(){return new l}};function n(a,b,c){b[c]=255&a}function o(a,b,c){for(;a>127;)b[c++]=127&a|128,a>>>=7;b[c]=a}function p(a,b){this.len=a,this.next=void 0,this.val=b}function q(a,b,c){for(;a.hi;)b[c++]=127&a.lo|128,a.lo=(a.lo>>>7|a.hi<<25)>>>0,a.hi>>>=7;for(;a.lo>127;)b[c++]=127&a.lo|128,a.lo=a.lo>>>7;b[c++]=a.lo}function r(a,b,c){b[c]=255&a,b[c+1]=a>>>8&255,b[c+2]=a>>>16&255,b[c+3]=a>>>24}l.create=m(),l.alloc=function(a){return new e.Array(a)},e.Array!==Array&&(l.alloc=e.pool(l.alloc,e.Array.prototype.subarray)),l.prototype._push=function(a,b,c){return this.tail=this.tail.next=new i(a,b,c),this.len+=b,this},p.prototype=Object.create(i.prototype),p.prototype.fn=o,l.prototype.uint32=function(a){return this.len+=(this.tail=this.tail.next=new p((a>>>=0)<128?1:a<16384?2:a<2097152?3:a<0x10000000?4:5,a)).len,this},l.prototype.int32=function(a){return a<0?this._push(q,10,f.fromNumber(a)):this.uint32(a)},l.prototype.sint32=function(a){return this.uint32((a<<1^a>>31)>>>0)},l.prototype.uint64=function(a){var b=f.from(a);return this._push(q,b.length(),b)},l.prototype.int64=l.prototype.uint64,l.prototype.sint64=function(a){var b=f.from(a).zzEncode();return this._push(q,b.length(),b)},l.prototype.bool=function(a){return this._push(n,1,+!!a)},l.prototype.fixed32=function(a){return this._push(r,4,a>>>0)},l.prototype.sfixed32=l.prototype.fixed32,l.prototype.fixed64=function(a){var b=f.from(a);return this._push(r,4,b.lo)._push(r,4,b.hi)},l.prototype.sfixed64=l.prototype.fixed64,l.prototype.float=function(a){return this._push(e.float.writeFloatLE,4,a)},l.prototype.double=function(a){return this._push(e.float.writeDoubleLE,8,a)};var s=e.Array.prototype.set?function(a,b,c){b.set(a,c)}:function(a,b,c){for(var d=0;d<a.length;++d)b[c+d]=a[d]};l.prototype.bytes=function(a){var b=a.length>>>0;if(!b)return this._push(n,1,0);if(e.isString(a)){var c=l.alloc(b=g.length(a));g.decode(a,c,0),a=c}return this.uint32(b)._push(s,b,a)},l.prototype.string=function(a){var b=h.length(a);return b?this.uint32(b)._push(h.write,b,a):this._push(n,1,0)},l.prototype.fork=function(){return this.states=new k(this),this.head=this.tail=new i(j,0,0),this.len=0,this},l.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new i(j,0,0),this.len=0),this},l.prototype.ldelim=function(){var a=this.head,b=this.tail,c=this.len;return this.reset().uint32(c),c&&(this.tail.next=a.next,this.tail=b,this.len+=c),this},l.prototype.finish=function(){for(var a=this.head.next,b=this.constructor.alloc(this.len),c=0;a;)a.fn(a.val,b,c),c+=a.len,a=a.next;return b},l._configure=function(a){d=a,l.create=m(),d._configure()}},19419,(a,b,c)=>{"use strict";b.exports=h;var d=a.r(16575),e=a.r(73362),f=a.r(13793);function g(a){return"missing required '"+a.name+"'"}function h(a){for(var b=f.codegen(["r","l","e"],a.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(a.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),c=0;c<a.fieldsArray.length;++c){var h=a._fieldsArray[c].resolve(),i=h.resolvedType instanceof d?"int32":h.type,j="m"+f.safeProp(h.name);b("case %i: {",h.id),h.map?(b("if(%s===util.emptyObject)",j)("%s={}",j)("var c2 = r.uint32()+r.pos"),void 0!==e.defaults[h.keyType]?b("k=%j",e.defaults[h.keyType]):b("k=null"),void 0!==e.defaults[i]?b("value=%j",e.defaults[i]):b("value=null"),b("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",h.keyType)("case 2:"),void 0===e.basic[i]?b("value=types[%i].decode(r,r.uint32())",c):b("value=r.%s()",i),b("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),void 0!==e.long[h.keyType]?b('%s[typeof k==="object"?util.longToHash(k):k]=value',j):b("%s[k]=value",j)):h.repeated?(b("if(!(%s&&%s.length))",j,j)("%s=[]",j),void 0!==e.packed[i]&&b("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",j,i)("}else"),void 0===e.basic[i]?b(h.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",j,c):b("%s.push(r.%s())",j,i)):void 0===e.basic[i]?b(h.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",j,c):b("%s=r.%s()",j,i),b("break")("}")}for(b("default:")("r.skipType(t&7)")("break")("}")("}"),c=0;c<a._fieldsArray.length;++c){var k=a._fieldsArray[c];k.required&&b("if(!m.hasOwnProperty(%j))",k.name)("throw util.ProtocolError(%j,{instance:m})",g(k))}return b("return m")}},13820,(a,b,c)=>{"use strict";b.exports=i;var d=a.r(16575),e=a.r(13793);function f(a,b){return a.name+": "+b+(a.repeated&&"array"!==b?"[]":a.map&&"object"!==b?"{k:"+a.keyType+"}":"")+" expected"}function g(a,b,c,e){if(b.resolvedType)if(b.resolvedType instanceof d){a("switch(%s){",e)("default:")("return%j",f(b,"enum value"));for(var g=Object.keys(b.resolvedType.values),h=0;h<g.length;++h)a("case %i:",b.resolvedType.values[g[h]]);a("break")("}")}else a("{")("var e=types[%i].verify(%s);",c,e)("if(e)")("return%j+e",b.name+".")("}");else switch(b.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":a("if(!util.isInteger(%s))",e)("return%j",f(b,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":a("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",e,e,e,e)("return%j",f(b,"integer|Long"));break;case"float":case"double":a('if(typeof %s!=="number")',e)("return%j",f(b,"number"));break;case"bool":a('if(typeof %s!=="boolean")',e)("return%j",f(b,"boolean"));break;case"string":a("if(!util.isString(%s))",e)("return%j",f(b,"string"));break;case"bytes":a('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',e,e,e)("return%j",f(b,"buffer"))}return a}function h(a,b,c){switch(b.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":a("if(!util.key32Re.test(%s))",c)("return%j",f(b,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":a("if(!util.key64Re.test(%s))",c)("return%j",f(b,"integer|Long key"));break;case"bool":a("if(!util.key2Re.test(%s))",c)("return%j",f(b,"boolean key"))}return a}function i(a){var b=e.codegen(["m"],a.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),c=a.oneofsArray,d={};c.length&&b("var p={}");for(var i=0;i<a.fieldsArray.length;++i){var j=a._fieldsArray[i].resolve(),k="m"+e.safeProp(j.name);if(j.optional&&b("if(%s!=null&&m.hasOwnProperty(%j)){",k,j.name),j.map)b("if(!util.isObject(%s))",k)("return%j",f(j,"object"))("var k=Object.keys(%s)",k)("for(var i=0;i<k.length;++i){"),h(b,j,"k[i]"),g(b,j,i,k+"[k[i]]")("}");else if(j.repeated)b("if(!Array.isArray(%s))",k)("return%j",f(j,"array"))("for(var i=0;i<%s.length;++i){",k),g(b,j,i,k+"[i]")("}");else{if(j.partOf){var l=e.safeProp(j.partOf.name);1===d[j.partOf.name]&&b("if(p%s===1)",l)("return%j",j.partOf.name+": multiple values"),d[j.partOf.name]=1,b("p%s=1",l)}g(b,j,i,k)}j.optional&&b("}")}return b("return null")}},50233,(a,b,c)=>{"use strict";var d=c,e=a.r(16575),f=a.r(13793);function g(a,b,c,d){var f=!1;if(b.resolvedType)if(b.resolvedType instanceof e){a("switch(d%s){",d);for(var g=b.resolvedType.values,h=Object.keys(g),i=0;i<h.length;++i)g[h[i]]!==b.typeDefault||f||(a("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',d,d,d),b.repeated||a("break"),f=!0),a("case%j:",h[i])("case %i:",g[h[i]])("m%s=%j",d,g[h[i]])("break");a("}")}else a('if(typeof d%s!=="object")',d)("throw TypeError(%j)",b.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",d,c,d);else{var j=!1;switch(b.type){case"double":case"float":a("m%s=Number(d%s)",d,d);break;case"uint32":case"fixed32":a("m%s=d%s>>>0",d,d);break;case"int32":case"sint32":case"sfixed32":a("m%s=d%s|0",d,d);break;case"uint64":j=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":a("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",d,d,j)('else if(typeof d%s==="string")',d)("m%s=parseInt(d%s,10)",d,d)('else if(typeof d%s==="number")',d)("m%s=d%s",d,d)('else if(typeof d%s==="object")',d)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",d,d,d,j?"true":"");break;case"bytes":a('if(typeof d%s==="string")',d)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",d,d,d)("else if(d%s.length >= 0)",d)("m%s=d%s",d,d);break;case"string":a("m%s=String(d%s)",d,d);break;case"bool":a("m%s=Boolean(d%s)",d,d)}}return a}function h(a,b,c,d){if(b.resolvedType)b.resolvedType instanceof e?a("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",d,c,d,d,c,d,d):a("d%s=types[%i].toObject(m%s,o)",d,c,d);else{var f=!1;switch(b.type){case"double":case"float":a("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",d,d,d,d);break;case"uint64":f=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":a('if(typeof m%s==="number")',d)("d%s=o.longs===String?String(m%s):m%s",d,d,d)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",d,d,d,d,f?"true":"",d);break;case"bytes":a("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",d,d,d,d,d);break;default:a("d%s=m%s",d,d)}}return a}d.fromObject=function(a){var b=a.fieldsArray,c=f.codegen(["d"],a.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!b.length)return c("return new this.ctor");c("var m=new this.ctor");for(var d=0;d<b.length;++d){var h=b[d].resolve(),i=f.safeProp(h.name);h.map?(c("if(d%s){",i)('if(typeof d%s!=="object")',i)("throw TypeError(%j)",h.fullName+": object expected")("m%s={}",i)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",i),g(c,h,d,i+"[ks[i]]")("}")("}")):h.repeated?(c("if(d%s){",i)("if(!Array.isArray(d%s))",i)("throw TypeError(%j)",h.fullName+": array expected")("m%s=[]",i)("for(var i=0;i<d%s.length;++i){",i),g(c,h,d,i+"[i]")("}")("}")):(h.resolvedType instanceof e||c("if(d%s!=null){",i),g(c,h,d,i),h.resolvedType instanceof e||c("}"))}return c("return m")},d.toObject=function(a){var b=a.fieldsArray.slice().sort(f.compareFieldsById);if(!b.length)return f.codegen()("return {}");for(var c=f.codegen(["m","o"],a.name+"$toObject")("if(!o)")("o={}")("var d={}"),d=[],g=[],i=[],j=0;j<b.length;++j)b[j].partOf||(b[j].resolve().repeated?d:b[j].map?g:i).push(b[j]);if(d.length){for(c("if(o.arrays||o.defaults){"),j=0;j<d.length;++j)c("d%s=[]",f.safeProp(d[j].name));c("}")}if(g.length){for(c("if(o.objects||o.defaults){"),j=0;j<g.length;++j)c("d%s={}",f.safeProp(g[j].name));c("}")}if(i.length){for(c("if(o.defaults){"),j=0;j<i.length;++j){var k=i[j],l=f.safeProp(k.name);if(k.resolvedType instanceof e)c("d%s=o.enums===String?%j:%j",l,k.resolvedType.valuesById[k.typeDefault],k.typeDefault);else if(k.long)c("if(util.Long){")("var n=new util.Long(%i,%i,%j)",k.typeDefault.low,k.typeDefault.high,k.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",l)("}else")("d%s=o.longs===String?%j:%i",l,k.typeDefault.toString(),k.typeDefault.toNumber());else if(k.bytes){var m="["+Array.prototype.slice.call(k.typeDefault).join(",")+"]";c("if(o.bytes===String)d%s=%j",l,String.fromCharCode.apply(String,k.typeDefault))("else{")("d%s=%s",l,m)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",l,l)("}")}else c("d%s=%j",l,k.typeDefault)}c("}")}var n=!1;for(j=0;j<b.length;++j){var k=b[j],o=a._fieldsArray.indexOf(k),l=f.safeProp(k.name);k.map?(n||(n=!0,c("var ks2")),c("if(m%s&&(ks2=Object.keys(m%s)).length){",l,l)("d%s={}",l)("for(var j=0;j<ks2.length;++j){"),h(c,k,o,l+"[ks2[j]]")("}")):k.repeated?(c("if(m%s&&m%s.length){",l,l)("d%s=[]",l)("for(var j=0;j<m%s.length;++j){",l),h(c,k,o,l+"[j]")("}")):(c("if(m%s!=null&&m.hasOwnProperty(%j)){",l,k.name),h(c,k,o,l),k.partOf&&c("if(o.oneofs)")("d%s=%j",f.safeProp(k.partOf.name),k.name)),c("}")}return c("return d")}},82170,(a,b,c)=>{"use strict";var d=c,e=a.r(83884);d[".google.protobuf.Any"]={fromObject:function(a){if(a&&a["@type"]){var b=a["@type"].substring(a["@type"].lastIndexOf("/")+1),c=this.lookup(b);if(c){var d="."===a["@type"].charAt(0)?a["@type"].slice(1):a["@type"];return -1===d.indexOf("/")&&(d="/"+d),this.create({type_url:d,value:c.encode(c.fromObject(a)).finish()})}}return this.fromObject(a)},toObject:function(a,b){var c="type.googleapis.com/",d="",f="";if(b&&b.json&&a.type_url&&a.value){f=a.type_url.substring(a.type_url.lastIndexOf("/")+1),d=a.type_url.substring(0,a.type_url.lastIndexOf("/")+1);var g=this.lookup(f);g&&(a=g.decode(a.value))}if(!(a instanceof this.ctor)&&a instanceof e){var h=a.$type.toObject(a,b),i="."===a.$type.fullName[0]?a.$type.fullName.slice(1):a.$type.fullName;return""===d&&(d=c),f=d+i,h["@type"]=f,h}return this.toObject(a,b)}}},7190,(a,b,c)=>{"use strict";b.exports=s;var d=a.r(42226);((s.prototype=Object.create(d.prototype)).constructor=s).className="Type";var e=a.r(16575),f=a.r(13175),g=a.r(52093),h=a.r(14325),i=a.r(26819),j=a.r(83884),k=a.r(72999),l=a.r(93548),m=a.r(13793),n=a.r(19529),o=a.r(19419),p=a.r(13820),q=a.r(50233),r=a.r(82170);function s(a,b){d.call(this,a,b),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function t(a){return a._fieldsById=a._fieldsArray=a._oneofsArray=null,delete a.encode,delete a.decode,delete a.verify,a}Object.defineProperties(s.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var a=Object.keys(this.fields),b=0;b<a.length;++b){var c=this.fields[a[b]],d=c.id;if(this._fieldsById[d])throw Error("duplicate id "+d+" in "+this);this._fieldsById[d]=c}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=m.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=m.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=s.generateConstructor(this)())},set:function(a){var b=a.prototype;b instanceof j||((a.prototype=new j).constructor=a,m.merge(a.prototype,b)),a.$type=a.prototype.$type=this,m.merge(a,j,!0),this._ctor=a;for(var c=0;c<this.fieldsArray.length;++c)this._fieldsArray[c].resolve();var d={};for(c=0;c<this.oneofsArray.length;++c)d[this._oneofsArray[c].resolve().name]={get:m.oneOfGetter(this._oneofsArray[c].oneof),set:m.oneOfSetter(this._oneofsArray[c].oneof)};c&&Object.defineProperties(a.prototype,d)}}}),s.generateConstructor=function(a){for(var b,c=m.codegen(["p"],a.name),d=0;d<a.fieldsArray.length;++d)(b=a._fieldsArray[d]).map?c("this%s={}",m.safeProp(b.name)):b.repeated&&c("this%s=[]",m.safeProp(b.name));return c("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},s.fromJSON=function(a,b){var c=new s(a,b.options);c.extensions=b.extensions,c.reserved=b.reserved;for(var j=Object.keys(b.fields),k=0;k<j.length;++k)c.add((void 0!==b.fields[j[k]].keyType?h.fromJSON:g.fromJSON)(j[k],b.fields[j[k]]));if(b.oneofs)for(j=Object.keys(b.oneofs),k=0;k<j.length;++k)c.add(f.fromJSON(j[k],b.oneofs[j[k]]));if(b.nested)for(j=Object.keys(b.nested),k=0;k<j.length;++k){var l=b.nested[j[k]];c.add((void 0!==l.id?g.fromJSON:void 0!==l.fields?s.fromJSON:void 0!==l.values?e.fromJSON:void 0!==l.methods?i.fromJSON:d.fromJSON)(j[k],l))}return b.extensions&&b.extensions.length&&(c.extensions=b.extensions),b.reserved&&b.reserved.length&&(c.reserved=b.reserved),b.group&&(c.group=!0),b.comment&&(c.comment=b.comment),b.edition&&(c._edition=b.edition),c._defaultEdition="proto3",c},s.prototype.toJSON=function(a){var b=d.prototype.toJSON.call(this,a),c=!!a&&!!a.keepComments;return m.toObject(["edition",this._editionToJSON(),"options",b&&b.options||void 0,"oneofs",d.arrayToJSON(this.oneofsArray,a),"fields",d.arrayToJSON(this.fieldsArray.filter(function(a){return!a.declaringField}),a)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",b&&b.nested||void 0,"comment",c?this.comment:void 0])},s.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;d.prototype.resolveAll.call(this);var a=this.oneofsArray;for(c=0;c<a.length;)a[c++].resolve();for(var b=this.fieldsArray,c=0;c<b.length;)b[c++].resolve();return this},s.prototype._resolveFeaturesRecursive=function(a){return this._needsRecursiveFeatureResolution&&(a=this._edition||a,d.prototype._resolveFeaturesRecursive.call(this,a),this.oneofsArray.forEach(b=>{b._resolveFeatures(a)}),this.fieldsArray.forEach(b=>{b._resolveFeatures(a)})),this},s.prototype.get=function(a){return this.fields[a]||this.oneofs&&this.oneofs[a]||this.nested&&this.nested[a]||null},s.prototype.add=function(a){if(this.get(a.name))throw Error("duplicate name '"+a.name+"' in "+this);if(a instanceof g&&void 0===a.extend){if(this._fieldsById?this._fieldsById[a.id]:this.fieldsById[a.id])throw Error("duplicate id "+a.id+" in "+this);if(this.isReservedId(a.id))throw Error("id "+a.id+" is reserved in "+this);if(this.isReservedName(a.name))throw Error("name '"+a.name+"' is reserved in "+this);return a.parent&&a.parent.remove(a),this.fields[a.name]=a,a.message=this,a.onAdd(this),t(this)}return a instanceof f?(this.oneofs||(this.oneofs={}),this.oneofs[a.name]=a,a.onAdd(this),t(this)):d.prototype.add.call(this,a)},s.prototype.remove=function(a){if(a instanceof g&&void 0===a.extend){if(!this.fields||this.fields[a.name]!==a)throw Error(a+" is not a member of "+this);return delete this.fields[a.name],a.parent=null,a.onRemove(this),t(this)}if(a instanceof f){if(!this.oneofs||this.oneofs[a.name]!==a)throw Error(a+" is not a member of "+this);return delete this.oneofs[a.name],a.parent=null,a.onRemove(this),t(this)}return d.prototype.remove.call(this,a)},s.prototype.isReservedId=function(a){return d.isReservedId(this.reserved,a)},s.prototype.isReservedName=function(a){return d.isReservedName(this.reserved,a)},s.prototype.create=function(a){return new this.ctor(a)},s.prototype.setup=function(){for(var a=this.fullName,b=[],c=0;c<this.fieldsArray.length;++c)b.push(this._fieldsArray[c].resolve().resolvedType);this.encode=n(this)({Writer:l,types:b,util:m}),this.decode=o(this)({Reader:k,types:b,util:m}),this.verify=p(this)({types:b,util:m}),this.fromObject=q.fromObject(this)({types:b,util:m}),this.toObject=q.toObject(this)({types:b,util:m});var d=r[a];if(d){var e=Object.create(this);e.fromObject=this.fromObject,this.fromObject=d.fromObject.bind(e),e.toObject=this.toObject,this.toObject=d.toObject.bind(e)}return this},s.prototype.encode=function(a,b){return this.setup().encode(a,b)},s.prototype.encodeDelimited=function(a,b){return this.encode(a,b&&b.len?b.fork():b).ldelim()},s.prototype.decode=function(a,b){return this.setup().decode(a,b)},s.prototype.decodeDelimited=function(a){return a instanceof k||(a=k.create(a)),this.decode(a,a.uint32())},s.prototype.verify=function(a){return this.setup().verify(a)},s.prototype.fromObject=function(a){return this.setup().fromObject(a)},s.prototype.toObject=function(a,b){return this.setup().toObject(a,b)},s.d=function(a){return function(b){m.decorateType(b,a)}}},67612,(a,b,c)=>{"use strict";b.exports=l;var d,e,f,g=a.r(42226);((l.prototype=Object.create(g.prototype)).constructor=l).className="Root";var h=a.r(52093),i=a.r(16575),j=a.r(13175),k=a.r(13793);function l(a){g.call(this,"",a),this.deferred=[],this.files=[],this._edition="proto2",this._fullyQualifiedObjects={}}function m(){}l.fromJSON=function(a,b){return b||(b=new l),a.options&&b.setOptions(a.options),b.addJSON(a.nested).resolveAll()},l.prototype.resolvePath=k.path.resolve,l.prototype.fetch=k.fetch,l.prototype.load=function a(b,c,d){"function"==typeof c&&(d=c,c=void 0);var g=this;if(!d)return k.asPromise(a,g,b,c);var h=d===m;function i(a,b){if(d){if(h)throw a;b&&b.resolveAll();var c=d;d=null,c(a,b)}}function j(a){var b=a.lastIndexOf("google/protobuf/");if(b>-1){var c=a.substring(b);if(c in f)return c}return null}function l(a,b){try{if(k.isString(b)&&"{"===b.charAt(0)&&(b=JSON.parse(b)),k.isString(b)){e.filename=a;var d,f=e(b,g,c),l=0;if(f.imports)for(;l<f.imports.length;++l)(d=j(f.imports[l])||g.resolvePath(a,f.imports[l]))&&n(d);if(f.weakImports)for(l=0;l<f.weakImports.length;++l)(d=j(f.weakImports[l])||g.resolvePath(a,f.weakImports[l]))&&n(d,!0)}else g.setOptions(b.options).addJSON(b.nested)}catch(a){i(a)}h||o||i(null,g)}function n(a,b){if(a=j(a)||a,!(g.files.indexOf(a)>-1)){if(g.files.push(a),a in f)return void(h?l(a,f[a]):(++o,setTimeout(function(){--o,l(a,f[a])})));if(h){var c;try{c=k.fs.readFileSync(a).toString("utf8")}catch(a){b||i(a);return}l(a,c)}else++o,g.fetch(a,function(c,e){if(--o,d){if(c)return void(b?o||i(null,g):i(c));l(a,e)}})}}var o=0;k.isString(b)&&(b=[b]);for(var p,q=0;q<b.length;++q)(p=g.resolvePath("",b[q]))&&n(p);return h?g.resolveAll():o||i(null,g),g},l.prototype.loadSync=function(a,b){if(!k.isNode)throw Error("not supported");return this.load(a,b,m)},l.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(a){return"'extend "+a.extend+"' in "+a.parent.fullName}).join(", "));return g.prototype.resolveAll.call(this)};var n=/^[A-Z]/;function o(a,b){var c=b.parent.lookup(b.extend);if(c){var d=new h(b.fullName,b.id,b.type,b.rule,void 0,b.options);return!!c.get(d.name)||(d.declaringField=b,b.extensionField=d,c.add(d),!0)}return!1}l.prototype._handleAdd=function(a){if(a instanceof h)void 0===a.extend||a.extensionField||o(this,a)||this.deferred.push(a);else if(a instanceof i)n.test(a.name)&&(a.parent[a.name]=a.values);else if(!(a instanceof j)){if(a instanceof d)for(var b=0;b<this.deferred.length;)o(this,this.deferred[b])?this.deferred.splice(b,1):++b;for(var c=0;c<a.nestedArray.length;++c)this._handleAdd(a._nestedArray[c]);n.test(a.name)&&(a.parent[a.name]=a)}(a instanceof d||a instanceof i||a instanceof h)&&(this._fullyQualifiedObjects[a.fullName]=a)},l.prototype._handleRemove=function(a){if(a instanceof h){if(void 0!==a.extend)if(a.extensionField)a.extensionField.parent.remove(a.extensionField),a.extensionField=null;else{var b=this.deferred.indexOf(a);b>-1&&this.deferred.splice(b,1)}}else if(a instanceof i)n.test(a.name)&&delete a.parent[a.name];else if(a instanceof g){for(var c=0;c<a.nestedArray.length;++c)this._handleRemove(a._nestedArray[c]);n.test(a.name)&&delete a.parent[a.name]}delete this._fullyQualifiedObjects[a.fullName]},l._configure=function(a,b,c){d=a,e=b,f=c}},13793,(a,b,c)=>{"use strict";var d,e,f=b.exports=a.r(85457),g=a.r(23318);f.codegen=a.r(98873),f.fetch=a.r(6566),f.path=a.r(7176),f.fs=f.inquire("fs"),f.toArray=function(a){if(a){for(var b=Object.keys(a),c=Array(b.length),d=0;d<b.length;)c[d]=a[b[d++]];return c}return[]},f.toObject=function(a){for(var b={},c=0;c<a.length;){var d=a[c++],e=a[c++];void 0!==e&&(b[d]=e)}return b};var h=/\\/g,i=/"/g;f.isReserved=function(a){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(a)},f.safeProp=function(a){return!/^[$\w_]+$/.test(a)||f.isReserved(a)?'["'+a.replace(h,"\\\\").replace(i,'\\"')+'"]':"."+a},f.ucFirst=function(a){return a.charAt(0).toUpperCase()+a.substring(1)};var j=/_([a-z])/g;f.camelCase=function(a){return a.substring(0,1)+a.substring(1).replace(j,function(a,b){return b.toUpperCase()})},f.compareFieldsById=function(a,b){return a.id-b.id},f.decorateType=function(b,c){if(b.$type)return c&&b.$type.name!==c&&(f.decorateRoot.remove(b.$type),b.$type.name=c,f.decorateRoot.add(b.$type)),b.$type;d||(d=a.r(7190));var e=new d(c||b.name);return f.decorateRoot.add(e),e.ctor=b,Object.defineProperty(b,"$type",{value:e,enumerable:!1}),Object.defineProperty(b.prototype,"$type",{value:e,enumerable:!1}),e};var k=0;f.decorateEnum=function(b){if(b.$type)return b.$type;e||(e=a.r(16575));var c=new e("Enum"+k++,b);return f.decorateRoot.add(c),Object.defineProperty(b,"$type",{value:c,enumerable:!1}),c},f.setProperty=function(a,b,c,d){function e(a,b,c){var f=b.shift();if("__proto__"===f||"prototype"===f)return a;if(b.length>0)a[f]=e(a[f]||{},b,c);else{var g=a[f];if(g&&d)return a;g&&(c=[].concat(g).concat(c)),a[f]=c}return a}if("object"!=typeof a)throw TypeError("dst must be an object");if(!b)throw TypeError("path must be specified");return e(a,b=b.split("."),c)},Object.defineProperty(f,"decorateRoot",{get:function(){return g.decorated||(g.decorated=new(a.r(67612)))}})},73362,(a,b,c)=>{"use strict";var d=c,e=a.r(13793),f=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function g(a,b){var c=0,d={};for(b|=0;c<a.length;)d[f[c+b]]=a[c++];return d}d.basic=g([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),d.defaults=g([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",e.emptyArray,null]),d.long=g([0,0,0,1,1],7),d.mapKey=g([0,0,0,5,5,0,0,0,1,1,0,2],2),d.packed=g([1,5,0,0,0,5,5,0,0,0,1,1,0])},52093,(a,b,c)=>{"use strict";b.exports=j;var d,e=a.r(77601);((j.prototype=Object.create(e.prototype)).constructor=j).className="Field";var f=a.r(16575),g=a.r(73362),h=a.r(13793),i=/^required|optional|repeated$/;function j(a,b,c,d,f,j,k){if(h.isObject(d)?(k=f,j=d,d=f=void 0):h.isObject(f)&&(k=j,j=f,f=void 0),e.call(this,a,j),!h.isInteger(b)||b<0)throw TypeError("id must be a non-negative integer");if(!h.isString(c))throw TypeError("type must be a string");if(void 0!==d&&!i.test(d=d.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==f&&!h.isString(f))throw TypeError("extend must be a string");"proto3_optional"===d&&(d="optional"),this.rule=d&&"optional"!==d?d:void 0,this.type=c,this.id=b,this.extend=f||void 0,this.repeated="repeated"===d,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!h.Long&&void 0!==g.long[c],this.bytes="bytes"===c,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=k}j.fromJSON=function(a,b){var c=new j(a,b.id,b.type,b.rule,b.extend,b.options,b.comment);return b.edition&&(c._edition=b.edition),c._defaultEdition="proto3",c},Object.defineProperty(j.prototype,"required",{get:function(){return"LEGACY_REQUIRED"===this._features.field_presence}}),Object.defineProperty(j.prototype,"optional",{get:function(){return!this.required}}),Object.defineProperty(j.prototype,"delimited",{get:function(){return this.resolvedType instanceof d&&"DELIMITED"===this._features.message_encoding}}),Object.defineProperty(j.prototype,"packed",{get:function(){return"PACKED"===this._features.repeated_field_encoding}}),Object.defineProperty(j.prototype,"hasPresence",{get:function(){return!this.repeated&&!this.map&&(this.partOf||this.declaringField||this.extensionField||"IMPLICIT"!==this._features.field_presence)}}),j.prototype.setOption=function(a,b,c){return e.prototype.setOption.call(this,a,b,c)},j.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return h.toObject(["edition",this._editionToJSON(),"rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",b?this.comment:void 0])},j.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=g.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof d?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof f&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof f||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=h.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var a;h.base64.test(this.typeDefault)?h.base64.decode(this.typeDefault,a=h.newBuffer(h.base64.length(this.typeDefault)),0):h.utf8.write(this.typeDefault,a=h.newBuffer(h.utf8.length(this.typeDefault)),0),this.typeDefault=a}return this.map?this.defaultValue=h.emptyObject:this.repeated?this.defaultValue=h.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof d&&(this.parent.ctor.prototype[this.name]=this.defaultValue),e.prototype.resolve.call(this)},j.prototype._inferLegacyProtoFeatures=function(a){if("proto2"!==a&&"proto3"!==a)return{};var b={};if("required"===this.rule&&(b.field_presence="LEGACY_REQUIRED"),this.parent&&void 0===g.defaults[this.type]){var c=this.parent.get(this.type.split(".").pop());c&&c instanceof d&&c.group&&(b.message_encoding="DELIMITED")}return!0===this.getOption("packed")?b.repeated_field_encoding="PACKED":!1===this.getOption("packed")&&(b.repeated_field_encoding="EXPANDED"),b},j.prototype._resolveFeatures=function(a){return e.prototype._resolveFeatures.call(this,this._edition||a)},j.d=function(a,b,c,d){return"function"==typeof b?b=h.decorateType(b).name:b&&"object"==typeof b&&(b=h.decorateEnum(b).name),function(e,f){h.decorateType(e.constructor).add(new j(f,a,b,c,{default:d}))}},j._configure=function(a){d=a}},13175,(a,b,c)=>{"use strict";b.exports=g;var d=a.r(77601);((g.prototype=Object.create(d.prototype)).constructor=g).className="OneOf";var e=a.r(52093),f=a.r(13793);function g(a,b,c,e){if(Array.isArray(b)||(c=b,b=void 0),d.call(this,a,c),!(void 0===b||Array.isArray(b)))throw TypeError("fieldNames must be an Array");this.oneof=b||[],this.fieldsArray=[],this.comment=e}function h(a){if(a.parent)for(var b=0;b<a.fieldsArray.length;++b)a.fieldsArray[b].parent||a.parent.add(a.fieldsArray[b])}g.fromJSON=function(a,b){return new g(a,b.oneof,b.options,b.comment)},g.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return f.toObject(["options",this.options,"oneof",this.oneof,"comment",b?this.comment:void 0])},g.prototype.add=function(a){if(!(a instanceof e))throw TypeError("field must be a Field");return a.parent&&a.parent!==this.parent&&a.parent.remove(a),this.oneof.push(a.name),this.fieldsArray.push(a),a.partOf=this,h(this),this},g.prototype.remove=function(a){if(!(a instanceof e))throw TypeError("field must be a Field");var b=this.fieldsArray.indexOf(a);if(b<0)throw Error(a+" is not a member of "+this);return this.fieldsArray.splice(b,1),(b=this.oneof.indexOf(a.name))>-1&&this.oneof.splice(b,1),a.partOf=null,this},g.prototype.onAdd=function(a){d.prototype.onAdd.call(this,a);for(var b=this,c=0;c<this.oneof.length;++c){var e=a.get(this.oneof[c]);e&&!e.partOf&&(e.partOf=b,b.fieldsArray.push(e))}h(this)},g.prototype.onRemove=function(a){for(var b,c=0;c<this.fieldsArray.length;++c)(b=this.fieldsArray[c]).parent&&b.parent.remove(b);d.prototype.onRemove.call(this,a)},Object.defineProperty(g.prototype,"isProto3Optional",{get:function(){if(null==this.fieldsArray||1!==this.fieldsArray.length)return!1;var a=this.fieldsArray[0];return null!=a.options&&!0===a.options.proto3_optional}}),g.d=function(){for(var a=Array(arguments.length),b=0;b<arguments.length;)a[b]=arguments[b++];return function(b,c){f.decorateType(b.constructor).add(new g(c,a)),Object.defineProperty(b,c,{get:f.oneOfGetter(a),set:f.oneOfSetter(a)})}}},77601,(a,b,c)=>{"use strict";b.exports=j,j.className="ReflectionObject";let d=a.r(13175);var e,f=a.r(13793),g={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},h={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},i={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function j(a,b){if(!f.isString(a))throw TypeError("name must be a string");if(b&&!f.isObject(b))throw TypeError("options must be an object");this.options=b,this.parsedOptions=null,this.name=a,this._edition=null,this._defaultEdition="proto2",this._features={},this._featuresResolved=!1,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(j.prototype,{root:{get:function(){for(var a=this;null!==a.parent;)a=a.parent;return a}},fullName:{get:function(){for(var a=[this.name],b=this.parent;b;)a.unshift(b.name),b=b.parent;return a.join(".")}}}),j.prototype.toJSON=function(){throw Error()},j.prototype.onAdd=function(a){this.parent&&this.parent!==a&&this.parent.remove(this),this.parent=a,this.resolved=!1;var b=a.root;b instanceof e&&b._handleAdd(this)},j.prototype.onRemove=function(a){var b=a.root;b instanceof e&&b._handleRemove(this),this.parent=null,this.resolved=!1},j.prototype.resolve=function(){return this.resolved||this.root instanceof e&&(this.resolved=!0),this},j.prototype._resolveFeaturesRecursive=function(a){return this._resolveFeatures(this._edition||a)},j.prototype._resolveFeatures=function(a){if(!this._featuresResolved){var b={};if(!a)throw Error("Unknown edition for "+this.fullName);var c=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(a));if(this._edition){if("proto2"===a)b=Object.assign({},h);else if("proto3"===a)b=Object.assign({},i);else if("2023"===a)b=Object.assign({},g);else throw Error("Unknown edition: "+a);this._features=Object.assign(b,c||{}),this._featuresResolved=!0;return}if(this.partOf instanceof d){var e=Object.assign({},this.partOf._features);this._features=Object.assign(e,c||{})}else if(this.declaringField);else if(this.parent){var f=Object.assign({},this.parent._features);this._features=Object.assign(f,c||{})}else throw Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features),this._featuresResolved=!0}},j.prototype._inferLegacyProtoFeatures=function(){return{}},j.prototype.getOption=function(a){if(this.options)return this.options[a]},j.prototype.setOption=function(a,b,c){return this.options||(this.options={}),/^features\./.test(a)?f.setProperty(this.options,a,b,c):c&&void 0!==this.options[a]||(this.getOption(a)!==b&&(this.resolved=!1),this.options[a]=b),this},j.prototype.setParsedOption=function(a,b,c){this.parsedOptions||(this.parsedOptions=[]);var d=this.parsedOptions;if(c){var e=d.find(function(b){return Object.prototype.hasOwnProperty.call(b,a)});if(e){var g=e[a];f.setProperty(g,c,b)}else(e={})[a]=f.setProperty({},c,b),d.push(e)}else{var h={};h[a]=b,d.push(h)}return this},j.prototype.setOptions=function(a,b){if(a)for(var c=Object.keys(a),d=0;d<c.length;++d)this.setOption(c[d],a[c[d]],b);return this},j.prototype.toString=function(){var a=this.constructor.className,b=this.fullName;return b.length?a+" "+b:a},j.prototype._editionToJSON=function(){if(this._edition&&"proto3"!==this._edition)return this._edition},j._configure=function(a){e=a}},16575,(a,b,c)=>{"use strict";b.exports=g;var d=a.r(77601);((g.prototype=Object.create(d.prototype)).constructor=g).className="Enum";var e=a.r(42226),f=a.r(13793);function g(a,b,c,e,f,g){if(d.call(this,a,c),b&&"object"!=typeof b)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=e,this.comments=f||{},this.valuesOptions=g,this._valuesFeatures={},this.reserved=void 0,b)for(var h=Object.keys(b),i=0;i<h.length;++i)"number"==typeof b[h[i]]&&(this.valuesById[this.values[h[i]]=b[h[i]]]=h[i])}g.prototype._resolveFeatures=function(a){return a=this._edition||a,d.prototype._resolveFeatures.call(this,a),Object.keys(this.values).forEach(a=>{var b=Object.assign({},this._features);this._valuesFeatures[a]=Object.assign(b,this.valuesOptions&&this.valuesOptions[a]&&this.valuesOptions[a].features)}),this},g.fromJSON=function(a,b){var c=new g(a,b.values,b.options,b.comment,b.comments);return c.reserved=b.reserved,b.edition&&(c._edition=b.edition),c._defaultEdition="proto3",c},g.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return f.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",b?this.comment:void 0,"comments",b?this.comments:void 0])},g.prototype.add=function(a,b,c,d){if(!f.isString(a))throw TypeError("name must be a string");if(!f.isInteger(b))throw TypeError("id must be an integer");if(void 0!==this.values[a])throw Error("duplicate name '"+a+"' in "+this);if(this.isReservedId(b))throw Error("id "+b+" is reserved in "+this);if(this.isReservedName(a))throw Error("name '"+a+"' is reserved in "+this);if(void 0!==this.valuesById[b]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+b+" in "+this);this.values[a]=b}else this.valuesById[this.values[a]=b]=a;return d&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[a]=d||null),this.comments[a]=c||null,this},g.prototype.remove=function(a){if(!f.isString(a))throw TypeError("name must be a string");var b=this.values[a];if(null==b)throw Error("name '"+a+"' does not exist in "+this);return delete this.valuesById[b],delete this.values[a],delete this.comments[a],this.valuesOptions&&delete this.valuesOptions[a],this},g.prototype.isReservedId=function(a){return e.isReservedId(this.reserved,a)},g.prototype.isReservedName=function(a){return e.isReservedName(this.reserved,a)}},19529,(a,b,c)=>{"use strict";b.exports=h;var d=a.r(16575),e=a.r(73362),f=a.r(13793);function g(a,b,c,d){return b.delimited?a("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",c,d,(b.id<<3|3)>>>0,(b.id<<3|4)>>>0):a("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",c,d,(b.id<<3|2)>>>0)}function h(a){for(var b,c,h=f.codegen(["m","w"],a.name+"$encode")("if(!w)")("w=Writer.create()"),i=a.fieldsArray.slice().sort(f.compareFieldsById),b=0;b<i.length;++b){var j=i[b].resolve(),k=a._fieldsArray.indexOf(j),l=j.resolvedType instanceof d?"int32":j.type,m=e.basic[l];c="m"+f.safeProp(j.name),j.map?(h("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",c,j.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",c)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(j.id<<3|2)>>>0,8|e.mapKey[j.keyType],j.keyType),void 0===m?h("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",k,c):h(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|m,l,c),h("}")("}")):j.repeated?(h("if(%s!=null&&%s.length){",c,c),j.packed&&void 0!==e.packed[l]?h("w.uint32(%i).fork()",(j.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",c)("w.%s(%s[i])",l,c)("w.ldelim()"):(h("for(var i=0;i<%s.length;++i)",c),void 0===m?g(h,j,k,c+"[i]"):h("w.uint32(%i).%s(%s[i])",(j.id<<3|m)>>>0,l,c)),h("}")):(j.optional&&h("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",c,j.name),void 0===m?g(h,j,k,c):h("w.uint32(%i).%s(%s)",(j.id<<3|m)>>>0,l,c))}return h("return w")}},30186,(a,b,c)=>{"use strict";b.exports=f;var d=a.r(93548);(f.prototype=Object.create(d.prototype)).constructor=f;var e=a.r(85457);function f(){d.call(this)}function g(a,b,c){a.length<40?e.utf8.write(a,b,c):b.utf8Write?b.utf8Write(a,c):b.write(a,c)}f._configure=function(){f.alloc=e._Buffer_allocUnsafe,f.writeBytesBuffer=e.Buffer&&e.Buffer.prototype instanceof Uint8Array&&"set"===e.Buffer.prototype.set.name?function(a,b,c){b.set(a,c)}:function(a,b,c){if(a.copy)a.copy(b,c,0,a.length);else for(var d=0;d<a.length;)b[c++]=a[d++]}},f.prototype.bytes=function(a){e.isString(a)&&(a=e._Buffer_from(a,"base64"));var b=a.length>>>0;return this.uint32(b),b&&this._push(f.writeBytesBuffer,b,a),this},f.prototype.string=function(a){var b=e.Buffer.byteLength(a);return this.uint32(b),b&&this._push(g,b,a),this},f._configure()},24886,(a,b,c)=>{"use strict";b.exports=f;var d=a.r(72999);(f.prototype=Object.create(d.prototype)).constructor=f;var e=a.r(85457);function f(a){d.call(this,a)}f._configure=function(){e.Buffer&&(f.prototype._slice=e.Buffer.prototype.slice)},f.prototype.string=function(){var a=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+a,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+a,this.len))},f._configure()},13383,(a,b,c)=>{"use strict";var d=c;function e(){d.util._configure(),d.Writer._configure(d.BufferWriter),d.Reader._configure(d.BufferReader)}d.build="minimal",d.Writer=a.r(93548),d.BufferWriter=a.r(30186),d.Reader=a.r(72999),d.BufferReader=a.r(24886),d.util=a.r(85457),d.rpc=a.r(34207),d.roots=a.r(23318),d.configure=e,e()},77133,(a,b,c)=>{"use strict";var d=b.exports=a.r(13383);function e(a,b,c){return"function"==typeof b?(c=b,b=new d.Root):b||(b=new d.Root),b.load(a,c)}function f(a,b){return b||(b=new d.Root),b.loadSync(a)}d.build="light",d.load=e,d.loadSync=f,d.encoder=a.r(19529),d.decoder=a.r(19419),d.verifier=a.r(13820),d.converter=a.r(50233),d.ReflectionObject=a.r(77601),d.Namespace=a.r(42226),d.Root=a.r(67612),d.Enum=a.r(16575),d.Type=a.r(7190),d.Field=a.r(52093),d.OneOf=a.r(13175),d.MapField=a.r(14325),d.Service=a.r(26819),d.Method=a.r(36654),d.Message=a.r(83884),d.wrappers=a.r(82170),d.types=a.r(73362),d.util=a.r(13793),d.ReflectionObject._configure(d.Root),d.Namespace._configure(d.Type,d.Service,d.Enum),d.Root._configure(d.Type),d.Field._configure(d.Type)},51098,(a,b,c)=>{"use strict";b.exports=n;var d=/[\s{}=;:[\],'"()<>]/g,e=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,f=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,g=/^ *[*/]+ */,h=/^\s*\*?\/*/,i=/\n/g,j=/\s/,k=/\\(.?)/g,l={0:"\0",r:"\r",n:"\n",t:"	"};function m(a){return a.replace(k,function(a,b){switch(b){case"\\":case"":return b;default:return l[b]||""}})}function n(a,b){a=a.toString();var c=0,k=a.length,l=1,n=0,o={},p=[],q=null;function r(a){return Error("illegal "+a+" (line "+l+")")}function s(){var b="'"===q?f:e;b.lastIndex=c-1;var d=b.exec(a);if(!d)throw r("string");return c=b.lastIndex,y(q),q=null,m(d[1])}function t(b){return a.charAt(b)}function u(c,d,e){var f,j={type:a.charAt(c++),lineEmpty:!1,leading:e},k=c-(b?2:3);do if(--k<0||"\n"===(f=a.charAt(k))){j.lineEmpty=!0;break}while(" "===f||"	"===f)for(var m=a.substring(c,d).split(i),p=0;p<m.length;++p)m[p]=m[p].replace(b?h:g,"").trim();j.text=m.join("\n").trim(),o[l]=j,n=l}function v(b){var c=w(b),d=a.substring(b,c);return/^\s*\/\//.test(d)}function w(a){for(var b=a;b<k&&"\n"!==t(b);)b++;return b}function x(){if(p.length>0)return p.shift();if(q)return s();var e,f,g,h,i,m=0===c;do{if(c===k)return null;for(e=!1;j.test(g=t(c));)if("\n"===g&&(m=!0,++l),++c===k)return null;if("/"===t(c)){if(++c===k)throw r("comment");if("/"===t(c))if(b){if(h=c,i=!1,v(c-1)){i=!0;do if((c=w(c))===k||(c++,!m))break;while(v(c))}else c=Math.min(k,w(c)+1);i&&(u(h,c,m),m=!0),l++,e=!0}else{for(i="/"===t(h=c+1);"\n"!==t(++c);)if(c===k)return null;++c,i&&(u(h,c-1,m),m=!0),++l,e=!0}else{if("*"!==(g=t(c)))return"/";h=c+1,i=b||"*"===t(h);do{if("\n"===g&&++l,++c===k)throw r("comment");f=g,g=t(c)}while("*"!==f||"/"!==g)++c,i&&(u(h,c-2,m),m=!0),e=!0}}}while(e)var n=c;if(d.lastIndex=0,!d.test(t(n++)))for(;n<k&&!d.test(t(n));)++n;var o=a.substring(c,c=n);return('"'===o||"'"===o)&&(q=o),o}function y(a){p.push(a)}function z(){if(!p.length){var a=x();if(null===a)return null;y(a)}return p[0]}function A(a,b){var c=z();if(c===a)return x(),!0;if(!b)throw r("token '"+c+"', '"+a+"' expected");return!1}function B(a){var c,d=null;return void 0===a?(c=o[l-1],delete o[l-1],c&&(b||"*"===c.type||c.lineEmpty)&&(d=c.leading?c.text:null)):(n<a&&z(),c=o[a],delete o[a],c&&!c.lineEmpty&&(b||"/"===c.type)&&(d=c.leading?null:c.text)),d}return Object.defineProperty({next:x,peek:z,push:y,skip:A,cmnt:B},"line",{get:function(){return l}})}n.unescape=m},70233,(a,b,c)=>{"use strict";b.exports=y,y.filename=null,y.defaults={keepCase:!1};var d=a.r(51098),e=a.r(67612),f=a.r(7190),g=a.r(52093),h=a.r(14325),i=a.r(13175),j=a.r(16575),k=a.r(26819),l=a.r(36654),m=a.r(77601),n=a.r(73362),o=a.r(13793),p=/^[1-9][0-9]*$/,q=/^-?[1-9][0-9]*$/,r=/^0[x][0-9a-fA-F]+$/,s=/^-?0[x][0-9a-fA-F]+$/,t=/^0[0-7]+$/,u=/^-?0[0-7]+$/,v=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,w=/^[a-zA-Z_][a-zA-Z_0-9]*$/,x=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function y(a,b,c){b instanceof e||(c=b,b=new e),c||(c=y.defaults);var z,A,B,C,D=c.preferTrailingComment||!1,E=d(a,c.alternateCommentMode||!1),F=E.next,G=E.push,H=E.peek,I=E.skip,J=E.cmnt,K=!0,L="proto2",M=b,N=[],O={},P=c.keepCase?function(a){return a}:o.camelCase;function Q(){N.forEach(a=>{a._edition=L,Object.keys(O).forEach(b=>{void 0===a.getOption(b)&&a.setOption(b,O[b],!0)})})}function R(a,b,c){var d=y.filename;return c||(y.filename=null),Error("illegal "+(b||"token")+" '"+a+"' ("+(d?d+", ":"")+"line "+E.line+")")}function S(){var a,b=[];do{if('"'!==(a=F())&&"'"!==a)throw R(a);b.push(F()),I(a),a=H()}while('"'===a||"'"===a)return b.join("")}function T(a){var b=F();switch(b){case"'":case'"':return G(b),S();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return V(b,!0)}catch(c){if(a&&x.test(b))return b;throw R(b,"value")}}function U(a,b){do if(b&&('"'===(c=H())||"'"===c)){var c,d,e=S();if(a.push(e),L>=2023)throw R(e,"id")}else try{a.push([d=W(F()),I("to",!0)?W(F()):d])}catch(d){if(b&&x.test(c)&&L>=2023)a.push(c);else throw d}while(I(",",!0))var f={options:void 0};f.setOption=function(a,b){void 0===this.options&&(this.options={}),this.options[a]=b},aa(f,function(a){if("option"===a)ai(f,a),I(";");else throw R(a)},function(){am(f)})}function V(a,b){var c=1;switch("-"===a.charAt(0)&&(c=-1,a=a.substring(1)),a){case"inf":case"INF":case"Inf":return 1/0*c;case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(p.test(a))return c*parseInt(a,10);if(r.test(a))return c*parseInt(a,16);if(t.test(a))return c*parseInt(a,8);if(v.test(a))return c*parseFloat(a);throw R(a,"number",b)}function W(a,b){switch(a){case"max":case"MAX":case"Max":return 0x1fffffff;case"0":return 0}if(!b&&"-"===a.charAt(0))throw R(a,"id");if(q.test(a))return parseInt(a,10);if(s.test(a))return parseInt(a,16);if(u.test(a))return parseInt(a,8);throw R(a,"id")}function X(){if(void 0!==A)throw R("package");if(A=F(),!x.test(A))throw R(A,"name");M=M.define(A),I(";")}function Y(){var a,b=H();switch(b){case"weak":a=C||(C=[]),F();break;case"public":F();default:a=B||(B=[])}b=S(),I(";"),a.push(b)}function Z(){if(I("="),(L=S())<2023)throw R(L,"syntax");I(";")}function $(){if(I("="),!["2023"].includes(L=S()))throw R(L,"edition");I(";")}function _(a,b){switch(b){case"option":return ai(a,b),I(";"),!0;case"message":return ab(a,b),!0;case"enum":return ag(a,b),!0;case"service":return an(a,b),!0;case"extend":return ap(a,b),!0}return!1}function aa(a,b,c){var d,e=E.line;if(a&&("string"!=typeof a.comment&&(a.comment=J()),a.filename=y.filename),I("{",!0)){for(;"}"!==(d=F());)b(d);I(";",!0)}else c&&c(),I(";"),a&&("string"!=typeof a.comment||D)&&(a.comment=J(e)||a.comment)}function ab(a,b){if(!w.test(b=F()))throw R(b,"type name");var c=new f(b);aa(c,function(a){if(!_(c,a))switch(a){case"map":ae(c,a);break;case"required":if("proto2"!==L)throw R(a);case"repeated":ac(c,a);break;case"optional":if("proto3"===L)ac(c,"proto3_optional");else if("proto2"!==L)throw R(a);else ac(c,"optional");break;case"oneof":af(c,a);break;case"extensions":U(c.extensions||(c.extensions=[]));break;case"reserved":U(c.reserved||(c.reserved=[]),!0);break;default:if("proto2"===L||!x.test(a))throw R(a);G(a),ac(c,"optional")}}),a.add(c),a===M&&N.push(c)}function ac(a,b,c){var d=F();if("group"===d)return void ad(a,b);for(;d.endsWith(".")||H().startsWith(".");)d+=F();if(!x.test(d))throw R(d,"type");var e=F();if(!w.test(e))throw R(e,"name");e=P(e),I("=");var f=new g(e,W(F()),d,b,c);if(aa(f,function(a){if("option"===a)ai(f,a),I(";");else throw R(a)},function(){am(f)}),"proto3_optional"===b){var h=new i("_"+e);f.setOption("proto3_optional",!0),h.add(f),a.add(h)}else a.add(f);a===M&&N.push(f)}function ad(a,b){if(L>=2023)throw R("group");var c=F();if(!w.test(c))throw R(c,"name");var d=o.lcFirst(c);c===d&&(c=o.ucFirst(c)),I("=");var e=W(F()),h=new f(c);h.group=!0;var i=new g(d,e,c,b);i.filename=y.filename,aa(h,function(a){switch(a){case"option":ai(h,a),I(";");break;case"required":case"repeated":ac(h,a);break;case"optional":"proto3"===L?ac(h,"proto3_optional"):ac(h,"optional");break;case"message":ab(h,a);break;case"enum":ag(h,a);break;case"reserved":U(h.reserved||(h.reserved=[]),!0);break;default:throw R(a)}}),a.add(h).add(i)}function ae(a){I("<");var b=F();if(void 0===n.mapKey[b])throw R(b,"type");I(",");var c=F();if(!x.test(c))throw R(c,"type");I(">");var d=F();if(!w.test(d))throw R(d,"name");I("=");var e=new h(P(d),W(F()),b,c);aa(e,function(a){if("option"===a)ai(e,a),I(";");else throw R(a)},function(){am(e)}),a.add(e)}function af(a,b){if(!w.test(b=F()))throw R(b,"name");var c=new i(P(b));aa(c,function(a){"option"===a?(ai(c,a),I(";")):(G(a),ac(c,"optional"))}),a.add(c)}function ag(a,b){if(!w.test(b=F()))throw R(b,"name");var c=new j(b);aa(c,function(a){switch(a){case"option":ai(c,a),I(";");break;case"reserved":U(c.reserved||(c.reserved=[]),!0),void 0===c.reserved&&(c.reserved=[]);break;default:ah(c,a)}}),a.add(c),a===M&&N.push(c)}function ah(a,b){if(!w.test(b))throw R(b,"name");I("=");var c=W(F(),!0),d={options:void 0};d.getOption=function(a){return this.options[a]},d.setOption=function(a,b){m.prototype.setOption.call(d,a,b)},d.setParsedOption=function(){},aa(d,function(a){if("option"===a)ai(d,a),I(";");else throw R(a)},function(){am(d)}),a.add(b,c,d.comment,d.parsedOptions||d.options)}function ai(a,b){var c,d,e=!0;for("option"===b&&(b=F());"="!==b;){if("("===b){var f=F();I(")"),b="("+f+")"}if(e){if(e=!1,b.includes(".")&&!b.includes("(")){var g=b.split(".");c=g[0]+".",b=g[1];continue}c=b}else d=d?d+=b:b;b=F()}var h=aj(a,d?c.concat(d):c);d=d&&"."===d[0]?d.slice(1):d,al(a,c=c&&"."===c[c.length-1]?c.slice(0,-1):c,h,d)}function aj(a,b){if(I("{",!0)){for(var c={};!I("}",!0);){if(!w.test(z=F()))throw R(z,"name");if(null===z)throw R(z,"end of input");var d,e,f=z;if(I(":",!0),"{"===H())d=aj(a,b+"."+z);else if("["===H()){if(d=[],I("[",!0)){do e=T(!0),d.push(e);while(I(",",!0))I("]"),void 0!==e&&ak(a,b+"."+z,e)}}else d=T(!0),ak(a,b+"."+z,d);var g=c[f];g&&(d=[].concat(g).concat(d)),c[f]=d,I(",",!0),I(";",!0)}return c}var h=T(!0);return ak(a,b,h),h}function ak(a,b,c){if(M===a&&/^features\./.test(b)){O[b]=c;return}a.setOption&&a.setOption(b,c)}function al(a,b,c,d){a.setParsedOption&&a.setParsedOption(b,c,d)}function am(a){if(I("[",!0)){do ai(a,"option");while(I(",",!0))I("]")}return a}function an(a,b){if(!w.test(b=F()))throw R(b,"service name");var c=new k(b);aa(c,function(a){if(!_(c,a))if("rpc"===a)ao(c,a);else throw R(a)}),a.add(c),a===M&&N.push(c)}function ao(a,b){var c=J(),d=b;if(!w.test(b=F()))throw R(b,"name");var e,f,g,h,i=b;if(I("("),I("stream",!0)&&(f=!0),!x.test(b=F())||(e=b,I(")"),I("returns"),I("("),I("stream",!0)&&(h=!0),!x.test(b=F())))throw R(b);g=b,I(")");var j=new l(i,d,e,g,f,h);j.comment=c,aa(j,function(a){if("option"===a)ai(j,a),I(";");else throw R(a)}),a.add(j)}function ap(a,b){if(!x.test(b=F()))throw R(b,"reference");var c=b;aa(null,function(b){switch(b){case"required":case"repeated":ac(a,b,c);break;case"optional":"proto3"===L?ac(a,"proto3_optional",c):ac(a,"optional",c);break;default:if("proto2"===L||!x.test(b))throw R(b);G(b),ac(a,"optional",c)}})}for(;null!==(z=F());)switch(z){case"package":if(!K)throw R(z);X();break;case"import":if(!K)throw R(z);Y();break;case"syntax":if(!K)throw R(z);Z();break;case"edition":if(!K)throw R(z);$();break;case"option":ai(M,z),I(";",!0);break;default:if(_(M,z)){K=!1;continue}throw R(z)}return Q(),y.filename=null,{package:A,imports:B,weakImports:C,root:b}}},19857,(a,b,c)=>{"use strict";b.exports=f;var d,e=/\/|\./;function f(a,b){e.test(a)||(a="google/protobuf/"+a+".proto",b={nested:{google:{nested:{protobuf:{nested:b}}}}}),f[a]=b}f("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),f("duration",{Duration:d={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),f("timestamp",{Timestamp:d}),f("empty",{Empty:{fields:{}}}),f("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),f("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),f("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),f.get=function(a){return f[a]||null}},73197,(a,b,c)=>{"use strict";var d=b.exports=a.r(77133);d.build="full",d.tokenize=a.r(51098),d.parse=a.r(70233),d.common=a.r(19857),d.Root._configure(d.Type,d.parse,d.common)},30155,(a,b,c)=>{"use strict";b.exports=a.r(73197)},85565,a=>{a.v(JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"options":{"go_package":"google.golang.org/protobuf/types/descriptorpb","java_package":"com.google.protobuf","java_outer_classname":"DescriptorProtos","csharp_namespace":"Google.Protobuf.Reflection","objc_class_prefix":"GPB","cc_enable_arenas":true,"optimize_for":"SPEED"},"nested":{"FileDescriptorSet":{"edition":"proto2","fields":{"file":{"rule":"repeated","type":"FileDescriptorProto","id":1}},"extensions":[[536000000,536000000]]},"Edition":{"edition":"proto2","values":{"EDITION_UNKNOWN":0,"EDITION_LEGACY":900,"EDITION_PROTO2":998,"EDITION_PROTO3":999,"EDITION_2023":1000,"EDITION_2024":1001,"EDITION_1_TEST_ONLY":1,"EDITION_2_TEST_ONLY":2,"EDITION_99997_TEST_ONLY":99997,"EDITION_99998_TEST_ONLY":99998,"EDITION_99999_TEST_ONLY":99999,"EDITION_MAX":2147483647}},"FileDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"package":{"type":"string","id":2},"dependency":{"rule":"repeated","type":"string","id":3},"publicDependency":{"rule":"repeated","type":"int32","id":10},"weakDependency":{"rule":"repeated","type":"int32","id":11},"optionDependency":{"rule":"repeated","type":"string","id":15},"messageType":{"rule":"repeated","type":"DescriptorProto","id":4},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":5},"service":{"rule":"repeated","type":"ServiceDescriptorProto","id":6},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":7},"options":{"type":"FileOptions","id":8},"sourceCodeInfo":{"type":"SourceCodeInfo","id":9},"syntax":{"type":"string","id":12},"edition":{"type":"Edition","id":14}}},"DescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"field":{"rule":"repeated","type":"FieldDescriptorProto","id":2},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":6},"nestedType":{"rule":"repeated","type":"DescriptorProto","id":3},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":4},"extensionRange":{"rule":"repeated","type":"ExtensionRange","id":5},"oneofDecl":{"rule":"repeated","type":"OneofDescriptorProto","id":8},"options":{"type":"MessageOptions","id":7},"reservedRange":{"rule":"repeated","type":"ReservedRange","id":9},"reservedName":{"rule":"repeated","type":"string","id":10},"visibility":{"type":"SymbolVisibility","id":11}},"nested":{"ExtensionRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2},"options":{"type":"ExtensionRangeOptions","id":3}}},"ReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"ExtensionRangeOptions":{"edition":"proto2","fields":{"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999},"declaration":{"rule":"repeated","type":"Declaration","id":2,"options":{"retention":"RETENTION_SOURCE"}},"features":{"type":"FeatureSet","id":50},"verification":{"type":"VerificationState","id":3,"options":{"default":"UNVERIFIED","retention":"RETENTION_SOURCE"}}},"extensions":[[1000,536870911]],"nested":{"Declaration":{"fields":{"number":{"type":"int32","id":1},"fullName":{"type":"string","id":2},"type":{"type":"string","id":3},"reserved":{"type":"bool","id":5},"repeated":{"type":"bool","id":6}},"reserved":[[4,4]]},"VerificationState":{"values":{"DECLARATION":0,"UNVERIFIED":1}}}},"FieldDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":3},"label":{"type":"Label","id":4},"type":{"type":"Type","id":5},"typeName":{"type":"string","id":6},"extendee":{"type":"string","id":2},"defaultValue":{"type":"string","id":7},"oneofIndex":{"type":"int32","id":9},"jsonName":{"type":"string","id":10},"options":{"type":"FieldOptions","id":8},"proto3Optional":{"type":"bool","id":17}},"nested":{"Type":{"values":{"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Label":{"values":{"LABEL_OPTIONAL":1,"LABEL_REPEATED":3,"LABEL_REQUIRED":2}}}},"OneofDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"options":{"type":"OneofOptions","id":2}}},"EnumDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"value":{"rule":"repeated","type":"EnumValueDescriptorProto","id":2},"options":{"type":"EnumOptions","id":3},"reservedRange":{"rule":"repeated","type":"EnumReservedRange","id":4},"reservedName":{"rule":"repeated","type":"string","id":5},"visibility":{"type":"SymbolVisibility","id":6}},"nested":{"EnumReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"EnumValueDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"type":"EnumValueOptions","id":3}}},"ServiceDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"method":{"rule":"repeated","type":"MethodDescriptorProto","id":2},"options":{"type":"ServiceOptions","id":3}}},"MethodDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"inputType":{"type":"string","id":2},"outputType":{"type":"string","id":3},"options":{"type":"MethodOptions","id":4},"clientStreaming":{"type":"bool","id":5},"serverStreaming":{"type":"bool","id":6}}},"FileOptions":{"edition":"proto2","fields":{"javaPackage":{"type":"string","id":1},"javaOuterClassname":{"type":"string","id":8},"javaMultipleFiles":{"type":"bool","id":10},"javaGenerateEqualsAndHash":{"type":"bool","id":20,"options":{"deprecated":true}},"javaStringCheckUtf8":{"type":"bool","id":27},"optimizeFor":{"type":"OptimizeMode","id":9,"options":{"default":"SPEED"}},"goPackage":{"type":"string","id":11},"ccGenericServices":{"type":"bool","id":16},"javaGenericServices":{"type":"bool","id":17},"pyGenericServices":{"type":"bool","id":18},"deprecated":{"type":"bool","id":23},"ccEnableArenas":{"type":"bool","id":31,"options":{"default":true}},"objcClassPrefix":{"type":"string","id":36},"csharpNamespace":{"type":"string","id":37},"swiftPrefix":{"type":"string","id":39},"phpClassPrefix":{"type":"string","id":40},"phpNamespace":{"type":"string","id":41},"phpMetadataNamespace":{"type":"string","id":44},"rubyPackage":{"type":"string","id":45},"features":{"type":"FeatureSet","id":50},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[42,42],[38,38],"php_generic_services"],"nested":{"OptimizeMode":{"values":{"SPEED":1,"CODE_SIZE":2,"LITE_RUNTIME":3}}}},"MessageOptions":{"edition":"proto2","fields":{"messageSetWireFormat":{"type":"bool","id":1},"noStandardDescriptorAccessor":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"mapEntry":{"type":"bool","id":7},"deprecatedLegacyJsonFieldConflicts":{"type":"bool","id":11,"options":{"deprecated":true}},"features":{"type":"FeatureSet","id":12},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4],[5,5],[6,6],[8,8],[9,9]]},"FieldOptions":{"edition":"proto2","fields":{"ctype":{"type":"CType","id":1,"options":{"default":"STRING"}},"packed":{"type":"bool","id":2},"jstype":{"type":"JSType","id":6,"options":{"default":"JS_NORMAL"}},"lazy":{"type":"bool","id":5},"unverifiedLazy":{"type":"bool","id":15},"deprecated":{"type":"bool","id":3},"weak":{"type":"bool","id":10,"options":{"deprecated":true}},"debugRedact":{"type":"bool","id":16},"retention":{"type":"OptionRetention","id":17},"targets":{"rule":"repeated","type":"OptionTargetType","id":19},"editionDefaults":{"rule":"repeated","type":"EditionDefault","id":20},"features":{"type":"FeatureSet","id":21},"featureSupport":{"type":"FeatureSupport","id":22},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4],[18,18]],"nested":{"CType":{"values":{"STRING":0,"CORD":1,"STRING_PIECE":2}},"JSType":{"values":{"JS_NORMAL":0,"JS_STRING":1,"JS_NUMBER":2}},"OptionRetention":{"values":{"RETENTION_UNKNOWN":0,"RETENTION_RUNTIME":1,"RETENTION_SOURCE":2}},"OptionTargetType":{"values":{"TARGET_TYPE_UNKNOWN":0,"TARGET_TYPE_FILE":1,"TARGET_TYPE_EXTENSION_RANGE":2,"TARGET_TYPE_MESSAGE":3,"TARGET_TYPE_FIELD":4,"TARGET_TYPE_ONEOF":5,"TARGET_TYPE_ENUM":6,"TARGET_TYPE_ENUM_ENTRY":7,"TARGET_TYPE_SERVICE":8,"TARGET_TYPE_METHOD":9}},"EditionDefault":{"fields":{"edition":{"type":"Edition","id":3},"value":{"type":"string","id":2}}},"FeatureSupport":{"fields":{"editionIntroduced":{"type":"Edition","id":1},"editionDeprecated":{"type":"Edition","id":2},"deprecationWarning":{"type":"string","id":3},"editionRemoved":{"type":"Edition","id":4}}}}},"OneofOptions":{"edition":"proto2","fields":{"features":{"type":"FeatureSet","id":1},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumOptions":{"edition":"proto2","fields":{"allowAlias":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"deprecatedLegacyJsonFieldConflicts":{"type":"bool","id":6,"options":{"deprecated":true}},"features":{"type":"FeatureSet","id":7},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[5,5]]},"EnumValueOptions":{"edition":"proto2","fields":{"deprecated":{"type":"bool","id":1},"features":{"type":"FeatureSet","id":2},"debugRedact":{"type":"bool","id":3},"featureSupport":{"type":"FieldOptions.FeatureSupport","id":4},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"ServiceOptions":{"edition":"proto2","fields":{"features":{"type":"FeatureSet","id":34},"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"MethodOptions":{"edition":"proto2","fields":{"deprecated":{"type":"bool","id":33},"idempotencyLevel":{"type":"IdempotencyLevel","id":34,"options":{"default":"IDEMPOTENCY_UNKNOWN"}},"features":{"type":"FeatureSet","id":35},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"nested":{"IdempotencyLevel":{"values":{"IDEMPOTENCY_UNKNOWN":0,"NO_SIDE_EFFECTS":1,"IDEMPOTENT":2}}}},"UninterpretedOption":{"edition":"proto2","fields":{"name":{"rule":"repeated","type":"NamePart","id":2},"identifierValue":{"type":"string","id":3},"positiveIntValue":{"type":"uint64","id":4},"negativeIntValue":{"type":"int64","id":5},"doubleValue":{"type":"double","id":6},"stringValue":{"type":"bytes","id":7},"aggregateValue":{"type":"string","id":8}},"nested":{"NamePart":{"fields":{"namePart":{"rule":"required","type":"string","id":1},"isExtension":{"rule":"required","type":"bool","id":2}}}}},"FeatureSet":{"edition":"proto2","fields":{"fieldPresence":{"type":"FieldPresence","id":1,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_2023","edition_defaults.value":"EXPLICIT"}},"enumType":{"type":"EnumType","id":2,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"OPEN"}},"repeatedFieldEncoding":{"type":"RepeatedFieldEncoding","id":3,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"PACKED"}},"utf8Validation":{"type":"Utf8Validation","id":4,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"VERIFY"}},"messageEncoding":{"type":"MessageEncoding","id":5,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_LEGACY","edition_defaults.value":"LENGTH_PREFIXED"}},"jsonFormat":{"type":"JsonFormat","id":6,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"ALLOW"}},"enforceNamingStyle":{"type":"EnforceNamingStyle","id":7,"options":{"retention":"RETENTION_SOURCE","targets":"TARGET_TYPE_METHOD","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"STYLE2024"}},"defaultSymbolVisibility":{"type":"VisibilityFeature.DefaultSymbolVisibility","id":8,"options":{"retention":"RETENTION_SOURCE","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"EXPORT_TOP_LEVEL"}}},"extensions":[[1000,9994],[9995,9999],[10000,10000]],"reserved":[[999,999]],"nested":{"FieldPresence":{"values":{"FIELD_PRESENCE_UNKNOWN":0,"EXPLICIT":1,"IMPLICIT":2,"LEGACY_REQUIRED":3}},"EnumType":{"values":{"ENUM_TYPE_UNKNOWN":0,"OPEN":1,"CLOSED":2}},"RepeatedFieldEncoding":{"values":{"REPEATED_FIELD_ENCODING_UNKNOWN":0,"PACKED":1,"EXPANDED":2}},"Utf8Validation":{"values":{"UTF8_VALIDATION_UNKNOWN":0,"VERIFY":2,"NONE":3}},"MessageEncoding":{"values":{"MESSAGE_ENCODING_UNKNOWN":0,"LENGTH_PREFIXED":1,"DELIMITED":2}},"JsonFormat":{"values":{"JSON_FORMAT_UNKNOWN":0,"ALLOW":1,"LEGACY_BEST_EFFORT":2}},"EnforceNamingStyle":{"values":{"ENFORCE_NAMING_STYLE_UNKNOWN":0,"STYLE2024":1,"STYLE_LEGACY":2}},"VisibilityFeature":{"fields":{},"reserved":[[1,536870911]],"nested":{"DefaultSymbolVisibility":{"values":{"DEFAULT_SYMBOL_VISIBILITY_UNKNOWN":0,"EXPORT_ALL":1,"EXPORT_TOP_LEVEL":2,"LOCAL_ALL":3,"STRICT":4}}}}}},"FeatureSetDefaults":{"edition":"proto2","fields":{"defaults":{"rule":"repeated","type":"FeatureSetEditionDefault","id":1},"minimumEdition":{"type":"Edition","id":4},"maximumEdition":{"type":"Edition","id":5}},"nested":{"FeatureSetEditionDefault":{"fields":{"edition":{"type":"Edition","id":3},"overridableFeatures":{"type":"FeatureSet","id":4},"fixedFeatures":{"type":"FeatureSet","id":5}},"reserved":[[1,1],[2,2],"features"]}}},"SourceCodeInfo":{"edition":"proto2","fields":{"location":{"rule":"repeated","type":"Location","id":1}},"extensions":[[536000000,536000000]],"nested":{"Location":{"fields":{"path":{"rule":"repeated","type":"int32","id":1,"options":{"packed":true}},"span":{"rule":"repeated","type":"int32","id":2,"options":{"packed":true}},"leadingComments":{"type":"string","id":3},"trailingComments":{"type":"string","id":4},"leadingDetachedComments":{"rule":"repeated","type":"string","id":6}}}}},"GeneratedCodeInfo":{"edition":"proto2","fields":{"annotation":{"rule":"repeated","type":"Annotation","id":1}},"nested":{"Annotation":{"fields":{"path":{"rule":"repeated","type":"int32","id":1,"options":{"packed":true}},"sourceFile":{"type":"string","id":2},"begin":{"type":"int32","id":3},"end":{"type":"int32","id":4},"semantic":{"type":"Semantic","id":5}},"nested":{"Semantic":{"values":{"NONE":0,"SET":1,"ALIAS":2}}}}}},"SymbolVisibility":{"edition":"proto2","values":{"VISIBILITY_UNSET":0,"VISIBILITY_LOCAL":1,"VISIBILITY_EXPORT":2}}}}}}}}'))},71317,(a,b,c)=>{"use strict";var d=a.r(30155);b.exports=c=d.descriptor=d.Root.fromJSON(a.r(85565)).lookup(".google.protobuf");var e=d.Namespace,f=d.Root,g=d.Enum,h=d.Type,i=d.Field,j=d.MapField,k=d.OneOf,l=d.Service,m=d.Method;function n(a,b,d){var j=c.FileDescriptorProto.create({name:a.filename||(a.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});E(d,j),a instanceof f||(j.package=a.fullName.substring(1));for(var k,m=0;m<a.nestedArray.length;++m)(k=a._nestedArray[m])instanceof h?j.messageType.push(k.toDescriptor(d)):k instanceof g?j.enumType.push(k.toDescriptor()):k instanceof i?j.extension.push(k.toDescriptor(d)):k instanceof l?j.service.push(k.toDescriptor()):k instanceof e&&n(k,b,d);j.options=A(a.options,c.FileOptions),j.messageType.length+j.enumType.length+j.extension.length+j.service.length&&b.push(j)}f.fromDescriptor=function(a){"number"==typeof a.length&&(a=c.FileDescriptorSet.decode(a));var b=new f;if(a.file)for(var d,e,j,k=0;k<a.file.length;++k){e=b,(d=a.file[k]).package&&d.package.length&&(e=b.define(d.package));var m=D(d);if(d.name&&d.name.length&&b.files.push(e.filename=d.name),d.messageType)for(j=0;j<d.messageType.length;++j)e.add(h.fromDescriptor(d.messageType[j],m));if(d.enumType)for(j=0;j<d.enumType.length;++j)e.add(g.fromDescriptor(d.enumType[j],m));if(d.extension)for(j=0;j<d.extension.length;++j)e.add(i.fromDescriptor(d.extension[j],m));if(d.service)for(j=0;j<d.service.length;++j)e.add(l.fromDescriptor(d.service[j],m));var n=y(d.options,c.FileOptions);if(n){var o=Object.keys(n);for(j=0;j<o.length;++j)e.setOption(o[j],n[o[j]])}}return b.resolveAll()},f.prototype.toDescriptor=function(a){var b=c.FileDescriptorSet.create();return n(this,b.file,a),b};var o=0;h.fromDescriptor=function(a,b,d){"number"==typeof a.length&&(a=c.DescriptorProto.decode(a));var e,f=new h(a.name.length?a.name:"Type"+o++,y(a.options,c.MessageOptions));if(d||(f._edition=b),a.oneofDecl)for(e=0;e<a.oneofDecl.length;++e)f.add(k.fromDescriptor(a.oneofDecl[e]));if(a.field)for(e=0;e<a.field.length;++e){var j=i.fromDescriptor(a.field[e],b,!0);f.add(j),a.field[e].hasOwnProperty("oneofIndex")&&f.oneofsArray[a.field[e].oneofIndex].add(j)}if(a.extension)for(e=0;e<a.extension.length;++e)f.add(i.fromDescriptor(a.extension[e],b,!0));if(a.nestedType)for(e=0;e<a.nestedType.length;++e)f.add(h.fromDescriptor(a.nestedType[e],b,!0)),a.nestedType[e].options&&a.nestedType[e].options.mapEntry&&f.setOption("map_entry",!0);if(a.enumType)for(e=0;e<a.enumType.length;++e)f.add(g.fromDescriptor(a.enumType[e],b,!0));if(a.extensionRange&&a.extensionRange.length)for(e=0,f.extensions=[];e<a.extensionRange.length;++e)f.extensions.push([a.extensionRange[e].start,a.extensionRange[e].end]);if(a.reservedRange&&a.reservedRange.length||a.reservedName&&a.reservedName.length){if(f.reserved=[],a.reservedRange)for(e=0;e<a.reservedRange.length;++e)f.reserved.push([a.reservedRange[e].start,a.reservedRange[e].end]);if(a.reservedName)for(e=0;e<a.reservedName.length;++e)f.reserved.push(a.reservedName[e])}return f},h.prototype.toDescriptor=function(a){var b,d,e=c.DescriptorProto.create({name:this.name});for(d=0;d<this.fieldsArray.length;++d)if(e.field.push(b=this._fieldsArray[d].toDescriptor(a)),this._fieldsArray[d]instanceof j){var f=w(this._fieldsArray[d].keyType,this._fieldsArray[d].resolvedKeyType,!1),k=w(this._fieldsArray[d].type,this._fieldsArray[d].resolvedType,!1),l=11===k||14===k?this._fieldsArray[d].resolvedType&&B(this.parent,this._fieldsArray[d].resolvedType)||this._fieldsArray[d].type:void 0;e.nestedType.push(c.DescriptorProto.create({name:b.typeName,field:[c.FieldDescriptorProto.create({name:"key",number:1,label:1,type:f}),c.FieldDescriptorProto.create({name:"value",number:2,label:1,type:k,typeName:l})],options:c.MessageOptions.create({mapEntry:!0})}))}for(d=0;d<this.oneofsArray.length;++d)e.oneofDecl.push(this._oneofsArray[d].toDescriptor());for(d=0;d<this.nestedArray.length;++d)this._nestedArray[d]instanceof i?e.field.push(this._nestedArray[d].toDescriptor(a)):this._nestedArray[d]instanceof h?e.nestedType.push(this._nestedArray[d].toDescriptor(a)):this._nestedArray[d]instanceof g&&e.enumType.push(this._nestedArray[d].toDescriptor());if(this.extensions)for(d=0;d<this.extensions.length;++d)e.extensionRange.push(c.DescriptorProto.ExtensionRange.create({start:this.extensions[d][0],end:this.extensions[d][1]}));if(this.reserved)for(d=0;d<this.reserved.length;++d)"string"==typeof this.reserved[d]?e.reservedName.push(this.reserved[d]):e.reservedRange.push(c.DescriptorProto.ReservedRange.create({start:this.reserved[d][0],end:this.reserved[d][1]}));return e.options=A(this.options,c.MessageOptions),e};var p=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;i.fromDescriptor=function(a,b,d){if("number"==typeof a.length&&(a=c.DescriptorProto.decode(a)),"number"!=typeof a.number)throw Error("missing field id");switch(e=a.typeName&&a.typeName.length?a.typeName:u(a.type),a.label){case 1:f=void 0;break;case 2:f="required";break;case 3:f="repeated";break;default:throw Error("illegal label: "+a.label)}var e,f,g=a.extendee;void 0!==a.extendee&&(g=g.length?g:void 0);var h=new i(a.name.length?a.name:"field"+a.number,a.number,e,f,g);if(d||(h._edition=b),h.options=y(a.options,c.FieldOptions),a.proto3_optional&&(h.options.proto3_optional=!0),a.defaultValue&&a.defaultValue.length){var j=a.defaultValue;switch(j){case"true":case"TRUE":j=!0;break;case"false":case"FALSE":j=!1;break;default:p.exec(j)&&(j=parseInt(j))}h.setOption("default",j)}return v(a.type)&&("proto3"===b?a.options&&!a.options.packed&&h.setOption("packed",!1):(!b||"proto2"===b)&&a.options&&a.options.packed&&h.setOption("packed",!0)),h},i.prototype.toDescriptor=function(a){var b=c.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)b.type=11,b.typeName=d.util.ucFirst(this.name),b.label=3;else{switch(b.type=w(this.type,this.resolve().resolvedType,this.delimited)){case 10:case 11:case 14:b.typeName=this.resolvedType?B(this.parent,this.resolvedType):this.type}"repeated"===this.rule?b.label=3:this.required&&"proto2"===a?b.label=2:b.label=1}if(b.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(b.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(b.options=A(this.options,c.FieldOptions),null!=this.options.default&&(b.defaultValue=String(this.options.default)),this.options.proto3_optional&&(b.proto3_optional=!0)),"proto3"===a?this.packed||((b.options||(b.options=c.FieldOptions.create())).packed=!1):(!a||"proto2"===a)&&this.packed&&((b.options||(b.options=c.FieldOptions.create())).packed=!0),b};var q=0;g.fromDescriptor=function(a,b,d){"number"==typeof a.length&&(a=c.EnumDescriptorProto.decode(a));var e={};if(a.value)for(var f=0;f<a.value.length;++f){var h=a.value[f].name,i=a.value[f].number||0;e[h&&h.length?h:"NAME"+i]=i}var j=new g(a.name&&a.name.length?a.name:"Enum"+q++,e,y(a.options,c.EnumOptions));return d||(j._edition=b),j},g.prototype.toDescriptor=function(){for(var a=[],b=0,d=Object.keys(this.values);b<d.length;++b)a.push(c.EnumValueDescriptorProto.create({name:d[b],number:this.values[d[b]]}));return c.EnumDescriptorProto.create({name:this.name,value:a,options:A(this.options,c.EnumOptions)})};var r=0;k.fromDescriptor=function(a){return"number"==typeof a.length&&(a=c.OneofDescriptorProto.decode(a)),new k(a.name&&a.name.length?a.name:"oneof"+r++)},k.prototype.toDescriptor=function(){return c.OneofDescriptorProto.create({name:this.name})};var s=0;l.fromDescriptor=function(a,b,d){"number"==typeof a.length&&(a=c.ServiceDescriptorProto.decode(a));var e=new l(a.name&&a.name.length?a.name:"Service"+s++,y(a.options,c.ServiceOptions));if(d||(e._edition=b),a.method)for(var f=0;f<a.method.length;++f)e.add(m.fromDescriptor(a.method[f]));return e},l.prototype.toDescriptor=function(){for(var a=[],b=0;b<this.methodsArray.length;++b)a.push(this._methodsArray[b].toDescriptor());return c.ServiceDescriptorProto.create({name:this.name,method:a,options:A(this.options,c.ServiceOptions)})};var t=0;function u(a){switch(a){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+a)}function v(a){switch(a){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function w(a,b,c){switch(a){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(b instanceof g)return 14;if(b instanceof h)return c?10:11;throw Error("illegal type: "+a)}function x(a,b){for(var c,d,e={},f=0;f<b.fieldsArray.length;++f)if("uninterpretedOption"!==(d=(c=b._fieldsArray[f]).name)&&Object.prototype.hasOwnProperty.call(a,d)){var i=C(d);c.resolvedType instanceof h?e[i]=x(a[d],c.resolvedType):c.resolvedType instanceof g?e[i]=c.resolvedType.valuesById[a[d]]:e[i]=a[d]}return e}function y(a,b){if(a)return x(b.toObject(a),b)}function z(a,b){for(var c={},e=Object.keys(a),f=0;f<e.length;++f){var g=e[f],i=d.util.camelCase(g);if(Object.prototype.hasOwnProperty.call(b.fields,i)){var j=b.fields[i];j.resolvedType instanceof h?c[i]=z(a[g],j.resolvedType):c[i]=a[g],j.repeated&&!Array.isArray(c[i])&&(c[i]=[c[i]])}}return c}function A(a,b){if(a)return b.fromObject(z(a,b))}function B(a,b){var c=a.fullName.split("."),d=b.fullName.split("."),g=0,h=0,i=d.length-1;if(!(a instanceof f)&&b instanceof e)for(;g<c.length&&h<i&&c[g]===d[h];){var j=b.lookup(c[g++],!0);if(null!==j&&j!==b)break;++h}else for(;g<c.length&&h<i&&c[g]===d[h];++g,++h);return d.slice(h).join(".")}function C(a){return a.substring(0,1)+a.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(a,b){return"_"+b.toLowerCase()})}function D(a){if("editions"===a.syntax)if(a.edition===c.Edition.EDITION_2023)return"2023";else throw Error("Unsupported edition "+a.edition);return"proto3"===a.syntax?"proto3":"proto2"}function E(a,b){if(a)if("proto2"===a||"proto3"===a)b.syntax=a;else if(b.syntax="editions","2023"===a)b.edition=c.Edition.EDITION_2023;else throw Error("Unsupported edition "+a)}m.fromDescriptor=function(a){return"number"==typeof a.length&&(a=c.MethodDescriptorProto.decode(a)),new m(a.name&&a.name.length?a.name:"Method"+t++,"rpc",a.inputType,a.outputType,!!a.clientStreaming,!!a.serverStreaming,y(a.options,c.MethodOptions))},m.prototype.toDescriptor=function(){return c.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:A(this.options,c.MethodOptions)})}},58950,a=>{a.v({nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}})},48109,a=>{a.v({nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}})},95685,a=>{a.v({nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}})},69030,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.addCommonProtos=c.loadProtosWithOptionsSync=c.loadProtosWithOptions=void 0;let d=a.r(22734),e=a.r(14747),f=a.r(30155);function g(a,b){let c=a.resolvePath;a.resolvePath=(a,f)=>{if(e.isAbsolute(f))return f;for(let a of b){let b=e.join(a,f);try{return d.accessSync(b,d.constants.R_OK),b}catch(a){continue}}return process.emitWarning(`${f} not found in any of the include paths ${b}`),c(a,f)}}c.loadProtosWithOptions=async function(a,b){let c=new f.Root;if((b=b||{}).includeDirs){if(!Array.isArray(b.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));g(c,b.includeDirs)}let d=await c.load(a,b);return d.resolveAll(),d},c.loadProtosWithOptionsSync=function(a,b){let c=new f.Root;if((b=b||{}).includeDirs){if(!Array.isArray(b.includeDirs))throw Error("The includeDirs option must be an array");g(c,b.includeDirs)}let d=c.loadSync(a,b);return d.resolveAll(),d},c.addCommonProtos=function(){let b=a.r(58950),c=a.r(85565),d=a.r(48109),e=a.r(95685);f.common("api",b.nested.google.nested.protobuf.nested),f.common("descriptor",c.nested.google.nested.protobuf.nested),f.common("source_context",d.nested.google.nested.protobuf.nested),f.common("type",e.nested.google.nested.protobuf.nested)}},2774,(a,b,c)=>{!function(d,e){function f(a){return a.default||a}if("function"==typeof define&&define.amd){let b;void 0!==(b=function(){var a={};return e(a),f(a)}())&&a.v(b)}else e(c),b.exports=f(c)}("u">typeof globalThis?globalThis:"u">typeof self?self:a.e,function(a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var b=null;try{b=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function c(a,b,c){this.low=0|a,this.high=0|b,this.unsigned=!!c}function d(a){return!0===(a&&a.__isLong__)}function e(a){var b=Math.clz32(a&-a);return a?31-b:b}c.prototype.__isLong__,Object.defineProperty(c.prototype,"__isLong__",{value:!0}),c.isLong=d;var f={},g={};function h(a,b){var c,d,e;if(b)return(a>>>=0,(e=0<=a&&a<256)&&(d=g[a]))?d:(c=j(a,0,!0),e&&(g[a]=c),c);return(a|=0,(e=-128<=a&&a<128)&&(d=f[a]))?d:(c=j(a,a<0?-1:0,!1),e&&(f[a]=c),c)}function i(a,b){if(isNaN(a))return b?s:r;if(b){if(a<0)return s;if(a>=o)return x}else{if(a<=-p)return y;if(a+1>=p)return w}return a<0?i(-a,b).neg():j(a%n|0,a/n|0,b)}function j(a,b,d){return new c(a,b,d)}c.fromInt=h,c.fromNumber=i,c.fromBits=j;var k=Math.pow;function l(a,b,c){if(0===a.length)throw Error("empty string");if("number"==typeof b?(c=b,b=!1):b=!!b,"NaN"===a||"Infinity"===a||"+Infinity"===a||"-Infinity"===a)return b?s:r;if((c=c||10)<2||36<c)throw RangeError("radix");if((d=a.indexOf("-"))>0)throw Error("interior hyphen");if(0===d)return l(a.substring(1),b,c).neg();for(var d,e=i(k(c,8)),f=r,g=0;g<a.length;g+=8){var h=Math.min(8,a.length-g),j=parseInt(a.substring(g,g+h),c);if(h<8){var m=i(k(c,h));f=f.mul(m).add(i(j))}else f=(f=f.mul(e)).add(i(j))}return f.unsigned=b,f}function m(a,b){return"number"==typeof a?i(a,b):"string"==typeof a?l(a,b):j(a.low,a.high,"boolean"==typeof b?b:a.unsigned)}c.fromString=l,c.fromValue=m;var n=0x100000000,o=0xffffffffffffffff,p=0x8000000000000000,q=h(0x1000000),r=h(0);c.ZERO=r;var s=h(0,!0);c.UZERO=s;var t=h(1);c.ONE=t;var u=h(1,!0);c.UONE=u;var v=h(-1);c.NEG_ONE=v;var w=j(-1,0x7fffffff,!1);c.MAX_VALUE=w;var x=j(-1,-1,!0);c.MAX_UNSIGNED_VALUE=x;var y=j(0,-0x80000000,!1);c.MIN_VALUE=y;var z=c.prototype;z.toInt=function(){return this.unsigned?this.low>>>0:this.low},z.toNumber=function(){return this.unsigned?(this.high>>>0)*n+(this.low>>>0):this.high*n+(this.low>>>0)},z.toString=function(a){if((a=a||10)<2||36<a)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(!this.eq(y))return"-"+this.neg().toString(a);else{var b=i(a),c=this.div(b),d=c.mul(b).sub(this);return c.toString(a)+d.toInt().toString(a)}for(var e=i(k(a,6),this.unsigned),f=this,g="";;){var h=f.div(e),j=(f.sub(h.mul(e)).toInt()>>>0).toString(a);if((f=h).isZero())return j+g;for(;j.length<6;)j="0"+j;g=""+j+g}},z.getHighBits=function(){return this.high},z.getHighBitsUnsigned=function(){return this.high>>>0},z.getLowBits=function(){return this.low},z.getLowBitsUnsigned=function(){return this.low>>>0},z.getNumBitsAbs=function(){if(this.isNegative())return this.eq(y)?64:this.neg().getNumBitsAbs();for(var a=0!=this.high?this.high:this.low,b=31;b>0&&(a&1<<b)==0;b--);return 0!=this.high?b+33:b+1},z.isSafeInteger=function(){var a=this.high>>21;return!a||!this.unsigned&&-1===a&&(0!==this.low||-2097152!==this.high)},z.isZero=function(){return 0===this.high&&0===this.low},z.eqz=z.isZero,z.isNegative=function(){return!this.unsigned&&this.high<0},z.isPositive=function(){return this.unsigned||this.high>=0},z.isOdd=function(){return(1&this.low)==1},z.isEven=function(){return(1&this.low)==0},z.equals=function(a){return d(a)||(a=m(a)),(this.unsigned===a.unsigned||this.high>>>31!=1||a.high>>>31!=1)&&this.high===a.high&&this.low===a.low},z.eq=z.equals,z.notEquals=function(a){return!this.eq(a)},z.neq=z.notEquals,z.ne=z.notEquals,z.lessThan=function(a){return 0>this.comp(a)},z.lt=z.lessThan,z.lessThanOrEqual=function(a){return 0>=this.comp(a)},z.lte=z.lessThanOrEqual,z.le=z.lessThanOrEqual,z.greaterThan=function(a){return this.comp(a)>0},z.gt=z.greaterThan,z.greaterThanOrEqual=function(a){return this.comp(a)>=0},z.gte=z.greaterThanOrEqual,z.ge=z.greaterThanOrEqual,z.compare=function(a){if(d(a)||(a=m(a)),this.eq(a))return 0;var b=this.isNegative(),c=a.isNegative();return b&&!c?-1:!b&&c?1:this.unsigned?a.high>>>0>this.high>>>0||a.high===this.high&&a.low>>>0>this.low>>>0?-1:1:this.sub(a).isNegative()?-1:1},z.comp=z.compare,z.negate=function(){return!this.unsigned&&this.eq(y)?y:this.not().add(t)},z.neg=z.negate,z.add=function(a){d(a)||(a=m(a));var b,c,e=this.high>>>16,f=65535&this.high,g=this.low>>>16,h=65535&this.low,i=a.high>>>16,k=65535&a.high,l=a.low>>>16,n=65535&a.low,o=0,p=0;return b=0+((c=0+(h+n))>>>16),c&=65535,b+=g+l,p+=b>>>16,b&=65535,p+=f+k,o+=p>>>16,p&=65535,o+=e+i,j(b<<16|c,(o&=65535)<<16|p,this.unsigned)},z.subtract=function(a){return d(a)||(a=m(a)),this.add(a.neg())},z.sub=z.subtract,z.multiply=function(a){if(this.isZero())return this;if(d(a)||(a=m(a)),b)return j(b.mul(this.low,this.high,a.low,a.high),b.get_high(),this.unsigned);if(a.isZero())return this.unsigned?s:r;if(this.eq(y))return a.isOdd()?y:r;if(a.eq(y))return this.isOdd()?y:r;if(this.isNegative())if(a.isNegative())return this.neg().mul(a.neg());else return this.neg().mul(a).neg();if(a.isNegative())return this.mul(a.neg()).neg();if(this.lt(q)&&a.lt(q))return i(this.toNumber()*a.toNumber(),this.unsigned);var c,e,f=this.high>>>16,g=65535&this.high,h=this.low>>>16,k=65535&this.low,l=a.high>>>16,n=65535&a.high,o=a.low>>>16,p=65535&a.low,t=0,u=0;return c=0+((e=0+k*p)>>>16),e&=65535,c+=h*p,u+=c>>>16,c&=65535,c+=k*o,u+=c>>>16,c&=65535,u+=g*p,t+=u>>>16,u&=65535,u+=h*o,t+=u>>>16,u&=65535,u+=k*n,t+=u>>>16,u&=65535,t+=f*p+g*o+h*n+k*l,j(c<<16|e,(t&=65535)<<16|u,this.unsigned)},z.mul=z.multiply,z.divide=function(a){if(d(a)||(a=m(a)),a.isZero())throw Error("division by zero");if(b){var c,e,f;return this.unsigned||-0x80000000!==this.high||-1!==a.low||-1!==a.high?j((this.unsigned?b.div_u:b.div_s)(this.low,this.high,a.low,a.high),b.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?s:r;if(this.unsigned){if(a.unsigned||(a=a.toUnsigned()),a.gt(this))return s;if(a.gt(this.shru(1)))return u;f=s}else{if(this.eq(y))if(a.eq(t)||a.eq(v))return y;else return a.eq(y)?t:(c=this.shr(1).div(a).shl(1)).eq(r)?a.isNegative()?t:v:(e=this.sub(a.mul(c)),f=c.add(e.div(a)));if(a.eq(y))return this.unsigned?s:r;if(this.isNegative())return a.isNegative()?this.neg().div(a.neg()):this.neg().div(a).neg();if(a.isNegative())return this.div(a.neg()).neg();f=r}for(e=this;e.gte(a);){for(var g=Math.ceil(Math.log(c=Math.max(1,Math.floor(e.toNumber()/a.toNumber())))/Math.LN2),h=g<=48?1:k(2,g-48),l=i(c),n=l.mul(a);n.isNegative()||n.gt(e);)c-=h,n=(l=i(c,this.unsigned)).mul(a);l.isZero()&&(l=t),f=f.add(l),e=e.sub(n)}return f},z.div=z.divide,z.modulo=function(a){return(d(a)||(a=m(a)),b)?j((this.unsigned?b.rem_u:b.rem_s)(this.low,this.high,a.low,a.high),b.get_high(),this.unsigned):this.sub(this.div(a).mul(a))},z.mod=z.modulo,z.rem=z.modulo,z.not=function(){return j(~this.low,~this.high,this.unsigned)},z.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},z.clz=z.countLeadingZeros,z.countTrailingZeros=function(){return this.low?e(this.low):e(this.high)+32},z.ctz=z.countTrailingZeros,z.and=function(a){return d(a)||(a=m(a)),j(this.low&a.low,this.high&a.high,this.unsigned)},z.or=function(a){return d(a)||(a=m(a)),j(this.low|a.low,this.high|a.high,this.unsigned)},z.xor=function(a){return d(a)||(a=m(a)),j(this.low^a.low,this.high^a.high,this.unsigned)},z.shiftLeft=function(a){return(d(a)&&(a=a.toInt()),0==(a&=63))?this:a<32?j(this.low<<a,this.high<<a|this.low>>>32-a,this.unsigned):j(0,this.low<<a-32,this.unsigned)},z.shl=z.shiftLeft,z.shiftRight=function(a){return(d(a)&&(a=a.toInt()),0==(a&=63))?this:a<32?j(this.low>>>a|this.high<<32-a,this.high>>a,this.unsigned):j(this.high>>a-32,this.high>=0?0:-1,this.unsigned)},z.shr=z.shiftRight,z.shiftRightUnsigned=function(a){return(d(a)&&(a=a.toInt()),0==(a&=63))?this:a<32?j(this.low>>>a|this.high<<32-a,this.high>>>a,this.unsigned):32===a?j(this.high,0,this.unsigned):j(this.high>>>a-32,0,this.unsigned)},z.shru=z.shiftRightUnsigned,z.shr_u=z.shiftRightUnsigned,z.rotateLeft=function(a){var b;return(d(a)&&(a=a.toInt()),0==(a&=63))?this:32===a?j(this.high,this.low,this.unsigned):a<32?(b=32-a,j(this.low<<a|this.high>>>b,this.high<<a|this.low>>>b,this.unsigned)):(a-=32,b=32-a,j(this.high<<a|this.low>>>b,this.low<<a|this.high>>>b,this.unsigned))},z.rotl=z.rotateLeft,z.rotateRight=function(a){var b;return(d(a)&&(a=a.toInt()),0==(a&=63))?this:32===a?j(this.high,this.low,this.unsigned):a<32?(b=32-a,j(this.high<<b|this.low>>>a,this.low<<b|this.high>>>a,this.unsigned)):(a-=32,b=32-a,j(this.low<<b|this.high>>>a,this.high<<b|this.low>>>a,this.unsigned))},z.rotr=z.rotateRight,z.toSigned=function(){return this.unsigned?j(this.low,this.high,!1):this},z.toUnsigned=function(){return this.unsigned?this:j(this.low,this.high,!0)},z.toBytes=function(a){return a?this.toBytesLE():this.toBytesBE()},z.toBytesLE=function(){var a=this.high,b=this.low;return[255&b,b>>>8&255,b>>>16&255,b>>>24,255&a,a>>>8&255,a>>>16&255,a>>>24]},z.toBytesBE=function(){var a=this.high,b=this.low;return[a>>>24,a>>>16&255,a>>>8&255,255&a,b>>>24,b>>>16&255,b>>>8&255,255&b]},c.fromBytes=function(a,b,d){return d?c.fromBytesLE(a,b):c.fromBytesBE(a,b)},c.fromBytesLE=function(a,b){return new c(a[0]|a[1]<<8|a[2]<<16|a[3]<<24,a[4]|a[5]<<8|a[6]<<16|a[7]<<24,b)},c.fromBytesBE=function(a,b){return new c(a[4]<<24|a[5]<<16|a[6]<<8|a[7],a[0]<<24|a[1]<<16|a[2]<<8|a[3],b)},"function"==typeof BigInt&&(c.fromBigInt=function(a,b){return j(Number(BigInt.asIntN(32,a)),Number(BigInt.asIntN(32,a>>BigInt(32))),b)},c.fromValue=function(a,b){return"bigint"==typeof a?c.fromBigInt(a,b):m(a,b)},z.toBigInt=function(){var a=BigInt(this.low>>>0);return BigInt(this.unsigned?this.high>>>0:this.high)<<BigInt(32)|a}),a.default=c})},67523,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.loadFileDescriptorSetFromObject=c.loadFileDescriptorSetFromBuffer=c.fromJSON=c.loadSync=c.load=c.IdempotencyLevel=c.isAnyExtension=c.Long=void 0;let e=a.r(77802),f=a.r(30155),g=a.r(71317),h=a.r(69030);c.Long=a.r(2774),c.isAnyExtension=function(a){return"@type"in a&&"string"==typeof a["@type"]},function(a){a.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",a.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",a.IDEMPOTENT="IDEMPOTENT"}(d=c.IdempotencyLevel||(c.IdempotencyLevel={}));let i={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function j(a,b){return""===a?b:a+"."+b}function k(a){return a instanceof f.Service||a instanceof f.Type||a instanceof f.Enum}function l(a){return a instanceof f.Namespace||a instanceof f.Root}function m(a,b){let c=j(b,a.name);return k(a)?[[c,a]]:l(a)&&void 0!==a.nested?Object.keys(a.nested).map(b=>m(a.nested[b],c)).reduce((a,b)=>a.concat(b),[]):[]}function n(a,b){return function(c){return a.toObject(a.decode(c),b)}}function o(a){return function(b){if(Array.isArray(b))throw Error(`Failed to serialize message: expected object with ${a.name} structure, got array instead`);let c=a.fromObject(b);return a.encode(c).finish()}}function p(a){return(a||[]).reduce((a,b)=>{for(let[c,d]of Object.entries(b))"uninterpreted_option"===c?a.uninterpreted_option.push(b.uninterpreted_option):a[c]=d;return a},{deprecated:!1,idempotency_level:d.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function q(a,b,c,d){let f=a.resolvedRequestType,g=a.resolvedResponseType;return{path:"/"+b+"/"+a.name,requestStream:!!a.requestStream,responseStream:!!a.responseStream,requestSerialize:o(f),requestDeserialize:n(f,c),responseSerialize:o(g),responseDeserialize:n(g,c),originalName:e(a.name),requestType:s(f,d),responseType:s(g,d),options:p(a.parsedOptions)}}function r(a,b,c,d){let e={};for(let f of a.methodsArray)e[f.name]=q(f,b,c,d);return e}function s(a,b){let c=a.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:c.$type.toObject(c,i),fileDescriptorProtos:b}}function t(a,b){let c=a.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:c.$type.toObject(c,i),fileDescriptorProtos:b}}function u(a,b,c,d){if(a instanceof f.Service)return r(a,b,c,d);if(a instanceof f.Type)return s(a,d);if(a instanceof f.Enum)return t(a,d);throw Error("Type mismatch in reflection object handling")}function v(a,b){let c={};a.resolveAll();let d=a.toDescriptor("proto3").file.map(a=>Buffer.from(g.FileDescriptorProto.encode(a).finish()));for(let[e,f]of m(a,""))c[e]=u(f,e,b,d);return c}function w(a,b){b=b||{};let c=f.Root.fromDescriptor(a);return c.resolveAll(),v(c,b)}c.load=function(a,b){return(0,h.loadProtosWithOptions)(a,b).then(a=>v(a,b))},c.loadSync=function(a,b){return v((0,h.loadProtosWithOptionsSync)(a,b),b)},c.fromJSON=function(a,b){b=b||{};let c=f.Root.fromJSON(a);return c.resolveAll(),v(c,b)},c.loadFileDescriptorSetFromBuffer=function(a,b){return w(g.FileDescriptorSet.decode(a),b)},c.loadFileDescriptorSetFromObject=function(a,b){return w(g.FileDescriptorSet.fromObject(a),b)},(0,h.addCommonProtos)()},74970,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.getChannelzServiceDefinition=c.getChannelzHandlers=c.unregisterChannelzRef=c.registerChannelzSocket=c.registerChannelzServer=c.registerChannelzSubchannel=c.registerChannelzChannel=c.ChannelzCallTracker=c.ChannelzChildrenTracker=c.ChannelzTrace=void 0;let d=a.r(4446),e=a.r(56537),f=a.r(57982),g=a.r(91177),h=a.r(31509),i=a.r(80721);function j(a){return{channel_id:a.id,name:a.name}}function k(a){return{subchannel_id:a.id,name:a.name}}function l(a){return{server_id:a.id}}function m(a){return{socket_id:a.id,name:a.name}}let n=32;class o{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(a,b,c){let d=new Date;this.events.push({description:b,severity:a,timestamp:d,childChannel:(null==c?void 0:c.kind)==="channel"?c:void 0,childSubchannel:(null==c?void 0:c.kind)==="subchannel"?c:void 0}),this.events.length>=2*n&&(this.events=this.events.slice(n)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:B(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(a=>({description:a.description,severity:a.severity,timestamp:B(a.timestamp),channel_ref:a.childChannel?j(a.childChannel):null,subchannel_ref:a.childSubchannel?k(a.childSubchannel):null}))}}}c.ChannelzTrace=o;class p{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(a){var b,c,d;switch(a.kind){case"channel":{let c=null!=(b=this.channelChildren.get(a.id))?b:{ref:a,count:0};c.count+=1,this.channelChildren.set(a.id,c);break}case"subchannel":{let b=null!=(c=this.subchannelChildren.get(a.id))?c:{ref:a,count:0};b.count+=1,this.subchannelChildren.set(a.id,b);break}case"socket":{let b=null!=(d=this.socketChildren.get(a.id))?d:{ref:a,count:0};b.count+=1,this.socketChildren.set(a.id,b)}}}unrefChild(a){switch(a.kind){case"channel":{let b=this.channelChildren.get(a.id);void 0!==b&&(b.count-=1,0===b.count?this.channelChildren.delete(a.id):this.channelChildren.set(a.id,b));break}case"subchannel":{let b=this.subchannelChildren.get(a.id);void 0!==b&&(b.count-=1,0===b.count?this.subchannelChildren.delete(a.id):this.subchannelChildren.set(a.id,b));break}case"socket":{let b=this.socketChildren.get(a.id);void 0!==b&&(b.count-=1,0===b.count?this.socketChildren.delete(a.id):this.socketChildren.set(a.id,b))}}}getChildLists(){let a=[];for(let{ref:b}of this.channelChildren.values())a.push(b);let b=[];for(let{ref:a}of this.subchannelChildren.values())b.push(a);let c=[];for(let{ref:a}of this.socketChildren.values())c.push(a);return{channels:a,subchannels:b,sockets:c}}}c.ChannelzChildrenTracker=p;class q{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}}c.ChannelzCallTracker=q;let r=1;function s(){return r++}let t=[],u=[],v=[],w=[];function x(a){let b=Number.parseInt(a,16);return[b/256|0,b%256]}function y(a){return""===a?[]:[].concat(...a.split(":").map(a=>x(a)))}function z(a){if((0,d.isIPv4)(a))return Buffer.from(Uint8Array.from(a.split(".").map(a=>Number.parseInt(a))));if(!(0,d.isIPv6)(a))return null;{let b,c,d=a.indexOf("::");-1===d?(b=a,c=""):(b=a.substring(0,d),c=a.substring(d+2));let e=Buffer.from(y(b)),f=Buffer.from(y(c)),g=Buffer.alloc(16-e.length-f.length,0);return Buffer.concat([e,g,f])}}function A(a){switch(a){case e.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case e.ConnectivityState.IDLE:return{state:"IDLE"};case e.ConnectivityState.READY:return{state:"READY"};case e.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case e.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function B(a){if(!a)return null;let b=a.getTime();return{seconds:b/1e3|0,nanos:b%1e3*1e6}}function C(a){let b=a.getInfo();return{ref:j(a.ref),data:{target:b.target,state:A(b.state),calls_started:b.callTracker.callsStarted,calls_succeeded:b.callTracker.callsSucceeded,calls_failed:b.callTracker.callsFailed,last_call_started_timestamp:B(b.callTracker.lastCallStartedTimestamp),trace:b.trace.getTraceMessage()},channel_ref:b.children.channels.map(a=>j(a)),subchannel_ref:b.children.subchannels.map(a=>k(a))}}function D(a,b){let c=Number.parseInt(a.request.channel_id),d=t[c];void 0===d?b({code:f.Status.NOT_FOUND,details:"No channel data found for id "+c}):b(null,{channel:C(d)})}function E(a,b){let c=Number.parseInt(a.request.max_results),d=[],e=Number.parseInt(a.request.start_channel_id);for(;e<t.length;e++){let a=t[e];if(void 0!==a&&(d.push(C(a)),d.length>=c))break}b(null,{channel:d,end:e>=v.length})}function F(a){let b=a.getInfo();return{ref:l(a.ref),data:{calls_started:b.callTracker.callsStarted,calls_succeeded:b.callTracker.callsSucceeded,calls_failed:b.callTracker.callsFailed,last_call_started_timestamp:B(b.callTracker.lastCallStartedTimestamp),trace:b.trace.getTraceMessage()},listen_socket:b.listenerChildren.sockets.map(a=>m(a))}}function G(a,b){let c=Number.parseInt(a.request.server_id),d=v[c];void 0===d?b({code:f.Status.NOT_FOUND,details:"No server data found for id "+c}):b(null,{server:F(d)})}function H(a,b){let c=Number.parseInt(a.request.max_results),d=[],e=Number.parseInt(a.request.start_server_id);for(;e<v.length;e++){let a=v[e];if(void 0!==a&&(d.push(F(a)),d.length>=c))break}b(null,{server:d,end:e>=v.length})}function I(a,b){let c=Number.parseInt(a.request.subchannel_id),d=u[c];if(void 0===d)return void b({code:f.Status.NOT_FOUND,details:"No subchannel data found for id "+c});let e=d.getInfo();b(null,{subchannel:{ref:k(d.ref),data:{target:e.target,state:A(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:B(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},socket_ref:e.children.sockets.map(a=>m(a))}})}function J(a){var b;return(0,g.isTcpSubchannelAddress)(a)?{address:"tcpip_address",tcpip_address:{ip_address:null!=(b=z(a.host))?b:void 0,port:a.port}}:{address:"uds_address",uds_address:{filename:a.path}}}function K(a,b){var c,d,e,g,h;let i=Number.parseInt(a.request.socket_id),j=w[i];if(void 0===j)return void b({code:f.Status.NOT_FOUND,details:"No socket data found for id "+i});let k=j.getInfo(),l=k.security?{model:"tls",tls:{cipher_suite:k.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!=(c=k.security.cipherSuiteStandardName)?c:void 0,other_name:null!=(d=k.security.cipherSuiteOtherName)?d:void 0,local_certificate:null!=(e=k.security.localCertificate)?e:void 0,remote_certificate:null!=(g=k.security.remoteCertificate)?g:void 0}}:null;b(null,{socket:{ref:m(j.ref),local:k.localAddress?J(k.localAddress):null,remote:k.remoteAddress?J(k.remoteAddress):null,remote_name:null!=(h=k.remoteName)?h:void 0,security:l,data:{keep_alives_sent:k.keepAlivesSent,streams_started:k.streamsStarted,streams_succeeded:k.streamsSucceeded,streams_failed:k.streamsFailed,last_local_stream_created_timestamp:B(k.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:B(k.lastRemoteStreamCreatedTimestamp),messages_received:k.messagesReceived,messages_sent:k.messagesSent,last_message_received_timestamp:B(k.lastMessageReceivedTimestamp),last_message_sent_timestamp:B(k.lastMessageSentTimestamp),local_flow_control_window:k.localFlowControlWindow?{value:k.localFlowControlWindow}:null,remote_flow_control_window:k.remoteFlowControlWindow?{value:k.remoteFlowControlWindow}:null}}})}function L(a,b){let c=Number.parseInt(a.request.server_id),d=v[c];if(void 0===d)return void b({code:f.Status.NOT_FOUND,details:"No server data found for id "+c});let e=Number.parseInt(a.request.start_socket_id),g=Number.parseInt(a.request.max_results),h=d.getInfo().sessionChildren.sockets.sort((a,b)=>a.id-b.id),i=[],j=0;for(;j<h.length&&(!(h[j].id>=e)||(i.push(m(h[j])),!(i.length>=g)));j++);b(null,{socket_ref:i,end:j>=h.length})}function M(){return{GetChannel:D,GetTopChannels:E,GetServer:G,GetServers:H,GetSubchannel:I,GetSocket:K,GetServerSockets:L}}c.registerChannelzChannel=function(a,b,c){let d=s(),e={id:d,name:a,kind:"channel"};return c&&(t[d]={ref:e,getInfo:b}),e},c.registerChannelzSubchannel=function(a,b,c){let d=s(),e={id:d,name:a,kind:"subchannel"};return c&&(u[d]={ref:e,getInfo:b}),e},c.registerChannelzServer=function(a,b){let c=s(),d={id:c,kind:"server"};return b&&(v[c]={ref:d,getInfo:a}),d},c.registerChannelzSocket=function(a,b,c){let d=s(),e={id:d,name:a,kind:"socket"};return c&&(w[d]={ref:e,getInfo:b}),e},c.unregisterChannelzRef=function(a){switch(a.kind){case"channel":delete t[a.id];return;case"subchannel":delete u[a.id];return;case"server":delete v[a.id];return;case"socket":delete w[a.id];return}},c.getChannelzHandlers=M;let N=null;function O(){if(N)return N;let b=(0,a.r(67523).loadSync)("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:["/ROOT/node_modules/@grpc/grpc-js/build/src/../../proto"]});return N=(0,i.loadPackageDefinition)(b).grpc.channelz.v1.Channelz.service}c.getChannelzServiceDefinition=O,c.setup=function(){(0,h.registerAdminService)(O,M)}},85115,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Subchannel=void 0;let d=a.r(56537),e=a.r(57451),f=a.r(11717),g=a.r(57982),h=a.r(55647),i=a.r(91177),j=a.r(74970),k="subchannel",l=0x7fffffff;class m{constructor(a,b,c,f,g){var h;this.channelTarget=a,this.subchannelAddress=b,this.options=c,this.credentials=f,this.connector=g,this.connectivityState=d.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new j.ChannelzCallTracker,this.childrenTracker=new j.ChannelzChildrenTracker,this.streamTracker=new j.ChannelzCallTracker;const k={initialDelay:c["grpc.initial_reconnect_backoff_ms"],maxDelay:c["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new e.BackoffTimeout(()=>{this.handleBackoffTimer()},k),this.backoffTimeout.unref(),this.subchannelAddressString=(0,i.subchannelAddressToString)(b),this.keepaliveTime=null!=(h=c["grpc.keepalive_time_ms"])?h:-1,0===c["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new j.ChannelzTrace,this.channelzRef=(0,j.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(c,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(a){f.trace(g.LogVerbosity.DEBUG,k,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}refTrace(a){f.trace(g.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([d.ConnectivityState.TRANSIENT_FAILURE],d.ConnectivityState.CONNECTING):this.transitionToState([d.ConnectivityState.TRANSIENT_FAILURE],d.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let a=this.options;if(a["grpc.keepalive_time_ms"]){let b=Math.min(this.keepaliveTime,l);a=Object.assign(Object.assign({},a),{"grpc.keepalive_time_ms":b})}this.connector.connect(this.subchannelAddress,this.credentials,a).then(a=>{this.transitionToState([d.ConnectivityState.CONNECTING],d.ConnectivityState.READY)?(this.transport=a,this.channelzEnabled&&this.childrenTracker.refChild(a.getChannelzRef()),a.addDisconnectListener(a=>{this.transitionToState([d.ConnectivityState.READY],d.ConnectivityState.IDLE),a&&this.keepaliveTime>0&&(this.keepaliveTime*=2,f.log(g.LogVerbosity.ERROR,`Connection to ${(0,h.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):a.shutdown()},a=>{this.transitionToState([d.ConnectivityState.CONNECTING],d.ConnectivityState.TRANSIENT_FAILURE,`${a}`)})}transitionToState(a,b,c){var e,f;if(-1===a.indexOf(this.connectivityState))return!1;this.trace(d.ConnectivityState[this.connectivityState]+" -> "+d.ConnectivityState[b]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+d.ConnectivityState[b]);let g=this.connectivityState;switch(this.connectivityState=b,b){case d.ConnectivityState.READY:this.stopBackoff();break;case d.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case d.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(e=this.transport)||e.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case d.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(f=this.transport)||f.shutdown(),this.transport=null;break;default:throw Error(`Invalid state: unknown ConnectivityState ${b}`)}for(let a of this.stateListeners)a(this,g,b,this.keepaliveTime,c);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,j.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([d.ConnectivityState.CONNECTING,d.ConnectivityState.READY],d.ConnectivityState.IDLE)}))}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}createCall(a,b,c,d){let e;if(!this.transport)throw Error("Cannot create call, subchannel not READY");return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),e={onCallEnd:a=>{a.code===g.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):e={},this.transport.createCall(a,b,c,d,e)}startConnecting(){process.nextTick(()=>{this.transitionToState([d.ConnectivityState.IDLE],d.ConnectivityState.CONNECTING)||this.connectivityState!==d.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(a){this.stateListeners.add(a)}removeConnectivityStateListener(a){this.stateListeners.delete(a)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([d.ConnectivityState.TRANSIENT_FAILURE],d.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(a){return a.getRealSubchannel()===this}throttleKeepalive(a){a>this.keepaliveTime&&(this.keepaliveTime=a)}}c.Subchannel=m},25328,(a,b,c)=>{b.exports=a.x("http2",()=>require("http2"))},21517,(a,b,c)=>{b.exports=a.x("http",()=>require("http"))},92509,(a,b,c)=>{b.exports=a.x("url",()=>require("url"))},79594,(a,b,c)=>{b.exports=a.x("dns",()=>require("dns"))},87695,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.DEFAULT_PORT=void 0;let d=a.r(49845),e=a.r(79594),f=a.r(24361),g=a.r(83931),h=a.r(57982),i=a.r(57904),j=a.r(11717),k=a.r(57982),l=a.r(55647),m=a.r(4446),n=a.r(57451),o="dns_resolver";function p(a){j.trace(k.LogVerbosity.DEBUG,o,a)}c.DEFAULT_PORT=443;let q=3e4,r=f.promisify(e.resolveTxt),s=f.promisify(e.lookup);function t(...a){let b=[];for(let c=0;c<Math.max.apply(null,a.map(a=>a.length));c++)for(let d of a)c<d.length&&b.push(d[c]);return b}class u{constructor(a,b,d){var e,f,g;this.target=a,this.listener=b,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,p("Resolver constructed for target "+(0,l.uriToString)(a));const j=(0,l.splitHostPort)(a.path);null===j?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,m.isIPv4)(j.host)||(0,m.isIPv6)(j.host)?(this.ipResult=[{host:j.host,port:null!=(e=j.port)?e:c.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=j.host,this.port=null!=(f=j.port)?f:c.DEFAULT_PORT),this.percentage=100*Math.random(),1===d["grpc.service_config_disable_resolution"]&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:h.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,l.uriToString)(this.target)}`,metadata:new i.Metadata};const k={initialDelay:d["grpc.initial_reconnect_backoff_ms"],maxDelay:d["grpc.max_reconnect_backoff_ms"]};this.backoff=new n.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},k),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!=(g=d["grpc.dns_min_time_between_resolutions_ms"])?g:q,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){this.returnedIpResult||(p("Returning IP address for target "+(0,l.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(null===this.dnsHostname)p("Failed to parse DNS address "+(0,l.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:h.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,l.uriToString)(this.target)}`,metadata:new i.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;p("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let a=this.dnsHostname;this.pendingLookupPromise=s(a,{all:!0}),this.pendingLookupPromise.then(a=>{if(null===this.pendingLookupPromise)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let b=a.filter(a=>4===a.family),c=a.filter(a=>6===a.family);this.latestLookupResult=t(c,b).map(a=>({host:a.address,port:+this.port}));let d="["+this.latestLookupResult.map(a=>a.host+":"+a.port).join(",")+"]";(p("Resolved addresses for target "+(0,l.uriToString)(this.target)+": "+d),0===this.latestLookupResult.length)?this.listener.onError(this.defaultResolutionError):this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},a=>{null!==this.pendingLookupPromise&&(p("Resolution error for target "+(0,l.uriToString)(this.target)+": "+a.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&null===this.pendingTxtPromise&&(this.pendingTxtPromise=r(a),this.pendingTxtPromise.then(a=>{if(null!==this.pendingTxtPromise){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,g.extractAndSelectServiceConfig)(a,this.percentage)}catch(a){this.latestServiceConfigError={code:h.Status.UNAVAILABLE,details:`Parsing service config failed with error ${a.message}`,metadata:new i.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},a=>{}))}}startNextResolutionTimer(){var a,b;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null==(b=(a=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)?void 0:b.call(a),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?p('resolution update delayed by "min time between resolutions" rate limit'):p("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(a){return a.path}}c.setup=function(){(0,d.registerResolver)("dns",u),(0,d.registerDefaultScheme)("dns")}},17048,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getProxiedConnection=c.mapProxyName=void 0;let d=a.r(11717),e=a.r(57982),f=a.r(49845),g=a.r(21517),h=a.r(55004),i=a.r(11717),j=a.r(91177),k=a.r(55647),l=a.r(92509),m=a.r(87695),n="proxy";function o(a){i.trace(e.LogVerbosity.DEBUG,n,a)}function p(){let a,b="",c="";if(process.env.grpc_proxy)c="grpc_proxy",b=process.env.grpc_proxy;else if(process.env.https_proxy)c="https_proxy",b=process.env.https_proxy;else{if(!process.env.http_proxy)return{};c="http_proxy",b=process.env.http_proxy}try{a=new l.URL(b)}catch(a){return(0,d.log)(e.LogVerbosity.ERROR,`cannot parse value of "${c}" env var`),{}}if("http:"!==a.protocol)return(0,d.log)(e.LogVerbosity.ERROR,`"${a.protocol}" scheme not supported in proxy URI`),{};let f=null;a.username&&(a.password?((0,d.log)(e.LogVerbosity.INFO,"userinfo found in proxy URI"),f=`${a.username}:${a.password}`):f=a.username);let g=a.hostname,h=a.port;""===h&&(h="80");let i={address:`${g}:${h}`};return f&&(i.creds=f),o("Proxy server "+i.address+" set by environment variable "+c),i}function q(){let a=process.env.no_grpc_proxy,b="no_grpc_proxy";return(a||(a=process.env.no_proxy,b="no_proxy"),a)?(o("No proxy server list set by environment variable "+b),a.split(",")):[]}c.mapProxyName=function(a,b){var c;let d={target:a,extraOptions:{}};if((null!=(c=b["grpc.enable_http_proxy"])?c:1)===0||"unix"===a.scheme)return d;let e=p();if(!e.address)return d;let f=(0,k.splitHostPort)(a.path);if(!f)return d;let g=f.host;for(let b of q())if(b===g)return o("Not using proxy for target in no_proxy list: "+(0,k.uriToString)(a)),d;let h={"grpc.http_connect_target":(0,k.uriToString)(a)};return e.creds&&(h["grpc.http_connect_creds"]=e.creds),{target:{scheme:"dns",path:e.address},extraOptions:h}},c.getProxiedConnection=function(a,b,c){var i;if(!("grpc.http_connect_target"in b))return Promise.resolve({});let l=b["grpc.http_connect_target"],n=(0,k.parseUri)(l);if(null===n)return Promise.resolve({});let p=(0,k.splitHostPort)(n.path);if(null===p)return Promise.resolve({});let q=`${p.host}:${null!=(i=p.port)?i:m.DEFAULT_PORT}`,r={method:"CONNECT",path:q},s={Host:q};(0,j.isTcpSubchannelAddress)(a)?(r.host=a.host,r.port=a.port):r.socketPath=a.path,"grpc.http_connect_creds"in b&&(s["Proxy-Authorization"]="Basic "+Buffer.from(b["grpc.http_connect_creds"]).toString("base64")),r.headers=s;let t=(0,j.subchannelAddressToString)(a);return o("Using proxy "+t+" to connect to "+r.path),new Promise((a,b)=>{let i=g.request(r);i.once("connect",(g,j,l)=>{var m;if(i.removeAllListeners(),j.removeAllListeners(),200===g.statusCode)if(o("Successfully connected to "+r.path+" through proxy "+t),"secureContext"in c){let d=(0,f.getDefaultAuthority)(n),e=(0,k.splitHostPort)(d),g=null!=(m=null==e?void 0:e.host)?m:d,i=h.connect(Object.assign({host:g,servername:g,socket:j},c),()=>{o("Successfully established a TLS connection to "+r.path+" through proxy "+t),a({socket:i,realTarget:n})});i.on("error",a=>{o("Failed to establish a TLS connection to "+r.path+" through proxy "+t+" with error "+a.message),b()})}else o("Successfully established a plaintext connection to "+r.path+" through proxy "+t),a({socket:j,realTarget:n});else(0,d.log)(e.LogVerbosity.ERROR,"Failed to connect to "+r.path+" through proxy "+t+" with status "+g.statusCode),b()}),i.once("error",a=>{i.removeAllListeners(),(0,d.log)(e.LogVerbosity.ERROR,"Failed to connect to proxy "+t+" with error "+a.message),b()}),i.end()})}},64241,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.StreamDecoder=void 0,function(a){a[a.NO_DATA=0]="NO_DATA",a[a.READING_SIZE=1]="READING_SIZE",a[a.READING_MESSAGE=2]="READING_MESSAGE"}(d||(d={}));class e{constructor(a){this.maxReadMessageLength=a,this.readState=d.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(a){let b,c=0,e=[];for(;c<a.length;)switch(this.readState){case d.NO_DATA:this.readCompressFlag=a.slice(c,c+1),c+=1,this.readState=d.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case d.READING_SIZE:if(b=Math.min(a.length-c,this.readSizeRemaining),a.copy(this.readPartialSize,4-this.readSizeRemaining,c,c+b),this.readSizeRemaining-=b,c+=b,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),-1!==this.maxReadMessageLength&&this.readMessageSize>this.maxReadMessageLength)throw Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=d.READING_MESSAGE;else{let a=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=d.NO_DATA,e.push(a)}}break;case d.READING_MESSAGE:if(b=Math.min(a.length-c,this.readMessageRemaining),this.readPartialMessage.push(a.slice(c,c+b)),this.readMessageRemaining-=b,c+=b,0===this.readMessageRemaining){let a=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),b=Buffer.concat(a,this.readMessageSize+5);this.readState=d.NO_DATA,e.push(b)}break;default:throw Error("Unexpected read state")}return e}}c.StreamDecoder=e},34314,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Http2SubchannelCall=void 0;let d=a.r(25328),e=a.r(46786),f=a.r(57982),g=a.r(57904),h=a.r(64241),i=a.r(11717),j=a.r(57982),k="subchannel_call";function l(a){for(let[b,c]of Object.entries(e.constants.errno))if(c===a)return b;return"Unknown system error "+a}class m{constructor(a,b,c,e,i){var j;this.http2Stream=a,this.callEventTracker=b,this.listener=c,this.transport=e,this.callId=i,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=f.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;const k=null!=(j=e.getOptions()["grpc.max_receive_message_length"])?j:f.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new h.StreamDecoder(k),a.on("response",(a,b)=>{let c="";for(let b of Object.keys(a))c+="		"+b+": "+a[b]+"\n";switch(this.trace("Received server headers:\n"+c),a[":status"]){case 400:this.mappedStatusCode=f.Status.INTERNAL;break;case 401:this.mappedStatusCode=f.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=f.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=f.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=f.Status.UNAVAILABLE;break;default:this.mappedStatusCode=f.Status.UNKNOWN}if(b&d.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(a);else{let b;try{b=g.Metadata.fromHttp2Headers(a)}catch(a){this.endCall({code:f.Status.UNKNOWN,details:a.message,metadata:new g.Metadata});return}this.listener.onReceiveMetadata(b)}}),a.on("trailers",a=>{this.handleTrailers(a)}),a.on("data",a=>{let b;if(!this.statusOutput){this.trace("receive HTTP/2 data frame of length "+a.length);try{b=this.decoder.write(a)}catch(a){this.cancelWithStatus(f.Status.RESOURCE_EXHAUSTED,a.message);return}for(let a of b)this.trace("parsed message of length "+a.length),this.callEventTracker.addMessageReceived(),this.tryPush(a)}}),a.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),a.on("close",()=>{process.nextTick(()=>{var b;let c;if(this.trace("HTTP/2 stream closed with code "+a.rstCode),(null==(b=this.finalStatus)?void 0:b.code)===f.Status.OK)return;let e="";switch(a.rstCode){case d.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;c=f.Status.INTERNAL,e=`Received RST_STREAM with code ${a.rstCode}`;break;case d.constants.NGHTTP2_REFUSED_STREAM:c=f.Status.UNAVAILABLE,e="Stream refused by server";break;case d.constants.NGHTTP2_CANCEL:c=f.Status.CANCELLED,e="Call cancelled";break;case d.constants.NGHTTP2_ENHANCE_YOUR_CALM:c=f.Status.RESOURCE_EXHAUSTED,e="Bandwidth exhausted or memory limit exceeded";break;case d.constants.NGHTTP2_INADEQUATE_SECURITY:c=f.Status.PERMISSION_DENIED,e="Protocol not secure enough";break;case d.constants.NGHTTP2_INTERNAL_ERROR:c=f.Status.INTERNAL,null===this.internalError?e=`Received RST_STREAM with code ${a.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(c=f.Status.UNAVAILABLE,e=this.internalError.message):e=`Received RST_STREAM with code ${a.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:c=f.Status.INTERNAL,e=`Received RST_STREAM with code ${a.rstCode}`}this.endCall({code:c,details:e,metadata:new g.Metadata,rstCode:a.rstCode})})}),a.on("error",a=>{"ERR_HTTP2_STREAM_ERROR"!==a.code&&(this.trace("Node error event: message="+a.message+" code="+a.code+" errno="+l(a.errno)+" syscall="+a.syscall),this.internalError=a),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:f.Status.UNAVAILABLE,details:"Connection dropped",metadata:new g.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(a){i.trace(j.LogVerbosity.DEBUG,k,"["+this.callId+"] "+a)}endCall(a){(null===this.finalStatus||this.finalStatus.code===f.Status.OK)&&(this.finalStatus=a,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null===this.finalStatus||this.finalStatus.code===f.Status.OK&&(!this.readsClosed||0!==this.unpushedReadMessages.length||this.isReadFilterPending||this.isPushPending)||this.outputStatus()}push(a){this.trace("pushing to reader message of length "+(a instanceof Buffer?a.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,this.statusOutput||(this.listener.onReceiveMessage(a),this.maybeOutputStatus())})}tryPush(a){this.canPush?(this.http2Stream.pause(),this.push(a)):(this.trace("unpushedReadMessages.push message of length "+a.length),this.unpushedReadMessages.push(a))}handleTrailers(a){let b;this.callEventTracker.onStreamEnd(!0);let c="";for(let b of Object.keys(a))c+="		"+b+": "+a[b]+"\n";this.trace("Received server trailers:\n"+c);try{b=g.Metadata.fromHttp2Headers(a)}catch(a){b=new g.Metadata}let d=b.getMap(),e=this.mappedStatusCode;if(e===f.Status.UNKNOWN&&"string"==typeof d["grpc-status"]){let a=Number(d["grpc-status"]);a in f.Status&&(e=a,this.trace("received status code "+a+" from server")),b.remove("grpc-status")}let h="";if("string"==typeof d["grpc-message"]){try{h=decodeURI(d["grpc-message"])}catch(a){h=d["grpc-message"]}b.remove("grpc-message"),this.trace('received status details string "'+h+'" from server')}let i={code:e,details:h,metadata:b};this.endCall(i)}destroyHttp2Stream(){var a;if(!this.http2Stream.destroyed){let b;b=(null==(a=this.finalStatus)?void 0:a.code)===f.Status.OK?d.constants.NGHTTP2_NO_ERROR:d.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+b),this.http2Stream.close(b)}}cancelWithStatus(a,b){this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),this.endCall({code:a,details:b,metadata:new g.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==f.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let a=this.unpushedReadMessages.shift();this.push(a);return}this.http2Stream.resume()}sendMessageWithContext(a,b){this.trace("write() called with message of length "+b.length);let c=b=>{process.nextTick(()=>{var c;let d=f.Status.UNAVAILABLE;(null==b?void 0:b.code)==="ERR_STREAM_WRITE_AFTER_END"&&(d=f.Status.INTERNAL),b&&this.cancelWithStatus(d,`Write error: ${b.message}`),null==(c=a.callback)||c.call(a)})};this.trace("sending data chunk of length "+b.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(b,c)}catch(a){this.endCall({code:f.Status.UNAVAILABLE,details:`Write failed with error ${a.message}`,metadata:new g.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}}c.Http2SubchannelCall=m},72672,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getNextCallNumber=void 0;let d=0;c.getNextCallNumber=function(){return d++}},95320,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Http2SubchannelConnector=void 0;let d=a.r(25328),e=a.r(55004),f=a.r(74970),g=a.r(57982),h=a.r(17048),i=a.r(11717),j=a.r(49845),k=a.r(91177),l=a.r(55647),m=a.r(4446),n=a.r(34314),o=a.r(72672),p="transport",q="transport_flowctrl",r=a.r(17887).version,{HTTP2_HEADER_AUTHORITY:s,HTTP2_HEADER_CONTENT_TYPE:t,HTTP2_HEADER_METHOD:u,HTTP2_HEADER_PATH:v,HTTP2_HEADER_TE:w,HTTP2_HEADER_USER_AGENT:x}=d.constants,y=2e4,z=Buffer.from("too_many_pings","ascii");class A{constructor(a,b,c,e){this.session=a,this.options=c,this.remoteName=e,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=y,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new f.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,k.subchannelAddressToString)(b),0===c["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,f.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[c["grpc.primary_user_agent"],`grpc-node-js/${r}`,c["grpc.secondary_user_agent"]].filter(a=>a).join(" "),"grpc.keepalive_time_ms"in c&&(this.keepaliveTimeMs=c["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in c&&(this.keepaliveTimeoutMs=c["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in c?this.keepaliveWithoutCalls=1===c["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,a.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),a.once("goaway",(a,b,c)=>{let e=!1;a===d.constants.NGHTTP2_ENHANCE_YOUR_CALM&&c&&c.equals(z)&&(e=!0),this.trace("connection closed by GOAWAY with code "+a+" and data "+(null==c?void 0:c.toString())),this.reportDisconnectToOwner(e)}),a.once("error",a=>{this.trace("connection closed with error "+a.message)}),i.isTracerEnabled(p)&&(a.on("remoteSettings",b=>{this.trace("new settings received"+(this.session!==a?" on the old connection":"")+": "+JSON.stringify(b))}),a.on("localSettings",b=>{this.trace("local settings acknowledged by remote"+(this.session!==a?" on the old connection":"")+": "+JSON.stringify(b))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var a,b,c;let d,e=this.session.socket,f=e.remoteAddress?(0,k.stringToSubchannelAddress)(e.remoteAddress,e.remotePort):null,g=e.localAddress?(0,k.stringToSubchannelAddress)(e.localAddress,e.localPort):null;if(this.session.encrypted){let b=e,c=b.getCipher(),f=b.getCertificate(),g=b.getPeerCertificate();d={cipherSuiteStandardName:null!=(a=c.standardName)?a:null,cipherSuiteOtherName:c.standardName?null:c.name,localCertificate:f&&"raw"in f?f.raw:null,remoteCertificate:g&&"raw"in g?g.raw:null}}else d=null;return{remoteAddress:f,localAddress:g,security:d,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(b=this.session.state.localWindowSize)?b:null,remoteFlowControlWindow:null!=(c=this.session.state.remoteWindowSize)?c:null}}trace(a){i.trace(g.LogVerbosity.DEBUG,p,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}keepaliveTrace(a){i.trace(g.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}flowControlTrace(a){i.trace(g.LogVerbosity.DEBUG,q,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}internalsTrace(a){i.trace(g.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}reportDisconnectToOwner(a){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(b=>b(a)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let a of this.activeCalls)a.onDisconnect()})}addDisconnectListener(a){this.disconnectListeners.push(a)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var a,b;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null==(b=(a=this.keepaliveTimeoutId).unref)||b.call(a));try{this.session.ping((a,b,c)=>{a&&(this.keepaliveTrace("Ping failed with error "+a.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch(a){this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var a,b;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimerId||this.keepaliveTimeoutId||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=null==(b=(a=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)?void 0:b.call(a)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(a){this.activeCalls.delete(a),0===this.activeCalls.size&&this.session.unref()}addActiveCall(a){this.activeCalls.add(a),1===this.activeCalls.size&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(a,b,c,d,e){let f,g,h,i=a.toHttp2Headers();i[s]=b,i[x]=this.userAgent,i[t]="application/grpc",i[u]="POST",i[v]=c,i[w]="trailers";try{f=this.session.request(i)}catch(a){throw this.handleDisconnect(),a}return this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed),this.channelzEnabled?(this.streamTracker.addCallStarted(),g={addMessageSent:()=>{var a;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,null==(a=e.addMessageSent)||a.call(e)},addMessageReceived:()=>{var a;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,null==(a=e.addMessageReceived)||a.call(e)},onCallEnd:a=>{var b;null==(b=e.onCallEnd)||b.call(e,a),this.removeActiveCall(h)},onStreamEnd:a=>{var b;a?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),null==(b=e.onStreamEnd)||b.call(e,a)}}):g={addMessageSent:()=>{var a;null==(a=e.addMessageSent)||a.call(e)},addMessageReceived:()=>{var a;null==(a=e.addMessageReceived)||a.call(e)},onCallEnd:a=>{var b;null==(b=e.onCallEnd)||b.call(e,a),this.removeActiveCall(h)},onStreamEnd:a=>{var b;null==(b=e.onStreamEnd)||b.call(e,a)}},h=new n.Http2SubchannelCall(f,g,d,this,(0,o.getNextCallNumber)()),this.addActiveCall(h),h}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,f.unregisterChannelzRef)(this.channelzRef)}}class B{constructor(a){this.channelTarget=a,this.session=null,this.isShutdown=!1}trace(a){i.trace(g.LogVerbosity.DEBUG,p,(0,l.uriToString)(this.channelTarget)+" "+a)}createSession(a,b,c,f){return this.isShutdown?Promise.reject():new Promise((g,h)=>{var i,n,o;let p;f.realTarget?(p=(0,l.uriToString)(f.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,l.uriToString)(f.realTarget))):(p=null,this.trace("creating HTTP/2 session to "+(0,k.subchannelAddressToString)(a)));let q=(0,j.getDefaultAuthority)(null!=(i=f.realTarget)?i:this.channelTarget),r=b._getConnectionOptions()||{};r.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in c?r.maxSessionMemory=c["grpc-node.max_session_memory"]:r.maxSessionMemory=Number.MAX_SAFE_INTEGER;let s="http://";if("secureContext"in r){if(s="https://",c["grpc.ssl_target_name_override"]){let a=c["grpc.ssl_target_name_override"];r.checkServerIdentity=(b,c)=>(0,e.checkServerIdentity)(a,c),r.servername=a}else{let a=null!=(o=null==(n=(0,l.splitHostPort)(q))?void 0:n.host)?o:"localhost";r.servername=a}f.socket&&(r.createConnection=(a,b)=>f.socket)}else r.createConnection=(b,c)=>f.socket?f.socket:m.connect(a);r=Object.assign(Object.assign(Object.assign({},r),a),{enableTrace:1===c["grpc-node.tls_enable_trace"]});let t=d.connect(s+q,r);this.session=t;let u="Failed to connect";t.unref(),t.once("connect",()=>{t.removeAllListeners(),g(new A(t,a,c,p)),this.session=null}),t.once("close",()=>{this.session=null,setImmediate(()=>{h(`${u} (${new Date().toISOString()})`)})}),t.once("error",a=>{u=a.message,this.trace("connection failed with error "+u)})})}connect(a,b,c){var d,f;if(this.isShutdown)return Promise.reject();let g=b._getConnectionOptions()||{};if("secureContext"in g){if(g.ALPNProtocols=["h2"],c["grpc.ssl_target_name_override"]){let a=c["grpc.ssl_target_name_override"];g.checkServerIdentity=(b,c)=>(0,e.checkServerIdentity)(a,c),g.servername=a}else if("grpc.http_connect_target"in c){let a=(0,j.getDefaultAuthority)(null!=(d=(0,l.parseUri)(c["grpc.http_connect_target"]))?d:{path:"localhost"}),b=(0,l.splitHostPort)(a);g.servername=null!=(f=null==b?void 0:b.host)?f:a}c["grpc-node.tls_enable_trace"]&&(g.enableTrace=!0)}return(0,h.getProxiedConnection)(a,c,g).then(d=>this.createSession(a,b,c,d))}shutdown(){var a;this.isShutdown=!0,null==(a=this.session)||a.close(),this.session=null}}c.Http2SubchannelConnector=B},72939,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getSubchannelPool=c.SubchannelPool=void 0;let d=a.r(69359),e=a.r(85115),f=a.r(91177),g=a.r(55647),h=a.r(95320),i=1e4;class j{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let a=!0;for(let b in this.pool){let c=this.pool[b].filter(a=>!a.subchannel.unrefIfOneRef());c.length>0&&(a=!1),this.pool[b]=c}a&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var a,b;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},i),null==(b=(a=this.cleanupTimer).unref)||b.call(a))}getOrCreateSubchannel(a,b,c,i){this.ensureCleanupTask();let j=(0,g.uriToString)(a);if(j in this.pool){for(let a of this.pool[j])if((0,f.subchannelAddressEqual)(b,a.subchannelAddress)&&(0,d.channelOptionsEqual)(c,a.channelArguments)&&i._equals(a.channelCredentials))return a.subchannel}let k=new e.Subchannel(a,b,c,i,new h.Http2SubchannelConnector(a));return j in this.pool||(this.pool[j]=[]),this.pool[j].push({subchannelAddress:b,channelArguments:c,channelCredentials:i,subchannel:k}),k.ref(),k}}c.SubchannelPool=j;let k=new j;c.getSubchannelPool=function(a){return a?k:new j}},15325,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.FilterStackFactory=c.FilterStack=void 0;class d{constructor(a){this.filters=a}sendMetadata(a){let b=a;for(let a=0;a<this.filters.length;a++)b=this.filters[a].sendMetadata(b);return b}receiveMetadata(a){let b=a;for(let a=this.filters.length-1;a>=0;a--)b=this.filters[a].receiveMetadata(b);return b}sendMessage(a){let b=a;for(let a=0;a<this.filters.length;a++)b=this.filters[a].sendMessage(b);return b}receiveMessage(a){let b=a;for(let a=this.filters.length-1;a>=0;a--)b=this.filters[a].receiveMessage(b);return b}receiveTrailers(a){let b=a;for(let a=this.filters.length-1;a>=0;a--)b=this.filters[a].receiveTrailers(b);return b}push(a){this.filters.unshift(...a)}getFilters(){return this.filters}}c.FilterStack=d;class e{constructor(a){this.factories=a}push(a){this.factories.unshift(...a)}clone(){return new e([...this.factories])}createFilter(){return new d(this.factories.map(a=>a.createFilter()))}}c.FilterStackFactory=e},6461,(a,b,c)=>{b.exports=a.x("zlib",()=>require("zlib"))},69425,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.CompressionAlgorithms=void 0,function(a){a[a.identity=0]="identity",a[a.deflate=1]="deflate",a[a.gzip=2]="gzip"}(d||(c.CompressionAlgorithms=d={}))},59940,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BaseFilter=void 0;class d{async sendMetadata(a){return a}receiveMetadata(a){return a}async sendMessage(a){return a}async receiveMessage(a){return a}receiveTrailers(a){return a}}c.BaseFilter=d},13298,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CompressionFilterFactory=c.CompressionFilter=void 0;let d=a.r(6461),e=a.r(69425),f=a.r(57982),g=a.r(59940),h=a.r(11717),i=a=>"number"==typeof a&&"string"==typeof e.CompressionAlgorithms[a];class j{async writeMessage(a,b){let c=a;b&&(c=await this.compressMessage(c));let d=Buffer.allocUnsafe(c.length+5);return d.writeUInt8(+!!b,0),d.writeUInt32BE(c.length,1),c.copy(d,5),d}async readMessage(a){let b=1===a.readUInt8(0),c=a.slice(5);return b&&(c=await this.decompressMessage(c)),c}}class k extends j{async compressMessage(a){return a}async writeMessage(a,b){let c=Buffer.allocUnsafe(a.length+5);return c.writeUInt8(0,0),c.writeUInt32BE(a.length,1),a.copy(c,5),c}decompressMessage(a){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}}class l extends j{constructor(a){super(),this.maxRecvMessageLength=a}compressMessage(a){return new Promise((b,c)=>{d.deflate(a,(a,d)=>{a?c(a):b(d)})})}decompressMessage(a){return new Promise((b,c)=>{let e=0,g=[],h=d.createInflate();h.on("data",a=>{g.push(a),e+=a.byteLength,-1!==this.maxRecvMessageLength&&e>this.maxRecvMessageLength&&(h.destroy(),c({code:f.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),h.on("end",()=>{b(Buffer.concat(g))}),h.write(a),h.end()})}}class m extends j{constructor(a){super(),this.maxRecvMessageLength=a}compressMessage(a){return new Promise((b,c)=>{d.gzip(a,(a,d)=>{a?c(a):b(d)})})}decompressMessage(a){return new Promise((b,c)=>{let e=0,g=[],h=d.createGunzip();h.on("data",a=>{g.push(a),e+=a.byteLength,-1!==this.maxRecvMessageLength&&e>this.maxRecvMessageLength&&(h.destroy(),c({code:f.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),h.on("end",()=>{b(Buffer.concat(g))}),h.write(a),h.end()})}}class n extends j{constructor(a){super(),this.compressionName=a}compressMessage(a){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(a){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}}function o(a,b){switch(a){case"identity":return new k;case"deflate":return new l(b);case"gzip":return new m(b);default:return new n(a)}}class p extends g.BaseFilter{constructor(a,b){var c,d;super(),this.sharedFilterConfig=b,this.sendCompression=new k,this.receiveCompression=new k,this.currentCompressionAlgorithm="identity";const g=a["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=null!=(c=a["grpc.max_receive_message_length"])?c:f.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,void 0!==g)if(i(g)){const a=e.CompressionAlgorithms[g],c=null==(d=b.serverSupportedEncodingHeader)?void 0:d.split(",");(!c||c.includes(a))&&(this.currentCompressionAlgorithm=a,this.sendCompression=o(this.currentCompressionAlgorithm,-1))}else h.log(f.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${g}`)}async sendMetadata(a){let b=await a;return b.set("grpc-accept-encoding","identity,deflate,gzip"),b.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?b.remove("grpc-encoding"):b.set("grpc-encoding",this.currentCompressionAlgorithm),b}receiveMetadata(a){let b=a.get("grpc-encoding");if(b.length>0){let a=b[0];"string"==typeof a&&(this.receiveCompression=o(a,this.maxReceiveMessageLength))}a.remove("grpc-encoding");let c=a.get("grpc-accept-encoding")[0];return c&&(this.sharedFilterConfig.serverSupportedEncodingHeader=c,c.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new k,this.currentCompressionAlgorithm="identity")),a.remove("grpc-accept-encoding"),a}async sendMessage(a){var b;let c,d=await a;return c=!(this.sendCompression instanceof k)&&((null!=(b=d.flags)?b:0)&2)==0,{message:await this.sendCompression.writeMessage(d.message,c),flags:d.flags}}async receiveMessage(a){return this.receiveCompression.readMessage(await a)}}c.CompressionFilter=p;class q{constructor(a,b){this.options=b,this.sharedFilterConfig={}}createFilter(){return new p(this.options,this.sharedFilterConfig)}}c.CompressionFilterFactory=q},1150,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.deadlineToString=c.getRelativeTimeout=c.getDeadlineTimeoutString=c.minDeadline=void 0,c.minDeadline=function(...a){let b=1/0;for(let c of a){let a=c instanceof Date?c.getTime():c;a<b&&(b=a)}return b};let d=[["m",1],["S",1e3],["M",6e4],["H",36e5]];c.getDeadlineTimeoutString=function(a){let b=new Date().getTime();a instanceof Date&&(a=a.getTime());let c=Math.max(a-b,0);for(let[a,b]of d){let d=c/b;if(d<1e8)return String(Math.ceil(d))+a}throw Error("Deadline is too far in the future")};let e=0x7fffffff;c.getRelativeTimeout=function(a){let b=(a instanceof Date?a.getTime():a)-new Date().getTime();return b<0?0:b>e?1/0:b},c.deadlineToString=function(a){if(a instanceof Date)return a.toISOString();{let b=new Date(a);return Number.isNaN(b.getTime())?""+a:b.toISOString()}}},65149,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.restrictControlPlaneStatusCode=void 0;let d=a.r(57982),e=[d.Status.OK,d.Status.INVALID_ARGUMENT,d.Status.NOT_FOUND,d.Status.ALREADY_EXISTS,d.Status.FAILED_PRECONDITION,d.Status.ABORTED,d.Status.OUT_OF_RANGE,d.Status.DATA_LOSS];c.restrictControlPlaneStatusCode=function(a,b){return e.includes(a)?{code:d.Status.INTERNAL,details:`Invalid status from control plane: ${a} ${d.Status[a]} ${b}`}:{code:a,details:b}}},25326,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.LoadBalancingCall=void 0;let d=a.r(56537),e=a.r(57982),f=a.r(1150),g=a.r(57904),h=a.r(3681),i=a.r(55647),j=a.r(11717),k=a.r(65149),l=a.r(25328),m="load_balancing_call";class n{constructor(a,b,c,d,e,f,g){var h,j;this.channel=a,this.callConfig=b,this.methodName=c,this.host=d,this.credentials=e,this.deadline=f,this.callNumber=g,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;const k=this.methodName.split("/");let l="";k.length>=2&&(l=k[1]);const m=null!=(j=null==(h=(0,i.splitHostPort)(this.host))?void 0:h.host)?j:"localhost";this.serviceUrl=`https://${m}/${l}`}trace(a){j.trace(e.LogVerbosity.DEBUG,m,"["+this.callNumber+"] "+a)}outputStatus(a,b){var c,d;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+a.code+' details="'+a.details+'"');let e=Object.assign(Object.assign({},a),{progress:b});null==(c=this.listener)||c.onReceiveStatus(e),null==(d=this.onCallEnded)||d.call(this,e.code)}}doPick(){var a,b;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");let c=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=c.subchannel?"("+c.subchannel.getChannelzRef().id+") "+c.subchannel.getAddress():""+c.subchannel;switch(this.trace("Pick result: "+h.PickResultType[c.pickResultType]+" subchannel: "+i+" status: "+(null==(a=c.status)?void 0:a.code)+" "+(null==(b=c.status)?void 0:b.details)),c.pickResultType){case h.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var b,h,j;if(this.ended)return void this.trace("Credentials metadata generation finished after call ended");let k=this.metadata.clone();if(k.merge(a),k.get("authorization").length>1&&this.outputStatus({code:e.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new g.Metadata},"PROCESSED"),c.subchannel.getConnectivityState()!==d.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+d.ConnectivityState[c.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&k.set("grpc-timeout",(0,f.getDeadlineTimeoutString)(this.deadline));try{this.child=c.subchannel.getRealSubchannel().createCall(k,this.host,this.methodName,{onReceiveMetadata:a=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(a)},onReceiveMessage:a=>{this.trace("Received message"),this.listener.onReceiveMessage(a)},onReceiveStatus:a=>{this.trace("Received status"),a.rstCode===l.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(a,"REFUSED"):this.outputStatus(a,"PROCESSED")}})}catch(a){this.trace("Failed to start call on picked subchannel "+i+" with error "+a.message),this.outputStatus({code:e.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+a.message,metadata:new g.Metadata},"NOT_STARTED");return}null==(h=(b=this.callConfig).onCommitted)||h.call(b),null==(j=c.onCallStarted)||j.call(c),this.onCallEnded=c.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:b,details:c}=(0,k.restrictControlPlaneStatusCode)("number"==typeof a.code?a.code:e.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:b,details:c,metadata:new g.Metadata},"PROCESSED")});break;case h.PickResultType.DROP:let{code:j,details:m}=(0,k.restrictControlPlaneStatusCode)(c.status.code,c.status.details);setImmediate(()=>{this.outputStatus({code:j,details:m,metadata:c.status.metadata},"DROP")});break;case h.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:b}=(0,k.restrictControlPlaneStatusCode)(c.status.code,c.status.details);setImmediate(()=>{this.outputStatus({code:a,details:b,metadata:c.status.metadata},"PROCESSED")})}break;case h.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(a,b){var c;this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),null==(c=this.child)||c.cancelWithStatus(a,b),this.outputStatus({code:a,details:b,metadata:new g.Metadata},"PROCESSED")}getPeer(){var a,b;return null!=(b=null==(a=this.child)?void 0:a.getPeer())?b:this.channel.getTarget()}start(a,b){this.trace("start called"),this.listener=b,this.metadata=a,this.doPick()}sendMessageWithContext(a,b){this.trace("write() called with message of length "+b.length),this.child?this.child.sendMessageWithContext(a,b):this.pendingMessage={context:a,message:b}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(a){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}}c.LoadBalancingCall=n},8122,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ResolvingCall=void 0;let d=a.r(57982),e=a.r(1150),f=a.r(57904),g=a.r(11717),h=a.r(65149),i="resolving_call";class j{constructor(a,b,c,f,g,h){this.channel=a,this.method=b,this.filterStackFactory=f,this.credentials=g,this.callNumber=h,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=c.deadline,this.host=c.host,c.parentCall&&(c.flags&d.Propagate.CANCELLATION&&c.parentCall.on("cancelled",()=>{this.cancelWithStatus(d.Status.CANCELLED,"Cancelled by parent call")}),c.flags&d.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+c.parentCall.getDeadline()),this.deadline=(0,e.minDeadline)(this.deadline,c.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(a){g.trace(d.LogVerbosity.DEBUG,i,"["+this.callNumber+"] "+a)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,e.deadlineToString)(this.deadline));let a=(0,e.getRelativeTimeout)(this.deadline);if(a!==1/0){this.trace("Deadline will be reached in "+a+"ms");let b=()=>{this.cancelWithStatus(d.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};a<=0?process.nextTick(b):this.deadlineTimer=setTimeout(b,a)}}outputStatus(a){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let b=this.filterStack.receiveTrailers(a);this.trace("ended with status: code="+b.code+' details="'+b.details+'"'),this.statusWatchers.forEach(a=>a(b)),process.nextTick(()=>{var a;null==(a=this.listener)||a.onReceiveStatus(b)})}}sendMessageOnChild(a,b){if(!this.child)throw Error("sendMessageonChild called with child not populated");let c=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:b,flags:a.flags})).then(b=>{this.writeFilterPending=!1,c.sendMessageWithContext(a,b.message),this.pendingHalfClose&&c.halfClose()},a=>{this.cancelWithStatus(a.code,a.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");let a=this.channel.getConfig(this.method,this.metadata);if("NONE"===a.type)return void this.channel.queueCallForConfig(this);if("ERROR"===a.type)return void(this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(a.error));let b=a.config;if(b.status!==d.Status.OK){let{code:a,details:c}=(0,h.restrictControlPlaneStatusCode)(b.status,"Failed to route call to method "+this.method);this.outputStatus({code:a,details:c,metadata:new f.Metadata});return}if(b.methodConfig.timeout){let a=new Date;a.setSeconds(a.getSeconds()+b.methodConfig.timeout.seconds),a.setMilliseconds(a.getMilliseconds()+b.methodConfig.timeout.nanos/1e6),this.deadline=(0,e.minDeadline)(this.deadline,a),this.runDeadlineTimer()}this.filterStackFactory.push(b.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(a=>{this.child=this.channel.createInnerCall(b,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(a,{onReceiveMetadata:a=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(a))},onReceiveMessage:a=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(a).then(a=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(a),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},a=>{this.cancelWithStatus(a.code,a.details)})},onReceiveStatus:a=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=a:this.outputStatus(a)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},a=>{this.outputStatus(a)})}reportResolverError(a){var b;(null==(b=this.metadata)?void 0:b.getOptions().waitForReady)?this.channel.queueCallForConfig(this):this.outputStatus(a)}cancelWithStatus(a,b){var c;this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),null==(c=this.child)||c.cancelWithStatus(a,b),this.outputStatus({code:a,details:b,metadata:new f.Metadata})}getPeer(){var a,b;return null!=(b=null==(a=this.child)?void 0:a.getPeer())?b:this.channel.getTarget()}start(a,b){this.trace("start called"),this.metadata=a.clone(),this.listener=b,this.getConfig()}sendMessageWithContext(a,b){this.trace("write() called with message of length "+b.length),this.child?this.sendMessageOnChild(a,b):this.pendingMessage={context:a,message:b}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(a){this.credentials=this.credentials.compose(a)}addStatusWatcher(a){this.statusWatchers.push(a)}getCallNumber(){return this.callNumber}}c.ResolvingCall=j},98364,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.RetryingCall=c.MessageBufferTracker=c.RetryThrottler=void 0;let d=a.r(57982),e=a.r(57904),f=a.r(11717),g="retrying_call";class h{constructor(a,b,c){this.maxTokens=a,this.tokenRatio=b,c?this.tokens=c.tokens*(a/c.maxTokens):this.tokens=a}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}}c.RetryThrottler=h;class i{constructor(a,b){this.totalLimit=a,this.limitPerCall=b,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(a,b){var c;let d=null!=(c=this.allocatedPerCall.get(b))?c:0;return!(this.limitPerCall-d<a)&&!(this.totalLimit-this.totalAllocated<a)&&(this.allocatedPerCall.set(b,d+a),this.totalAllocated+=a,!0)}free(a,b){var c;if(this.totalAllocated<a)throw Error(`Invalid buffer allocation state: call ${b} freed ${a} > total allocated ${this.totalAllocated}`);this.totalAllocated-=a;let d=null!=(c=this.allocatedPerCall.get(b))?c:0;if(d<a)throw Error(`Invalid buffer allocation state: call ${b} freed ${a} > allocated for call ${d}`);this.allocatedPerCall.set(b,d-a)}freeAll(a){var b;let c=null!=(b=this.allocatedPerCall.get(a))?b:0;if(this.totalAllocated<c)throw Error(`Invalid buffer allocation state: call ${a} allocated ${c} > total allocated ${this.totalAllocated}`);this.totalAllocated-=c,this.allocatedPerCall.delete(a)}}c.MessageBufferTracker=i;let j="grpc-previous-rpc-attempts";class k{constructor(a,b,c,d,e,f,g,h,i){if(this.channel=a,this.callConfig=b,this.methodName=c,this.host=d,this.credentials=e,this.deadline=f,this.callNumber=g,this.bufferTracker=h,this.retryThrottler=i,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,b.methodConfig.retryPolicy){this.state="RETRY";const a=b.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(a.initialBackoff.substring(0,a.initialBackoff.length-1))}else b.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(a){f.trace(d.LogVerbosity.DEBUG,g,"["+this.callNumber+"] "+a)}reportStatus(a){this.trace("ended with status: code="+a.code+' details="'+a.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var b;null==(b=this.listener)||b.onReceiveStatus({code:a.code,details:a.details,metadata:a.metadata})})}cancelWithStatus(a,b){for(let{call:c}of(this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),this.reportStatus({code:a,details:b,metadata:new e.Metadata}),this.underlyingCalls))c.cancelWithStatus(a,b)}getPeer(){return null!==this.committedCallIndex?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(a){var b;return null!=(b=this.writeBuffer[a-this.writeBufferOffset])?b:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if("COMMITTED"!==this.state)return;let a=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let b=this.writeBufferOffset;b<a;b++){let a=this.getBufferEntry(b);a.allocated&&this.bufferTracker.free(a.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(a-this.writeBufferOffset),this.writeBufferOffset=a}commitCall(a){if("COMMITTED"!==this.state&&"COMPLETED"!==this.underlyingCalls[a].state){this.trace("Committing call ["+this.underlyingCalls[a].call.getCallNumber()+"] at index "+a),this.state="COMMITTED",this.committedCallIndex=a;for(let b=0;b<this.underlyingCalls.length;b++)b!==a&&"COMPLETED"!==this.underlyingCalls[b].state&&(this.underlyingCalls[b].state="COMPLETED",this.underlyingCalls[b].call.cancelWithStatus(d.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if("COMMITTED"===this.state)return;let a=-1,b=-1;for(let[c,d]of this.underlyingCalls.entries())"ACTIVE"===d.state&&d.nextMessageToSend>a&&(a=d.nextMessageToSend,b=c);-1===b?this.state="TRANSPARENT_ONLY":this.commitCall(b)}isStatusCodeInList(a,b){return a.some(a=>a===b||a.toString().toLowerCase()===d.Status[b].toLowerCase())}getNextRetryBackoffMs(){var a;let b=null==(a=this.callConfig)?void 0:a.methodConfig.retryPolicy;if(!b)return 0;let c=Math.random()*this.nextRetryBackoffSec*1e3,d=Number(b.maxBackoff.substring(0,b.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*b.backoffMultiplier,d),c}maybeRetryCall(a,b){let c;if("RETRY"!==this.state)return void b(!1);let d=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(d.maxAttempts,5))return void b(!1);if(null===a)c=this.getNextRetryBackoffMs();else if(a<0){this.state="TRANSPARENT_ONLY",b(!1);return}else c=a,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var a,c;"RETRY"!==this.state?b(!1):(null==(c=null==(a=this.retryThrottler)?void 0:a.canRetryCall())||c)&&(b(!0),this.attempts+=1,this.startNewAttempt())},c)}countActiveCalls(){let a=0;for(let b of this.underlyingCalls)(null==b?void 0:b.state)==="ACTIVE"&&(a+=1);return a}handleProcessedStatus(a,b,c){var d,e,f;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(b),this.reportStatus(a);break;case"HEDGING":if(this.isStatusCodeInList(null!=(d=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)?d:[],a.code)){let d;if(null==(e=this.retryThrottler)||e.addCallFailed(),null===c)d=0;else if(c<0){this.state="TRANSPARENT_ONLY",this.commitCall(b),this.reportStatus(a);return}else d=c;setTimeout(()=>{this.maybeStartHedgingAttempt(),0===this.countActiveCalls()&&(this.commitCall(b),this.reportStatus(a))},d)}else this.commitCall(b),this.reportStatus(a);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,a.code)?(null==(f=this.retryThrottler)||f.addCallFailed(),this.maybeRetryCall(c,c=>{c||(this.commitCall(b),this.reportStatus(a))})):(this.commitCall(b),this.reportStatus(a))}}getPushback(a){let b=a.get("grpc-retry-pushback-ms");if(0===b.length)return null;try{return parseInt(b[0])}catch(a){return -1}}handleChildStatus(a,b){var c;if("COMPLETED"===this.underlyingCalls[b].state)return;if(this.trace("state="+this.state+" handling status with progress "+a.progress+" from child ["+this.underlyingCalls[b].call.getCallNumber()+"] in state "+this.underlyingCalls[b].state),this.underlyingCalls[b].state="COMPLETED",a.code===d.Status.OK){null==(c=this.retryThrottler)||c.addCallSucceeded(),this.commitCall(b),this.reportStatus(a);return}if("COMMITTED"===this.state)return void this.reportStatus(a);let e=this.getPushback(a.metadata);switch(a.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(a,b,e):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(b),this.reportStatus(a);break;case"PROCESSED":this.handleProcessedStatus(a,b,e)}}maybeStartHedgingAttempt(){if("HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let a=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(a.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var a,b,c;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),"HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let d=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(d.maxAttempts,5))return;let e=null!=(a=d.hedgingDelay)?a:"0s",f=Number(e.substring(0,e.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},1e3*f),null==(c=(b=this.hedgingTimer).unref)||c.call(b)}startNewAttempt(){let a=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+a.getCallNumber()+"] for attempt "+this.attempts);let b=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:a,nextMessageToSend:0});let c=this.attempts-1,d=this.initialMetadata.clone();c>0&&d.set(j,`${c}`);let e=!1;a.start(d,{onReceiveMetadata:d=>{this.trace("Received metadata from child ["+a.getCallNumber()+"]"),this.commitCall(b),e=!0,c>0&&d.set(j,`${c}`),"ACTIVE"===this.underlyingCalls[b].state&&this.listener.onReceiveMetadata(d)},onReceiveMessage:c=>{this.trace("Received message from child ["+a.getCallNumber()+"]"),this.commitCall(b),"ACTIVE"===this.underlyingCalls[b].state&&this.listener.onReceiveMessage(c)},onReceiveStatus:d=>{this.trace("Received status from child ["+a.getCallNumber()+"]"),!e&&c>0&&d.metadata.set(j,`${c}`),this.handleChildStatus(d,b)}}),this.sendNextChildMessage(b),this.readStarted&&a.startRead()}start(a,b){this.trace("start called"),this.listener=b,this.initialMetadata=a,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(a){var b,c;let d=this.underlyingCalls[a],e=d.nextMessageToSend;null==(c=(b=this.getBufferEntry(e)).callback)||c.call(b),this.clearSentMessages(),d.nextMessageToSend+=1,this.sendNextChildMessage(a)}sendNextChildMessage(a){let b=this.underlyingCalls[a];if("COMPLETED"!==b.state&&this.getBufferEntry(b.nextMessageToSend)){let c=this.getBufferEntry(b.nextMessageToSend);switch(c.entryType){case"MESSAGE":b.call.sendMessageWithContext({callback:b=>{this.handleChildWriteCompleted(a)}},c.message.message);break;case"HALF_CLOSE":b.nextMessageToSend+=1,b.call.halfClose()}}}sendMessageWithContext(a,b){var c;this.trace("write() called with message of length "+b.length);let d={message:b,flags:a.flags},e=this.getNextBufferIndex(),f={entryType:"MESSAGE",message:d,allocated:this.bufferTracker.allocate(b.length,this.callNumber)};if(this.writeBuffer.push(f),f.allocated)for(let[d,f]of(null==(c=a.callback)||c.call(a),this.underlyingCalls.entries()))"ACTIVE"===f.state&&f.nextMessageToSend===e&&f.call.sendMessageWithContext({callback:a=>{this.handleChildWriteCompleted(d)}},b);else{if(this.commitCallWithMostMessages(),null===this.committedCallIndex)return;let c=this.underlyingCalls[this.committedCallIndex];f.callback=a.callback,"ACTIVE"===c.state&&c.nextMessageToSend===e&&c.call.sendMessageWithContext({callback:a=>{this.handleChildWriteCompleted(this.committedCallIndex)}},b)}}startRead(){for(let a of(this.trace("startRead called"),this.readStarted=!0,this.underlyingCalls))(null==a?void 0:a.state)==="ACTIVE"&&a.call.startRead()}halfClose(){this.trace("halfClose called");let a=this.getNextBufferIndex();for(let b of(this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1}),this.underlyingCalls))(null==b?void 0:b.state)==="ACTIVE"&&b.nextMessageToSend===a&&(b.nextMessageToSend+=1,b.call.halfClose())}setCredentials(a){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}}c.RetryingCall=k},4706,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BaseSubchannelWrapper=void 0;class d{constructor(a){this.child=a}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(a){this.child.addConnectivityStateListener(a)}removeConnectivityStateListener(a){this.child.removeConnectivityStateListener(a)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(a){this.child.throttleKeepalive(a)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(a){return this.getRealSubchannel()===a.getRealSubchannel()}}c.BaseSubchannelWrapper=d},75952,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.InternalChannel=void 0;let d=a.r(61591),e=a.r(74765),f=a.r(72939),g=a.r(3681),h=a.r(57982),i=a.r(15325),j=a.r(13298),k=a.r(49845),l=a.r(11717),m=a.r(17048),n=a.r(55647),o=a.r(56537),p=a.r(74970),q=a.r(25326),r=a.r(1150),s=a.r(8122),t=a.r(72672),u=a.r(65149),v=a.r(98364),w=a.r(4706),x=0x7fffffff,y=1e3,z=18e5,A=new Map,B=0x1000000,C=1048576;class D extends w.BaseSubchannelWrapper{constructor(a,b){super(a),this.channel=b,this.refCount=0,this.subchannelStateListener=(a,c,d,e)=>{b.throttleKeepalive(e)},a.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}}class E{constructor(a,b,c){var q,r,s,t,w,E,F,G;if(this.credentials=b,this.options=c,this.connectivityState=o.ConnectivityState.IDLE,this.currentPicker=new g.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new p.ChannelzCallTracker,this.childrenTracker=new p.ChannelzChildrenTracker,"string"!=typeof a)throw TypeError("Channel target must be a string");if(!(b instanceof d.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(c&&"object"!=typeof c)throw TypeError("Channel options must be an object");this.originalTarget=a;const H=(0,n.parseUri)(a);if(null===H)throw Error(`Could not parse target name "${a}"`);const I=(0,k.mapUriDefaultScheme)(H);if(null===I)throw Error(`Could not find a default scheme for target name "${a}"`);this.callRefTimer=setInterval(()=>{},x),null==(r=(q=this.callRefTimer).unref)||r.call(q),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new p.ChannelzTrace,this.channelzRef=(0,p.registerChannelzChannel)(a,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,k.getDefaultAuthority)(I);const J=(0,m.mapProxyName)(I,c);this.target=J.target,this.options=Object.assign({},this.options,J.extraOptions),this.subchannelPool=(0,f.getSubchannelPool)((null!=(s=c["grpc.use_local_subchannel_pool"])?s:0)===0),this.retryBufferTracker=new v.MessageBufferTracker(null!=(t=c["grpc.retry_buffer_size"])?t:B,null!=(w=c["grpc.per_rpc_retry_buffer_size"])?w:C),this.keepaliveTime=null!=(E=c["grpc.keepalive_time_ms"])?E:-1,this.idleTimeoutMs=Math.max(null!=(F=c["grpc.client_idle_timeout_ms"])?F:z,y);const K={createSubchannel:(a,b)=>{let c=this.subchannelPool.getOrCreateSubchannel(this.target,a,Object.assign({},this.options,b),this.credentials);c.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",c.getChannelzRef());let d=new D(c,this);return this.wrappedSubchannels.add(d),d},updateState:(a,b)=>{this.currentPicker=b;let c=this.pickQueue.slice();for(let a of(this.pickQueue=[],c.length>0&&this.callRefTimerUnref(),c))a.doPick();this.updateState(a)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:a=>{this.channelzEnabled&&this.childrenTracker.refChild(a)},removeChannelzChild:a=>{this.channelzEnabled&&this.childrenTracker.unrefChild(a)}};this.resolvingLoadBalancer=new e.ResolvingLoadBalancer(this.target,K,c,(a,b)=>{a.retryThrottling?A.set(this.getTarget(),new v.RetryThrottler(a.retryThrottling.maxTokens,a.retryThrottling.tokenRatio,A.get(this.getTarget()))):A.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=b,this.currentResolutionError=null,process.nextTick(()=>{let a=this.configSelectionQueue;for(let b of(this.configSelectionQueue=[],a.length>0&&this.callRefTimerUnref(),a))b.getConfig()})},a=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+a.code+' and details "'+a.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},(0,u.restrictControlPlaneStatusCode)(a.code,a.details)),{metadata:a.metadata}));let b=this.configSelectionQueue;for(let c of(this.configSelectionQueue=[],b.length>0&&this.callRefTimerUnref(),b))c.reportResolverError(a)}),this.filterStackFactory=new i.FilterStackFactory([new j.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(c,void 0,2));const L=Error();(0,l.trace)(h.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null==(G=L.stack)?void 0:G.substring(L.stack.indexOf("\n")+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(a,b){(0,l.trace)(null!=b?b:h.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,n.uriToString)(this.target)+" "+a)}callRefTimerRef(){var a,b,c,d;(null==(b=(a=this.callRefTimer).hasRef)?void 0:b.call(a))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(d=(c=this.callRefTimer).ref)||d.call(c))}callRefTimerUnref(){var a,b;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(b=(a=this.callRefTimer).unref)||b.call(a))}removeConnectivityStateWatcher(a){let b=this.connectivityStateWatchers.findIndex(b=>b===a);b>=0&&this.connectivityStateWatchers.splice(b,1)}updateState(a){for(let b of((0,l.trace)(h.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,n.uriToString)(this.target)+" "+o.ConnectivityState[this.connectivityState]+" -> "+o.ConnectivityState[a]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+o.ConnectivityState[a]),this.connectivityState=a,this.connectivityStateWatchers.slice()))a!==b.currentState&&(b.timer&&clearTimeout(b.timer),this.removeConnectivityStateWatcher(b),b.callback());a!==o.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(a){if(a>this.keepaliveTime)for(let b of(this.keepaliveTime=a,this.wrappedSubchannels))b.throttleKeepalive(a)}removeWrappedSubchannel(a){this.wrappedSubchannels.delete(a)}doPick(a,b){return this.currentPicker.pick({metadata:a,extraPickInfo:b})}queueCallForPick(a){this.pickQueue.push(a),this.callRefTimerRef()}getConfig(a,b){return(this.resolvingLoadBalancer.exitIdle(),this.configSelector)?{type:"SUCCESS",config:this.configSelector(a,b)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(a){this.configSelectionQueue.push(a),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(o.ConnectivityState.IDLE),this.currentPicker=new g.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(a){var b,c;this.idleTimer=setTimeout(()=>{if(this.callCount>0)return void this.startIdleTimeout(this.idleTimeoutMs);let a=new Date().valueOf()-this.lastActivityTimestamp.valueOf();a>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-a)},a),null==(c=(b=this.idleTimer).unref)||c.call(b)}maybeStartIdleTimer(){this.connectivityState===o.ConnectivityState.SHUTDOWN||this.idleTimer||this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(a){this.channelzEnabled&&(a.code===h.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(a,b,c,d,e){let f=(0,t.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+f+'] method="'+b+'"'),new q.LoadBalancingCall(this,a,b,c,d,e,f)}createRetryingCall(a,b,c,d,e){let f=(0,t.getNextCallNumber)();return this.trace("createRetryingCall ["+f+'] method="'+b+'"'),new v.RetryingCall(this,a,b,c,d,e,f,this.retryBufferTracker,A.get(this.getTarget()))}createInnerCall(a,b,c,d,e){return 0===this.options["grpc.enable_retries"]?this.createLoadBalancingCall(a,b,c,d,e):this.createRetryingCall(a,b,c,d,e)}createResolvingCall(a,b,c,d,e){let f=(0,t.getNextCallNumber)();this.trace("createResolvingCall ["+f+'] method="'+a+'", deadline='+(0,r.deadlineToString)(b));let g={deadline:b,flags:null!=e?e:h.Propagate.DEFAULTS,host:null!=c?c:this.defaultAuthority,parentCall:d},i=new s.ResolvingCall(this,a,g,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),f);return this.onCallStart(),i.addStatusWatcher(a=>{this.onCallEnd(a)}),i}close(){this.resolvingLoadBalancer.destroy(),this.updateState(o.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,p.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,n.uriToString)(this.target)}getConnectivityState(a){let b=this.connectivityState;return a&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),b}watchConnectivityState(a,b,c){if(this.connectivityState===o.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let d=null;if(b!==1/0){let a=b instanceof Date?b:new Date(b),f=new Date;if(b===-1/0||a<=f)return void process.nextTick(c,Error("Deadline passed without connectivity state change"));d=setTimeout(()=>{this.removeConnectivityStateWatcher(e),c(Error("Deadline passed without connectivity state change"))},a.getTime()-f.getTime())}let e={currentState:a,callback:c,timer:d};this.connectivityStateWatchers.push(e)}getChannelzRef(){return this.channelzRef}createCall(a,b,c,d,e){if("string"!=typeof a)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof b||b instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===o.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");return this.createResolvingCall(a,b,c,d,e)}}c.InternalChannel=E},61655,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ChannelImplementation=void 0;let d=a.r(61591),e=a.r(75952);class f{constructor(a,b,c){if("string"!=typeof a)throw TypeError("Channel target must be a string");if(!(b instanceof d.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(c&&"object"!=typeof c)throw TypeError("Channel options must be an object");this.internalChannel=new e.InternalChannel(a,b,c)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(a){return this.internalChannel.getConnectivityState(a)}watchConnectivityState(a,b,c){this.internalChannel.watchConnectivityState(a,b,c)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(a,b,c,d,e){if("string"!=typeof a)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof b||b instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(a,b,c,d,e)}}c.ChannelImplementation=f},15365,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Http2ServerCallStream=c.ServerDuplexStreamImpl=c.ServerWritableStreamImpl=c.ServerReadableStreamImpl=c.ServerUnaryCallImpl=void 0;let d=a.r(27699),e=a.r(25328),f=a.r(88947),g=a.r(6461),h=a.r(57982),i=a.r(57904),j=a.r(64241),k=a.r(11717),l=a.r(21015),m="server_call";function n(a){k.trace(h.LogVerbosity.DEBUG,m,a)}let o="grpc-message",p="grpc-status",q="grpc-timeout",r=/(\d{1,8})\s*([HMSmun])/,s={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},t={"grpc-accept-encoding":"identity,deflate,gzip","grpc-encoding":"identity"},u={[e.constants.HTTP2_HEADER_STATUS]:e.constants.HTTP_STATUS_OK,[e.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},v={waitForTrailers:!0};class w extends d.EventEmitter{constructor(a,b,c){super(),this.call=a,this.metadata=b,this.request=c,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}c.ServerUnaryCallImpl=w;class x extends f.Readable{constructor(a,b,c,d){super({objectMode:!0}),this.call=a,this.metadata=b,this.deserialize=c,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,d)}_read(a){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}c.ServerReadableStreamImpl=x;class y extends f.Writable{constructor(a,b,c,d){super({objectMode:!0}),this.call=a,this.metadata=b,this.serialize=c,this.request=d,this.cancelled=!1,this.trailingMetadata=new i.Metadata,this.call.setupSurfaceCall(this),this.on("error",a=>{this.call.sendError(a),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(a,b,c){try{let b=this.call.serializeMessage(a);if(!this.call.write(b))return void this.call.once("drain",c)}catch(a){this.emit("error",{details:(0,l.getErrorMessage)(a),code:h.Status.INTERNAL})}c()}_final(a){this.call.sendStatus({code:h.Status.OK,details:"OK",metadata:this.trailingMetadata}),a(null)}end(a){return a&&(this.trailingMetadata=a),super.end()}}c.ServerWritableStreamImpl=y;class z extends f.Duplex{constructor(a,b,c,d,e){super({objectMode:!0}),this.call=a,this.metadata=b,this.serialize=c,this.deserialize=d,this.cancelled=!1,this.trailingMetadata=new i.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,e),this.on("error",a=>{this.call.sendError(a),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(a){return a&&(this.trailingMetadata=a),super.end()}}c.ServerDuplexStreamImpl=z,z.prototype._read=x.prototype._read,z.prototype._write=y.prototype._write,z.prototype._final=y.prototype._final;class A extends d.EventEmitter{constructor(a,b,c){super(),this.stream=a,this.handler=b,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=h.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=h.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",a=>{}),this.stream.once("close",()=>{var a;n("Request to method "+(null==(a=this.handler)?void 0:a.path)+" stream closed with rstCode "+this.stream.rstCode),!this.statusSent&&(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:h.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in c&&(this.maxSendMessageSize=c["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in c&&(this.maxReceiveMessageSize=c["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(a,b){let c=a.subarray(5);if("identity"===b)return c;if("deflate"!==b&&"gzip"!==b)return Promise.reject({code:h.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${b}"`});{let a;return a="deflate"===b?g.createInflate():g.createGunzip(),new Promise((b,d)=>{let e=0,f=[];a.on("data",b=>{f.push(b),e+=b.byteLength,-1!==this.maxReceiveMessageSize&&e>this.maxReceiveMessageSize&&(a.destroy(),d({code:h.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),a.on("end",()=>{b(Buffer.concat(f))}),a.write(c),a.end()})}}sendMetadata(a){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let b=a?a.toHttp2Headers():null,c=Object.assign(Object.assign(Object.assign({},u),t),b);this.stream.respond(c,v)}receiveMetadata(a){let b=i.Metadata.fromHttp2Headers(a);k.isTracerEnabled(m)&&n("Request to "+this.handler.path+" received headers "+JSON.stringify(b.toJSON()));let c=b.get(q);if(c.length>0){let a=c[0].toString().match(r);if(null===a){let a=Error("Invalid deadline");return a.code=h.Status.OUT_OF_RANGE,this.sendError(a),b}let d=a[1]*s[a[2]]|0,e=new Date;this.deadline=e.setMilliseconds(e.getMilliseconds()+d),this.deadlineTimer=setTimeout(B,d,this),b.remove(q)}return b.remove(e.constants.HTTP2_HEADER_ACCEPT_ENCODING),b.remove(e.constants.HTTP2_HEADER_TE),b.remove(e.constants.HTTP2_HEADER_CONTENT_TYPE),b.remove("grpc-accept-encoding"),b}receiveUnaryMessage(a){return new Promise((b,c)=>{let{stream:d}=this,e=0,f=this,g=[],i=this.maxReceiveMessageSize;function j(a){if(e+=a.byteLength,-1!==i&&e>i){d.removeListener("data",j),d.removeListener("end",k),d.removeListener("error",k),c({code:h.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${e} vs. ${i})`});return}g.push(a)}function k(i){if(d.removeListener("data",j),d.removeListener("end",k),d.removeListener("error",k),void 0!==i)return void c({code:h.Status.INTERNAL,details:i.message});if(0===e)return void c({code:h.Status.INTERNAL,details:"received empty unary message"});f.emit("receiveMessage");let l=Buffer.concat(g,e),m=1===l.readUInt8(0)?a:"identity",n=f.getDecompressedMessage(l,m);Buffer.isBuffer(n)?b(f.deserializeMessageWithInternalError(n)):n.then(a=>b(f.deserializeMessageWithInternalError(a)),b=>c(b.code?b:{code:h.Status.INTERNAL,details:`Received "grpc-encoding" header "${a}" but ${a} decompression failed`}))}this.stream.on("data",j),this.stream.on("end",k),this.stream.on("error",k)})}async deserializeMessageWithInternalError(a){try{return this.deserializeMessage(a)}catch(a){throw{details:(0,l.getErrorMessage)(a),code:h.Status.INTERNAL}}}serializeMessage(a){let b=this.handler.serialize(a),c=b.byteLength,d=Buffer.allocUnsafe(c+5);return d.writeUInt8(0,0),d.writeUInt32BE(c,1),b.copy(d,5),d}deserializeMessage(a){return this.handler.deserialize(a)}async sendUnaryMessage(a,b,c,d){if(!this.checkCancelled()){if(void 0===c&&(c=null),a){!Object.prototype.hasOwnProperty.call(a,"metadata")&&c&&(a.metadata=c),this.sendError(a);return}try{let a=this.serializeMessage(b);this.write(a),this.sendStatus({code:h.Status.OK,details:"OK",metadata:c})}catch(a){this.sendError({details:(0,l.getErrorMessage)(a),code:h.Status.INTERNAL})}}}sendStatus(a){var b,c;if(this.emit("callEnd",a.code),this.emit("streamEnd",a.code===h.Status.OK),!this.checkCancelled())if(n("Request to method "+(null==(b=this.handler)?void 0:b.path)+" ended with status code: "+h.Status[a.code]+" details: "+a.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var b;let c=Object.assign({[p]:a.code,[o]:encodeURI(a.details)},null==(b=a.metadata)?void 0:b.toHttp2Headers());this.stream.sendTrailers(c),this.statusSent=!0}),this.stream.end());else{let b=Object.assign(Object.assign({[p]:a.code,[o]:encodeURI(a.details)},u),null==(c=a.metadata)?void 0:c.toHttp2Headers());this.stream.respond(b,{endStream:!0}),this.statusSent=!0}}sendError(a){let b={code:h.Status.UNKNOWN,details:"message"in a?a.message:"Unknown Error",metadata:"metadata"in a&&void 0!==a.metadata?a.metadata:null};"code"in a&&"number"==typeof a.code&&Number.isInteger(a.code)&&(b.code=a.code,"details"in a&&"string"==typeof a.details&&(b.details=a.details)),this.sendStatus(b)}write(a){if(!this.checkCancelled())return -1!==this.maxSendMessageSize&&a.length>this.maxSendMessageSize?void this.sendError({code:h.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${a.length} vs. ${this.maxSendMessageSize})`}):(this.sendMetadata(),this.emit("sendMessage"),this.stream.write(a))}resume(){this.stream.resume()}setupSurfaceCall(a){this.once("cancelled",b=>{a.cancelled=!0,a.emit("cancelled",b)}),this.once("callEnd",b=>a.emit("callEnd",b))}setupReadable(a,b){let c=new j.StreamDecoder(this.maxReceiveMessageSize),d=!1,e=!1,f=!1,g=async()=>{f||!d||e||(f=!0,await this.pushOrBufferMessage(a,null))};this.stream.on("data",async d=>{let f;try{f=c.write(d)}catch(a){this.sendError({code:h.Status.RESOURCE_EXHAUSTED,details:a.message});return}for(let c of(e=!0,this.stream.pause(),f)){let d;this.emit("receiveMessage");let e=1===c.readUInt8(0)?b:"identity";try{d=await this.getDecompressedMessage(c,e)}catch(a){this.sendError(a);return}if(!d)return;await this.pushOrBufferMessage(a,d)}e=!1,this.stream.resume(),await g()}),this.stream.once("end",async()=>{d=!0,await g()})}consumeUnpushedMessages(a){for(this.canPush=!0;this.messagesToPush.length>0;){let b=this.messagesToPush.shift(),c=a.push(b);if(null===b||!1===c){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage(a,b){this.isPushPending?this.bufferedMessages.push(b):await this.pushMessage(a,b)}async pushMessage(a,b){if(null===b){n("Received end of stream"),this.canPush?a.push(null):this.messagesToPush.push(null);return}n("Received message of length "+b.length),this.isPushPending=!0;try{let c=await this.deserializeMessage(b);this.canPush?a.push(c)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(c)}catch(c){this.bufferedMessages.length=0;let b=(0,l.getErrorCode)(c);(null===b||b<h.Status.OK||b>h.Status.UNAUTHENTICATED)&&(b=h.Status.INTERNAL),a.emit("error",{details:(0,l.getErrorMessage)(c),code:b})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage(a,this.bufferedMessages.shift())}getPeer(){var a;let b=null==(a=this.stream.session)?void 0:a.socket;return null!=b&&b.remoteAddress?b.remotePort?`${b.remoteAddress}:${b.remotePort}`:b.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}}function B(a){let b=Error("Deadline exceeded");b.code=h.Status.DEADLINE_EXCEEDED,a.sendError(b),a.cancelled=!0,a.emit("cancelled","deadline")}c.Http2ServerCallStream=A},4296,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ServerCredentials=void 0;let d=a.r(49229);class e{static createInsecure(){return new f}static createSsl(a,b,c=!1){if(null!==a&&!Buffer.isBuffer(a))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(b))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof c)throw TypeError("checkClientCertificate must be a boolean");let e=[],f=[];for(let a=0;a<b.length;a++){let c=b[a];if(null===c||"object"!=typeof c)throw TypeError(`keyCertPair[${a}] must be an object`);if(!Buffer.isBuffer(c.private_key))throw TypeError(`keyCertPair[${a}].private_key must be a Buffer`);if(!Buffer.isBuffer(c.cert_chain))throw TypeError(`keyCertPair[${a}].cert_chain must be a Buffer`);e.push(c.cert_chain),f.push(c.private_key)}return new g({ca:a||(0,d.getDefaultRootsData)()||void 0,cert:e,key:f,requestCert:c,ciphers:d.CIPHER_SUITES})}}c.ServerCredentials=e;class f extends e{_isSecure(){return!1}_getSettings(){return null}}class g extends e{constructor(a){super(),this.options=a}_isSecure(){return!0}_getSettings(){return this.options}}},41069,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Server=void 0;let d=a.r(25328),e=a.r(57982),f=a.r(15365),g=a.r(4296),h=a.r(49845),i=a.r(11717),j=a.r(91177),k=a.r(55647),l=a.r(74970),m=0x7fffffff,n=0x7fffffff,o=2e4,{HTTP2_HEADER_PATH:p}=d.constants,q="server";function r(){}function s(a){return{code:e.Status.UNIMPLEMENTED,details:`The server does not implement the method ${a}`}}function t(a,b){let c=s(b);switch(a){case"unary":return(a,b)=>{b(c,null)};case"clientStream":return(a,b)=>{b(c,null)};case"serverStream":return a=>{a.emit("error",c)};case"bidi":return a=>{a.emit("error",c)};default:throw Error(`Invalid handlerType ${a}`)}}class u{constructor(a){var b,c,d,e;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new l.ChannelzTrace,this.callTracker=new l.ChannelzCallTracker,this.listenerChildrenTracker=new l.ChannelzChildrenTracker,this.sessionChildrenTracker=new l.ChannelzChildrenTracker,this.options=null!=a?a:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,l.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=null!=(b=this.options["grpc.max_connection_age_ms"])?b:m,this.maxConnectionAgeGraceMs=null!=(c=this.options["grpc.max_connection_age_grace_ms"])?c:m,this.keepaliveTimeMs=null!=(d=this.options["grpc.keepalive_time_ms"])?d:n,this.keepaliveTimeoutMs=null!=(e=this.options["grpc.keepalive_timeout_ms"])?e:o,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(a){return()=>{var b,c,d;let e,f=this.sessions.get(a),g=a.socket,h=g.remoteAddress?(0,j.stringToSubchannelAddress)(g.remoteAddress,g.remotePort):null,i=g.localAddress?(0,j.stringToSubchannelAddress)(g.localAddress,g.localPort):null;if(a.encrypted){let a=g,c=a.getCipher(),d=a.getCertificate(),f=a.getPeerCertificate();e={cipherSuiteStandardName:null!=(b=c.standardName)?b:null,cipherSuiteOtherName:c.standardName?null:c.name,localCertificate:d&&"raw"in d?d.raw:null,remoteCertificate:f&&"raw"in f?f.raw:null}}else e=null;return{remoteAddress:h,localAddress:i,security:e,remoteName:null,streamsStarted:f.streamTracker.callsStarted,streamsSucceeded:f.streamTracker.callsSucceeded,streamsFailed:f.streamTracker.callsFailed,messagesSent:f.messagesSent,messagesReceived:f.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:f.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:f.lastMessageSentTimestamp,lastMessageReceivedTimestamp:f.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(c=a.state.localWindowSize)?c:null,remoteFlowControlWindow:null!=(d=a.state.remoteWindowSize)?d:null}}}trace(a){i.trace(e.LogVerbosity.DEBUG,q,"("+this.channelzRef.id+") "+a)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService(a,b){if(null===a||"object"!=typeof a||null===b||"object"!=typeof b)throw Error("addService() requires two objects as arguments");let c=Object.keys(a);if(0===c.length)throw Error("Cannot add an empty service to a server");c.forEach(c=>{let d,e,f=a[c];d=f.requestStream?f.responseStream?"bidi":"clientStream":f.responseStream?"serverStream":"unary";let g=b[c];if(void 0===g&&"string"==typeof f.originalName&&(g=b[f.originalName]),e=void 0!==g?g.bind(b):t(d,c),!1===this.register(f.path,e,f.responseSerialize,f.requestDeserialize,d))throw Error(`Method handler for ${f.path} already provided.`)})}removeService(a){if(null===a||"object"!=typeof a)throw Error("removeService() requires object as argument");Object.keys(a).forEach(b=>{let c=a[b];this.unregister(c.path)})}bind(a,b){throw Error("Not implemented. Use bindAsync() instead")}bindAsync(a,b,c){if(!0===this.started)throw Error("server is already started");if(this.shutdown)throw Error("bindAsync called after shutdown");if("string"!=typeof a)throw TypeError("port must be a string");if(null===b||!(b instanceof g.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof c)throw TypeError("callback must be a function");let f=(0,k.parseUri)(a);if(null===f)throw Error(`Could not parse port "${a}"`);let m=(0,h.mapUriDefaultScheme)(f);if(null===m)throw Error(`Could not get a default scheme for port "${a}"`);let n={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?n.maxSessionMemory=this.options["grpc-node.max_session_memory"]:n.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(n.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let o=(a,b)=>{process.nextTick(()=>c(a,b))},p=()=>{let a;if(b._isSecure()){let c=Object.assign(n,b._getSettings());c.enableTrace=1===this.options["grpc-node.tls_enable_trace"],(a=d.createSecureServer(c)).on("secureConnection",a=>{a.on("error",a=>{this.trace("An incoming TLS connection closed with error: "+a.message)})})}else a=d.createServer(n);return a.setTimeout(0,r),this._setupHandlers(a),a},q=(a,b,c)=>0===a.length?Promise.resolve({port:b,count:c}):Promise.all(a.map(a=>{let c;this.trace("Attempting to bind "+(0,j.subchannelAddressToString)(a)),c=(0,j.isTcpSubchannelAddress)(a)?{host:a.host,port:b}:a;let d=p();return new Promise((e,f)=>{let g=b=>{this.trace("Failed to bind "+(0,j.subchannelAddressToString)(a)+" with error "+b.message),e(b)};d.once("error",g),d.listen(c,()=>{let a;if(this.shutdown){d.close(),e(Error("bindAsync failed because server is shutdown"));return}let c=d.address();a="string"==typeof c?{path:c}:{host:c.address,port:c.port};let f=(0,l.registerChannelzSocket)((0,j.subchannelAddressToString)(a),()=>({localAddress:a,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(f),this.http2ServerList.push({server:d,channelzRef:f}),this.trace("Successfully bound "+(0,j.subchannelAddressToString)(a)),e("port"in a?a.port:b),d.removeListener("error",g)})})})).then(a=>{let d=0;for(let c of a)if("number"==typeof c&&(d+=1,c!==b))throw Error("Invalid state: multiple port numbers added from single address");return{port:b,count:d+c}}),s=a=>{if(0===a.length)return Promise.resolve({port:0,count:0});let b=a[0],c=p();return new Promise((d,e)=>{let f=c=>{this.trace("Failed to bind "+(0,j.subchannelAddressToString)(b)+" with error "+c.message),d(s(a.slice(1)))};c.once("error",f),c.listen(b,()=>{if(this.shutdown){c.close(),d({port:0,count:0});return}let b=c.address(),e={host:b.address,port:b.port},g=(0,l.registerChannelzSocket)((0,j.subchannelAddressToString)(e),()=>({localAddress:e,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(g),this.http2ServerList.push({server:c,channelzRef:g}),this.trace("Successfully bound "+(0,j.subchannelAddressToString)(e)),d(q(a.slice(1),b.port,1)),c.removeListener("error",f)})})},t={onSuccessfulResolution:(b,c,d)=>{let f;(t.onSuccessfulResolution=()=>{},this.shutdown&&o(Error("bindAsync failed because server is shutdown"),0),0===b.length)?o(Error(`No addresses resolved for port ${a}`),0):(f=(0,j.isTcpSubchannelAddress)(b[0])?0===b[0].port?s(b):q(b,b[0].port,0):q(b,1,0)).then(a=>{if(0===a.count){let a=`No address added out of total ${b.length} resolved`;i.log(e.LogVerbosity.ERROR,a),o(Error(a),0)}else a.count<b.length&&i.log(e.LogVerbosity.INFO,`WARNING Only ${a.count} addresses added out of total ${b.length} resolved`),o(null,a.port)},a=>{let c=`No address added out of total ${b.length} resolved`;i.log(e.LogVerbosity.ERROR,c),o(Error(c),0)})},onError:a=>{o(Error(a.details),0)}};(0,h.createResolver)(m,t,this.options).updateResolution()}forceShutdown(){for(let{server:a,channelzRef:b}of this.http2ServerList)a.listening&&a.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(b),(0,l.unregisterChannelzRef)(b))});this.started=!1,this.shutdown=!0,this.sessions.forEach((a,b)=>{b.destroy(d.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,l.unregisterChannelzRef)(this.channelzRef)}register(a,b,c,d,e){return!this.handlers.has(a)&&(this.handlers.set(a,{func:b,serialize:c,deserialize:d,type:e,path:a}),!0)}unregister(a){return this.handlers.delete(a)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:a})=>!0!==a.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(a){let b=b=>{this.channelzEnabled&&(0,l.unregisterChannelzRef)(this.channelzRef),a(b)},c=0;function d(){0==--c&&b()}for(let{server:a,channelzRef:b}of(this.started=!1,this.shutdown=!0,this.http2ServerList))a.listening&&(c++,a.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(b),(0,l.unregisterChannelzRef)(b)),d()}));this.sessions.forEach((a,b)=>{b.closed||(c+=1,b.close(d))}),0===c&&b()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(a,b){let c=b[d.constants.HTTP2_HEADER_CONTENT_TYPE];return"string"==typeof c&&!!c.startsWith("application/grpc")||(a.respond({[d.constants.HTTP2_HEADER_STATUS]:d.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler(a){this.trace("Received call to method "+a+" at address "+this.serverAddressString);let b=this.handlers.get(a);return void 0===b?(this.trace("No handler registered for method "+a+". Sending UNIMPLEMENTED status."),null):b}_respondWithError(a,b,c=null){let d=new f.Http2ServerCallStream(b,null,this.options);void 0===a.code&&(a.code=e.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==c||c.streamTracker.addCallFailed()),d.sendError(a)}_channelzHandler(a,b){let c=this.sessions.get(a.session);if(this.callTracker.addCallStarted(),null==c||c.streamTracker.addCallStarted(),!this._verifyContentType(a,b)){this.callTracker.addCallFailed(),null==c||c.streamTracker.addCallFailed();return}let d=b[p],g=this._retrieveHandler(d);if(!g)return void this._respondWithError(s(d),a,c);let h=new f.Http2ServerCallStream(a,g,this.options);h.once("callEnd",a=>{a===e.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),c&&(h.once("streamEnd",a=>{a?c.streamTracker.addCallSucceeded():c.streamTracker.addCallFailed()}),h.on("sendMessage",()=>{c.messagesSent+=1,c.lastMessageSentTimestamp=new Date}),h.on("receiveMessage",()=>{c.messagesReceived+=1,c.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(h,g,b)||(this.callTracker.addCallFailed(),null==c||c.streamTracker.addCallFailed(),h.sendError({code:e.Status.INTERNAL,details:`Unknown handler type: ${g.type}`}))}_streamHandler(a,b){if(!0!==this._verifyContentType(a,b))return;let c=b[p],d=this._retrieveHandler(c);if(!d)return void this._respondWithError(s(c),a,null);let g=new f.Http2ServerCallStream(a,d,this.options);this._runHandlerForCall(g,d,b)||g.sendError({code:e.Status.INTERNAL,details:`Unknown handler type: ${d.type}`})}_runHandlerForCall(a,b,c){var d;let e=a.receiveMetadata(c),f=null!=(d=e.get("grpc-encoding")[0])?d:"identity";e.remove("grpc-encoding");let{type:g}=b;if("unary"===g)v(a,b,e,f);else if("clientStream"===g)w(a,b,e,f);else if("serverStream"===g)x(a,b,e,f);else{if("bidi"!==g)return!1;y(a,b,e,f)}return!0}_setupHandlers(a){if(null===a)return;let b=a.address(),c="null";b&&(c="string"==typeof b?b:b.address+":"+b.port),this.serverAddressString=c;let e=this.channelzEnabled?this._channelzHandler:this._streamHandler;a.on("stream",e.bind(this)),a.on("session",a=>{var b,c,e,f,g;if(!this.started)return void a.destroy();let h=(0,l.registerChannelzSocket)(null!=(b=a.socket.remoteAddress)?b:"unknown",this.getChannelzSessionInfoGetter(a),this.channelzEnabled),i={ref:h,streamTracker:new l.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(a,i);let j=a.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+j),this.sessionChildrenTracker.refChild(h));let k=null,n=null,o=!1;if(this.maxConnectionAgeMs!==m){let b=this.maxConnectionAgeMs/10,f=Math.random()*b*2-b;k=null==(e=(c=setTimeout(()=>{var b,c;o=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+j);try{a.goaway(d.constants.NGHTTP2_NO_ERROR,0x7fffffff,Buffer.from("max_age"))}catch(b){a.destroy();return}a.close(),this.maxConnectionAgeGraceMs!==m&&(n=null==(c=(b=setTimeout(()=>{a.destroy()},this.maxConnectionAgeGraceMs)).unref)?void 0:c.call(b))},this.maxConnectionAgeMs+f)).unref)?void 0:e.call(c)}let p=null==(g=(f=setInterval(()=>{var b,c;let d=null==(c=(b=setTimeout(()=>{o=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+j),a.close()},this.keepaliveTimeoutMs)).unref)?void 0:c.call(b);try{a.ping((a,b,c)=>{clearTimeout(d)})}catch(b){a.destroy()}},this.keepaliveTimeMs)).unref)?void 0:g.call(f);a.on("close",()=>{this.channelzEnabled&&(o||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+j),this.sessionChildrenTracker.unrefChild(h),(0,l.unregisterChannelzRef)(h)),k&&clearTimeout(k),n&&clearTimeout(n),p&&clearTimeout(p),this.sessions.delete(a)})})}}async function v(a,b,c,d){try{let e=await a.receiveUnaryMessage(d);if(void 0===e||a.cancelled)return;let g=new f.ServerUnaryCallImpl(a,c,e);b.func(g,(b,c,d,e)=>{a.sendUnaryMessage(b,c,d,e)})}catch(b){a.sendError(b)}}function w(a,b,c,d){let e=new f.ServerReadableStreamImpl(a,c,b.deserialize,d);function g(b,c,d,f){e.destroy(),a.sendUnaryMessage(b,c,d,f)}a.cancelled||(e.on("error",g),b.func(e,g))}async function x(a,b,c,d){try{let e=await a.receiveUnaryMessage(d);if(void 0===e||a.cancelled)return;let g=new f.ServerWritableStreamImpl(a,c,b.serialize,e);b.func(g)}catch(b){a.sendError(b)}}function y(a,b,c,d){let e=new f.ServerDuplexStreamImpl(a,c,b.serialize,b.deserialize,d);a.cancelled||b.func(e)}c.Server=u},36272,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.StatusBuilder=void 0;class d{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(a){return this.code=a,this}withDetails(a){return this.details=a,this}withMetadata(a){return this.metadata=a,this}build(){let a={};return null!==this.code&&(a.code=this.code),null!==this.details&&(a.details=this.details),null!==this.metadata&&(a.metadata=this.metadata),a}}c.StatusBuilder=d},38999,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.isDuration=c.durationToMs=c.msToDuration=void 0,c.msToDuration=function(a){return{seconds:a/1e3|0,nanos:a%1e3*1e6|0}},c.durationToMs=function(a){return 1e3*a.seconds+a.nanos/1e6|0},c.isDuration=function(a){return"number"==typeof a.seconds&&"number"==typeof a.nanos}},62818,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.OutlierDetectionLoadBalancer=c.OutlierDetectionLoadBalancingConfig=void 0;let e=a.r(56537),f=a.r(57982),g=a.r(38999),h=a.r(94497),i=a.r(39071),j=a.r(33140),k=a.r(3681),l=a.r(91177),m=a.r(4706),n=a.r(11717),o="outlier_detection";function p(a){n.trace(f.LogVerbosity.DEBUG,o,a)}let q="outlier_detection",r=(null!=(d=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)?d:"true")==="true",s={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},t={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function u(a,b,c,d){if(b in a&&typeof a[b]!==c){let e=d?`${d}.${b}`:b;throw Error(`outlier detection config ${e} parse error: expected ${c}, got ${typeof a[b]}`)}}function v(a,b,c){let d=c?`${c}.${b}`:b;if(b in a){if(!(0,g.isDuration)(a[b]))throw Error(`outlier detection config ${d} parse error: expected Duration, got ${typeof a[b]}`);if(!(a[b].seconds>=0&&a[b].seconds<=315576e6&&a[b].nanos>=0&&a[b].nanos<=0x3b9ac9ff))throw Error(`outlier detection config ${d} parse error: values out of range for non-negative Duaration`)}}function w(a,b,c){let d=c?`${c}.${b}`:b;if(u(a,b,"number",c),b in a&&!(a[b]>=0&&a[b]<=100))throw Error(`outlier detection config ${d} parse error: value out of range for percentage (0-100)`)}class x{constructor(a,b,c,d,e,f,g){if(this.childPolicy=g,g.length>0&&"pick_first"===g[0].getLoadBalancerName())throw Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=null!=a?a:1e4,this.baseEjectionTimeMs=null!=b?b:3e4,this.maxEjectionTimeMs=null!=c?c:3e5,this.maxEjectionPercent=null!=d?d:10,this.successRateEjection=e?Object.assign(Object.assign({},s),e):null,this.failurePercentageEjection=f?Object.assign(Object.assign({},t),f):null}getLoadBalancerName(){return q}toJsonObject(){return{interval:(0,g.msToDuration)(this.intervalMs),base_ejection_time:(0,g.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,g.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(a=>a.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(a){return new x(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,a)}static createFromJson(a){var b;if(v(a,"interval"),v(a,"base_ejection_time"),v(a,"max_ejection_time"),w(a,"max_ejection_percent"),"success_rate_ejection"in a){if("object"!=typeof a.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");u(a.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),w(a.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),u(a.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),u(a.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in a){if("object"!=typeof a.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");w(a.failure_percentage_ejection,"threshold","failure_percentage_ejection"),w(a.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),u(a.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),u(a.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new x(a.interval?(0,g.durationToMs)(a.interval):null,a.base_ejection_time?(0,g.durationToMs)(a.base_ejection_time):null,a.max_ejection_time?(0,g.durationToMs)(a.max_ejection_time):null,null!=(b=a.max_ejection_percent)?b:null,a.success_rate_ejection,a.failure_percentage_ejection,a.child_policy.map(i.validateLoadBalancingConfig))}}c.OutlierDetectionLoadBalancingConfig=x;class y extends m.BaseSubchannelWrapper{constructor(a,b){super(a),this.mapEntry=b,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=a.getConnectivityState(),a.addConnectivityStateListener((a,b,c,d)=>{if(this.childSubchannelState=c,!this.ejected)for(let a of this.stateListeners)a(this,b,c,d)})}getConnectivityState(){return this.ejected?e.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(a){this.stateListeners.push(a)}removeConnectivityStateListener(a){let b=this.stateListeners.indexOf(a);b>-1&&this.stateListeners.splice(b,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let a=this.mapEntry.subchannelWrappers.indexOf(this);a>=0&&this.mapEntry.subchannelWrappers.splice(a,1)}}eject(){for(let a of(this.ejected=!0,this.stateListeners))a(this,this.childSubchannelState,e.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){for(let a of(this.ejected=!1,this.stateListeners))a(this,e.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}}function z(){return{success:0,failure:0}}class A{constructor(){this.activeBucket=z(),this.inactiveBucket=z()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=z()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}}class B{constructor(a,b){this.wrappedPicker=a,this.countCalls=b}pick(a){let b=this.wrappedPicker.pick(a);if(b.pickResultType!==k.PickResultType.COMPLETE)return b;{let a=b.subchannel,c=a.getMapEntry();if(!c)return Object.assign(Object.assign({},b),{subchannel:a.getWrappedSubchannel()});{let d=b.onCallEnded;return this.countCalls&&(d=a=>{var d;a===f.Status.OK?c.counter.addSuccess():c.counter.addFailure(),null==(d=b.onCallEnded)||d.call(b,a)}),Object.assign(Object.assign({},b),{subchannel:a.getWrappedSubchannel(),onCallEnded:d})}}}}class C{constructor(a){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new j.ChildLoadBalancerHandler((0,h.createChildChannelControlHelper)(a,{createSubchannel:(b,c)=>{let d=a.createSubchannel(b,c),e=this.addressMap.get((0,l.subchannelAddressToString)(b)),f=new y(d,e);return(null==e?void 0:e.currentEjectionTimestamp)!==null&&f.eject(),null==e||e.subchannelWrappers.push(f),f},updateState:(b,c)=>{b===e.ConnectivityState.READY?a.updateState(b,new B(c,this.isCountingEnabled())):a.updateState(b,c)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let a=0;for(let b of this.addressMap.values())null!==b.currentEjectionTimestamp&&(a+=1);return 100*a/this.addressMap.size}runSuccessRateCheck(a){if(!this.latestConfig)return;let b=this.latestConfig.getSuccessRateEjectionConfig();if(!b)return;p("Running success rate check");let c=b.request_volume,d=0,e=[];for(let[a,b]of this.addressMap){let f=b.counter.getLastSuccesses(),g=b.counter.getLastFailures();p("Stats for "+a+": successes="+f+" failures="+g+" targetRequestVolume="+c),f+g>=c&&(d+=1,e.push(f/(f+g)))}if(p("Found "+d+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+e+"]"),d<b.minimum_hosts)return;let f=e.reduce((a,b)=>a+b)/e.length,g=0;for(let a of e){let b=a-f;g+=b*b}let h=Math.sqrt(g/e.length),i=f-h*(b.stdev_factor/1e3);for(let[d,e]of(p("stdev="+h+" ejectionThreshold="+i),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let f=e.counter.getLastSuccesses(),g=e.counter.getLastFailures();if(f+g<c)continue;let h=f/(f+g);if(p("Checking candidate "+d+" successRate="+h),h<i){let c=100*Math.random();p("Candidate "+d+" randomNumber="+c+" enforcement_percentage="+b.enforcement_percentage),c<b.enforcement_percentage&&(p("Ejecting candidate "+d),this.eject(e,a))}}}runFailurePercentageCheck(a){if(!this.latestConfig)return;let b=this.latestConfig.getFailurePercentageEjectionConfig();if(!b)return;p("Running failure percentage check. threshold="+b.threshold+" request volume threshold="+b.request_volume);let c=0;for(let a of this.addressMap.values())a.counter.getLastSuccesses()+a.counter.getLastFailures()>=b.request_volume&&(c+=1);if(!(c<b.minimum_hosts))for(let[c,d]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let e=d.counter.getLastSuccesses(),f=d.counter.getLastFailures();if((p("Candidate successes="+e+" failures="+f),!(e+f<b.request_volume))&&100*f/(f+e)>b.threshold){let e=100*Math.random();p("Candidate "+c+" randomNumber="+e+" enforcement_percentage="+b.enforcement_percentage),e<b.enforcement_percentage&&(p("Ejecting candidate "+c),this.eject(d,a))}}}eject(a,b){for(let b of(a.currentEjectionTimestamp=new Date,a.ejectionTimeMultiplier+=1,a.subchannelWrappers))b.eject()}uneject(a){for(let b of(a.currentEjectionTimestamp=null,a.subchannelWrappers))b.uneject()}switchAllBuckets(){for(let a of this.addressMap.values())a.counter.switchBuckets()}startTimer(a){var b,c;this.ejectionTimer=setTimeout(()=>this.runChecks(),a),null==(c=(b=this.ejectionTimer).unref)||c.call(b)}runChecks(){let a=new Date;if(p("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(let[b,c]of(this.timerStartTime=a,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(a),this.runFailurePercentageCheck(a),this.addressMap.entries()))if(null===c.currentEjectionTimestamp)c.ejectionTimeMultiplier>0&&(c.ejectionTimeMultiplier-=1);else{let a=this.latestConfig.getBaseEjectionTimeMs(),d=this.latestConfig.getMaxEjectionTimeMs(),e=new Date(c.currentEjectionTimestamp.getTime());e.setMilliseconds(e.getMilliseconds()+Math.min(a*c.ejectionTimeMultiplier,Math.max(a,d))),e<new Date&&(p("Unejecting "+b),this.uneject(c))}}updateAddressList(a,b,c){if(!(b instanceof x))return;let d=new Set;for(let b of a)d.add((0,l.subchannelAddressToString)(b));for(let a of d)this.addressMap.has(a)||(p("Adding map entry for "+a),this.addressMap.set(a,{counter:new A,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let a of this.addressMap.keys())d.has(a)||(p("Removing map entry for "+a),this.addressMap.delete(a));let e=(0,i.getFirstUsableConfig)(b.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(a,e,c),b.getSuccessRateEjectionConfig()||b.getFailurePercentageEjectionConfig())if(this.timerStartTime){p("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let a=b.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(a)}else p("Starting new timer"),this.timerStartTime=new Date,this.startTimer(b.getIntervalMs()),this.switchAllBuckets();else for(let a of(p("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject(a),a.ejectionTimeMultiplier=0;this.latestConfig=b}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return q}}c.OutlierDetectionLoadBalancer=C,c.setup=function(){r&&(0,h.registerLoadBalancerType)(q,C,x)}},94497,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.OutlierDetectionLoadBalancingConfig=c.BaseSubchannelWrapper=c.registerAdminService=c.FilterStackFactory=c.BaseFilter=c.PickResultType=c.QueuePicker=c.UnavailablePicker=c.ChildLoadBalancerHandler=c.subchannelAddressToString=c.validateLoadBalancingConfig=c.getFirstUsableConfig=c.registerLoadBalancerType=c.createChildChannelControlHelper=c.BackoffTimeout=c.durationToMs=c.uriToString=c.createResolver=c.registerResolver=c.log=c.trace=void 0;var d=a.r(11717);Object.defineProperty(c,"trace",{enumerable:!0,get:function(){return d.trace}}),Object.defineProperty(c,"log",{enumerable:!0,get:function(){return d.log}});var e=a.r(49845);Object.defineProperty(c,"registerResolver",{enumerable:!0,get:function(){return e.registerResolver}}),Object.defineProperty(c,"createResolver",{enumerable:!0,get:function(){return e.createResolver}});var f=a.r(55647);Object.defineProperty(c,"uriToString",{enumerable:!0,get:function(){return f.uriToString}});var g=a.r(38999);Object.defineProperty(c,"durationToMs",{enumerable:!0,get:function(){return g.durationToMs}});var h=a.r(57451);Object.defineProperty(c,"BackoffTimeout",{enumerable:!0,get:function(){return h.BackoffTimeout}});var i=a.r(39071);Object.defineProperty(c,"createChildChannelControlHelper",{enumerable:!0,get:function(){return i.createChildChannelControlHelper}}),Object.defineProperty(c,"registerLoadBalancerType",{enumerable:!0,get:function(){return i.registerLoadBalancerType}}),Object.defineProperty(c,"getFirstUsableConfig",{enumerable:!0,get:function(){return i.getFirstUsableConfig}}),Object.defineProperty(c,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return i.validateLoadBalancingConfig}});var j=a.r(91177);Object.defineProperty(c,"subchannelAddressToString",{enumerable:!0,get:function(){return j.subchannelAddressToString}});var k=a.r(33140);Object.defineProperty(c,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return k.ChildLoadBalancerHandler}});var l=a.r(3681);Object.defineProperty(c,"UnavailablePicker",{enumerable:!0,get:function(){return l.UnavailablePicker}}),Object.defineProperty(c,"QueuePicker",{enumerable:!0,get:function(){return l.QueuePicker}}),Object.defineProperty(c,"PickResultType",{enumerable:!0,get:function(){return l.PickResultType}});var m=a.r(59940);Object.defineProperty(c,"BaseFilter",{enumerable:!0,get:function(){return m.BaseFilter}});var n=a.r(15325);Object.defineProperty(c,"FilterStackFactory",{enumerable:!0,get:function(){return n.FilterStackFactory}});var o=a.r(31509);Object.defineProperty(c,"registerAdminService",{enumerable:!0,get:function(){return o.registerAdminService}});var p=a.r(4706);Object.defineProperty(c,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return p.BaseSubchannelWrapper}});var q=a.r(62818);Object.defineProperty(c,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return q.OutlierDetectionLoadBalancingConfig}})},5560,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=void 0;let d=a.r(49845);class e{constructor(a,b,c){let d;this.listener=b,this.addresses=[],this.hasReturnedResult=!1,d=""===a.authority?"/"+a.path:a.path,this.addresses=[{path:d}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(a){return"localhost"}}c.setup=function(){(0,d.registerResolver)("unix",e)}},40926,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=void 0;let d=a.r(4446),e=a.r(57982),f=a.r(57904),g=a.r(49845),h=a.r(55647),i=a.r(11717),j="ip_resolver";function k(a){i.trace(e.LogVerbosity.DEBUG,j,a)}let l="ipv4",m="ipv6",n=443;class o{constructor(a,b,c){var g;this.listener=b,this.addresses=[],this.error=null,this.hasReturnedResult=!1,k("Resolver constructed for target "+(0,h.uriToString)(a));const i=[];if(a.scheme!==l&&a.scheme!==m){this.error={code:e.Status.UNAVAILABLE,details:`Unrecognized scheme ${a.scheme} in IP resolver`,metadata:new f.Metadata};return}for(const b of a.path.split(",")){const c=(0,h.splitHostPort)(b);if(null===c||a.scheme===l&&!(0,d.isIPv4)(c.host)||a.scheme===m&&!(0,d.isIPv6)(c.host)){this.error={code:e.Status.UNAVAILABLE,details:`Failed to parse ${a.scheme} address ${b}`,metadata:new f.Metadata};return}i.push({host:c.host,port:null!=(g=c.port)?g:n})}this.addresses=i,k("Parsed "+a.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(a){return a.path.split(",")[0]}}c.setup=function(){(0,g.registerResolver)(l,o),(0,g.registerResolver)(m,o)}},24241,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.PickFirstLoadBalancer=c.shuffled=c.PickFirstLoadBalancingConfig=void 0;let d=a.r(39071),e=a.r(56537),f=a.r(3681),g=a.r(11717),h=a.r(57982),i="pick_first";function j(a){g.trace(h.LogVerbosity.DEBUG,i,a)}let k="pick_first",l=250;class m{constructor(a){this.shuffleAddressList=a}getLoadBalancerName(){return k}toJsonObject(){return{[k]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(a){if("shuffleAddressList"in a&&"boolean"!=typeof a.shuffleAddressList)throw Error("pick_first config field shuffleAddressList must be a boolean if provided");return new m(!0===a.shuffleAddressList)}}c.PickFirstLoadBalancingConfig=m;class n{constructor(a){this.subchannel=a}pick(a){return{pickResultType:f.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}}function o(a){let b=a.slice();for(let a=b.length-1;a>1;a--){let c=Math.floor(Math.random()*(a+1)),d=b[a];b[a]=b[c],b[c]=d}return b}c.shuffled=o;class p{constructor(a){this.channelControlHelper=a,this.children=[],this.currentState=e.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(a,b,c,d,e)=>{this.onSubchannelStateUpdate(a,b,c,e)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(a=>a.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(e.ConnectivityState.READY,new n(this.currentPick)):0===this.children.length?this.updateState(e.ConnectivityState.IDLE,new f.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(e.ConnectivityState.TRANSIENT_FAILURE,new f.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(e.ConnectivityState.CONNECTING,new f.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){for(let{subchannel:a}of(this.stickyTransientFailureMode=!0,this.children))a.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(null!==this.currentPick){let a=this.currentPick;this.currentPick=null,a.unref(),a.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(a.getChannelzRef())}}onSubchannelStateUpdate(a,b,c,d){var f;if(null==(f=this.currentPick)?void 0:f.realSubchannelEquals(a)){c!==e.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[b,f]of this.children.entries())if(a.realSubchannelEquals(f.subchannel)){c===e.ConnectivityState.READY&&this.pickSubchannel(f.subchannel),c===e.ConnectivityState.TRANSIENT_FAILURE&&(f.hasReportedTransientFailure=!0,d&&(this.lastError=d),this.maybeEnterStickyTransientFailureMode(),b===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(b+1)),f.subchannel.startConnecting();return}}startNextSubchannelConnecting(a){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[b,c]of this.children.entries())if(b>=a){let a=c.subchannel.getConnectivityState();if(a===e.ConnectivityState.IDLE||a===e.ConnectivityState.CONNECTING)return void this.startConnecting(b)}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(a){var b,c;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=a,this.children[a].subchannel.getConnectivityState()===e.ConnectivityState.IDLE&&(j("Start connecting to subchannel with address "+this.children[a].subchannel.getAddress()),process.nextTick(()=>{var b;null==(b=this.children[a])||b.subchannel.startConnecting()})),this.connectionDelayTimeout=null==(c=(b=setTimeout(()=>{this.startNextSubchannelConnecting(a+1)},l)).unref)?void 0:c.call(b)}pickSubchannel(a){this.currentPick&&a.realSubchannelEquals(this.currentPick)||(j("Pick subchannel with address "+a.getAddress()),this.stickyTransientFailureMode=!1,null!==this.currentPick&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=a,a.ref(),this.channelControlHelper.addChannelzChild(a.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(a,b){j(e.ConnectivityState[this.currentState]+" -> "+e.ConnectivityState[a]),this.currentState=a,this.channelControlHelper.updateState(a,b)}resetSubchannelList(){for(let a of this.children)this.currentPick&&a.subchannel.realSubchannelEquals(this.currentPick)||a.subchannel.removeConnectivityStateListener(this.subchannelStateListener),a.subchannel.unref(),this.channelControlHelper.removeChannelzChild(a.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(a){let b=a.map(a=>({subchannel:this.channelControlHelper.createSubchannel(a,{}),hasReportedTransientFailure:!1}));for(let{subchannel:a}of b)a.ref(),this.channelControlHelper.addChannelzChild(a.getChannelzRef());for(let{subchannel:a}of(this.resetSubchannelList(),this.children=b,this.children))if(a.addConnectivityStateListener(this.subchannelStateListener),a.getConnectivityState()===e.ConnectivityState.READY)return void this.pickSubchannel(a);for(let a of this.children)a.subchannel.getConnectivityState()===e.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(a,b){b instanceof m&&(b.getShuffleAddressList()&&(a=o(a)),this.latestAddressList=a,this.connectToAddressList(a))}exitIdle(){this.currentState===e.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return k}}c.PickFirstLoadBalancer=p,c.setup=function(){(0,d.registerLoadBalancerType)(k,p,m),(0,d.registerDefaultLoadBalancerType)(k)}},63765,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.RoundRobinLoadBalancer=void 0;let d=a.r(39071),e=a.r(56537),f=a.r(3681),g=a.r(91177),h=a.r(11717),i=a.r(57982),j="round_robin";function k(a){h.trace(i.LogVerbosity.DEBUG,j,a)}let l="round_robin";class m{getLoadBalancerName(){return l}toJsonObject(){return{[l]:{}}}static createFromJson(a){return new m}}class n{constructor(a,b=0){this.subchannelList=a,this.nextIndex=b}pick(a){let b=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:f.PickResultType.COMPLETE,subchannel:b,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class o{constructor(a){this.channelControlHelper=a,this.subchannels=[],this.currentState=e.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(a,b,c,d,f)=>{this.calculateAndUpdateState(),(c===e.ConnectivityState.TRANSIENT_FAILURE||c===e.ConnectivityState.IDLE)&&(f&&(this.lastError=f),this.channelControlHelper.requestReresolution(),a.startConnecting())}}countSubchannelsWithState(a){return this.subchannels.filter(b=>b.getConnectivityState()===a).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(e.ConnectivityState.READY)>0){let a=this.subchannels.filter(a=>a.getConnectivityState()===e.ConnectivityState.READY),b=0;null!==this.currentReadyPicker&&(b=a.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(b=0),this.updateState(e.ConnectivityState.READY,new n(a,b))}else this.countSubchannelsWithState(e.ConnectivityState.CONNECTING)>0?this.updateState(e.ConnectivityState.CONNECTING,new f.QueuePicker(this)):this.countSubchannelsWithState(e.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(e.ConnectivityState.TRANSIENT_FAILURE,new f.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(e.ConnectivityState.IDLE,new f.QueuePicker(this))}updateState(a,b){k(e.ConnectivityState[this.currentState]+" -> "+e.ConnectivityState[a]),a===e.ConnectivityState.READY?this.currentReadyPicker=b:this.currentReadyPicker=null,this.currentState=a,this.channelControlHelper.updateState(a,b)}resetSubchannelList(){for(let a of this.subchannels)a.removeConnectivityStateListener(this.subchannelStateListener),a.unref(),this.channelControlHelper.removeChannelzChild(a.getChannelzRef());this.subchannels=[]}updateAddressList(a,b){for(let b of(this.resetSubchannelList(),k("Connect to address list "+a.map(a=>(0,g.subchannelAddressToString)(a))),this.subchannels=a.map(a=>this.channelControlHelper.createSubchannel(a,{})),this.subchannels)){b.ref(),b.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(b.getChannelzRef());let a=b.getConnectivityState();(a===e.ConnectivityState.IDLE||a===e.ConnectivityState.TRANSIENT_FAILURE)&&b.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let a of this.subchannels)a.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return l}}c.RoundRobinLoadBalancer=o,c.setup=function(){(0,d.registerLoadBalancerType)(l,o,m)}},80304,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.experimental=c.addAdminServicesToServer=c.getChannelzHandlers=c.getChannelzServiceDefinition=c.InterceptorConfigurationError=c.InterceptingCall=c.RequesterBuilder=c.ListenerBuilder=c.StatusBuilder=c.getClientChannel=c.ServerCredentials=c.Server=c.setLogVerbosity=c.setLogger=c.load=c.loadObject=c.CallCredentials=c.ChannelCredentials=c.waitForClientReady=c.closeClient=c.Channel=c.makeGenericClientConstructor=c.makeClientConstructor=c.loadPackageDefinition=c.Client=c.compressionAlgorithms=c.propagate=c.connectivityState=c.status=c.logVerbosity=c.Metadata=c.credentials=void 0;let d=a.r(20574);Object.defineProperty(c,"CallCredentials",{enumerable:!0,get:function(){return d.CallCredentials}});let e=a.r(61655);Object.defineProperty(c,"Channel",{enumerable:!0,get:function(){return e.ChannelImplementation}});let f=a.r(69425);Object.defineProperty(c,"compressionAlgorithms",{enumerable:!0,get:function(){return f.CompressionAlgorithms}});let g=a.r(56537);Object.defineProperty(c,"connectivityState",{enumerable:!0,get:function(){return g.ConnectivityState}});let h=a.r(61591);Object.defineProperty(c,"ChannelCredentials",{enumerable:!0,get:function(){return h.ChannelCredentials}});let i=a.r(19856);Object.defineProperty(c,"Client",{enumerable:!0,get:function(){return i.Client}});let j=a.r(57982);Object.defineProperty(c,"logVerbosity",{enumerable:!0,get:function(){return j.LogVerbosity}}),Object.defineProperty(c,"status",{enumerable:!0,get:function(){return j.Status}}),Object.defineProperty(c,"propagate",{enumerable:!0,get:function(){return j.Propagate}});let k=a.r(11717),l=a.r(80721);Object.defineProperty(c,"loadPackageDefinition",{enumerable:!0,get:function(){return l.loadPackageDefinition}}),Object.defineProperty(c,"makeClientConstructor",{enumerable:!0,get:function(){return l.makeClientConstructor}}),Object.defineProperty(c,"makeGenericClientConstructor",{enumerable:!0,get:function(){return l.makeClientConstructor}});let m=a.r(57904);Object.defineProperty(c,"Metadata",{enumerable:!0,get:function(){return m.Metadata}});let n=a.r(41069);Object.defineProperty(c,"Server",{enumerable:!0,get:function(){return n.Server}});let o=a.r(4296);Object.defineProperty(c,"ServerCredentials",{enumerable:!0,get:function(){return o.ServerCredentials}});let p=a.r(36272);Object.defineProperty(c,"StatusBuilder",{enumerable:!0,get:function(){return p.StatusBuilder}}),c.credentials={combineChannelCredentials:(a,...b)=>b.reduce((a,b)=>a.compose(b),a),combineCallCredentials:(a,...b)=>b.reduce((a,b)=>a.compose(b),a),createInsecure:h.ChannelCredentials.createInsecure,createSsl:h.ChannelCredentials.createSsl,createFromSecureContext:h.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:d.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:d.CallCredentials.createFromGoogleCredential,createEmpty:d.CallCredentials.createEmpty},c.closeClient=a=>a.close(),c.waitForClientReady=(a,b,c)=>a.waitForReady(b,c),c.loadObject=(a,b)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},c.load=(a,b,c)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},c.setLogger=a=>{k.setLogger(a)},c.setLogVerbosity=a=>{k.setLoggerVerbosity(a)},c.getClientChannel=a=>i.Client.prototype.getChannel.call(a);var q=a.r(83278);Object.defineProperty(c,"ListenerBuilder",{enumerable:!0,get:function(){return q.ListenerBuilder}}),Object.defineProperty(c,"RequesterBuilder",{enumerable:!0,get:function(){return q.RequesterBuilder}}),Object.defineProperty(c,"InterceptingCall",{enumerable:!0,get:function(){return q.InterceptingCall}}),Object.defineProperty(c,"InterceptorConfigurationError",{enumerable:!0,get:function(){return q.InterceptorConfigurationError}});var r=a.r(74970);Object.defineProperty(c,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return r.getChannelzServiceDefinition}}),Object.defineProperty(c,"getChannelzHandlers",{enumerable:!0,get:function(){return r.getChannelzHandlers}});var s=a.r(31509);Object.defineProperty(c,"addAdminServicesToServer",{enumerable:!0,get:function(){return s.addAdminServicesToServer}}),c.experimental=a.r(94497);let t=a.r(87695),u=a.r(5560),v=a.r(40926),w=a.r(24241),x=a.r(63765),y=a.r(62818),z=a.r(74970);(()=>{t.setup(),u.setup(),v.setup(),w.setup(),x.setup(),y.setup(),z.setup()})()},69387,60574,a=>{"use strict";var b,c,d,e,f=a.i(88156),g=a.i(57179),h=f,i=a.i(69304),j="u">typeof globalThis?globalThis:a.g,k={};(function(){function a(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function d(a,b,c){c||(c=0);let d=Array(16);if("string"==typeof b)for(var e=0;e<16;++e)d[e]=b.charCodeAt(c++)|b.charCodeAt(c++)<<8|b.charCodeAt(c++)<<16|b.charCodeAt(c++)<<24;else for(e=0;e<16;++e)d[e]=b[c++]|b[c++]<<8|b[c++]<<16|b[c++]<<24;b=a.g[0],c=a.g[1],e=a.g[2];let f=a.g[3],g;g=b+(f^c&(e^f))+d[0]+0xd76aa478|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[1]+0xe8c7b756|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[2]+0x242070db|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[3]+0xc1bdceee|0,g=b+(f^(c=e+(g<<22|g>>>10))&(e^f))+d[4]+0xf57c0faf|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[5]+0x4787c62a|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[6]+0xa8304613|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[7]+0xfd469501|0,g=b+(f^(c=e+(g<<22|g>>>10))&(e^f))+d[8]+0x698098d8|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[9]+0x8b44f7af|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[10]+0xffff5bb1|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[11]+0x895cd7be|0,g=b+(f^(c=e+(g<<22|g>>>10))&(e^f))+d[12]+0x6b901122|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[13]+0xfd987193|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[14]+0xa679438e|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[15]+0x49b40821|0,c=e+(g<<22|g>>>10),g=b+(e^f&(c^e))+d[1]+0xf61e2562|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[6]+0xc040b340|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[11]+0x265e5a51|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[0]+0xe9b6c7aa|0,c=e+(g<<20|g>>>12),g=b+(e^f&(c^e))+d[5]+0xd62f105d|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[10]+0x2441453|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[15]+0xd8a1e681|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[4]+0xe7d3fbc8|0,c=e+(g<<20|g>>>12),g=b+(e^f&(c^e))+d[9]+0x21e1cde6|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[14]+0xc33707d6|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[3]+0xf4d50d87|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[8]+0x455a14ed|0,c=e+(g<<20|g>>>12),g=b+(e^f&(c^e))+d[13]+0xa9e3e905|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[2]+0xfcefa3f8|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[7]+0x676f02d9|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[12]+0x8d2a4c8a|0,g=b+((c=e+(g<<20|g>>>12))^e^f)+d[5]+0xfffa3942|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[8]+0x8771f681|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[11]+0x6d9d6122|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[14]+0xfde5380c|0,g=b+((c=e+(g<<23|g>>>9))^e^f)+d[1]+0xa4beea44|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[4]+0x4bdecfa9|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[7]+0xf6bb4b60|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[10]+0xbebfbc70|0,g=b+((c=e+(g<<23|g>>>9))^e^f)+d[13]+0x289b7ec6|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[0]+0xeaa127fa|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[3]+0xd4ef3085|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[6]+0x4881d05|0,g=b+((c=e+(g<<23|g>>>9))^e^f)+d[9]+0xd9d4d039|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[12]+0xe6db99e5|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[15]+0x1fa27cf8|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[2]+0xc4ac5665|0,c=e+(g<<23|g>>>9),g=b+(e^(c|~f))+d[0]+0xf4292244|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[7]+0x432aff97|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[14]+0xab9423a7|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[5]+0xfc93a039|0,c=e+(g<<21|g>>>11),g=b+(e^(c|~f))+d[12]+0x655b59c3|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[3]+0x8f0ccc92|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[10]+0xffeff47d|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[1]+0x85845dd1|0,c=e+(g<<21|g>>>11),g=b+(e^(c|~f))+d[8]+0x6fa87e4f|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[15]+0xfe2ce6e0|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[6]+0xa3014314|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[13]+0x4e0811a1|0,c=e+(g<<21|g>>>11),g=b+(e^(c|~f))+d[4]+0xf7537e82|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[11]+0xbd3af235|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[2]+0x2ad7d2bb|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[9]+0xeb86d391|0,a.g[0]=a.g[0]+b|0,a.g[1]=a.g[1]+(e+(g<<21|g>>>11))|0,a.g[2]=a.g[2]+e|0,a.g[3]=a.g[3]+f|0}function e(a,b){var c=h;return Object.prototype.hasOwnProperty.call(c,a)?c[a]:c[a]=b(a)}function f(a,b){this.h=b;let c=[],d=!0;for(let e=a.length-1;e>=0;e--){let f=0|a[e];d&&f==b||(c[e]=f,d=!1)}this.g=c}(function(a,b){function c(){}c.prototype=b.prototype,a.F=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.D=function(a,c,d){for(var e=Array(arguments.length-2),f=2;f<arguments.length;f++)e[f-2]=arguments[f];return b.prototype[c].apply(a,e)}})(a,function(){this.blockSize=-1}),a.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},a.prototype.v=function(a,b){void 0===b&&(b=a.length);let c=b-this.blockSize,e=this.C,f=this.h,g=0;for(;g<b;){if(0==f)for(;g<=c;)d(this,a,g),g+=this.blockSize;if("string"==typeof a){for(;g<b;)if(e[f++]=a.charCodeAt(g++),f==this.blockSize){d(this,e),f=0;break}}else for(;g<b;)if(e[f++]=a[g++],f==this.blockSize){d(this,e),f=0;break}}this.h=f,this.o+=b},a.prototype.A=function(){var a=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);a[0]=128;for(var b=1;b<a.length-8;++b)a[b]=0;b=8*this.o;for(var c=a.length-8;c<a.length;++c)a[c]=255&b,b/=256;for(this.v(a),a=Array(16),b=0,c=0;c<4;++c)for(let d=0;d<32;d+=8)a[b++]=this.g[c]>>>d&255;return a};var g,h={};function i(a){return -128<=a&&a<128?e(a,function(a){return new f([0|a],a<0?-1:0)}):new f([0|a],a<0?-1:0)}function j(a){if(isNaN(a)||!isFinite(a))return m;if(a<0)return r(j(-a));let b=[],c=1;for(let d=0;a>=c;d++)b[d]=a/c|0,c*=0x100000000;return new f(b,0)}function l(a,b){if(0==a.length)throw Error("number format error: empty string");if((b=b||10)<2||36<b)throw Error("radix out of range: "+b);if("-"==a.charAt(0))return r(l(a.substring(1),b));if(a.indexOf("-")>=0)throw Error('number format error: interior "-" character');let c=j(Math.pow(b,8)),d=m;for(let f=0;f<a.length;f+=8){var e=Math.min(8,a.length-f);let g=parseInt(a.substring(f,f+e),b);e<8?(e=j(Math.pow(b,e)),d=d.j(e).add(j(g))):d=(d=d.j(c)).add(j(g))}return d}var m=i(0),n=i(1),o=i(0x1000000);function p(a){if(0!=a.h)return!1;for(let b=0;b<a.g.length;b++)if(0!=a.g[b])return!1;return!0}function q(a){return -1==a.h}function r(a){let b=a.g.length,c=[];for(let d=0;d<b;d++)c[d]=~a.g[d];return new f(c,~a.h).add(n)}function s(a,b){return a.add(r(b))}function t(a,b){for(;(65535&a[b])!=a[b];)a[b+1]+=a[b]>>>16,a[b]&=65535,b++}function u(a,b){this.g=a,this.h=b}function v(a,b){if(p(b))throw Error("division by zero");if(p(a))return new u(m,m);if(q(a))return b=v(r(a),b),new u(r(b.g),r(b.h));if(q(b))return b=v(a,r(b)),new u(r(b.g),b.h);if(a.g.length>30){if(q(a)||q(b))throw Error("slowDivide_ only works with positive integers.");for(var c=n,d=b;0>=d.l(a);)c=w(c),d=w(d);var e=x(c,1),f=x(d,1);for(d=x(d,2),c=x(c,2);!p(d);){var g=f.add(d);0>=g.l(a)&&(e=e.add(c),f=g),d=x(d,1),c=x(c,1)}return b=s(a,e.j(b)),new u(e,b)}for(e=m;a.l(b)>=0;){for(d=(d=Math.ceil(Math.log(c=Math.max(1,Math.floor(a.m()/b.m())))/Math.LN2))<=48?1:Math.pow(2,d-48),g=(f=j(c)).j(b);q(g)||g.l(a)>0;)c-=d,g=(f=j(c)).j(b);p(f)&&(f=n),e=e.add(f),a=s(a,g)}return new u(e,a)}function w(a){let b=a.g.length+1,c=[];for(let d=0;d<b;d++)c[d]=a.i(d)<<1|a.i(d-1)>>>31;return new f(c,a.h)}function x(a,b){let c=b>>5;b%=32;let d=a.g.length-c,e=[];for(let f=0;f<d;f++)e[f]=b>0?a.i(f+c)>>>b|a.i(f+c+1)<<32-b:a.i(f+c);return new f(e,a.h)}(g=f.prototype).m=function(){if(q(this))return-r(this).m();let a=0,b=1;for(let c=0;c<this.g.length;c++){let d=this.i(c);a+=(d>=0?d:0x100000000+d)*b,b*=0x100000000}return a},g.toString=function(a){if((a=a||10)<2||36<a)throw Error("radix out of range: "+a);if(p(this))return"0";if(q(this))return"-"+r(this).toString(a);let b=j(Math.pow(a,6));var c=this;let d="";for(;;){let e=v(c,b).g,f=(((c=s(c,e.j(b))).g.length>0?c.g[0]:c.h)>>>0).toString(a);if(p(c=e))return f+d;for(;f.length<6;)f="0"+f;d=f+d}},g.i=function(a){return a<0?0:a<this.g.length?this.g[a]:this.h},g.l=function(a){return q(a=s(this,a))?-1:+!p(a)},g.abs=function(){return q(this)?r(this):this},g.add=function(a){let b=Math.max(this.g.length,a.g.length),c=[],d=0;for(let e=0;e<=b;e++){let b=d+(65535&this.i(e))+(65535&a.i(e)),f=(b>>>16)+(this.i(e)>>>16)+(a.i(e)>>>16);d=f>>>16,b&=65535,f&=65535,c[e]=f<<16|b}return new f(c,-0x80000000&c[c.length-1]?-1:0)},g.j=function(a){if(p(this)||p(a))return m;if(q(this))return q(a)?r(this).j(r(a)):r(r(this).j(a));if(q(a))return r(this.j(r(a)));if(0>this.l(o)&&0>a.l(o))return j(this.m()*a.m());let b=this.g.length+a.g.length,c=[];for(var d=0;d<2*b;d++)c[d]=0;for(d=0;d<this.g.length;d++)for(let b=0;b<a.g.length;b++){let e=this.i(d)>>>16,f=65535&this.i(d),g=a.i(b)>>>16,h=65535&a.i(b);c[2*d+2*b]+=f*h,t(c,2*d+2*b),c[2*d+2*b+1]+=e*h,t(c,2*d+2*b+1),c[2*d+2*b+1]+=f*g,t(c,2*d+2*b+1),c[2*d+2*b+2]+=e*g,t(c,2*d+2*b+2)}for(a=0;a<b;a++)c[a]=c[2*a+1]<<16|c[2*a];for(a=b;a<2*b;a++)c[a]=0;return new f(c,0)},g.B=function(a){return v(this,a).h},g.and=function(a){let b=Math.max(this.g.length,a.g.length),c=[];for(let d=0;d<b;d++)c[d]=this.i(d)&a.i(d);return new f(c,this.h&a.h)},g.or=function(a){let b=Math.max(this.g.length,a.g.length),c=[];for(let d=0;d<b;d++)c[d]=this.i(d)|a.i(d);return new f(c,this.h|a.h)},g.xor=function(a){let b=Math.max(this.g.length,a.g.length),c=[];for(let d=0;d<b;d++)c[d]=this.i(d)^a.i(d);return new f(c,this.h^a.h)},a.prototype.digest=a.prototype.A,a.prototype.reset=a.prototype.u,a.prototype.update=a.prototype.v,c=k.Md5=a,f.prototype.add=f.prototype.add,f.prototype.multiply=f.prototype.j,f.prototype.modulo=f.prototype.B,f.prototype.compare=f.prototype.l,f.prototype.toNumber=f.prototype.m,f.prototype.toString=f.prototype.toString,f.prototype.getBits=f.prototype.i,f.fromNumber=j,f.fromString=l,b=k.Integer=f}).apply(void 0!==j?j:"u">typeof self?self:{});var l=a.i(14834),m=a.i(24361),n=a.i(54799),o=a.i(80304),p=a.i(67523);class q{constructor(a){this.uid=a}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(a){return a.uid===this.uid}}q.UNAUTHENTICATED=new q(null),q.GOOGLE_CREDENTIALS=new q("google-credentials-uid"),q.FIRST_PARTY=new q("first-party-uid"),q.MOCK_USER=new q("mock-user");let r="12.9.0";function s(a){r=a}function t(a){return(0,m.inspect)(a,{depth:100})}let u=new l.Logger("@firebase/firestore");function v(){return u.logLevel}function w(a,...b){if(u.logLevel<=l.LogLevel.DEBUG){let c=b.map(z);u.debug(`Firestore (${r}): ${a}`,...c)}}function x(a,...b){if(u.logLevel<=l.LogLevel.ERROR){let c=b.map(z);u.error(`Firestore (${r}): ${a}`,...c)}}function y(a,...b){if(u.logLevel<=l.LogLevel.WARN){let c=b.map(z);u.warn(`Firestore (${r}): ${a}`,...c)}}function z(a){if("string"==typeof a)return a;try{return t(a)}catch(b){return a}}function A(a,b,c){let d="Unexpected state";"string"==typeof b?d=b:c=b,B(a,d,c)}function B(a,b,c){let d=`FIRESTORE (${r}) INTERNAL ASSERTION FAILED: ${b} (ID: ${a.toString(16)})`;if(void 0!==c)try{let a=JSON.stringify(c);d+=" CONTEXT: "+a}catch(a){d+=" CONTEXT: "+c}throw x(d),Error(d)}function C(a,b,c,d){let e="Unexpected state";"string"==typeof c?e=c:d=c,a||B(b,e,d)}function D(a,b){return a}let E="ok",F="cancelled",G="unknown",H="invalid-argument",I="deadline-exceeded",J="not-found",K="already-exists",L="permission-denied",M="unauthenticated",N="resource-exhausted",O="failed-precondition",P="aborted",Q="out-of-range",R="unimplemented",S="internal",T="unavailable",U="data-loss";class V extends i.FirebaseError{constructor(a,b){super(a,b),this.code=a,this.message=b,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class W{constructor(){this.promise=new Promise((a,b)=>{this.resolve=a,this.reject=b})}}class X{constructor(a,b){this.user=b,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${a}`)}}class Y{getToken(){return Promise.resolve(null)}invalidateToken(){}start(a,b){a.enqueueRetryable(()=>b(q.UNAUTHENTICATED))}shutdown(){}}class Z{constructor(a){this.token=a,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(a,b){this.changeListener=b,a.enqueueRetryable(()=>b(this.token.user))}shutdown(){this.changeListener=null}}class ${constructor(a){this.authProvider=a,this.currentUser=q.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(a,b){C(void 0===this.tokenListener,42304);let c=this.tokenCounter,d=a=>this.tokenCounter!==c?(c=this.tokenCounter,b(a)):Promise.resolve(),e=new W;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),e.resolve(),e=new W,a.enqueueRetryable(()=>d(this.currentUser))};let f=()=>{let b=e;a.enqueueRetryable(async()=>{await b.promise,await d(this.currentUser)})},g=a=>{w("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=a,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),f())};this.authProvider.onInit(a=>g(a)),setTimeout(()=>{if(!this.auth){let a=this.authProvider.getImmediate({optional:!0});a?g(a):(w("FirebaseAuthCredentialsProvider","Auth not yet detected"),e.resolve(),e=new W)}},0),f()}getToken(){let a=this.tokenCounter,b=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(b).then(b=>this.tokenCounter!==a?(w("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):b?(C("string"==typeof b.accessToken,31837,{tokenData:b}),new X(b.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let a=this.auth&&this.auth.getUid();return C(null===a||"string"==typeof a,2055,{currentUid:a}),new q(a)}}class _{constructor(a,b,c){this.sessionIndex=a,this.iamToken=b,this.authTokenFactory=c,this.type="FirstParty",this.user=q.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let a=this.getAuthToken();return a&&this._headers.set("Authorization",a),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}}class aa{constructor(a,b,c){this.sessionIndex=a,this.iamToken=b,this.authTokenFactory=c}getToken(){return Promise.resolve(new _(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(a,b){a.enqueueRetryable(()=>b(q.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ab{constructor(a){this.value=a,this.type="AppCheck",this.headers=new Map,a&&a.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ac{constructor(a,b){this.appCheckProvider=b,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null,this.serverAppAppCheckToken=null,(0,h._isFirebaseServerApp)(a)&&a.settings.appCheckToken&&(this.serverAppAppCheckToken=a.settings.appCheckToken)}start(a,b){C(void 0===this.tokenListener,3512);let c=a=>{null!=a.error&&w("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);let c=a.token!==this.latestAppCheckToken;return this.latestAppCheckToken=a.token,w("FirebaseAppCheckTokenProvider",`Received ${c?"new":"existing"} token.`),c?b(a.token):Promise.resolve()};this.tokenListener=b=>{a.enqueueRetryable(()=>c(b))};let d=a=>{w("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(a=>d(a)),setTimeout(()=>{if(!this.appCheck){let a=this.appCheckProvider.getImmediate({optional:!0});a?d(a):w("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.serverAppAppCheckToken)return Promise.resolve(new ab(this.serverAppAppCheckToken));let a=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken(a).then(a=>a?(C("string"==typeof a.token,44558,{tokenResult:a}),this.latestAppCheckToken=a.token,new ab(a.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}}function ad(a){if(!a)return new Y;switch(a.type){case"firstParty":return new aa(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new V(H,"makeAuthCredentialsProvider failed due to invalid credential type")}}function ae(a){return(0,n.randomBytes)(a)}class af{static newId(){let a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",b=Math.floor(256/a.length)*a.length,c="",d=20;for(;c.length<d;){let e=ae(40);for(let f=0;f<e.length;++f)c.length<d&&e[f]<b&&(c+=a.charAt(e[f]%a.length))}return c}}function ag(a,b){return a<b?-1:+(a>b)}function ah(a,b){let c=Math.min(a.length,b.length);for(let d=0;d<c;d++){let c=a.charAt(d),e=b.charAt(d);if(c!==e)return ak(c)===ak(e)?ag(c,e):ak(c)?1:-1}return ag(a.length,b.length)}let ai=55296,aj=57343;function ak(a){let b=a.charCodeAt(0);return b>=ai&&b<=aj}function al(a,b,c){return a.length===b.length&&a.every((a,d)=>c(a,b[d]))}function am(a){return a+"\0"}let an="__name__";class ao{constructor(a,b,c){void 0===b?b=0:b>a.length&&A(637,{offset:b,range:a.length}),void 0===c?c=a.length-b:c>a.length-b&&A(1746,{length:c,range:a.length-b}),this.segments=a,this.offset=b,this.len=c}get length(){return this.len}isEqual(a){return 0===ao.comparator(this,a)}child(a){let b=this.segments.slice(this.offset,this.limit());return a instanceof ao?a.forEach(a=>{b.push(a)}):b.push(a),this.construct(b)}limit(){return this.offset+this.length}popFirst(a){return a=void 0===a?1:a,this.construct(this.segments,this.offset+a,this.length-a)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(a){return this.segments[this.offset+a]}isEmpty(){return 0===this.length}isPrefixOf(a){if(a.length<this.length)return!1;for(let b=0;b<this.length;b++)if(this.get(b)!==a.get(b))return!1;return!0}isImmediateParentOf(a){if(this.length+1!==a.length)return!1;for(let b=0;b<this.length;b++)if(this.get(b)!==a.get(b))return!1;return!0}forEach(a){for(let b=this.offset,c=this.limit();b<c;b++)a(this.segments[b])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(a,b){let c=Math.min(a.length,b.length);for(let d=0;d<c;d++){let c=ao.compareSegments(a.get(d),b.get(d));if(0!==c)return c}return ag(a.length,b.length)}static compareSegments(a,b){let c=ao.isNumericId(a),d=ao.isNumericId(b);return c&&!d?-1:!c&&d?1:c&&d?ao.extractNumericId(a).compare(ao.extractNumericId(b)):ah(a,b)}static isNumericId(a){return a.startsWith("__id")&&a.endsWith("__")}static extractNumericId(a){return b.fromString(a.substring(4,a.length-2))}}class ap extends ao{construct(a,b,c){return new ap(a,b,c)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...a){let b=[];for(let c of a){if(c.indexOf("//")>=0)throw new V(H,`Invalid segment (${c}). Paths must not contain // in them.`);b.push(...c.split("/").filter(a=>a.length>0))}return new ap(b)}static emptyPath(){return new ap([])}}let aq=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ar extends ao{construct(a,b,c){return new ar(a,b,c)}static isValidIdentifier(a){return aq.test(a)}canonicalString(){return this.toArray().map(a=>(a=a.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ar.isValidIdentifier(a)||(a="`"+a+"`"),a)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===an}static keyField(){return new ar([an])}static fromServerFormat(a){let b=[],c="",d=0,e=()=>{if(0===c.length)throw new V(H,`Invalid field path (${a}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);b.push(c),c=""},f=!1;for(;d<a.length;){let b=a[d];if("\\"===b){if(d+1===a.length)throw new V(H,"Path has trailing escape character: "+a);let b=a[d+1];if("\\"!==b&&"."!==b&&"`"!==b)throw new V(H,"Path has invalid escape sequence: "+a);c+=b,d+=2}else"`"===b?f=!f:"."!==b||f?c+=b:e(),d++}if(e(),f)throw new V(H,"Unterminated ` in path: "+a);return new ar(b)}static emptyPath(){return new ar([])}}class as{constructor(a){this.path=a}static fromPath(a){return new as(ap.fromString(a))}static fromName(a){return new as(ap.fromString(a).popFirst(5))}static empty(){return new as(ap.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(a){return this.path.length>=2&&this.path.get(this.path.length-2)===a}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(a){return null!==a&&0===ap.comparator(this.path,a.path)}toString(){return this.path.toString()}static comparator(a,b){return ap.comparator(a.path,b.path)}static isDocumentKey(a){return a.length%2==0}static fromSegments(a){return new as(new ap(a.slice()))}}function at(a,b,c){if(!c)throw new V(H,`Function ${a}() cannot be called with an empty ${b}.`)}function au(a,b,c,d){if(!0===b&&!0===d)throw new V(H,`${a} and ${c} cannot be used together.`)}function av(a){if(!as.isDocumentKey(a))throw new V(H,`Invalid document reference. Document references must have an even number of segments, but ${a} has ${a.length}.`)}function aw(a){if(as.isDocumentKey(a))throw new V(H,`Invalid collection reference. Collection references must have an odd number of segments, but ${a} has ${a.length}.`)}function ax(a){return"object"==typeof a&&null!==a&&(Object.getPrototypeOf(a)===Object.prototype||null===Object.getPrototypeOf(a))}function ay(a){if(void 0===a)return"undefined";if(null===a)return"null";if("string"==typeof a)return a.length>20&&(a=`${a.substring(0,20)}...`),JSON.stringify(a);if("number"==typeof a||"boolean"==typeof a)return""+a;if("object"==typeof a)if(a instanceof Array)return"an array";else{let b=az(a);return b?`a custom ${b} object`:"an object"}else if("function"==typeof a)return"a function";else return A(12329,{type:typeof a})}function az(a){return a.constructor?a.constructor.name:null}function aA(a,b){if("_delegate"in a&&(a=a._delegate),!(a instanceof b))if(b.name===a.constructor.name)throw new V(H,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");else{let c=ay(a);throw new V(H,`Expected type '${b.name}', but it was: ${c}`)}return a}function aB(a,b){if(b<=0)throw new V(H,`Function ${a}() requires a positive number, but it was: ${b}.`)}function aC(a,b){let c={typeString:a};return b&&(c.value=b),c}function aD(a,b){let c;if(!ax(a))throw new V(H,"JSON must be an object");for(let d in b)if(b[d]){let e=b[d].typeString,f="value"in b[d]?{value:b[d].value}:void 0;if(!(d in a)){c=`JSON missing required field: '${d}'`;break}let g=a[d];if(e&&typeof g!==e){c=`JSON field '${d}' must be a ${e}.`;break}if(void 0!==f&&g!==f.value){c=`Expected '${d}' field to equal '${f.value}'`;break}}if(c)throw new V(H,c);return!0}let aE=-0xe7791f700,aF=1e6;class aG{static now(){return aG.fromMillis(Date.now())}static fromDate(a){return aG.fromMillis(a.getTime())}static fromMillis(a){let b=Math.floor(a/1e3),c=Math.floor((a-1e3*b)*aF);return new aG(b,c)}constructor(a,b){if(this.seconds=a,this.nanoseconds=b,b<0||b>=1e9)throw new V(H,"Timestamp nanoseconds out of range: "+b);if(a<aE||a>=0x3afff44180)throw new V(H,"Timestamp seconds out of range: "+a)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/aF}_compareTo(a){return this.seconds===a.seconds?ag(this.nanoseconds,a.nanoseconds):ag(this.seconds,a.seconds)}isEqual(a){return a.seconds===this.seconds&&a.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:aG._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(a){if(aD(a,aG._jsonSchema))return new aG(a.seconds,a.nanoseconds)}valueOf(){return String(this.seconds-aE).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}aG._jsonSchemaVersion="firestore/timestamp/1.0",aG._jsonSchema={type:aC("string",aG._jsonSchemaVersion),seconds:aC("number"),nanoseconds:aC("number")};class aH{static fromTimestamp(a){return new aH(a)}static min(){return new aH(new aG(0,0))}static max(){return new aH(new aG(0x3afff4417f,1e9-1))}constructor(a){this.timestamp=a}compareTo(a){return this.timestamp._compareTo(a.timestamp)}isEqual(a){return this.timestamp.isEqual(a.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}let aI=-1,aJ=0;class aK{constructor(a,b,c,d){this.indexId=a,this.collectionGroup=b,this.fields=c,this.indexState=d}}function aL(a){return a.fields.find(a=>2===a.kind)}function aM(a){return a.fields.filter(a=>2!==a.kind)}function aN(a){let b=aM(a);return 0===b.length?0:b[b.length-1].kind}function aO(a,b){let c=ag(a.collectionGroup,b.collectionGroup);if(0!==c)return c;for(let d=0;d<Math.min(a.fields.length,b.fields.length);++d)if(0!==(c=aR(a.fields[d],b.fields[d])))return c;return ag(a.fields.length,b.fields.length)}function aP(a){return`id=${a.indexId}|cg=${a.collectionGroup}|f=${a.fields.map(a=>`${a.fieldPath}:${a.kind}`).join(",")}`}aK.UNKNOWN_ID=-1;class aQ{constructor(a,b){this.fieldPath=a,this.kind=b}}function aR(a,b){let c=ar.comparator(a.fieldPath,b.fieldPath);return 0!==c?c:ag(a.kind,b.kind)}class aS{constructor(a,b){this.sequenceNumber=a,this.offset=b}static empty(){return new aS(aJ,aV.min())}}function aT(a,b){let c=a.toTimestamp().seconds,d=a.toTimestamp().nanoseconds+1;return new aV(aH.fromTimestamp(1e9===d?new aG(c+1,0):new aG(c,d)),as.empty(),b)}function aU(a){return new aV(a.readTime,a.key,aI)}class aV{constructor(a,b,c){this.readTime=a,this.documentKey=b,this.largestBatchId=c}static min(){return new aV(aH.min(),as.empty(),aI)}static max(){return new aV(aH.max(),as.empty(),aI)}}function aW(a,b){let c=a.readTime.compareTo(b.readTime);return 0!==c||0!==(c=as.comparator(a.documentKey,b.documentKey))?c:ag(a.largestBatchId,b.largestBatchId)}let aX="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class aY{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(a){this.onCommittedListeners.push(a)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(a=>a())}}async function aZ(a){if(a.code===O&&a.message===aX)w("LocalStore","Unexpectedly lost primary lease");else throw a}class a${constructor(a){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,a(a=>{this.isDone=!0,this.result=a,this.nextCallback&&this.nextCallback(a)},a=>{this.isDone=!0,this.error=a,this.catchCallback&&this.catchCallback(a)})}catch(a){return this.next(void 0,a)}next(a,b){return(this.callbackAttached&&A(59440),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(b,this.error):this.wrapSuccess(a,this.result):new a$((c,d)=>{this.nextCallback=b=>{this.wrapSuccess(a,b).next(c,d)},this.catchCallback=a=>{this.wrapFailure(b,a).next(c,d)}})}toPromise(){return new Promise((a,b)=>{this.next(a,b)})}wrapUserFunction(a){try{let b=a();if(b instanceof a$)return b;return a$.resolve(b)}catch(a){return a$.reject(a)}}wrapSuccess(a,b){return a?this.wrapUserFunction(()=>a(b)):a$.resolve(b)}wrapFailure(a,b){return a?this.wrapUserFunction(()=>a(b)):a$.reject(b)}static resolve(a){return new a$((b,c)=>{b(a)})}static reject(a){return new a$((b,c)=>{c(a)})}static waitFor(a){return new a$((b,c)=>{let d=0,e=0,f=!1;a.forEach(a=>{++d,a.next(()=>{++e,f&&e===d&&b()},a=>c(a))}),f=!0,e===d&&b()})}static or(a){let b=a$.resolve(!1);for(let c of a)b=b.next(a=>a?a$.resolve(a):c());return b}static forEach(a,b){let c=[];return a.forEach((a,d)=>{c.push(b.call(this,a,d))}),this.waitFor(c)}static mapArray(a,b){return new a$((c,d)=>{let e=a.length,f=Array(e),g=0;for(let h=0;h<e;h++){let i=h;b(a[i]).next(a=>{f[i]=a,++g===e&&c(f)},a=>d(a))}})}static doWhile(a,b){return new a$((c,d)=>{let e=()=>{!0===a()?b().next(()=>{e()},d):c()};e()})}}let a_="SimpleDb",a0=3;class a1{static open(a,b,c,d){try{return new a1(b,a.transaction(d,c))}catch(a){throw new a5(b,a)}}constructor(a,b){this.action=a,this.transaction=b,this.aborted=!1,this.completionDeferred=new W,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{b.error?this.completionDeferred.reject(new a5(a,b.error)):this.completionDeferred.resolve()},this.transaction.onerror=b=>{let c=ba(b.target.error);this.completionDeferred.reject(new a5(a,c))}}get completionPromise(){return this.completionDeferred.promise}abort(a){a&&this.completionDeferred.reject(a),this.aborted||(w(a_,"Aborting transaction:",a?a.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let a=this.transaction;this.aborted||"function"!=typeof a.commit||a.commit()}store(a){return new a7(this.transaction.objectStore(a))}}class a2{static delete(a){return w(a_,"Removing database:",a),a8((0,i.getGlobal)().indexedDB.deleteDatabase(a)).toPromise()}static isAvailable(){if(!(0,i.isIndexedDBAvailable)())return!1;if(a2.isMockPersistence())return!0;let a=(0,i.getUA)(),b=a2.getIOSVersion(a),c=0<b&&b<10,d=a3(a),e=0<d&&d<4.5;return!(a.indexOf("MSIE ")>0||a.indexOf("Trident/")>0||a.indexOf("Edge/")>0)&&!c&&!e}static isMockPersistence(){return"u">typeof process&&process.env?.USE_MOCK_PERSISTENCE==="YES"}static getStore(a,b){return a.store(b)}static getIOSVersion(a){let b=a.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(b?b[1].split("_").slice(0,2).join("."):"-1")}constructor(a,b,c){this.name=a,this.version=b,this.schemaConverter=c,this.lastClosedDbVersion=null,12.2===a2.getIOSVersion((0,i.getUA)())&&x("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async ensureDb(a){return this.db||(w(a_,"Opening database:",this.name),this.db=await new Promise((b,c)=>{let d=indexedDB.open(this.name,this.version);d.onsuccess=a=>{b(a.target.result)},d.onblocked=()=>{c(new a5(a,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},d.onerror=b=>{let d=b.target.error;"VersionError"===d.name?c(new V(O,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===d.name?c(new V(O,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+d)):c(new a5(a,d))},d.onupgradeneeded=a=>{w(a_,'Database "'+this.name+'" requires upgrade from version:',a.oldVersion);let b=a.target.result;this.schemaConverter.createOrUpgrade(b,d.transaction,a.oldVersion,this.version).next(()=>{w(a_,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=a=>this.versionchangelistener(a)),this.db}setVersionChangeListener(a){this.versionchangelistener=a,this.db&&(this.db.onversionchange=b=>a(b))}async runTransaction(a,b,c,d){let e="readonly"===b,f=0;for(;;){++f;try{this.db=await this.ensureDb(a);let b=a1.open(this.db,a,e?"readonly":"readwrite",c),f=d(b).next(a=>(b.maybeCommit(),a)).catch(a=>(b.abort(a),a$.reject(a))).toPromise();return f.catch(()=>{}),await b.completionPromise,f}catch(c){let a=c,b="FirebaseError"!==a.name&&f<a0;if(w(a_,"Transaction failed with error:",a.message,"Retrying:",b),this.close(),!b)return Promise.reject(a)}}}close(){this.db&&this.db.close(),this.db=void 0}}function a3(a){let b=a.match(/Android ([\d.]+)/i);return Number(b?b[1].split(".").slice(0,2).join("."):"-1")}class a4{constructor(a){this.dbCursor=a,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(a){this.dbCursor=a}done(){this.shouldStop=!0}skip(a){this.nextKey=a}delete(){return a8(this.dbCursor.delete())}}class a5 extends V{constructor(a,b){super(T,`IndexedDB transaction '${a}' failed: ${b}`),this.name="IndexedDbTransactionError"}}function a6(a){return"IndexedDbTransactionError"===a.name}class a7{constructor(a){this.store=a}put(a,b){let c;return void 0!==b?(w(a_,"PUT",this.store.name,a,b),c=this.store.put(b,a)):(w(a_,"PUT",this.store.name,"<auto-key>",a),c=this.store.put(a)),a8(c)}add(a){return w(a_,"ADD",this.store.name,a,a),a8(this.store.add(a))}get(a){return a8(this.store.get(a)).next(b=>(void 0===b&&(b=null),w(a_,"GET",this.store.name,a,b),b))}delete(a){return w(a_,"DELETE",this.store.name,a),a8(this.store.delete(a))}count(){return w(a_,"COUNT",this.store.name),a8(this.store.count())}loadAll(a,b){let c=this.options(a,b),d=c.index?this.store.index(c.index):this.store;if("function"==typeof d.getAll){let a=d.getAll(c.range);return new a$((b,c)=>{a.onerror=a=>{c(a.target.error)},a.onsuccess=a=>{b(a.target.result)}})}{let a=this.cursor(c),b=[];return this.iterateCursor(a,(a,c)=>{b.push(c)}).next(()=>b)}}loadFirst(a,b){let c=this.store.getAll(a,null===b?void 0:b);return new a$((a,b)=>{c.onerror=a=>{b(a.target.error)},c.onsuccess=b=>{a(b.target.result)}})}deleteAll(a,b){w(a_,"DELETE ALL",this.store.name);let c=this.options(a,b);c.keysOnly=!1;let d=this.cursor(c);return this.iterateCursor(d,(a,b,c)=>c.delete())}iterate(a,b){let c;b?c=a:(c={},b=a);let d=this.cursor(c);return this.iterateCursor(d,b)}iterateSerial(a){let b=this.cursor({});return new a$((c,d)=>{b.onerror=a=>{d(ba(a.target.error))},b.onsuccess=b=>{let d=b.target.result;d?a(d.primaryKey,d.value).next(a=>{a?d.continue():c()}):c()}})}iterateCursor(a,b){let c=[];return new a$((d,e)=>{a.onerror=a=>{e(a.target.error)},a.onsuccess=a=>{let e=a.target.result;if(!e)return void d();let f=new a4(e),g=b(e.primaryKey,e.value,f);if(g instanceof a$){let a=g.catch(a=>(f.done(),a$.reject(a)));c.push(a)}f.isDone?d():null===f.skipToKey?e.continue():e.continue(f.skipToKey)}}).next(()=>a$.waitFor(c))}options(a,b){let c;return void 0!==a&&("string"==typeof a?c=a:b=a),{index:c,range:b}}cursor(a){let b="next";if(a.reverse&&(b="prev"),!a.index)return this.store.openCursor(a.range,b);{let c=this.store.index(a.index);return a.keysOnly?c.openKeyCursor(a.range,b):c.openCursor(a.range,b)}}}function a8(a){return new a$((b,c)=>{a.onsuccess=a=>{b(a.target.result)},a.onerror=a=>{c(ba(a.target.error))}})}let a9=!1;function ba(a){let b=a2.getIOSVersion((0,i.getUA)());if(b>=12.2&&b<13){let b="An internal error was encountered in the Indexed Database server";if(a.message.indexOf(b)>=0){let a=new V("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${b}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return a9||(a9=!0,setTimeout(()=>{throw a},0)),a}}return a}let bb="IndexBackfiller",bc=15e3,bd=6e4,be=50;class bf{constructor(a,b){this.asyncQueue=a,this.backfiller=b,this.task=null}start(){this.schedule(bc)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}schedule(a){w(bb,`Scheduled in ${a}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",a,async()=>{this.task=null;try{let a=await this.backfiller.backfill();w(bb,`Documents written: ${a}`)}catch(a){a6(a)?w(bb,"Ignoring IndexedDB error during index backfill: ",a):await aZ(a)}await this.schedule(bd)})}}class bg{constructor(a,b){this.localStore=a,this.persistence=b}async backfill(a=be){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",b=>this.writeIndexEntries(b,a))}writeIndexEntries(a,b){let c=new Set,d=b,e=!0;return a$.doWhile(()=>!0===e&&d>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(a).next(b=>{if(!(null===b||c.has(b)))return w(bb,`Processing collection: ${b}`),this.writeEntriesForCollectionGroup(a,b,d).next(a=>{d-=a,c.add(b)});e=!1})).next(()=>b-d)}writeEntriesForCollectionGroup(a,b,c){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(a,b).next(d=>this.localStore.localDocuments.getNextDocuments(a,b,d,c).next(c=>{let e=c.changes;return this.localStore.indexManager.updateIndexEntries(a,e).next(()=>this.getNewOffset(d,c)).next(c=>(w(bb,`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(a,b,c))).next(()=>e.size)}))}getNewOffset(a,b){let c=a;return b.changes.forEach((a,b)=>{let d=aU(b);aW(d,c)>0&&(c=d)}),new aV(c.readTime,c.documentKey,Math.max(b.batchId,a.largestBatchId))}}class bh{constructor(a,b){this.previousValue=a,b&&(b.sequenceNumberHandler=a=>this.setPreviousValue(a),this.writeNewSequenceNumber=a=>b.writeSequenceNumber(a))}setPreviousValue(a){return this.previousValue=Math.max(a,this.previousValue),this.previousValue}next(){let a=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(a),a}}bh.INVALID=-1;let bi="\x01",bj="\x01",bk="\x10",bl="\x11";function bm(a){let b="";for(let c=0;c<a.length;c++)b.length>0&&(b=bo(b)),b=bn(a.get(c),b);return bo(b)}function bn(a,b){let c=b,d=a.length;for(let b=0;b<d;b++){let d=a.charAt(b);switch(d){case"\0":c+=bi+bk;break;case bi:c+=bi+bl;break;default:c+=d}}return c}function bo(a){return a+bi+bj}function bp(a){let b=a.length;if(C(b>=2,64408,{path:a}),2===b)return C(a.charAt(0)===bi&&a.charAt(1)===bj,56145,{path:a}),ap.emptyPath();let c=b-2,d=[],e="";for(let f=0;f<b;){let b=a.indexOf(bi,f);switch((b<0||b>c)&&A(50515,{path:a}),a.charAt(b+1)){case bj:let g,h=a.substring(f,b);0===e.length?g=h:(e+=h,g=e,e=""),d.push(g);break;case bk:e+=a.substring(f,b),e+="\0";break;case bl:e+=a.substring(f,b+1);break;default:A(61167,{path:a})}f=b+2}return new ap(d)}let bq="remoteDocuments",br="owner",bs="owner",bt="mutationQueues",bu="userId",bv="mutations",bw="batchId",bx="userMutationsIndex",by=["userId","batchId"];function bz(a){return[a]}function bA(a,b){return[a,bm(b)]}function bB(a,b,c){return[a,bm(b),c]}let bC={},bD="documentMutations",bE="remoteDocumentsV14",bF=["prefixPath","collectionGroup","readTime","documentId"],bG="documentKeyIndex",bH=["prefixPath","collectionGroup","documentId"],bI="collectionGroupIndex",bJ=["collectionGroup","readTime","prefixPath","documentId"],bK="remoteDocumentGlobal",bL="remoteDocumentGlobalKey",bM="targets",bN="targetId",bO="queryTargetsIndex",bP=["canonicalId","targetId"],bQ="targetDocuments",bR=["targetId","path"],bS="documentTargetsIndex",bT=["path","targetId"],bU="targetGlobalKey",bV="targetGlobal",bW="collectionParents",bX=["collectionId","parent"],bY="clientMetadata",bZ="clientId",b$="bundles",b_="bundleId",b0="namedQueries",b1="name",b2="indexConfiguration",b3="indexId",b4="collectionGroupIndex",b5="collectionGroup",b6="indexState",b7=["indexId","uid"],b8="sequenceNumberIndex",b9=["uid","sequenceNumber"],ca="indexEntries",cb=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],cc="documentKeyIndex",cd=["indexId","uid","orderedDocumentKey"],ce="documentOverlays",cf=["userId","collectionPath","documentId"],cg="collectionPathOverlayIndex",ch=["userId","collectionPath","largestBatchId"],ci="collectionGroupOverlayIndex",cj=["userId","collectionGroup","largestBatchId"],ck="globals",cl="name",cm=[bt,bv,bD,bq,bM,br,bV,bQ,bY,bK,bW,b$,b0],cn=[...cm,ce],co=[bt,bv,bD,bE,bM,br,bV,bQ,bY,bK,bW,b$,b0,ce],cp=co,cq=[...cp,b2,b6,ca],cr=cq,cs=[...cq,ck],ct=cs;function cu(a){return 18===a?ct:17===a?cs:16===a?cr:15===a?cq:14===a?cp:13===a?co:12===a?cn:11===a?cm:void A(60245)}class cv extends aY{constructor(a,b){super(),this.simpleDbTransaction=a,this.currentSequenceNumber=b}}function cw(a,b){let c=D(a);return a2.getStore(c.simpleDbTransaction,b)}function cx(a){let b=0;for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b++;return b}function cy(a,b){for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b(c,a[c])}function cz(a,b){let c=[];for(let d in a)Object.prototype.hasOwnProperty.call(a,d)&&c.push(b(a[d],d,a));return c}function cA(a){for(let b in a)if(Object.prototype.hasOwnProperty.call(a,b))return!1;return!0}class cB{constructor(a,b){this.comparator=a,this.root=b||cD.EMPTY}insert(a,b){return new cB(this.comparator,this.root.insert(a,b,this.comparator).copy(null,null,cD.BLACK,null,null))}remove(a){return new cB(this.comparator,this.root.remove(a,this.comparator).copy(null,null,cD.BLACK,null,null))}get(a){let b=this.root;for(;!b.isEmpty();){let c=this.comparator(a,b.key);if(0===c)return b.value;c<0?b=b.left:c>0&&(b=b.right)}return null}indexOf(a){let b=0,c=this.root;for(;!c.isEmpty();){let d=this.comparator(a,c.key);if(0===d)return b+c.left.size;d<0?c=c.left:(b+=c.left.size+1,c=c.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(a){return this.root.inorderTraversal(a)}forEach(a){this.inorderTraversal((b,c)=>(a(b,c),!1))}toString(){let a=[];return this.inorderTraversal((b,c)=>(a.push(`${b}:${c}`),!1)),`{${a.join(", ")}}`}reverseTraversal(a){return this.root.reverseTraversal(a)}getIterator(){return new cC(this.root,null,this.comparator,!1)}getIteratorFrom(a){return new cC(this.root,a,this.comparator,!1)}getReverseIterator(){return new cC(this.root,null,this.comparator,!0)}getReverseIteratorFrom(a){return new cC(this.root,a,this.comparator,!0)}}class cC{constructor(a,b,c,d){this.isReverse=d,this.nodeStack=[];let e=1;for(;!a.isEmpty();)if(e=b?c(a.key,b):1,b&&d&&(e*=-1),e<0)a=this.isReverse?a.left:a.right;else if(0===e){this.nodeStack.push(a);break}else this.nodeStack.push(a),a=this.isReverse?a.right:a.left}getNext(){let a=this.nodeStack.pop(),b={key:a.key,value:a.value};if(this.isReverse)for(a=a.left;!a.isEmpty();)this.nodeStack.push(a),a=a.right;else for(a=a.right;!a.isEmpty();)this.nodeStack.push(a),a=a.left;return b}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let a=this.nodeStack[this.nodeStack.length-1];return{key:a.key,value:a.value}}}class cD{constructor(a,b,c,d,e){this.key=a,this.value=b,this.color=null!=c?c:cD.RED,this.left=null!=d?d:cD.EMPTY,this.right=null!=e?e:cD.EMPTY,this.size=this.left.size+1+this.right.size}copy(a,b,c,d,e){return new cD(null!=a?a:this.key,null!=b?b:this.value,null!=c?c:this.color,null!=d?d:this.left,null!=e?e:this.right)}isEmpty(){return!1}inorderTraversal(a){return this.left.inorderTraversal(a)||a(this.key,this.value)||this.right.inorderTraversal(a)}reverseTraversal(a){return this.right.reverseTraversal(a)||a(this.key,this.value)||this.left.reverseTraversal(a)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(a,b,c){let d=this,e=c(a,d.key);return(d=e<0?d.copy(null,null,null,d.left.insert(a,b,c),null):0===e?d.copy(null,b,null,null,null):d.copy(null,null,null,null,d.right.insert(a,b,c))).fixUp()}removeMin(){if(this.left.isEmpty())return cD.EMPTY;let a=this;return a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),(a=a.copy(null,null,null,a.left.removeMin(),null)).fixUp()}remove(a,b){let c,d=this;if(0>b(a,d.key))d.left.isEmpty()||d.left.isRed()||d.left.left.isRed()||(d=d.moveRedLeft()),d=d.copy(null,null,null,d.left.remove(a,b),null);else{if(d.left.isRed()&&(d=d.rotateRight()),d.right.isEmpty()||d.right.isRed()||d.right.left.isRed()||(d=d.moveRedRight()),0===b(a,d.key))if(d.right.isEmpty())return cD.EMPTY;else c=d.right.min(),d=d.copy(c.key,c.value,null,null,d.right.removeMin());d=d.copy(null,null,null,null,d.right.remove(a,b))}return d.fixUp()}isRed(){return this.color}fixUp(){let a=this;return a.right.isRed()&&!a.left.isRed()&&(a=a.rotateLeft()),a.left.isRed()&&a.left.left.isRed()&&(a=a.rotateRight()),a.left.isRed()&&a.right.isRed()&&(a=a.colorFlip()),a}moveRedLeft(){let a=this.colorFlip();return a.right.left.isRed()&&(a=(a=(a=a.copy(null,null,null,null,a.right.rotateRight())).rotateLeft()).colorFlip()),a}moveRedRight(){let a=this.colorFlip();return a.left.left.isRed()&&(a=(a=a.rotateRight()).colorFlip()),a}rotateLeft(){let a=this.copy(null,null,cD.RED,null,this.right.left);return this.right.copy(null,null,this.color,a,null)}rotateRight(){let a=this.copy(null,null,cD.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,a)}colorFlip(){let a=this.left.copy(null,null,!this.left.color,null,null),b=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,a,b)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw A(43730,{key:this.key,value:this.value});if(this.right.isRed())throw A(14113,{key:this.key,value:this.value});let a=this.left.check();if(a===this.right.check())return a+ +!this.isRed();throw A(27949)}}cD.EMPTY=null,cD.RED=!0,cD.BLACK=!1;class cE{constructor(){this.size=0}get key(){throw A(57766)}get value(){throw A(16141)}get color(){throw A(16727)}get left(){throw A(29726)}get right(){throw A(36894)}copy(a,b,c,d,e){return this}insert(a,b,c){return new cD(a,b)}remove(a,b){return this}isEmpty(){return!0}inorderTraversal(a){return!1}reverseTraversal(a){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}}cD.EMPTY=new cE;class cF{constructor(a){this.comparator=a,this.data=new cB(this.comparator)}has(a){return null!==this.data.get(a)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(a){return this.data.indexOf(a)}forEach(a){this.data.inorderTraversal((b,c)=>(a(b),!1))}forEachInRange(a,b){let c=this.data.getIteratorFrom(a[0]);for(;c.hasNext();){let d=c.getNext();if(this.comparator(d.key,a[1])>=0)return;b(d.key)}}forEachWhile(a,b){let c;for(c=void 0!==b?this.data.getIteratorFrom(b):this.data.getIterator();c.hasNext();)if(!a(c.getNext().key))return}firstAfterOrEqual(a){let b=this.data.getIteratorFrom(a);return b.hasNext()?b.getNext().key:null}getIterator(){return new cG(this.data.getIterator())}getIteratorFrom(a){return new cG(this.data.getIteratorFrom(a))}add(a){return this.copy(this.data.remove(a).insert(a,!0))}delete(a){return this.has(a)?this.copy(this.data.remove(a)):this}isEmpty(){return this.data.isEmpty()}unionWith(a){let b=this;return b.size<a.size&&(b=a,a=this),a.forEach(a=>{b=b.add(a)}),b}isEqual(a){if(!(a instanceof cF)||this.size!==a.size)return!1;let b=this.data.getIterator(),c=a.data.getIterator();for(;b.hasNext();){let a=b.getNext().key,d=c.getNext().key;if(0!==this.comparator(a,d))return!1}return!0}toArray(){let a=[];return this.forEach(b=>{a.push(b)}),a}toString(){let a=[];return this.forEach(b=>a.push(b)),"SortedSet("+a.toString()+")"}copy(a){let b=new cF(this.comparator);return b.data=a,b}}class cG{constructor(a){this.iter=a}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function cH(a,b,c,d,e){let f=a.getIterator(),g=b.getIterator(),h=cI(f),i=cI(g);for(;h||i;){let a=!1,b=!1;if(h&&i){let d=c(h,i);d<0?b=!0:d>0&&(a=!0)}else null!=h?b=!0:a=!0;a?(d(i),i=cI(g)):b?(e(h),h=cI(f)):(h=cI(f),i=cI(g))}}function cI(a){return a.hasNext()?a.getNext():void 0}class cJ{constructor(a){this.fields=a,a.sort(ar.comparator)}static empty(){return new cJ([])}unionWith(a){let b=new cF(ar.comparator);for(let a of this.fields)b=b.add(a);for(let c of a)b=b.add(c);return new cJ(b.toArray())}covers(a){for(let b of this.fields)if(b.isPrefixOf(a))return!0;return!1}isEqual(a){return al(this.fields,a.fields,(a,b)=>a.isEqual(b))}}function cK(a){return Buffer.from(a,"base64").toString("binary")}function cL(a){return Buffer.from(a,"binary").toString("base64")}class cM{constructor(a){this.binaryString=a}static fromBase64String(a){return new cM(cK(a))}static fromUint8Array(a){return new cM(cN(a))}[Symbol.iterator](){let a=0;return{next:()=>a<this.binaryString.length?{value:this.binaryString.charCodeAt(a++),done:!1}:{value:void 0,done:!0}}}toBase64(){return cL(this.binaryString)}toUint8Array(){return cO(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(a){return ag(this.binaryString,a.binaryString)}isEqual(a){return this.binaryString===a.binaryString}}function cN(a){let b="";for(let c=0;c<a.length;++c)b+=String.fromCharCode(a[c]);return b}function cO(a){let b=new Uint8Array(a.length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}cM.EMPTY_BYTE_STRING=new cM("");let cP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function cQ(a){if(C(!!a,39018),"string"==typeof a){let b=0,c=cP.exec(a);if(C(!!c,46558,{timestamp:a}),c[1]){let a=c[1];b=Number(a=(a+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(a).getTime()/1e3),nanos:b}}return{seconds:cR(a.seconds),nanos:cR(a.nanos)}}function cR(a){return"number"==typeof a?a:"string"==typeof a?Number(a):0}function cS(a){return"string"==typeof a?cM.fromBase64String(a):cM.fromUint8Array(a)}let cT="server_timestamp",cU="__type__",cV="__previous_value__",cW="__local_write_time__";function cX(a){return(a?.mapValue?.fields||{})[cU]?.stringValue===cT}function cY(a,b){let c={fields:{[cU]:{stringValue:cT},[cW]:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return b&&cX(b)&&(b=cZ(b)),b&&(c.fields[cV]=b),{mapValue:c}}function cZ(a){let b=a.mapValue.fields[cV];return cX(b)?cZ(b):b}function c$(a){let b=cQ(a.mapValue.fields[cW].timestampValue);return new aG(b.seconds,b.nanos)}class c_{constructor(a,b,c,d,e,f,g,h,i,j,k){this.databaseId=a,this.appId=b,this.persistenceKey=c,this.host=d,this.ssl=e,this.forceLongPolling=f,this.autoDetectLongPolling=g,this.longPollingOptions=h,this.useFetchStreams=i,this.isUsingEmulator=j,this.apiKey=k}}let c0="(default)";class c1{constructor(a,b){this.projectId=a,this.database=b||c0}static empty(){return new c1("","")}get isDefaultDatabase(){return this.database===c0}isEqual(a){return a instanceof c1&&a.projectId===this.projectId&&a.database===this.database}}function c2(a,b){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new V(H,'"projectId" not provided in firebase.initializeApp.');return new c1(a.options.projectId,b)}let c3=-1;function c4(a){return null==a}function c5(a){return 0===a&&1/a==-1/0}function c6(a){return"number"==typeof a&&Number.isInteger(a)&&!c5(a)&&a<=Number.MAX_SAFE_INTEGER&&a>=Number.MIN_SAFE_INTEGER}let c7="__type__",c8="__max__",c9={mapValue:{fields:{__type__:{stringValue:c8}}}},da="__vector__",db="value",dc={nullValue:"NULL_VALUE"};function dd(a){return"nullValue"in a?0:"booleanValue"in a?1:"integerValue"in a||"doubleValue"in a?2:"timestampValue"in a?3:"stringValue"in a?5:"bytesValue"in a?6:"referenceValue"in a?7:"geoPointValue"in a?8:"arrayValue"in a?9:"mapValue"in a?cX(a)?4:dQ(a)?0x1fffffffffffff:dO(a)?10:11:A(28295,{value:a})}function de(a,b){if(a===b)return!0;let c=dd(a);if(c!==dd(b))return!1;switch(c){case 0:case 0x1fffffffffffff:return!0;case 1:return a.booleanValue===b.booleanValue;case 4:return c$(a).isEqual(c$(b));case 3:return df(a,b);case 5:return a.stringValue===b.stringValue;case 6:return dh(a,b);case 7:return a.referenceValue===b.referenceValue;case 8:return dg(a,b);case 2:return di(a,b);case 9:return al(a.arrayValue.values||[],b.arrayValue.values||[],de);case 10:case 11:return dj(a,b);default:return A(52216,{left:a})}}function df(a,b){if("string"==typeof a.timestampValue&&"string"==typeof b.timestampValue&&a.timestampValue.length===b.timestampValue.length)return a.timestampValue===b.timestampValue;let c=cQ(a.timestampValue),d=cQ(b.timestampValue);return c.seconds===d.seconds&&c.nanos===d.nanos}function dg(a,b){return cR(a.geoPointValue.latitude)===cR(b.geoPointValue.latitude)&&cR(a.geoPointValue.longitude)===cR(b.geoPointValue.longitude)}function dh(a,b){return cS(a.bytesValue).isEqual(cS(b.bytesValue))}function di(a,b){if("integerValue"in a&&"integerValue"in b)return cR(a.integerValue)===cR(b.integerValue);if("doubleValue"in a&&"doubleValue"in b){let c=cR(a.doubleValue),d=cR(b.doubleValue);return c===d?c5(c)===c5(d):isNaN(c)&&isNaN(d)}return!1}function dj(a,b){let c=a.mapValue.fields||{},d=b.mapValue.fields||{};if(cx(c)!==cx(d))return!1;for(let a in c)if(c.hasOwnProperty(a)&&(void 0===d[a]||!de(c[a],d[a])))return!1;return!0}function dk(a,b){return void 0!==(a.values||[]).find(a=>de(a,b))}function dl(a,b){if(a===b)return 0;let c=dd(a),d=dd(b);if(c!==d)return ag(c,d);switch(c){case 0:case 0x1fffffffffffff:return 0;case 1:return ag(a.booleanValue,b.booleanValue);case 2:return dm(a,b);case 3:return dn(a.timestampValue,b.timestampValue);case 4:return dn(c$(a),c$(b));case 5:return ah(a.stringValue,b.stringValue);case 6:return dr(a.bytesValue,b.bytesValue);case 7:return dp(a.referenceValue,b.referenceValue);case 8:return dq(a.geoPointValue,b.geoPointValue);case 9:return ds(a.arrayValue,b.arrayValue);case 10:return dt(a.mapValue,b.mapValue);case 11:return du(a.mapValue,b.mapValue);default:throw A(23264,{leftType:c})}}function dm(a,b){let c=cR(a.integerValue||a.doubleValue),d=cR(b.integerValue||b.doubleValue);return c<d?-1:c>d?1:c===d?0:isNaN(c)?isNaN(d)?0:-1:1}function dn(a,b){if("string"==typeof a&&"string"==typeof b&&a.length===b.length)return ag(a,b);let c=cQ(a),d=cQ(b),e=ag(c.seconds,d.seconds);return 0!==e?e:ag(c.nanos,d.nanos)}function dp(a,b){let c=a.split("/"),d=b.split("/");for(let a=0;a<c.length&&a<d.length;a++){let b=ag(c[a],d[a]);if(0!==b)return b}return ag(c.length,d.length)}function dq(a,b){let c=ag(cR(a.latitude),cR(b.latitude));return 0!==c?c:ag(cR(a.longitude),cR(b.longitude))}function dr(a,b){let c=cS(a),d=cS(b);return c.compareTo(d)}function ds(a,b){let c=a.values||[],d=b.values||[];for(let a=0;a<c.length&&a<d.length;++a){let b=dl(c[a],d[a]);if(b)return b}return ag(c.length,d.length)}function dt(a,b){let c=a.fields||{},d=b.fields||{},e=c[db]?.arrayValue,f=d[db]?.arrayValue,g=ag(e?.values?.length||0,f?.values?.length||0);return 0!==g?g:ds(e,f)}function du(a,b){if(a===c9.mapValue&&b===c9.mapValue)return 0;if(a===c9.mapValue)return 1;if(b===c9.mapValue)return -1;let c=a.fields||{},d=Object.keys(c),e=b.fields||{},f=Object.keys(e);d.sort(),f.sort();for(let a=0;a<d.length&&a<f.length;++a){let b=ah(d[a],f[a]);if(0!==b)return b;let g=dl(c[d[a]],e[f[a]]);if(0!==g)return g}return ag(d.length,f.length)}function dv(a){return dw(a)}function dw(a){if("nullValue"in a)return"null";if("booleanValue"in a)return""+a.booleanValue;if("integerValue"in a)return""+a.integerValue;if("doubleValue"in a)return""+a.doubleValue;if("timestampValue"in a)return dy(a.timestampValue);else if("stringValue"in a)return a.stringValue;else if("bytesValue"in a)return dx(a.bytesValue);else if("referenceValue"in a)return dA(a.referenceValue);else if("geoPointValue"in a)return dz(a.geoPointValue);else if("arrayValue"in a)return dC(a.arrayValue);else if("mapValue"in a)return dB(a.mapValue);else return A(61005,{value:a})}function dx(a){return cS(a).toBase64()}function dy(a){let b=cQ(a);return`time(${b.seconds},${b.nanos})`}function dz(a){return`geo(${a.latitude},${a.longitude})`}function dA(a){return as.fromName(a).toString()}function dB(a){let b=Object.keys(a.fields||{}).sort(),c="{",d=!0;for(let e of b)d?d=!1:c+=",",c+=`${e}:${dw(a.fields[e])}`;return c+"}"}function dC(a){let b="[",c=!0;for(let d of a.values||[])c?c=!1:b+=",",b+=dw(d);return b+"]"}function dD(a){switch(dd(a)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let b=cZ(a);return b?16+dD(b):16;case 5:return 2*a.stringValue.length;case 6:return cS(a.bytesValue).approximateByteSize();case 7:return a.referenceValue.length;case 9:return dF(a.arrayValue);case 10:case 11:return dE(a.mapValue);default:throw A(13486,{value:a})}}function dE(a){let b=0;return cy(a.fields,(a,c)=>{b+=a.length+dD(c)}),b}function dF(a){return(a.values||[]).reduce((a,b)=>a+dD(b),0)}function dG(a,b){return{referenceValue:`projects/${a.projectId}/databases/${a.database}/documents/${b.path.canonicalString()}`}}function dH(a){return!!a&&"integerValue"in a}function dI(a){return!!a&&"doubleValue"in a}function dJ(a){return dH(a)||dI(a)}function dK(a){return!!a&&"arrayValue"in a}function dL(a){return!!a&&"nullValue"in a}function dM(a){return!!a&&"doubleValue"in a&&isNaN(Number(a.doubleValue))}function dN(a){return!!a&&"mapValue"in a}function dO(a){return(a?.mapValue?.fields||{})[c7]?.stringValue===da}function dP(a){if(a.geoPointValue)return{geoPointValue:{...a.geoPointValue}};if(a.timestampValue&&"object"==typeof a.timestampValue)return{timestampValue:{...a.timestampValue}};if(a.mapValue){let b={mapValue:{fields:{}}};return cy(a.mapValue.fields,(a,c)=>b.mapValue.fields[a]=dP(c)),b}{if(!a.arrayValue)return{...a};let b={arrayValue:{values:[]}};for(let c=0;c<(a.arrayValue.values||[]).length;++c)b.arrayValue.values[c]=dP(a.arrayValue.values[c]);return b}}function dQ(a){return(((a.mapValue||{}).fields||{}).__type__||{}).stringValue===c8}let dR={mapValue:{fields:{[c7]:{stringValue:da},[db]:{arrayValue:{}}}}};function dS(a){if("nullValue"in a)return dc;if("booleanValue"in a)return{booleanValue:!1};if("integerValue"in a||"doubleValue"in a)return{doubleValue:NaN};if("timestampValue"in a)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("stringValue"in a)return{stringValue:""};else if("bytesValue"in a)return{bytesValue:""};else if("referenceValue"in a)return dG(c1.empty(),as.empty());else if("geoPointValue"in a)return{geoPointValue:{latitude:-90,longitude:-180}};else if("arrayValue"in a)return{arrayValue:{}};else if(!("mapValue"in a))return A(35942,{value:a});else return dO(a)?dR:{mapValue:{}}}function dT(a){if("nullValue"in a)return{booleanValue:!1};if("booleanValue"in a)return{doubleValue:NaN};if("integerValue"in a||"doubleValue"in a)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("timestampValue"in a)return{stringValue:""};if("stringValue"in a)return{bytesValue:""};else if("bytesValue"in a)return dG(c1.empty(),as.empty());else if("referenceValue"in a)return{geoPointValue:{latitude:-90,longitude:-180}};else if("geoPointValue"in a)return{arrayValue:{}};else if("arrayValue"in a)return dR;else if(!("mapValue"in a))return A(61959,{value:a});else return dO(a)?{mapValue:{}}:c9}function dU(a,b){let c=dl(a.value,b.value);return 0!==c?c:a.inclusive&&!b.inclusive?-1:!a.inclusive&&b.inclusive?1:0}function dV(a,b){let c=dl(a.value,b.value);return 0!==c?c:a.inclusive&&!b.inclusive?1:!a.inclusive&&b.inclusive?-1:0}class dW{constructor(a){this.value=a}static empty(){return new dW({mapValue:{}})}field(a){if(a.isEmpty())return this.value;{let b=this.value;for(let c=0;c<a.length-1;++c)if(!dN(b=(b.mapValue.fields||{})[a.get(c)]))return null;return(b=(b.mapValue.fields||{})[a.lastSegment()])||null}}set(a,b){this.getFieldsMap(a.popLast())[a.lastSegment()]=dP(b)}setAll(a){let b=ar.emptyPath(),c={},d=[];a.forEach((a,e)=>{if(!b.isImmediateParentOf(e)){let a=this.getFieldsMap(b);this.applyChanges(a,c,d),c={},d=[],b=e.popLast()}a?c[e.lastSegment()]=dP(a):d.push(e.lastSegment())});let e=this.getFieldsMap(b);this.applyChanges(e,c,d)}delete(a){let b=this.field(a.popLast());dN(b)&&b.mapValue.fields&&delete b.mapValue.fields[a.lastSegment()]}isEqual(a){return de(this.value,a.value)}getFieldsMap(a){let b=this.value;b.mapValue.fields||(b.mapValue={fields:{}});for(let c=0;c<a.length;++c){let d=b.mapValue.fields[a.get(c)];dN(d)&&d.mapValue.fields||(d={mapValue:{fields:{}}},b.mapValue.fields[a.get(c)]=d),b=d}return b.mapValue.fields}applyChanges(a,b,c){for(let d of(cy(b,(b,c)=>a[b]=c),c))delete a[d]}clone(){return new dW(dP(this.value))}}function dX(a){let b=[];return cy(a.fields,(a,c)=>{let d=new ar([a]);if(dN(c)){let a=dX(c.mapValue).fields;if(0===a.length)b.push(d);else for(let c of a)b.push(d.child(c))}else b.push(d)}),new cJ(b)}class dY{constructor(a,b,c,d,e,f,g){this.key=a,this.documentType=b,this.version=c,this.readTime=d,this.createTime=e,this.data=f,this.documentState=g}static newInvalidDocument(a){return new dY(a,0,aH.min(),aH.min(),aH.min(),dW.empty(),0)}static newFoundDocument(a,b,c,d){return new dY(a,1,b,aH.min(),c,d,0)}static newNoDocument(a,b){return new dY(a,2,b,aH.min(),aH.min(),dW.empty(),0)}static newUnknownDocument(a,b){return new dY(a,3,b,aH.min(),aH.min(),dW.empty(),2)}convertToFoundDocument(a,b){return this.createTime.isEqual(aH.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=a),this.version=a,this.documentType=1,this.data=b,this.documentState=0,this}convertToNoDocument(a){return this.version=a,this.documentType=2,this.data=dW.empty(),this.documentState=0,this}convertToUnknownDocument(a){return this.version=a,this.documentType=3,this.data=dW.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=aH.min(),this}setReadTime(a){return this.readTime=a,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(a){return a instanceof dY&&this.key.isEqual(a.key)&&this.version.isEqual(a.version)&&this.documentType===a.documentType&&this.documentState===a.documentState&&this.data.isEqual(a.data)}mutableCopy(){return new dY(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function dZ(a,b,c){let d=b.data.field(a),e=c.data.field(a);return null!==d&&null!==e?dl(d,e):A(42886)}class d${constructor(a,b){this.position=a,this.inclusive=b}}function d_(a,b,c){let d=0;for(let e=0;e<a.position.length;e++){let f=b[e],g=a.position[e];if(d=f.field.isKeyField()?as.comparator(as.fromName(g.referenceValue),c.key):dl(g,c.data.field(f.field)),"desc"===f.dir&&(d*=-1),0!==d)break}return d}function d0(a,b,c){let d=d_(a,b,c);return a.inclusive?d>=0:d>0}function d1(a,b,c){let d=d_(a,b,c);return a.inclusive?d<=0:d<0}function d2(a,b){if(null===a)return null===b;if(null===b||a.inclusive!==b.inclusive||a.position.length!==b.position.length)return!1;for(let c=0;c<a.position.length;c++)if(!de(a.position[c],b.position[c]))return!1;return!0}class d3{constructor(a,b="asc"){this.field=a,this.dir=b}}function d4(a){return a.field.canonicalString()+a.dir}function d5(a){return`${a.field.canonicalString()} (${a.dir})`}function d6(a,b){return a.dir===b.dir&&a.field.isEqual(b.field)}class d7{}class d8 extends d7{constructor(a,b,c){super(),this.field=a,this.op=b,this.value=c}static create(a,b,c){if(a.isKeyField())if("in"===b||"not-in"===b)return this.createKeyFieldInFilter(a,b,c);else return new em(a,b,c);if("array-contains"===b)return new eq(a,c);if("in"===b)return new er(a,c);if("not-in"===b)return new es(a,c);if("array-contains-any"===b)return new et(a,c);else return new d8(a,b,c)}static createKeyFieldInFilter(a,b,c){return"in"===b?new en(a,c):new eo(a,c)}matches(a){let b=a.data.field(this.field);return"!="===this.op?null!==b&&void 0===b.nullValue&&this.matchesComparison(dl(b,this.value)):null!==b&&dd(this.value)===dd(b)&&this.matchesComparison(dl(b,this.value))}matchesComparison(a){switch(this.op){case"<":return a<0;case"<=":return a<=0;case"==":return 0===a;case"!=":return 0!==a;case">":return a>0;case">=":return a>=0;default:return A(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class d9 extends d7{constructor(a,b){super(),this.filters=a,this.op=b,this.memoizedFlattenedFilters=null}static create(a,b){return new d9(a,b)}matches(a){return ea(this)?void 0===this.filters.find(b=>!b.matches(a)):void 0!==this.filters.find(b=>b.matches(a))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce((a,b)=>a.concat(b.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}}function ea(a){return"and"===a.op}function eb(a){return"or"===a.op}function ec(a){return ed(a)&&ea(a)}function ed(a){for(let b of a.filters)if(b instanceof d9)return!1;return!0}function ee(a){if(a instanceof d8)return a.field.canonicalString()+a.op.toString()+dv(a.value);{if(ec(a))return a.filters.map(a=>ee(a)).join(",");let b=a.filters.map(a=>ee(a)).join(",");return`${a.op}(${b})`}}function ef(a,b){return a instanceof d8?eg(a,b):a instanceof d9?eh(a,b):void A(19439)}function eg(a,b){return b instanceof d8&&a.op===b.op&&a.field.isEqual(b.field)&&de(a.value,b.value)}function eh(a,b){return b instanceof d9&&a.op===b.op&&a.filters.length===b.filters.length&&a.filters.reduce((a,c,d)=>a&&ef(c,b.filters[d]),!0)}function ei(a,b){let c=a.filters.concat(b);return d9.create(c,a.op)}function ej(a){return a instanceof d8?el(a):a instanceof d9?ek(a):"Filter"}function ek(a){return a.op.toString()+" {"+a.getFilters().map(ej).join(" ,")+"}"}function el(a){return`${a.field.canonicalString()} ${a.op} ${dv(a.value)}`}class em extends d8{constructor(a,b,c){super(a,b,c),this.key=as.fromName(c.referenceValue)}matches(a){let b=as.comparator(a.key,this.key);return this.matchesComparison(b)}}class en extends d8{constructor(a,b){super(a,"in",b),this.keys=ep("in",b)}matches(a){return this.keys.some(b=>b.isEqual(a.key))}}class eo extends d8{constructor(a,b){super(a,"not-in",b),this.keys=ep("not-in",b)}matches(a){return!this.keys.some(b=>b.isEqual(a.key))}}function ep(a,b){return(b.arrayValue?.values||[]).map(a=>as.fromName(a.referenceValue))}class eq extends d8{constructor(a,b){super(a,"array-contains",b)}matches(a){let b=a.data.field(this.field);return dK(b)&&dk(b.arrayValue,this.value)}}class er extends d8{constructor(a,b){super(a,"in",b)}matches(a){let b=a.data.field(this.field);return null!==b&&dk(this.value.arrayValue,b)}}class es extends d8{constructor(a,b){super(a,"not-in",b)}matches(a){if(dk(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let b=a.data.field(this.field);return null!==b&&void 0===b.nullValue&&!dk(this.value.arrayValue,b)}}class et extends d8{constructor(a,b){super(a,"array-contains-any",b)}matches(a){let b=a.data.field(this.field);return!!dK(b)&&!!b.arrayValue.values&&b.arrayValue.values.some(a=>dk(this.value.arrayValue,a))}}class eu{constructor(a,b=null,c=[],d=[],e=null,f=null,g=null){this.path=a,this.collectionGroup=b,this.orderBy=c,this.filters=d,this.limit=e,this.startAt=f,this.endAt=g,this.memoizedCanonicalId=null}}function ev(a,b=null,c=[],d=[],e=null,f=null,g=null){return new eu(a,b,c,d,e,f,g)}function ew(a){let b=D(a);if(null===b.memoizedCanonicalId){let a=b.path.canonicalString();null!==b.collectionGroup&&(a+="|cg:"+b.collectionGroup),a+="|f:",a+=b.filters.map(a=>ee(a)).join(","),a+="|ob:",a+=b.orderBy.map(a=>d4(a)).join(","),c4(b.limit)||(a+="|l:",a+=b.limit),b.startAt&&(a+="|lb:",a+=b.startAt.inclusive?"b:":"a:",a+=b.startAt.position.map(a=>dv(a)).join(",")),b.endAt&&(a+="|ub:",a+=b.endAt.inclusive?"a:":"b:",a+=b.endAt.position.map(a=>dv(a)).join(",")),b.memoizedCanonicalId=a}return b.memoizedCanonicalId}function ex(a){let b=a.path.canonicalString();return null!==a.collectionGroup&&(b+=" collectionGroup="+a.collectionGroup),a.filters.length>0&&(b+=`, filters: [${a.filters.map(a=>ej(a)).join(", ")}]`),c4(a.limit)||(b+=", limit: "+a.limit),a.orderBy.length>0&&(b+=`, orderBy: [${a.orderBy.map(a=>d5(a)).join(", ")}]`),a.startAt&&(b+=", startAt: ",b+=a.startAt.inclusive?"b:":"a:",b+=a.startAt.position.map(a=>dv(a)).join(",")),a.endAt&&(b+=", endAt: ",b+=a.endAt.inclusive?"a:":"b:",b+=a.endAt.position.map(a=>dv(a)).join(",")),`Target(${b})`}function ey(a,b){if(a.limit!==b.limit||a.orderBy.length!==b.orderBy.length)return!1;for(let c=0;c<a.orderBy.length;c++)if(!d6(a.orderBy[c],b.orderBy[c]))return!1;if(a.filters.length!==b.filters.length)return!1;for(let c=0;c<a.filters.length;c++)if(!ef(a.filters[c],b.filters[c]))return!1;return a.collectionGroup===b.collectionGroup&&!!a.path.isEqual(b.path)&&!!d2(a.startAt,b.startAt)&&d2(a.endAt,b.endAt)}function ez(a){return as.isDocumentKey(a.path)&&null===a.collectionGroup&&0===a.filters.length}function eA(a,b){return a.filters.filter(a=>a instanceof d8&&a.field.isEqual(b))}function eB(a,b){let c=aL(b);if(void 0===c)return null;for(let b of eA(a,c.fieldPath))switch(b.op){case"array-contains-any":return b.value.arrayValue.values||[];case"array-contains":return[b.value]}return null}function eC(a,b){let c=new Map;for(let d of aM(b))for(let b of eA(a,d.fieldPath))switch(b.op){case"==":case"in":c.set(d.fieldPath.canonicalString(),b.value);break;case"not-in":case"!=":return c.set(d.fieldPath.canonicalString(),b.value),Array.from(c.values())}return null}function eD(a,b){let c=[],d=!0;for(let e of aM(b)){let b=0===e.kind?eF(a,e.fieldPath,a.startAt):eG(a,e.fieldPath,a.startAt);c.push(b.value),d&&(d=b.inclusive)}return new d$(c,d)}function eE(a,b){let c=[],d=!0;for(let e of aM(b)){let b=0===e.kind?eG(a,e.fieldPath,a.endAt):eF(a,e.fieldPath,a.endAt);c.push(b.value),d&&(d=b.inclusive)}return new d$(c,d)}function eF(a,b,c){let d=dc,e=!0;for(let c of eA(a,b)){let a=dc,b=!0;switch(c.op){case"<":case"<=":a=dS(c.value);break;case"==":case"in":case">=":a=c.value;break;case">":a=c.value,b=!1;break;case"!=":case"not-in":a=dc}0>dU({value:d,inclusive:e},{value:a,inclusive:b})&&(d=a,e=b)}if(null!==c){for(let f=0;f<a.orderBy.length;++f)if(a.orderBy[f].field.isEqual(b)){let a=c.position[f];0>dU({value:d,inclusive:e},{value:a,inclusive:c.inclusive})&&(d=a,e=c.inclusive);break}}return{value:d,inclusive:e}}function eG(a,b,c){let d=c9,e=!0;for(let c of eA(a,b)){let a=c9,b=!0;switch(c.op){case">=":case">":a=dT(c.value),b=!1;break;case"==":case"in":case"<=":a=c.value;break;case"<":a=c.value,b=!1;break;case"!=":case"not-in":a=c9}dV({value:d,inclusive:e},{value:a,inclusive:b})>0&&(d=a,e=b)}if(null!==c){for(let f=0;f<a.orderBy.length;++f)if(a.orderBy[f].field.isEqual(b)){let a=c.position[f];dV({value:d,inclusive:e},{value:a,inclusive:c.inclusive})>0&&(d=a,e=c.inclusive);break}}return{value:d,inclusive:e}}function eH(a){let b=new cF(ar.comparator),c=!1;for(let d of a.filters)for(let a of d.getFlattenedFilters())a.field.isKeyField()||("array-contains"===a.op||"array-contains-any"===a.op?c=!0:b=b.add(a.field));for(let c of a.orderBy)c.field.isKeyField()||(b=b.add(c.field));return b.size+ +!!c}function eI(a){return null!==a.limit}class eJ{constructor(a,b=null,c=[],d=[],e=null,f="F",g=null,h=null){this.path=a,this.collectionGroup=b,this.explicitOrderBy=c,this.filters=d,this.limit=e,this.limitType=f,this.startAt=g,this.endAt=h,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}}function eK(a,b,c,d,e,f,g,h){return new eJ(a,b,c,d,e,f,g,h)}function eL(a){return new eJ(a)}function eM(a,b){return new eJ(b,null,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)}function eN(a){return 0===a.filters.length&&null===a.limit&&null==a.startAt&&null==a.endAt&&(0===a.explicitOrderBy.length||1===a.explicitOrderBy.length&&a.explicitOrderBy[0].field.isKeyField())}function eO(a){let b=new cF(ar.comparator);return a.filters.forEach(a=>{a.getFlattenedFilters().forEach(a=>{a.isInequality()&&(b=b.add(a.field))})}),b}function eP(a){return as.isDocumentKey(a.path)&&null===a.collectionGroup&&0===a.filters.length}function eQ(a){return null!==a.collectionGroup}function eR(a){let b=D(a);if(null===b.memoizedNormalizedOrderBy){b.memoizedNormalizedOrderBy=[];let a=new Set;for(let c of b.explicitOrderBy)b.memoizedNormalizedOrderBy.push(c),a.add(c.field.canonicalString());let c=b.explicitOrderBy.length>0?b.explicitOrderBy[b.explicitOrderBy.length-1].dir:"asc";eO(b).forEach(d=>{a.has(d.canonicalString())||d.isKeyField()||b.memoizedNormalizedOrderBy.push(new d3(d,c))}),a.has(ar.keyField().canonicalString())||b.memoizedNormalizedOrderBy.push(new d3(ar.keyField(),c))}return b.memoizedNormalizedOrderBy}function eS(a){let b=D(a);return b.memoizedTarget||(b.memoizedTarget=eU(b,eR(a))),b.memoizedTarget}function eT(a){let b=D(a);return b.memoizedAggregateTarget||(b.memoizedAggregateTarget=eU(b,a.explicitOrderBy)),b.memoizedAggregateTarget}function eU(a,b){if("F"===a.limitType)return ev(a.path,a.collectionGroup,b,a.filters,a.limit,a.startAt,a.endAt);{b=b.map(a=>{let b="desc"===a.dir?"asc":"desc";return new d3(a.field,b)});let c=a.endAt?new d$(a.endAt.position,a.endAt.inclusive):null,d=a.startAt?new d$(a.startAt.position,a.startAt.inclusive):null;return ev(a.path,a.collectionGroup,b,a.filters,a.limit,c,d)}}function eV(a,b){let c=a.filters.concat([b]);return new eJ(a.path,a.collectionGroup,a.explicitOrderBy.slice(),c,a.limit,a.limitType,a.startAt,a.endAt)}function eW(a,b){let c=a.explicitOrderBy.concat([b]);return new eJ(a.path,a.collectionGroup,c,a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)}function eX(a,b,c){return new eJ(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),b,c,a.startAt,a.endAt)}function eY(a,b){return new eJ(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,b,a.endAt)}function eZ(a,b){return new eJ(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,b)}function e$(a,b){return ey(eS(a),eS(b))&&a.limitType===b.limitType}function e_(a){return`${ew(eS(a))}|lt:${a.limitType}`}function e0(a){return`Query(target=${ex(eS(a))}; limitType=${a.limitType})`}function e1(a,b){return b.isFoundDocument()&&e2(a,b)&&e3(a,b)&&e4(a,b)&&e5(a,b)}function e2(a,b){let c=b.key.path;return null!==a.collectionGroup?b.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(c):as.isDocumentKey(a.path)?a.path.isEqual(c):a.path.isImmediateParentOf(c)}function e3(a,b){for(let c of eR(a))if(!c.field.isKeyField()&&null===b.data.field(c.field))return!1;return!0}function e4(a,b){for(let c of a.filters)if(!c.matches(b))return!1;return!0}function e5(a,b){return(!a.startAt||!!d1(a.startAt,eR(a),b))&&(!a.endAt||!!d0(a.endAt,eR(a),b))}function e6(a){return a.collectionGroup||(a.path.length%2==1?a.path.lastSegment():a.path.get(a.path.length-2))}function e7(a){return(b,c)=>{let d=!1;for(let e of eR(a)){let a=e8(e,b,c);if(0!==a)return a;d=d||e.field.isKeyField()}return 0}}function e8(a,b,c){let d=a.field.isKeyField()?as.comparator(b.key,c.key):dZ(a.field,b,c);switch(a.dir){case"asc":return d;case"desc":return -1*d;default:return A(19790,{direction:a.dir})}}class e9{constructor(a,b){this.mapKeyFn=a,this.equalsFn=b,this.inner={},this.innerSize=0}get(a){let b=this.mapKeyFn(a),c=this.inner[b];if(void 0!==c){for(let[b,d]of c)if(this.equalsFn(b,a))return d}}has(a){return void 0!==this.get(a)}set(a,b){let c=this.mapKeyFn(a),d=this.inner[c];if(void 0===d){this.inner[c]=[[a,b]],this.innerSize++;return}for(let c=0;c<d.length;c++)if(this.equalsFn(d[c][0],a)){d[c]=[a,b];return}d.push([a,b]),this.innerSize++}delete(a){let b=this.mapKeyFn(a),c=this.inner[b];if(void 0===c)return!1;for(let d=0;d<c.length;d++)if(this.equalsFn(c[d][0],a))return 1===c.length?delete this.inner[b]:c.splice(d,1),this.innerSize--,!0;return!1}forEach(a){cy(this.inner,(b,c)=>{for(let[b,d]of c)a(b,d)})}isEmpty(){return cA(this.inner)}size(){return this.innerSize}}let fa=new cB(as.comparator);function fb(){return fa}let fc=new cB(as.comparator);function fd(...a){let b=fc;for(let c of a)b=b.insert(c.key,c);return b}function fe(){return fi()}function ff(a){let b=fc;return a.forEach((a,c)=>b=b.insert(a,c.overlayedDocument)),b}function fg(){return fi()}function fh(){return fi()}function fi(){return new e9(a=>a.toString(),(a,b)=>a.isEqual(b))}let fj=new cB(as.comparator);function fk(){return fj}let fl=new cF(as.comparator);function fm(...a){let b=fl;for(let c of a)b=b.add(c);return b}let fn=new cF(ag);function fo(){return fn}function fp(a,b){if(a.useProto3Json){if(isNaN(b))return{doubleValue:"NaN"};else if(b===1/0)return{doubleValue:"Infinity"};else if(b===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:c5(b)?"-0":b}}function fq(a){return{integerValue:""+a}}function fr(a,b){return c6(b)?fq(b):fp(a,b)}class fs{constructor(){this._=void 0}}function ft(a,b,c){return a instanceof fx?cY(c,b):a instanceof fy?fz(a,b):a instanceof fA?fB(a,b):fD(a,b)}function fu(a,b,c){return a instanceof fy?fz(a,b):a instanceof fA?fB(a,b):c}function fv(a,b){return a instanceof fC?dJ(b)?b:{integerValue:0}:null}function fw(a,b){return a instanceof fy&&b instanceof fy||a instanceof fA&&b instanceof fA?al(a.elements,b.elements,de):a instanceof fC&&b instanceof fC?de(a.operand,b.operand):a instanceof fx&&b instanceof fx}class fx extends fs{}class fy extends fs{constructor(a){super(),this.elements=a}}function fz(a,b){let c=fF(b);for(let b of a.elements)c.some(a=>de(a,b))||c.push(b);return{arrayValue:{values:c}}}class fA extends fs{constructor(a){super(),this.elements=a}}function fB(a,b){let c=fF(b);for(let b of a.elements)c=c.filter(a=>!de(a,b));return{arrayValue:{values:c}}}class fC extends fs{constructor(a,b){super(),this.serializer=a,this.operand=b}}function fD(a,b){let c=fv(a,b),d=fE(c)+fE(a.operand);return dH(c)&&dH(a.operand)?fq(d):fp(a.serializer,d)}function fE(a){return cR(a.integerValue||a.doubleValue)}function fF(a){return dK(a)&&a.arrayValue.values?a.arrayValue.values.slice():[]}class fG{constructor(a,b){this.field=a,this.transform=b}}function fH(a,b){return a.field.isEqual(b.field)&&fw(a.transform,b.transform)}function fI(a,b){return void 0===a&&void 0===b||!!a&&!!b&&al(a,b,(a,b)=>fH(a,b))}class fJ{constructor(a,b){this.version=a,this.transformResults=b}}class fK{constructor(a,b){this.updateTime=a,this.exists=b}static none(){return new fK}static exists(a){return new fK(void 0,a)}static updateTime(a){return new fK(a)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(a){return this.exists===a.exists&&(this.updateTime?!!a.updateTime&&this.updateTime.isEqual(a.updateTime):!a.updateTime)}}function fL(a,b){return void 0!==a.updateTime?b.isFoundDocument()&&b.version.isEqual(a.updateTime):void 0===a.exists||a.exists===b.isFoundDocument()}class fM{}function fN(a,b){if(!a.hasLocalMutations||b&&0===b.fields.length)return null;if(null===b)if(a.isNoDocument())return new f_(a.key,fK.none());else return new fS(a.key,a.data,fK.none());{let c=a.data,d=dW.empty(),e=new cF(ar.comparator);for(let a of b.fields)if(!e.has(a)){let b=c.field(a);null===b&&a.length>1&&(a=a.popLast(),b=c.field(a)),null===b?d.delete(a):d.set(a,b),e=e.add(a)}return new fV(a.key,d,new cJ(e.toArray()),fK.none())}}function fO(a,b,c){a instanceof fS?fT(a,b,c):a instanceof fV?fW(a,b,c):f0(a,b,c)}function fP(a,b,c,d){return a instanceof fS?fU(a,b,c,d):a instanceof fV?fX(a,b,c,d):f1(a,b,c)}function fQ(a,b){let c=null;for(let d of a.fieldTransforms){let a=b.data.field(d.field),e=fv(d.transform,a||null);null!=e&&(null===c&&(c=dW.empty()),c.set(d.field,e))}return c||null}function fR(a,b){return a.type===b.type&&!!a.key.isEqual(b.key)&&!!a.precondition.isEqual(b.precondition)&&!!fI(a.fieldTransforms,b.fieldTransforms)&&(0===a.type?a.value.isEqual(b.value):1!==a.type||a.data.isEqual(b.data)&&a.fieldMask.isEqual(b.fieldMask))}class fS extends fM{constructor(a,b,c,d=[]){super(),this.key=a,this.value=b,this.precondition=c,this.fieldTransforms=d,this.type=0}getFieldMask(){return null}}function fT(a,b,c){let d=a.value.clone(),e=fZ(a.fieldTransforms,b,c.transformResults);d.setAll(e),b.convertToFoundDocument(c.version,d).setHasCommittedMutations()}function fU(a,b,c,d){if(!fL(a.precondition,b))return c;let e=a.value.clone(),f=f$(a.fieldTransforms,d,b);return e.setAll(f),b.convertToFoundDocument(b.version,e).setHasLocalMutations(),null}class fV extends fM{constructor(a,b,c,d,e=[]){super(),this.key=a,this.data=b,this.fieldMask=c,this.precondition=d,this.fieldTransforms=e,this.type=1}getFieldMask(){return this.fieldMask}}function fW(a,b,c){if(!fL(a.precondition,b))return void b.convertToUnknownDocument(c.version);let d=fZ(a.fieldTransforms,b,c.transformResults),e=b.data;e.setAll(fY(a)),e.setAll(d),b.convertToFoundDocument(c.version,e).setHasCommittedMutations()}function fX(a,b,c,d){if(!fL(a.precondition,b))return c;let e=f$(a.fieldTransforms,d,b),f=b.data;return(f.setAll(fY(a)),f.setAll(e),b.convertToFoundDocument(b.version,f).setHasLocalMutations(),null===c)?null:c.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(a=>a.field))}function fY(a){let b=new Map;return a.fieldMask.fields.forEach(c=>{if(!c.isEmpty()){let d=a.data.field(c);b.set(c,d)}}),b}function fZ(a,b,c){let d=new Map;C(a.length===c.length,32656,{serverTransformResultCount:c.length,fieldTransformCount:a.length});for(let e=0;e<c.length;e++){let f=a[e],g=f.transform,h=b.data.field(f.field);d.set(f.field,fu(g,h,c[e]))}return d}function f$(a,b,c){let d=new Map;for(let e of a){let a=e.transform,f=c.data.field(e.field);d.set(e.field,ft(a,f,b))}return d}class f_ extends fM{constructor(a,b){super(),this.key=a,this.precondition=b,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}function f0(a,b,c){b.convertToNoDocument(c.version).setHasCommittedMutations()}function f1(a,b,c){return fL(a.precondition,b)?(b.convertToNoDocument(b.version).setHasLocalMutations(),null):c}class f2 extends fM{constructor(a,b){super(),this.key=a,this.precondition=b,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class f3{constructor(a,b,c,d){this.batchId=a,this.localWriteTime=b,this.baseMutations=c,this.mutations=d}applyToRemoteDocument(a,b){let c=b.mutationResults;for(let b=0;b<this.mutations.length;b++){let d=this.mutations[b];d.key.isEqual(a.key)&&fO(d,a,c[b])}}applyToLocalView(a,b){for(let c of this.baseMutations)c.key.isEqual(a.key)&&(b=fP(c,a,b,this.localWriteTime));for(let c of this.mutations)c.key.isEqual(a.key)&&(b=fP(c,a,b,this.localWriteTime));return b}applyToLocalDocumentSet(a,b){let c=fh();return this.mutations.forEach(d=>{let e=a.get(d.key),f=e.overlayedDocument,g=this.applyToLocalView(f,e.mutatedFields),h=fN(f,g=b.has(d.key)?null:g);null!==h&&c.set(d.key,h),f.isValidDocument()||f.convertToNoDocument(aH.min())}),c}keys(){return this.mutations.reduce((a,b)=>a.add(b.key),fm())}isEqual(a){return this.batchId===a.batchId&&al(this.mutations,a.mutations,(a,b)=>fR(a,b))&&al(this.baseMutations,a.baseMutations,(a,b)=>fR(a,b))}}class f4{constructor(a,b,c,d){this.batch=a,this.commitVersion=b,this.mutationResults=c,this.docVersions=d}static from(a,b,c){C(a.mutations.length===c.length,58842,{mutationsSent:a.mutations.length,resultsReceived:c.length});let d=fk(),e=a.mutations;for(let a=0;a<e.length;a++)d=d.insert(e[a].key,c[a].version);return new f4(a,b,c,d)}}class f5{constructor(a,b){this.largestBatchId=a,this.mutation=b}getKey(){return this.mutation.key}isEqual(a){return null!==a&&this.mutation===a.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class f6{constructor(a,b){this.count=a,this.unchangedNames=b}}function f7(a){switch(a){case E:return A(64938);case F:case G:case I:case N:case S:case T:case M:return!1;case H:case J:case K:case L:case O:case P:case Q:case R:case U:return!0;default:return A(15467,{code:a})}}function f8(a){return f7(a)&&a!==P}function f9(a){if(void 0===a)return x("GRPC error has no .code"),G;switch(a){case d.OK:return E;case d.CANCELLED:return F;case d.UNKNOWN:return G;case d.DEADLINE_EXCEEDED:return I;case d.RESOURCE_EXHAUSTED:return N;case d.INTERNAL:return S;case d.UNAVAILABLE:return T;case d.UNAUTHENTICATED:return M;case d.INVALID_ARGUMENT:return H;case d.NOT_FOUND:return J;case d.ALREADY_EXISTS:return K;case d.PERMISSION_DENIED:return L;case d.FAILED_PRECONDITION:return O;case d.ABORTED:return P;case d.OUT_OF_RANGE:return Q;case d.UNIMPLEMENTED:return R;case d.DATA_LOSS:return U;default:return A(39323,{code:a})}}!function(a){a[a.OK=0]="OK",a[a.CANCELLED=1]="CANCELLED",a[a.UNKNOWN=2]="UNKNOWN",a[a.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",a[a.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",a[a.NOT_FOUND=5]="NOT_FOUND",a[a.ALREADY_EXISTS=6]="ALREADY_EXISTS",a[a.PERMISSION_DENIED=7]="PERMISSION_DENIED",a[a.UNAUTHENTICATED=16]="UNAUTHENTICATED",a[a.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",a[a.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",a[a.ABORTED=10]="ABORTED",a[a.OUT_OF_RANGE=11]="OUT_OF_RANGE",a[a.UNIMPLEMENTED=12]="UNIMPLEMENTED",a[a.INTERNAL=13]="INTERNAL",a[a.UNAVAILABLE=14]="UNAVAILABLE",a[a.DATA_LOSS=15]="DATA_LOSS"}(d||(d={}));class ga extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}let gb=null;function gc(a){if(gb)throw Error("a TestingHooksSpi instance is already set");gb=a}function gd(){return new m.TextEncoder}function ge(){return new m.TextDecoder("utf-8")}let gf=new b([0xffffffff,0xffffffff],0);function gg(a){let b=gd().encode(a),d=new c;return d.update(b),new Uint8Array(d.digest())}function gh(a){let c=new DataView(a.buffer),d=c.getUint32(0,!0),e=c.getUint32(4,!0),f=c.getUint32(8,!0),g=c.getUint32(12,!0);return[new b([d,e],0),new b([f,g],0)]}class gi{constructor(a,c,d){if(this.bitmap=a,this.padding=c,this.hashCount=d,c<0||c>=8)throw new gj(`Invalid padding: ${c}`);if(d<0||a.length>0&&0===this.hashCount)throw new gj(`Invalid hash count: ${d}`);if(0===a.length&&0!==c)throw new gj(`Invalid padding when bitmap length is 0: ${c}`);this.bitCount=8*a.length-c,this.bitCountInInteger=b.fromNumber(this.bitCount)}getBitIndex(a,c,d){let e=a.add(c.multiply(b.fromNumber(d)));return 1===e.compare(gf)&&(e=new b([e.getBits(0),e.getBits(1)],0)),e.modulo(this.bitCountInInteger).toNumber()}isBitSet(a){return(this.bitmap[Math.floor(a/8)]&1<<a%8)!=0}mightContain(a){if(0===this.bitCount)return!1;let[b,c]=gh(gg(a));for(let a=0;a<this.hashCount;a++){let d=this.getBitIndex(b,c,a);if(!this.isBitSet(d))return!1}return!0}static create(a,b,c){let d=a%8==0?0:8-a%8,e=new gi(new Uint8Array(Math.ceil(a/8)),d,b);return c.forEach(a=>e.insert(a)),e}insert(a){if(0===this.bitCount)return;let[b,c]=gh(gg(a));for(let a=0;a<this.hashCount;a++){let d=this.getBitIndex(b,c,a);this.setBit(d)}}setBit(a){let b=Math.floor(a/8),c=a%8;this.bitmap[b]|=1<<c}}class gj extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class gk{constructor(a,b,c,d,e){this.snapshotVersion=a,this.targetChanges=b,this.targetMismatches=c,this.documentUpdates=d,this.resolvedLimboDocuments=e}static createSynthesizedRemoteEventForCurrentChange(a,b,c){let d=new Map;return d.set(a,gl.createSynthesizedTargetChangeForCurrentChange(a,b,c)),new gk(aH.min(),d,new cB(ag),fb(),fm())}}class gl{constructor(a,b,c,d,e){this.resumeToken=a,this.current=b,this.addedDocuments=c,this.modifiedDocuments=d,this.removedDocuments=e}static createSynthesizedTargetChangeForCurrentChange(a,b,c){return new gl(c,b,fm(),fm(),fm())}}class gm{constructor(a,b,c,d){this.updatedTargetIds=a,this.removedTargetIds=b,this.key=c,this.newDoc=d}}class gn{constructor(a,b){this.targetId=a,this.existenceFilter=b}}class go{constructor(a,b,c=cM.EMPTY_BYTE_STRING,d=null){this.state=a,this.targetIds=b,this.resumeToken=c,this.cause=d}}class gp{constructor(){this.pendingResponses=0,this.documentChanges=gt(),this._resumeToken=cM.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return 0!==this.pendingResponses}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(a){a.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=a)}toTargetChange(){let a=fm(),b=fm(),c=fm();return this.documentChanges.forEach((d,e)=>{switch(e){case 0:a=a.add(d);break;case 2:b=b.add(d);break;case 1:c=c.add(d);break;default:A(38017,{changeType:e})}}),new gl(this._resumeToken,this._current,a,b,c)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=gt()}addDocumentChange(a,b){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(a,b)}removeDocumentChange(a){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(a)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,C(this.pendingResponses>=0,3241,{pendingResponses:this.pendingResponses})}markCurrent(){this._hasPendingChanges=!0,this._current=!0}}let gq="WatchChangeAggregator";class gr{constructor(a){this.metadataProvider=a,this.targetStates=new Map,this.pendingDocumentUpdates=fb(),this.pendingDocumentUpdatesByTarget=gs(),this.pendingDocumentTargetMapping=gs(),this.pendingTargetResets=new cB(ag)}handleDocumentChange(a){for(let b of a.updatedTargetIds)a.newDoc&&a.newDoc.isFoundDocument()?this.addDocumentToTarget(b,a.newDoc):this.removeDocumentFromTarget(b,a.key,a.newDoc);for(let b of a.removedTargetIds)this.removeDocumentFromTarget(b,a.key,a.newDoc)}handleTargetChange(a){this.forEachTarget(a,b=>{let c=this.ensureTargetState(b);switch(a.state){case 0:this.isActiveTarget(b)&&c.updateResumeToken(a.resumeToken);break;case 1:c.recordTargetResponse(),c.isPending||c.clearPendingChanges(),c.updateResumeToken(a.resumeToken);break;case 2:c.recordTargetResponse(),c.isPending||this.removeTarget(b);break;case 3:this.isActiveTarget(b)&&(c.markCurrent(),c.updateResumeToken(a.resumeToken));break;case 4:this.isActiveTarget(b)&&(this.resetTarget(b),c.updateResumeToken(a.resumeToken));break;default:A(56790,{state:a.state})}})}forEachTarget(a,b){a.targetIds.length>0?a.targetIds.forEach(b):this.targetStates.forEach((a,c)=>{this.isActiveTarget(c)&&b(c)})}handleExistenceFilter(a){let b=a.targetId,c=a.existenceFilter.count,d=this.targetDataForActiveTarget(b);if(d){let e=d.target;if(ez(e))if(0===c){let a=new as(e.path);this.removeDocumentFromTarget(b,a,dY.newNoDocument(a,aH.min()))}else C(1===c,20013,{expectedCount:c});else{let d=this.getCurrentDocumentCountForTarget(b);if(d!==c){let c=this.parseBloomFilter(a),e=c?this.applyBloomFilter(c,a,d):1;if(0!==e){this.resetTarget(b);let a=2===e?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(b,a)}gb?.notifyOnExistenceFilterMismatch(gu(d,a.existenceFilter,this.metadataProvider.getDatabaseId(),c,e))}}}}parseBloomFilter(a){let b,c,d=a.existenceFilter.unchangedNames;if(!d||!d.bits)return null;let{bits:{bitmap:e="",padding:f=0},hashCount:g=0}=d;try{b=cS(e).toUint8Array()}catch(a){if(a instanceof ga)return y("Decoding the base64 bloom filter in existence filter failed ("+a.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw a}try{c=new gi(b,f,g)}catch(a){return a instanceof gj?y("BloomFilter error: ",a):y("Applying bloom filter failed: ",a),null}return 0===c.bitCount?null:c}applyBloomFilter(a,b,c){return 2*(b.existenceFilter.count!==c-this.filterRemovedDocuments(a,b.targetId))}filterRemovedDocuments(a,b){let c=this.metadataProvider.getRemoteKeysForTarget(b),d=0;return c.forEach(c=>{let e=this.metadataProvider.getDatabaseId(),f=`projects/${e.projectId}/databases/${e.database}/documents/${c.path.canonicalString()}`;!a.mightContain(f)&&(this.removeDocumentFromTarget(b,c,null),d++)}),d}createRemoteEvent(a){let b=new Map;this.targetStates.forEach((c,d)=>{let e=this.targetDataForActiveTarget(d);if(e){if(c.current&&ez(e.target)){let b=new as(e.target.path);this.ensureDocumentUpdateByTarget(b).has(d)||this.targetContainsDocument(d,b)||this.removeDocumentFromTarget(d,b,dY.newNoDocument(b,a))}c.hasPendingChanges&&(b.set(d,c.toTargetChange()),c.clearPendingChanges())}});let c=fm();this.pendingDocumentTargetMapping.forEach((a,b)=>{let d=!0;b.forEachWhile(a=>{let b=this.targetDataForActiveTarget(a);return!b||"TargetPurposeLimboResolution"===b.purpose||(d=!1,!1)}),d&&(c=c.add(a))}),this.pendingDocumentUpdates.forEach((b,c)=>c.setReadTime(a));let d=new gk(a,b,this.pendingTargetResets,this.pendingDocumentUpdates,c);return this.pendingDocumentUpdates=fb(),this.pendingDocumentUpdatesByTarget=gs(),this.pendingDocumentTargetMapping=gs(),this.pendingTargetResets=new cB(ag),d}addDocumentToTarget(a,b){if(!this.isActiveTarget(a))return;let c=2*!!this.targetContainsDocument(a,b.key);this.ensureTargetState(a).addDocumentChange(b.key,c),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(b.key,b),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(b.key,this.ensureDocumentUpdateByTarget(b.key).add(a)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(b.key,this.ensureDocumentTargetMapping(b.key).add(a))}removeDocumentFromTarget(a,b,c){if(!this.isActiveTarget(a))return;let d=this.ensureTargetState(a);this.targetContainsDocument(a,b)?d.addDocumentChange(b,1):d.removeDocumentChange(b),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(b,this.ensureDocumentTargetMapping(b).delete(a)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(b,this.ensureDocumentTargetMapping(b).add(a)),c&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(b,c))}removeTarget(a){this.targetStates.delete(a)}getCurrentDocumentCountForTarget(a){let b=this.ensureTargetState(a).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(a).size+b.addedDocuments.size-b.removedDocuments.size}recordPendingTargetRequest(a){this.ensureTargetState(a).recordPendingTargetRequest()}ensureTargetState(a){let b=this.targetStates.get(a);return b||(b=new gp,this.targetStates.set(a,b)),b}ensureDocumentTargetMapping(a){let b=this.pendingDocumentTargetMapping.get(a);return b||(b=new cF(ag),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(a,b)),b}ensureDocumentUpdateByTarget(a){let b=this.pendingDocumentUpdatesByTarget.get(a);return b||(b=new cF(ag),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(a,b)),b}isActiveTarget(a){let b=null!==this.targetDataForActiveTarget(a);return b||w(gq,"Detected inactive target",a),b}targetDataForActiveTarget(a){let b=this.targetStates.get(a);return b&&b.isPending?null:this.metadataProvider.getTargetDataForTarget(a)}resetTarget(a){this.targetStates.set(a,new gp),this.metadataProvider.getRemoteKeysForTarget(a).forEach(b=>{this.removeDocumentFromTarget(a,b,null)})}targetContainsDocument(a,b){return this.metadataProvider.getRemoteKeysForTarget(a).has(b)}}function gs(){return new cB(as.comparator)}function gt(){return new cB(as.comparator)}function gu(a,b,c,d,e){let f={localCacheCount:a,existenceFilterCount:b.count,databaseId:c.database,projectId:c.projectId},g=b.unchangedNames;return g&&(f.bloomFilter={applied:0===e,hashCount:g?.hashCount??0,bitmapLength:g?.bits?.bitmap?.length??0,padding:g?.bits?.padding??0,mightContain:a=>d?.mightContain(a)??!1}),f}let gv=(()=>{let a={};return a.asc="ASCENDING",a.desc="DESCENDING",a})(),gw=(()=>{let a={};return a["<"]="LESS_THAN",a["<="]="LESS_THAN_OR_EQUAL",a[">"]="GREATER_THAN",a[">="]="GREATER_THAN_OR_EQUAL",a["=="]="EQUAL",a["!="]="NOT_EQUAL",a["array-contains"]="ARRAY_CONTAINS",a.in="IN",a["not-in"]="NOT_IN",a["array-contains-any"]="ARRAY_CONTAINS_ANY",a})(),gx=(()=>{let a={};return a.and="AND",a.or="OR",a})();function gy(a,b){}class gz{constructor(a,b){this.databaseId=a,this.useProto3Json=b}}function gA(a){return new V(void 0===a.code?G:f9(a.code),a.message||"")}function gB(a,b){return a.useProto3Json||c4(b)?b:{value:b}}function gC(a){let b;return c4(b="object"==typeof a?a.value:a)?null:b}function gD(a,b){if(!a.useProto3Json)return{seconds:""+b.seconds,nanos:b.nanoseconds};{let a=new Date(1e3*b.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),c=("000000000"+b.nanoseconds).slice(-9);return`${a}.${c}Z`}}function gE(a){let b=cQ(a);return new aG(b.seconds,b.nanos)}function gF(a,b){return a.useProto3Json?b.toBase64():b.toUint8Array()}function gG(a,b){return a.useProto3Json?(C(void 0===b||"string"==typeof b,58123),cM.fromBase64String(b||"")):(C(void 0===b||b instanceof Buffer||b instanceof Uint8Array,16193),cM.fromUint8Array(b||new Uint8Array))}function gH(a,b){return gD(a,b.toTimestamp())}function gI(a){return C(!!a,49232),aH.fromTimestamp(gE(a))}function gJ(a,b){return gK(a,b).canonicalString()}function gK(a,b){let c=gR(a).child("documents");return void 0===b?c:c.child(b)}function gL(a){let b=ap.fromString(a);return C(hI(b),10190,{key:b.toString()}),b}function gM(a,b){return gJ(a.databaseId,b.path)}function gN(a,b){let c=gL(b);if(c.get(1)!==a.databaseId.projectId)throw new V(H,"Tried to deserialize key from different project: "+c.get(1)+" vs "+a.databaseId.projectId);if(c.get(3)!==a.databaseId.database)throw new V(H,"Tried to deserialize key from different database: "+c.get(3)+" vs "+a.databaseId.database);return new as(gS(c))}function gO(a,b){return gJ(a.databaseId,b)}function gP(a){let b=gL(a);return 4===b.length?ap.emptyPath():gS(b)}function gQ(a){return new ap(["projects",a.databaseId.projectId,"databases",a.databaseId.database]).canonicalString()}function gR(a){return new ap(["projects",a.projectId,"databases",a.database])}function gS(a){return C(a.length>4&&"documents"===a.get(4),29091,{key:a.toString()}),a.popFirst(5)}function gT(a,b,c){return{name:gM(a,b),fields:c.value.mapValue.fields}}function gU(a,b){return{name:gM(a,b.key),fields:b.data.value.mapValue.fields,updateTime:gD(a,b.version.toTimestamp()),createTime:gD(a,b.createTime.toTimestamp())}}function gV(a,b,c){let d=gN(a,b.name),e=gI(b.updateTime),f=b.createTime?gI(b.createTime):aH.min(),g=new dW({mapValue:{fields:b.fields}}),h=dY.newFoundDocument(d,e,f,g);return c&&h.setHasCommittedMutations(),c?h.setHasCommittedMutations():h}function gW(a,b){C(!!b.found,43571),gy(b.found.name),gy(b.found.updateTime);let c=gN(a,b.found.name),d=gI(b.found.updateTime),e=b.found.createTime?gI(b.found.createTime):aH.min(),f=new dW({mapValue:{fields:b.found.fields}});return dY.newFoundDocument(c,d,e,f)}function gX(a,b){C(!!b.missing,3894),C(!!b.readTime,22933);let c=gN(a,b.missing),d=gI(b.readTime);return dY.newNoDocument(c,d)}function gY(a,b){return"found"in b?gW(a,b):"missing"in b?gX(a,b):A(7234,{result:b})}function gZ(a,b){let c;if("targetChange"in b){gy(b.targetChange);let d=g$(b.targetChange.targetChangeType||"NO_CHANGE"),e=b.targetChange.targetIds||[],f=gG(a,b.targetChange.resumeToken),g=b.targetChange.cause;c=new go(d,e,f,g&&gA(g)||null)}else if("documentChange"in b){gy(b.documentChange);let d=b.documentChange;gy(d.document),gy(d.document.name),gy(d.document.updateTime);let e=gN(a,d.document.name),f=gI(d.document.updateTime),g=d.document.createTime?gI(d.document.createTime):aH.min(),h=new dW({mapValue:{fields:d.document.fields}}),i=dY.newFoundDocument(e,f,g,h);c=new gm(d.targetIds||[],d.removedTargetIds||[],i.key,i)}else if("documentDelete"in b){gy(b.documentDelete);let d=b.documentDelete;gy(d.document);let e=gN(a,d.document),f=d.readTime?gI(d.readTime):aH.min(),g=dY.newNoDocument(e,f);c=new gm([],d.removedTargetIds||[],g.key,g)}else if("documentRemove"in b){gy(b.documentRemove);let d=b.documentRemove;gy(d.document);let e=gN(a,d.document);c=new gm([],d.removedTargetIds||[],e,null)}else{if(!("filter"in b))return A(11601,{change:b});gy(b.filter);let a=b.filter;gy(a.targetId);let{count:d=0,unchangedNames:e}=a,f=new f6(d,e);c=new gn(a.targetId,f)}return c}function g$(a){if("NO_CHANGE"===a)return 0;if("ADD"===a)return 1;if("REMOVE"===a)return 2;if("CURRENT"===a)return 3;if("RESET"===a)return 4;else return A(39313,{state:a})}function g_(a){if(!("targetChange"in a))return aH.min();let b=a.targetChange;return b.targetIds&&b.targetIds.length||!b.readTime?aH.min():gI(b.readTime)}function g0(a,b){let c;if(b instanceof fS)c={update:gT(a,b.key,b.value)};else if(b instanceof f_)c={delete:gM(a,b.key)};else if(b instanceof fV)c={update:gT(a,b.key,b.data),updateMask:hG(b.fieldMask)};else{if(!(b instanceof f2))return A(16599,{mutationType:b.type});c={verify:gM(a,b.key)}}return b.fieldTransforms.length>0&&(c.updateTransforms=b.fieldTransforms.map(b=>g6(a,b))),b.precondition.isNone||(c.currentDocument=g2(a,b.precondition)),c}function g1(a,b){let c=b.currentDocument?g3(b.currentDocument):fK.none(),d=b.updateTransforms?b.updateTransforms.map(b=>g7(a,b)):[];if(b.update){gy(b.update.name);let e=gN(a,b.update.name),f=new dW({mapValue:{fields:b.update.fields}});return b.updateMask?new fV(e,f,hH(b.updateMask),c,d):new fS(e,f,c,d)}return b.delete?new f_(gN(a,b.delete),c):b.verify?new f2(gN(a,b.verify),c):A(1463,{proto:b})}function g2(a,b){return void 0!==b.updateTime?{updateTime:gH(a,b.updateTime)}:void 0!==b.exists?{exists:b.exists}:A(27497)}function g3(a){return void 0!==a.updateTime?fK.updateTime(gI(a.updateTime)):void 0!==a.exists?fK.exists(a.exists):fK.none()}function g4(a,b){let c=a.updateTime?gI(a.updateTime):gI(b);return c.isEqual(aH.min())&&(c=gI(b)),new fJ(c,a.transformResults||[])}function g5(a,b){return a&&a.length>0?(C(void 0!==b,14353),a.map(a=>g4(a,b))):[]}function g6(a,b){let c=b.transform;if(c instanceof fx)return{fieldPath:b.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof fy)return{fieldPath:b.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof fA)return{fieldPath:b.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof fC)return{fieldPath:b.field.canonicalString(),increment:c.operand};throw A(20930,{transform:b.transform})}function g7(a,b){let c=null;return"setToServerValue"in b?(C("REQUEST_TIME"===b.setToServerValue,16630,{proto:b}),c=new fx):"appendMissingElements"in b?c=new fy(b.appendMissingElements.values||[]):"removeAllFromArray"in b?c=new fA(b.removeAllFromArray.values||[]):"increment"in b?c=new fC(a,b.increment):A(16584,{proto:b}),new fG(ar.fromServerFormat(b.fieldPath),c)}function g8(a,b){return{documents:[gO(a,b.path)]}}function g9(a){let b=a.documents.length;return C(1===b,1966,{count:b}),eS(eL(gP(a.documents[0])))}function ha(a,b){let c,d={structuredQuery:{}},e=b.path;null!==b.collectionGroup?(c=e,d.structuredQuery.from=[{collectionId:b.collectionGroup,allDescendants:!0}]):(c=e.popLast(),d.structuredQuery.from=[{collectionId:e.lastSegment()}]),d.parent=gO(a,c);let f=hh(b.filters);f&&(d.structuredQuery.where=f);let g=hk(b.orderBy);g&&(d.structuredQuery.orderBy=g);let h=gB(a,b.limit);return null!==h&&(d.structuredQuery.limit=h),b.startAt&&(d.structuredQuery.startAt=hm(b.startAt)),b.endAt&&(d.structuredQuery.endAt=hn(b.endAt)),{queryTarget:d,parent:c}}function hb(a,b,c,d){let{queryTarget:e,parent:f}=ha(a,b),g={},h=[],i=0;return c.forEach(a=>{let b=d?a.alias:`aggregate_${i++}`;g[b]=a.alias,"count"===a.aggregateType?h.push({alias:b,count:{}}):"avg"===a.aggregateType?h.push({alias:b,avg:{field:hw(a.fieldPath)}}):"sum"===a.aggregateType&&h.push({alias:b,sum:{field:hw(a.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:h,structuredQuery:e.structuredQuery},parent:e.parent},aliasMap:g,parent:f}}function hc(a){let b=gP(a.parent),c=a.structuredQuery,d=c.from?c.from.length:0,e=null;if(d>0){C(1===d,65062);let a=c.from[0];a.allDescendants?e=a.collectionId:b=b.child(a.collectionId)}let f=[];c.where&&(f=hi(c.where));let g=[];c.orderBy&&(g=hl(c.orderBy));let h=null;c.limit&&(h=gC(c.limit));let i=null;c.startAt&&(i=ho(c.startAt));let j=null;return c.endAt&&(j=hp(c.endAt)),eK(b,e,g,f,h,"F",i,j)}function hd(a){return eS(hc(a))}function he(a,b){let c=hf(b.purpose);return null==c?null:{"goog-listen-tags":c}}function hf(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return A(28987,{purpose:a})}}function hg(a,b){let c,d=b.target;if((c=ez(d)?{documents:g8(a,d)}:{query:ha(a,d).queryTarget}).targetId=b.targetId,b.resumeToken.approximateByteSize()>0){c.resumeToken=gF(a,b.resumeToken);let d=gB(a,b.expectedCount);null!==d&&(c.expectedCount=d)}else if(b.snapshotVersion.compareTo(aH.min())>0){c.readTime=gD(a,b.snapshotVersion.toTimestamp());let d=gB(a,b.expectedCount);null!==d&&(c.expectedCount=d)}return c}function hh(a){if(0!==a.length)return hA(d9.create(a,"and"))}function hi(a){let b=hj(a);return b instanceof d9&&ec(b)?b.getFilters():[b]}function hj(a){return void 0!==a.unaryFilter?hD(a):void 0!==a.fieldFilter?hE(a):void 0!==a.compositeFilter?hF(a):A(30097,{filter:a})}function hk(a){if(0!==a.length)return a.map(a=>hy(a))}function hl(a){return a.map(a=>hz(a))}function hm(a){return{before:a.inclusive,values:a.position}}function hn(a){return{before:!a.inclusive,values:a.position}}function ho(a){let b=!!a.before;return new d$(a.values||[],b)}function hp(a){let b=!a.before;return new d$(a.values||[],b)}function hq(a){return gv[a]}function hr(a){switch(a){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function hs(a){return gw[a]}function ht(a){return gx[a]}function hu(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return A(58110);default:return A(50506)}}function hv(a){switch(a){case"AND":return"and";case"OR":return"or";default:return A(1026)}}function hw(a){return{fieldPath:a.canonicalString()}}function hx(a){return ar.fromServerFormat(a.fieldPath)}function hy(a){return{field:hw(a.field),direction:hq(a.dir)}}function hz(a){return new d3(hx(a.field),hr(a.direction))}function hA(a){return a instanceof d8?hC(a):a instanceof d9?hB(a):A(54877,{filter:a})}function hB(a){let b=a.getFilters().map(a=>hA(a));return 1===b.length?b[0]:{compositeFilter:{op:ht(a.op),filters:b}}}function hC(a){if("=="===a.op){if(dM(a.value))return{unaryFilter:{field:hw(a.field),op:"IS_NAN"}};else if(dL(a.value))return{unaryFilter:{field:hw(a.field),op:"IS_NULL"}}}else if("!="===a.op){if(dM(a.value))return{unaryFilter:{field:hw(a.field),op:"IS_NOT_NAN"}};else if(dL(a.value))return{unaryFilter:{field:hw(a.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:hw(a.field),op:hs(a.op),value:a.value}}}function hD(a){switch(a.unaryFilter.op){case"IS_NAN":let b=hx(a.unaryFilter.field);return d8.create(b,"==",{doubleValue:NaN});case"IS_NULL":let c=hx(a.unaryFilter.field);return d8.create(c,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let d=hx(a.unaryFilter.field);return d8.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let e=hx(a.unaryFilter.field);return d8.create(e,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return A(61313);default:return A(60726)}}function hE(a){return d8.create(hx(a.fieldFilter.field),hu(a.fieldFilter.op),a.fieldFilter.value)}function hF(a){return d9.create(a.compositeFilter.filters.map(a=>hj(a)),hv(a.compositeFilter.op))}function hG(a){let b=[];return a.fields.forEach(a=>b.push(a.canonicalString())),{fieldPaths:b}}function hH(a){return new cJ((a.fieldPaths||[]).map(a=>ar.fromServerFormat(a)))}function hI(a){return a.length>=4&&"projects"===a.get(0)&&"databases"===a.get(2)}function hJ(a){return!!a&&"function"==typeof a._toProto&&"ProtoValue"===a._protoValueType}class hK{constructor(a,b,c,d,e=aH.min(),f=aH.min(),g=cM.EMPTY_BYTE_STRING,h=null){this.target=a,this.targetId=b,this.purpose=c,this.sequenceNumber=d,this.snapshotVersion=e,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=g,this.expectedCount=h}withSequenceNumber(a){return new hK(this.target,this.targetId,this.purpose,a,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(a,b){return new hK(this.target,this.targetId,this.purpose,this.sequenceNumber,b,this.lastLimboFreeSnapshotVersion,a,null)}withExpectedCount(a){return new hK(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,a)}withLastLimboFreeSnapshotVersion(a){return new hK(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,a,this.resumeToken,this.expectedCount)}}class hL{constructor(a){this.remoteSerializer=a}}function hM(a,b){let c;if(b.document)c=gV(a.remoteSerializer,b.document,!!b.hasCommittedMutations);else if(b.noDocument){let a=as.fromSegments(b.noDocument.path),d=hR(b.noDocument.readTime);c=dY.newNoDocument(a,d),b.hasCommittedMutations&&c.setHasCommittedMutations()}else{if(!b.unknownDocument)return A(56709);let a=as.fromSegments(b.unknownDocument.path),d=hR(b.unknownDocument.version);c=dY.newUnknownDocument(a,d)}return b.readTime&&c.setReadTime(hP(b.readTime)),c}function hN(a,b){let c=b.key,d={prefixPath:c.getCollectionPath().popLast().toArray(),collectionGroup:c.collectionGroup,documentId:c.path.lastSegment(),readTime:hO(b.readTime),hasCommittedMutations:b.hasCommittedMutations};if(b.isFoundDocument())d.document=gU(a.remoteSerializer,b);else if(b.isNoDocument())d.noDocument={path:c.path.toArray(),readTime:hQ(b.version)};else{if(!b.isUnknownDocument())return A(57904,{document:b});d.unknownDocument={path:c.path.toArray(),version:hQ(b.version)}}return d}function hO(a){let b=a.toTimestamp();return[b.seconds,b.nanoseconds]}function hP(a){let b=new aG(a[0],a[1]);return aH.fromTimestamp(b)}function hQ(a){let b=a.toTimestamp();return{seconds:b.seconds,nanoseconds:b.nanoseconds}}function hR(a){let b=new aG(a.seconds,a.nanoseconds);return aH.fromTimestamp(b)}function hS(a,b,c){let d=c.baseMutations.map(b=>g0(a.remoteSerializer,b)),e=c.mutations.map(b=>g0(a.remoteSerializer,b));return{userId:b,batchId:c.batchId,localWriteTimeMs:c.localWriteTime.toMillis(),baseMutations:d,mutations:e}}function hT(a,b){let c=(b.baseMutations||[]).map(b=>g1(a.remoteSerializer,b));for(let a=0;a<b.mutations.length-1;++a){let c=b.mutations[a];a+1<b.mutations.length&&void 0!==b.mutations[a+1].transform&&(c.updateTransforms=b.mutations[a+1].transform.fieldTransforms,b.mutations.splice(a+1,1),++a)}let d=b.mutations.map(b=>g1(a.remoteSerializer,b)),e=aG.fromMillis(b.localWriteTimeMs);return new f3(b.batchId,e,c,d)}function hU(a){let b,c=hR(a.readTime),d=void 0!==a.lastLimboFreeSnapshotVersion?hR(a.lastLimboFreeSnapshotVersion):aH.min();return new hK(b=hW(a.query)?g9(a.query):hd(a.query),a.targetId,"TargetPurposeListen",a.lastListenSequenceNumber,c,d,cM.fromBase64String(a.resumeToken))}function hV(a,b){let c,d=hQ(b.snapshotVersion),e=hQ(b.lastLimboFreeSnapshotVersion);c=ez(b.target)?g8(a.remoteSerializer,b.target):ha(a.remoteSerializer,b.target).queryTarget;let f=b.resumeToken.toBase64();return{targetId:b.targetId,canonicalId:ew(b.target),readTime:d,resumeToken:f,lastListenSequenceNumber:b.sequenceNumber,lastLimboFreeSnapshotVersion:e,query:c}}function hW(a){return void 0!==a.documents}function hX(a){return{id:a.bundleId,createTime:hR(a.createTime),version:a.version}}function hY(a){return{bundleId:a.id,createTime:hQ(gI(a.createTime)),version:a.version}}function hZ(a){return{name:a.name,query:h_(a.bundledQuery),readTime:hR(a.readTime)}}function h$(a){return{name:a.name,readTime:hQ(gI(a.readTime)),bundledQuery:a.bundledQuery}}function h_(a){let b=hc({parent:a.parent,structuredQuery:a.structuredQuery});return"LAST"===a.limitType?eX(b,b.limit,"L"):b}function h0(a){return{name:a.name,query:h_(a.bundledQuery),readTime:gI(a.readTime)}}function h1(a){return{id:a.id,version:a.version,createTime:gI(a.createTime)}}function h2(a,b){return new f5(b.largestBatchId,g1(a.remoteSerializer,b.overlayMutation))}function h3(a,b,c){let[d,e,f]=h4(b,c.mutation.key);return{userId:b,collectionPath:e,documentId:f,collectionGroup:c.mutation.key.getCollectionGroup(),largestBatchId:c.largestBatchId,overlayMutation:g0(a.remoteSerializer,c.mutation)}}function h4(a,b){let c=b.path.lastSegment();return[a,bm(b.path.popLast()),c]}function h5(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(a=>[a.fieldPath.canonicalString(),a.kind])}}function h6(a,b){let c=b?new aS(b.sequenceNumber,new aV(hR(b.readTime),new as(bp(b.documentKey)),b.largestBatchId)):aS.empty(),d=a.fields.map(([a,b])=>new aQ(ar.fromServerFormat(a),b));return new aK(a.indexId,a.collectionGroup,d,c)}function h7(a,b,c,d){return{indexId:a,uid:b,sequenceNumber:c,readTime:hQ(d.readTime),documentKey:bm(d.documentKey.path),largestBatchId:d.largestBatchId}}class h8{getBundleMetadata(a,b){return h9(a).get(b).next(a=>{if(a)return hX(a)})}saveBundleMetadata(a,b){return h9(a).put(hY(b))}getNamedQuery(a,b){return ia(a).get(b).next(a=>{if(a)return hZ(a)})}saveNamedQuery(a,b){return ia(a).put(h$(b))}}function h9(a){return cw(a,b$)}function ia(a){return cw(a,b0)}class ib{constructor(a,b){this.serializer=a,this.userId=b}static forUser(a,b){return new ib(a,b.uid||"")}getOverlay(a,b){return ic(a).get(h4(this.userId,b)).next(a=>a?h2(this.serializer,a):null)}getOverlays(a,b){let c=fg();return a$.forEach(b,b=>this.getOverlay(a,b).next(a=>{null!==a&&c.set(b,a)})).next(()=>c)}saveOverlays(a,b,c){let d=[];return c.forEach((c,e)=>{let f=new f5(b,e);d.push(this.saveOverlay(a,f))}),a$.waitFor(d)}removeOverlaysForBatchId(a,b,c){let d=new Set;b.forEach(a=>d.add(bm(a.getCollectionPath())));let e=[];return d.forEach(b=>{let d=IDBKeyRange.bound([this.userId,b,c],[this.userId,b,c+1],!1,!0);e.push(ic(a).deleteAll(cg,d))}),a$.waitFor(e)}getOverlaysForCollection(a,b,c){let d=fg(),e=bm(b),f=IDBKeyRange.bound([this.userId,e,c],[this.userId,e,1/0],!0);return ic(a).loadAll(cg,f).next(a=>{for(let b of a){let a=h2(this.serializer,b);d.set(a.getKey(),a)}return d})}getOverlaysForCollectionGroup(a,b,c,d){let e,f=fg(),g=IDBKeyRange.bound([this.userId,b,c],[this.userId,b,1/0],!0);return ic(a).iterate({index:ci,range:g},(a,b,c)=>{let g=h2(this.serializer,b);f.size()<d||g.largestBatchId===e?(f.set(g.getKey(),g),e=g.largestBatchId):c.done()}).next(()=>f)}saveOverlay(a,b){return ic(a).put(h3(this.serializer,this.userId,b))}}function ic(a){return cw(a,ce)}class id{globalsStore(a){return cw(a,ck)}getSessionToken(a){return this.globalsStore(a).get("sessionToken").next(a=>{let b=a?.value;return b?cM.fromUint8Array(b):cM.EMPTY_BYTE_STRING})}setSessionToken(a,b){return this.globalsStore(a).put({name:"sessionToken",value:b.toUint8Array()})}}let ie=5,ig=10,ih=13,ii=15,ij=20,ik=25,il=30,im=37,io=45,ip=50,iq=53,ir=55,is=60,it=2;class iu{writeIndexValue(a,b){this.writeIndexValueAux(a,b),b.writeInfinity()}writeIndexValueAux(a,b){if("nullValue"in a)this.writeValueTypeLabel(b,ie);else if("booleanValue"in a)this.writeValueTypeLabel(b,ig),b.writeNumber(+!!a.booleanValue);else if("integerValue"in a)this.writeValueTypeLabel(b,ii),b.writeNumber(cR(a.integerValue));else if("doubleValue"in a){let c=cR(a.doubleValue);isNaN(c)?this.writeValueTypeLabel(b,ih):(this.writeValueTypeLabel(b,ii),c5(c)?b.writeNumber(0):b.writeNumber(c))}else if("timestampValue"in a){let c=a.timestampValue;this.writeValueTypeLabel(b,ij),"string"==typeof c&&(c=cQ(c)),b.writeString(`${c.seconds||""}`),b.writeNumber(c.nanos||0)}else if("stringValue"in a)this.writeIndexString(a.stringValue,b),this.writeTruncationMarker(b);else if("bytesValue"in a)this.writeValueTypeLabel(b,il),b.writeBytes(cS(a.bytesValue)),this.writeTruncationMarker(b);else if("referenceValue"in a)this.writeIndexEntityRef(a.referenceValue,b);else if("geoPointValue"in a){let c=a.geoPointValue;this.writeValueTypeLabel(b,io),b.writeNumber(c.latitude||0),b.writeNumber(c.longitude||0)}else"mapValue"in a?dQ(a)?this.writeValueTypeLabel(b,Number.MAX_SAFE_INTEGER):dO(a)?this.writeIndexVector(a.mapValue,b):(this.writeIndexMap(a.mapValue,b),this.writeTruncationMarker(b)):"arrayValue"in a?(this.writeIndexArray(a.arrayValue,b),this.writeTruncationMarker(b)):A(19022,{indexValue:a})}writeIndexString(a,b){this.writeValueTypeLabel(b,ik),this.writeUnlabeledIndexString(a,b)}writeUnlabeledIndexString(a,b){b.writeString(a)}writeIndexMap(a,b){let c=a.fields||{};for(let a of(this.writeValueTypeLabel(b,ir),Object.keys(c)))this.writeIndexString(a,b),this.writeIndexValueAux(c[a],b)}writeIndexVector(a,b){let c=a.fields||{};this.writeValueTypeLabel(b,iq);let d=db,e=c[d].arrayValue?.values?.length||0;this.writeValueTypeLabel(b,ii),b.writeNumber(cR(e)),this.writeIndexString(d,b),this.writeIndexValueAux(c[d],b)}writeIndexArray(a,b){let c=a.values||[];for(let a of(this.writeValueTypeLabel(b,ip),c))this.writeIndexValueAux(a,b)}writeIndexEntityRef(a,b){this.writeValueTypeLabel(b,im),as.fromName(a).path.forEach(a=>{this.writeValueTypeLabel(b,is),this.writeUnlabeledIndexString(a,b)})}writeValueTypeLabel(a,b){a.writeNumber(b)}writeTruncationMarker(a){a.writeNumber(it)}}iu.INSTANCE=new iu;let iv="\uD800",iw="\uDBFF",ix=0,iy=255,iz=1,iA=255,iB=255,iC=0,iD=64,iE=8,iF=1024;function iG(a){let b=new DataView(new ArrayBuffer(8));return b.setFloat64(0,a,!1),new Uint8Array(b.buffer)}function iH(a){if(0===a)return 8;let b=0;return a>>4==0&&(b+=4,a<<=4),a>>6==0&&(b+=2,a<<=2),a>>7==0&&(b+=1),b}function iI(a){let b=0;for(let c=0;c<8;++c){let d=iH(255&a[c]);if(b+=d,8!==d)break}return b}function iJ(a){return Math.ceil((iD-iI(a))/iE)}class iK{constructor(){this.buffer=new Uint8Array(iF),this.position=0}writeBytesAscending(a){let b=a[Symbol.iterator](),c=b.next();for(;!c.done;)this.writeByteAscending(c.value),c=b.next();this.writeSeparatorAscending()}writeBytesDescending(a){let b=a[Symbol.iterator](),c=b.next();for(;!c.done;)this.writeByteDescending(c.value),c=b.next();this.writeSeparatorDescending()}writeUtf8Ascending(a){for(let b of a){let a=b.charCodeAt(0);if(a<128)this.writeByteAscending(a);else if(a<2048)this.writeByteAscending(960|a>>>6),this.writeByteAscending(128|63&a);else if(b<iv||iw<b)this.writeByteAscending(480|a>>>12),this.writeByteAscending(128|63&a>>>6),this.writeByteAscending(128|63&a);else{let a=b.codePointAt(0);this.writeByteAscending(240|a>>>18),this.writeByteAscending(128|63&a>>>12),this.writeByteAscending(128|63&a>>>6),this.writeByteAscending(128|63&a)}}this.writeSeparatorAscending()}writeUtf8Descending(a){for(let b of a){let a=b.charCodeAt(0);if(a<128)this.writeByteDescending(a);else if(a<2048)this.writeByteDescending(960|a>>>6),this.writeByteDescending(128|63&a);else if(b<iv||iw<b)this.writeByteDescending(480|a>>>12),this.writeByteDescending(128|63&a>>>6),this.writeByteDescending(128|63&a);else{let a=b.codePointAt(0);this.writeByteDescending(240|a>>>18),this.writeByteDescending(128|63&a>>>12),this.writeByteDescending(128|63&a>>>6),this.writeByteDescending(128|63&a)}}this.writeSeparatorDescending()}writeNumberAscending(a){let b=this.toOrderedBits(a),c=iJ(b);this.ensureAvailable(1+c),this.buffer[this.position++]=255&c;for(let a=b.length-c;a<b.length;++a)this.buffer[this.position++]=255&b[a]}writeNumberDescending(a){let b=this.toOrderedBits(a),c=iJ(b);this.ensureAvailable(1+c),this.buffer[this.position++]=~(255&c);for(let a=b.length-c;a<b.length;++a)this.buffer[this.position++]=~(255&b[a])}writeInfinityAscending(){this.writeEscapedByteAscending(iA),this.writeEscapedByteAscending(iB)}writeInfinityDescending(){this.writeEscapedByteDescending(iA),this.writeEscapedByteDescending(iB)}reset(){this.position=0}seed(a){this.ensureAvailable(a.length),this.buffer.set(a,this.position),this.position+=a.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(a){let b=iG(a),c=(128&b[0])!=0;b[0]^=c?255:128;for(let a=1;a<b.length;++a)b[a]^=255*!!c;return b}writeByteAscending(a){let b=255&a;b===ix?(this.writeEscapedByteAscending(ix),this.writeEscapedByteAscending(iy)):b===iA?(this.writeEscapedByteAscending(iA),this.writeEscapedByteAscending(iC)):this.writeEscapedByteAscending(b)}writeByteDescending(a){let b=255&a;b===ix?(this.writeEscapedByteDescending(ix),this.writeEscapedByteDescending(iy)):b===iA?(this.writeEscapedByteDescending(iA),this.writeEscapedByteDescending(iC)):this.writeEscapedByteDescending(a)}writeSeparatorAscending(){this.writeEscapedByteAscending(ix),this.writeEscapedByteAscending(iz)}writeSeparatorDescending(){this.writeEscapedByteDescending(ix),this.writeEscapedByteDescending(iz)}writeEscapedByteAscending(a){this.ensureAvailable(1),this.buffer[this.position++]=a}writeEscapedByteDescending(a){this.ensureAvailable(1),this.buffer[this.position++]=~a}ensureAvailable(a){let b=a+this.position;if(b<=this.buffer.length)return;let c=2*this.buffer.length;c<b&&(c=b);let d=new Uint8Array(c);d.set(this.buffer),this.buffer=d}}class iL{constructor(a){this.orderedCode=a}writeBytes(a){this.orderedCode.writeBytesAscending(a)}writeString(a){this.orderedCode.writeUtf8Ascending(a)}writeNumber(a){this.orderedCode.writeNumberAscending(a)}writeInfinity(){this.orderedCode.writeInfinityAscending()}}class iM{constructor(a){this.orderedCode=a}writeBytes(a){this.orderedCode.writeBytesDescending(a)}writeString(a){this.orderedCode.writeUtf8Descending(a)}writeNumber(a){this.orderedCode.writeNumberDescending(a)}writeInfinity(){this.orderedCode.writeInfinityDescending()}}class iN{constructor(){this.orderedCode=new iK,this.ascending=new iL(this.orderedCode),this.descending=new iM(this.orderedCode)}seed(a){this.orderedCode.seed(a)}forKind(a){return 0===a?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}}class iO{constructor(a,b,c,d){this._indexId=a,this._documentKey=b,this._arrayValue=c,this._directionalValue=d}successor(){let a=this._directionalValue.length,b=0===a||255===this._directionalValue[a-1]?a+1:a,c=new Uint8Array(b);return c.set(this._directionalValue,0),b!==a?c.set([0],this._directionalValue.length):++c[c.length-1],new iO(this._indexId,this._documentKey,this._arrayValue,c)}dbIndexEntry(a,b,c){return{indexId:this._indexId,uid:a,arrayValue:iR(this._arrayValue),directionalValue:iR(this._directionalValue),orderedDocumentKey:iR(b),documentKey:c.path.toArray()}}dbIndexEntryKey(a,b,c){let d=this.dbIndexEntry(a,b,c);return[d.indexId,d.uid,d.arrayValue,d.directionalValue,d.orderedDocumentKey,d.documentKey]}}function iP(a,b){let c=a._indexId-b._indexId;return 0!==c||0!==(c=iQ(a._arrayValue,b._arrayValue))||0!==(c=iQ(a._directionalValue,b._directionalValue))?c:as.comparator(a._documentKey,b._documentKey)}function iQ(a,b){for(let c=0;c<a.length&&c<b.length;++c){let d=a[c]-b[c];if(0!==d)return d}return a.length-b.length}function iR(a){return(0,i.isSafariOrWebkit)()?iT(a):a}function iS(a){return"string"!=typeof a?a:iU(a)}function iT(a){let b="";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b}function iU(a){let b=new Uint8Array(a.length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}class iV{constructor(a){for(const b of(this.inequalityFilters=new cF((a,b)=>ar.comparator(a.field,b.field)),this.collectionId=null!=a.collectionGroup?a.collectionGroup:a.path.lastSegment(),this.orderBys=a.orderBy,this.equalityFilters=[],a.filters)){const a=b;a.isInequality()?this.inequalityFilters=this.inequalityFilters.add(a):this.equalityFilters.push(a)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(a){if(C(a.collectionGroup===this.collectionId,49279),this.hasMultipleInequality)return!1;let b=aL(a);if(void 0!==b&&!this.hasMatchingEqualityFilter(b))return!1;let c=aM(a),d=new Set,e=0,f=0;for(;e<c.length;++e)if(this.hasMatchingEqualityFilter(c[e]))d=d.add(c[e].fieldPath.canonicalString());else break;if(e===c.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!d.has(a.field.canonicalString())){let b=c[e];if(!this.matchesFilter(a,b)||!this.matchesOrderBy(this.orderBys[f++],b))return!1}++e}for(;e<c.length;++e){let a=c[e];if(f>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[f++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let a=new cF(ar.comparator),b=[];for(let c of this.equalityFilters)if(!c.field.isKeyField())if("array-contains"===c.op||"array-contains-any"===c.op)b.push(new aQ(c.field,2));else{if(a.has(c.field))continue;a=a.add(c.field),b.push(new aQ(c.field,0))}for(let c of this.orderBys)!c.field.isKeyField()&&(a.has(c.field)||(a=a.add(c.field),b.push(new aQ(c.field,+("asc"!==c.dir)))));return new aK(aK.UNKNOWN_ID,this.collectionId,b,aS.empty())}hasMatchingEqualityFilter(a){for(let b of this.equalityFilters)if(this.matchesFilter(b,a))return!0;return!1}matchesFilter(a,b){if(void 0===a||!a.field.isEqual(b.fieldPath))return!1;let c="array-contains"===a.op||"array-contains-any"===a.op;return 2===b.kind===c}matchesOrderBy(a,b){return!!a.field.isEqual(b.fieldPath)&&(0===b.kind&&"asc"===a.dir||1===b.kind&&"desc"===a.dir)}}function iW(a){if(C(a instanceof d8||a instanceof d9,20012),a instanceof d8)if(!(a instanceof er))return a;else{let b=a.value.arrayValue?.values?.map(b=>d8.create(a.field,"==",b))||[];return d9.create(b,"or")}let b=a.filters.map(a=>iW(a));return d9.create(b,a.op)}function iX(a){if(0===a.getFilters().length)return[];let b=i0(iW(a));return(C(i$(b),7391),iY(b)||iZ(b))?[b]:b.getFilters()}function iY(a){return a instanceof d8}function iZ(a){return a instanceof d9&&ec(a)}function i$(a){return iY(a)||iZ(a)||i_(a)}function i_(a){if(a instanceof d9&&eb(a)){for(let b of a.getFilters())if(!iY(b)&&!iZ(b))return!1;return!0}return!1}function i0(a){if(C(a instanceof d8||a instanceof d9,34018),a instanceof d8)return a;if(1===a.filters.length)return i0(a.filters[0]);let b=a.filters.map(a=>i0(a)),c=d9.create(b,a.op);return i$(c=i5(c))?c:(C(c instanceof d9,64498),C(ea(c),40251),C(c.filters.length>1,57927),c.filters.reduce((a,b)=>i1(a,b)))}function i1(a,b){let c;return C(a instanceof d8||a instanceof d9,38388),C(b instanceof d8||b instanceof d9,25473),i5(c=a instanceof d8?b instanceof d8?i2(a,b):i4(a,b):b instanceof d8?i4(b,a):i3(a,b))}function i2(a,b){return d9.create([a,b],"and")}function i3(a,b){if(C(a.filters.length>0&&b.filters.length>0,48005),ea(a)&&ea(b))return ei(a,b.getFilters());let c=eb(a)?a:b,d=eb(a)?b:a,e=c.filters.map(a=>i1(a,d));return d9.create(e,"or")}function i4(a,b){if(ea(b))return ei(b,a.getFilters());{let c=b.filters.map(b=>i1(a,b));return d9.create(c,"or")}}function i5(a){if(C(a instanceof d8||a instanceof d9,11850),a instanceof d8)return a;let b=a.getFilters();if(1===b.length)return i5(b[0]);if(ed(a))return a;let c=b.map(a=>i5(a)),d=[];return(c.forEach(b=>{b instanceof d8?d.push(b):b instanceof d9&&(b.op===a.op?d.push(...b.filters):d.push(b))}),1===d.length)?d[0]:d9.create(d,a.op)}class i6{constructor(){this.collectionParentIndex=new i7}addToCollectionParentIndex(a,b){return this.collectionParentIndex.add(b),a$.resolve()}getCollectionParents(a,b){return a$.resolve(this.collectionParentIndex.getEntries(b))}addFieldIndex(a,b){return a$.resolve()}deleteFieldIndex(a,b){return a$.resolve()}deleteAllFieldIndexes(a){return a$.resolve()}createTargetIndexes(a,b){return a$.resolve()}getDocumentsMatchingTarget(a,b){return a$.resolve(null)}getIndexType(a,b){return a$.resolve(0)}getFieldIndexes(a,b){return a$.resolve([])}getNextCollectionGroupToUpdate(a){return a$.resolve(null)}getMinOffset(a,b){return a$.resolve(aV.min())}getMinOffsetFromCollectionGroup(a,b){return a$.resolve(aV.min())}updateCollectionGroup(a,b,c){return a$.resolve()}updateIndexEntries(a,b){return a$.resolve()}}class i7{constructor(){this.index={}}add(a){let b=a.lastSegment(),c=a.popLast(),d=this.index[b]||new cF(ap.comparator),e=!d.has(c);return this.index[b]=d.add(c),e}has(a){let b=a.lastSegment(),c=a.popLast(),d=this.index[b];return d&&d.has(c)}getEntries(a){return(this.index[a]||new cF(ap.comparator)).toArray()}}let i8="IndexedDbIndexManager",i9=new Uint8Array(0);class ja{constructor(a,b){this.databaseId=b,this.collectionParentsCache=new i7,this.targetToDnfSubTargets=new e9(a=>ew(a),(a,b)=>ey(a,b)),this.uid=a.uid||""}addToCollectionParentIndex(a,b){if(!this.collectionParentsCache.has(b)){let c=b.lastSegment(),d=b.popLast();a.addOnCommittedListener(()=>{this.collectionParentsCache.add(b)});let e={collectionId:c,parent:bm(d)};return jb(a).put(e)}return a$.resolve()}getCollectionParents(a,b){let c=[],d=IDBKeyRange.bound([b,""],[am(b),""],!1,!0);return jb(a).loadAll(d).next(a=>{for(let d of a){if(d.collectionId!==b)break;c.push(bp(d.parent))}return c})}addFieldIndex(a,b){let c=jd(a),d=h5(b);delete d.indexId;let e=c.add(d);if(!b.indexState)return e.next();{let c=je(a);return e.next(a=>{c.put(h7(a,this.uid,b.indexState.sequenceNumber,b.indexState.offset))})}}deleteFieldIndex(a,b){let c=jd(a),d=je(a),e=jc(a);return c.delete(b.indexId).next(()=>d.delete(IDBKeyRange.bound([b.indexId],[b.indexId+1],!1,!0))).next(()=>e.delete(IDBKeyRange.bound([b.indexId],[b.indexId+1],!1,!0)))}deleteAllFieldIndexes(a){let b=jd(a),c=jc(a),d=je(a);return b.deleteAll().next(()=>c.deleteAll()).next(()=>d.deleteAll())}createTargetIndexes(a,b){return a$.forEach(this.getSubTargets(b),b=>this.getIndexType(a,b).next(c=>{if(0===c||1===c){let c=new iV(b).buildTargetIndex();if(null!=c)return this.addFieldIndex(a,c)}}))}getDocumentsMatchingTarget(a,b){let c=jc(a),d=!0,e=new Map;return a$.forEach(this.getSubTargets(b),b=>this.getFieldIndex(a,b).next(a=>{d&&(d=!!a),e.set(b,a)})).next(()=>{if(!d)return a$.resolve(null);{let a=fm(),d=[];return a$.forEach(e,(e,f)=>{w(i8,`Using index ${aP(e)} to execute ${ew(b)}`);let g=eB(f,e),h=eC(f,e),i=eD(f,e),j=eE(f,e),k=this.encodeBound(e,f,i),l=this.encodeBound(e,f,j),m=this.encodeValues(e,f,h),n=this.generateIndexRanges(e.indexId,g,k,i.inclusive,l,j.inclusive,m);return a$.forEach(n,e=>c.loadFirst(e,b.limit).next(b=>{b.forEach(b=>{let c=as.fromSegments(b.documentKey);a.has(c)||(a=a.add(c),d.push(c))})}))}).next(()=>d)}})}getSubTargets(a){let b=this.targetToDnfSubTargets.get(a);return b||(b=0===a.filters.length?[a]:iX(d9.create(a.filters,"and")).map(b=>ev(a.path,a.collectionGroup,a.orderBy,b.getFilters(),a.limit,a.startAt,a.endAt)),this.targetToDnfSubTargets.set(a,b)),b}generateIndexRanges(a,b,c,d,e,f,g){let h=(null!=b?b.length:1)*Math.max(c.length,e.length),i=h/(null!=b?b.length:1),j=[];for(let k=0;k<h;++k){let h=b?this.encodeSingleElement(b[k/i]):i9,l=this.generateLowerBound(a,h,c[k%i],d),m=this.generateUpperBound(a,h,e[k%i],f),n=g.map(b=>this.generateLowerBound(a,h,b,!0));j.push(...this.createRange(l,m,n))}return j}generateLowerBound(a,b,c,d){let e=new iO(a,as.empty(),b,c);return d?e:e.successor()}generateUpperBound(a,b,c,d){let e=new iO(a,as.empty(),b,c);return d?e.successor():e}getFieldIndex(a,b){let c=new iV(b),d=null!=b.collectionGroup?b.collectionGroup:b.path.lastSegment();return this.getFieldIndexes(a,d).next(a=>{let b=null;for(let d of a)c.servedByIndex(d)&&(!b||d.fields.length>b.fields.length)&&(b=d);return b})}getIndexType(a,b){let c=2,d=this.getSubTargets(b);return a$.forEach(d,b=>this.getFieldIndex(a,b).next(a=>{a?0!==c&&a.fields.length<eH(b)&&(c=1):c=0})).next(()=>eI(b)&&d.length>1&&2===c?1:c)}encodeDirectionalElements(a,b){let c=new iN;for(let d of aM(a)){let a=b.data.field(d.fieldPath);if(null==a)return null;let e=c.forKind(d.kind);iu.INSTANCE.writeIndexValue(a,e)}return c.encodedBytes()}encodeSingleElement(a){let b=new iN;return iu.INSTANCE.writeIndexValue(a,b.forKind(0)),b.encodedBytes()}encodeDirectionalKey(a,b){let c=new iN;return iu.INSTANCE.writeIndexValue(dG(this.databaseId,b),c.forKind(aN(a))),c.encodedBytes()}encodeValues(a,b,c){if(null===c)return[];let d=[];d.push(new iN);let e=0;for(let f of aM(a)){let a=c[e++];for(let c of d)if(this.isInFilter(b,f.fieldPath)&&dK(a))d=this.expandIndexValues(d,f,a);else{let b=c.forKind(f.kind);iu.INSTANCE.writeIndexValue(a,b)}}return this.getEncodedBytes(d)}encodeBound(a,b,c){return this.encodeValues(a,b,c.position)}getEncodedBytes(a){let b=[];for(let c=0;c<a.length;++c)b[c]=a[c].encodedBytes();return b}expandIndexValues(a,b,c){let d=[...a],e=[];for(let a of c.arrayValue.values||[])for(let c of d){let d=new iN;d.seed(c.encodedBytes()),iu.INSTANCE.writeIndexValue(a,d.forKind(b.kind)),e.push(d)}return e}isInFilter(a,b){return!!a.filters.find(a=>a instanceof d8&&a.field.isEqual(b)&&("in"===a.op||"not-in"===a.op))}getFieldIndexes(a,b){let c=jd(a),d=je(a);return(b?c.loadAll(b4,IDBKeyRange.bound(b,b)):c.loadAll()).next(a=>{let b=[];return a$.forEach(a,a=>d.get([a.indexId,this.uid]).next(c=>{b.push(h6(a,c))})).next(()=>b)})}getNextCollectionGroupToUpdate(a){return this.getFieldIndexes(a).next(a=>0===a.length?null:(a.sort((a,b)=>{let c=a.indexState.sequenceNumber-b.indexState.sequenceNumber;return 0!==c?c:ag(a.collectionGroup,b.collectionGroup)}),a[0].collectionGroup))}updateCollectionGroup(a,b,c){let d=jd(a),e=je(a);return this.getNextSequenceNumber(a).next(a=>d.loadAll(b4,IDBKeyRange.bound(b,b)).next(b=>a$.forEach(b,b=>e.put(h7(b.indexId,this.uid,a,c)))))}updateIndexEntries(a,b){let c=new Map;return a$.forEach(b,(b,d)=>{let e=c.get(b.collectionGroup);return(e?a$.resolve(e):this.getFieldIndexes(a,b.collectionGroup)).next(e=>(c.set(b.collectionGroup,e),a$.forEach(e,c=>this.getExistingIndexEntries(a,b,c).next(b=>{let e=this.computeIndexEntries(d,c);return b.isEqual(e)?a$.resolve():this.updateEntries(a,d,c,b,e)}))))})}addIndexEntry(a,b,c,d){return jc(a).put(d.dbIndexEntry(this.uid,this.encodeDirectionalKey(c,b.key),b.key))}deleteIndexEntry(a,b,c,d){return jc(a).delete(d.dbIndexEntryKey(this.uid,this.encodeDirectionalKey(c,b.key),b.key))}getExistingIndexEntries(a,b,c){let d=jc(a),e=new cF(iP);return d.iterate({index:cc,range:IDBKeyRange.only([c.indexId,this.uid,iR(this.encodeDirectionalKey(c,b))])},(a,d)=>{e=e.add(new iO(c.indexId,b,iS(d.arrayValue),iS(d.directionalValue)))}).next(()=>e)}computeIndexEntries(a,b){let c=new cF(iP),d=this.encodeDirectionalElements(b,a);if(null==d)return c;let e=aL(b);if(null!=e){let f=a.data.field(e.fieldPath);if(dK(f))for(let e of f.arrayValue.values||[])c=c.add(new iO(b.indexId,a.key,this.encodeSingleElement(e),d))}else c=c.add(new iO(b.indexId,a.key,i9,d));return c}updateEntries(a,b,c,d,e){w(i8,"Updating index entries for document '%s'",b.key);let f=[];return cH(d,e,iP,d=>{f.push(this.addIndexEntry(a,b,c,d))},d=>{f.push(this.deleteIndexEntry(a,b,c,d))}),a$.waitFor(f)}getNextSequenceNumber(a){let b=1;return je(a).iterate({index:b8,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(a,c,d)=>{d.done(),b=c.sequenceNumber+1}).next(()=>b)}createRange(a,b,c){c=c.sort((a,b)=>iP(a,b)).filter((a,b,c)=>!b||0!==iP(a,c[b-1]));let d=[];for(let e of(d.push(a),c)){let c=iP(e,a),f=iP(e,b);if(0===c)d[0]=a.successor();else if(c>0&&f<0)d.push(e),d.push(e.successor());else if(f>0)break}d.push(b);let e=[];for(let a=0;a<d.length;a+=2){if(this.isRangeMatchable(d[a],d[a+1]))return[];let b=d[a].dbIndexEntryKey(this.uid,i9,as.empty()),c=d[a+1].dbIndexEntryKey(this.uid,i9,as.empty());e.push(IDBKeyRange.bound(b,c))}return e}isRangeMatchable(a,b){return iP(a,b)>0}getMinOffsetFromCollectionGroup(a,b){return this.getFieldIndexes(a,b).next(jf)}getMinOffset(a,b){return a$.mapArray(this.getSubTargets(b),b=>this.getFieldIndex(a,b).next(a=>a||A(44426))).next(jf)}}function jb(a){return cw(a,bW)}function jc(a){return cw(a,ca)}function jd(a){return cw(a,b2)}function je(a){return cw(a,b6)}function jf(a){C(0!==a.length,28825);let b=a[0].indexState.offset,c=b.largestBatchId;for(let d=1;d<a.length;d++){let e=a[d].indexState.offset;0>aW(e,b)&&(b=e),c<e.largestBatchId&&(c=e.largestBatchId)}return new aV(b.readTime,b.documentKey,c)}function jg(a,b,c){let d=a.store(bv),e=a.store(bD),f=[],g=IDBKeyRange.only(c.batchId),h=0,i=d.iterate({range:g},(a,b,c)=>(h++,c.delete()));f.push(i.next(()=>{C(1===h,47070,{batchId:c.batchId})}));let j=[];for(let a of c.mutations){let d=bB(b,a.key.path,c.batchId);f.push(e.delete(d)),j.push(a.key)}return a$.waitFor(f).next(()=>j)}function jh(a){let b;if(!a)return 0;if(a.document)b=a.document;else if(a.unknownDocument)b=a.unknownDocument;else if(a.noDocument)b=a.noDocument;else throw A(14731);return JSON.stringify(b).length}class ji{constructor(a,b,c,d){this.userId=a,this.serializer=b,this.indexManager=c,this.referenceDelegate=d,this.documentKeysByBatchId={}}static forUser(a,b,c,d){return C(""!==a.uid,64387),new ji(a.isAuthenticated()?a.uid:"",b,c,d)}checkEmpty(a){let b=!0,c=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return jl(a).iterate({index:bx,range:c},(a,c,d)=>{b=!1,d.done()}).next(()=>b)}addMutationBatch(a,b,c,d){let e=jm(a),f=jl(a);return f.add({}).next(g=>{C("number"==typeof g,49019);let h=new f3(g,b,c,d),i=hS(this.serializer,this.userId,h),j=[],k=new cF((a,b)=>ag(a.canonicalString(),b.canonicalString()));for(let a of d){let b=bB(this.userId,a.key.path,g);k=k.add(a.key.path.popLast()),j.push(f.put(i)),j.push(e.put(b,bC))}return k.forEach(b=>{j.push(this.indexManager.addToCollectionParentIndex(a,b))}),a.addOnCommittedListener(()=>{this.documentKeysByBatchId[g]=h.keys()}),a$.waitFor(j).next(()=>h)})}lookupMutationBatch(a,b){return jl(a).get(b).next(a=>a?(C(a.userId===this.userId,48,"Unexpected user for mutation batch",{userId:a.userId,batchId:b}),hT(this.serializer,a)):null)}lookupMutationKeys(a,b){return this.documentKeysByBatchId[b]?a$.resolve(this.documentKeysByBatchId[b]):this.lookupMutationBatch(a,b).next(a=>{if(!a)return null;{let c=a.keys();return this.documentKeysByBatchId[b]=c,c}})}getNextMutationBatchAfterBatchId(a,b){let c=b+1,d=IDBKeyRange.lowerBound([this.userId,c]),e=null;return jl(a).iterate({index:bx,range:d},(a,b,d)=>{b.userId===this.userId&&(C(b.batchId>=c,47524,{nextBatchId:c}),e=hT(this.serializer,b)),d.done()}).next(()=>e)}getHighestUnacknowledgedBatchId(a){let b=IDBKeyRange.upperBound([this.userId,1/0]),c=c3;return jl(a).iterate({index:bx,range:b,reverse:!0},(a,b,d)=>{c=b.batchId,d.done()}).next(()=>c)}getAllMutationBatches(a){let b=IDBKeyRange.bound([this.userId,c3],[this.userId,1/0]);return jl(a).loadAll(bx,b).next(a=>a.map(a=>hT(this.serializer,a)))}getAllMutationBatchesAffectingDocumentKey(a,b){let c=bA(this.userId,b.path),d=IDBKeyRange.lowerBound(c),e=[];return jm(a).iterate({range:d},(c,d,f)=>{let[g,h,i]=c,j=bp(h);return g===this.userId&&b.path.isEqual(j)?jl(a).get(i).next(a=>{if(!a)throw A(61480,{indexKey:c,batchId:i});C(a.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:a.userId,batchId:i}),e.push(hT(this.serializer,a))}):void f.done()}).next(()=>e)}getAllMutationBatchesAffectingDocumentKeys(a,b){let c=new cF(ag),d=[];return b.forEach(b=>{let e=bA(this.userId,b.path),f=IDBKeyRange.lowerBound(e),g=jm(a).iterate({range:f},(a,d,e)=>{let[f,g,h]=a,i=bp(g);f===this.userId&&b.path.isEqual(i)?c=c.add(h):e.done()});d.push(g)}),a$.waitFor(d).next(()=>this.lookupMutationBatches(a,c))}getAllMutationBatchesAffectingQuery(a,b){let c=b.path,d=c.length+1,e=bA(this.userId,c),f=IDBKeyRange.lowerBound(e),g=new cF(ag);return jm(a).iterate({range:f},(a,b,e)=>{let[f,h,i]=a,j=bp(h);f===this.userId&&c.isPrefixOf(j)?j.length===d&&(g=g.add(i)):e.done()}).next(()=>this.lookupMutationBatches(a,g))}lookupMutationBatches(a,b){let c=[],d=[];return b.forEach(b=>{d.push(jl(a).get(b).next(a=>{if(null===a)throw A(35274,{batchId:b});C(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:b}),c.push(hT(this.serializer,a))}))}),a$.waitFor(d).next(()=>c)}removeMutationBatch(a,b){return jg(a.simpleDbTransaction,this.userId,b).next(c=>(a.addOnCommittedListener(()=>{this.removeCachedMutationKeys(b.batchId)}),a$.forEach(c,b=>this.referenceDelegate.markPotentiallyOrphaned(a,b))))}removeCachedMutationKeys(a){delete this.documentKeysByBatchId[a]}performConsistencyCheck(a){return this.checkEmpty(a).next(b=>{if(!b)return a$.resolve();let c=IDBKeyRange.lowerBound(bz(this.userId)),d=[];return jm(a).iterate({range:c},(a,b,c)=>{if(a[0]!==this.userId)return void c.done();{let b=bp(a[1]);d.push(b)}}).next(()=>{C(0===d.length,56720,{danglingKeys:d.map(a=>a.canonicalString())})})})}containsKey(a,b){return jj(a,this.userId,b)}getMutationQueueMetadata(a){return jn(a).get(this.userId).next(a=>a||{userId:this.userId,lastAcknowledgedBatchId:c3,lastStreamToken:""})}}function jj(a,b,c){let d=bA(b,c.path),e=d[1],f=IDBKeyRange.lowerBound(d),g=!1;return jm(a).iterate({range:f,keysOnly:!0},(a,c,d)=>{let[f,h,i]=a;f===b&&h===e&&(g=!0),d.done()}).next(()=>g)}function jk(a,b){let c=!1;return jn(a).iterateSerial(d=>jj(a,d,b).next(a=>(a&&(c=!0),a$.resolve(!a)))).next(()=>c)}function jl(a){return cw(a,bv)}function jm(a){return cw(a,bD)}function jn(a){return cw(a,bt)}let jo=2;class jp{constructor(a){this.lastId=a}next(){return this.lastId+=jo,this.lastId}static forTargetCache(){return new jp(2-jo)}static forSyncEngine(){return new jp(1-jo)}}class jq{constructor(a,b){this.referenceDelegate=a,this.serializer=b}allocateTargetId(a){return this.retrieveMetadata(a).next(b=>{let c=new jp(b.highestTargetId);return b.highestTargetId=c.next(),this.saveMetadata(a,b).next(()=>b.highestTargetId)})}getLastRemoteSnapshotVersion(a){return this.retrieveMetadata(a).next(a=>aH.fromTimestamp(new aG(a.lastRemoteSnapshotVersion.seconds,a.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(a){return this.retrieveMetadata(a).next(a=>a.highestListenSequenceNumber)}setTargetsMetadata(a,b,c){return this.retrieveMetadata(a).next(d=>(d.highestListenSequenceNumber=b,c&&(d.lastRemoteSnapshotVersion=c.toTimestamp()),b>d.highestListenSequenceNumber&&(d.highestListenSequenceNumber=b),this.saveMetadata(a,d)))}addTargetData(a,b){return this.saveTargetData(a,b).next(()=>this.retrieveMetadata(a).next(c=>(c.targetCount+=1,this.updateMetadataFromTargetData(b,c),this.saveMetadata(a,c))))}updateTargetData(a,b){return this.saveTargetData(a,b)}removeTargetData(a,b){return this.removeMatchingKeysForTargetId(a,b.targetId).next(()=>jr(a).delete(b.targetId)).next(()=>this.retrieveMetadata(a)).next(b=>(C(b.targetCount>0,8065),b.targetCount-=1,this.saveMetadata(a,b)))}removeTargets(a,b,c){let d=0,e=[];return jr(a).iterate((f,g)=>{let h=hU(g);h.sequenceNumber<=b&&null===c.get(h.targetId)&&(d++,e.push(this.removeTargetData(a,h)))}).next(()=>a$.waitFor(e)).next(()=>d)}forEachTarget(a,b){return jr(a).iterate((a,c)=>{b(hU(c))})}retrieveMetadata(a){return js(a).get(bU).next(a=>(C(null!==a,2888),a))}saveMetadata(a,b){return js(a).put(bU,b)}saveTargetData(a,b){return jr(a).put(hV(this.serializer,b))}updateMetadataFromTargetData(a,b){let c=!1;return a.targetId>b.highestTargetId&&(b.highestTargetId=a.targetId,c=!0),a.sequenceNumber>b.highestListenSequenceNumber&&(b.highestListenSequenceNumber=a.sequenceNumber,c=!0),c}getTargetCount(a){return this.retrieveMetadata(a).next(a=>a.targetCount)}getTargetData(a,b){let c=ew(b),d=IDBKeyRange.bound([c,-1/0],[c,1/0]),e=null;return jr(a).iterate({range:d,index:bO},(a,c,d)=>{let f=hU(c);ey(b,f.target)&&(e=f,d.done())}).next(()=>e)}addMatchingKeys(a,b,c){let d=[],e=jt(a);return b.forEach(b=>{let f=bm(b.path);d.push(e.put({targetId:c,path:f})),d.push(this.referenceDelegate.addReference(a,c,b))}),a$.waitFor(d)}removeMatchingKeys(a,b,c){let d=jt(a);return a$.forEach(b,b=>{let e=bm(b.path);return a$.waitFor([d.delete([c,e]),this.referenceDelegate.removeReference(a,c,b)])})}removeMatchingKeysForTargetId(a,b){let c=jt(a),d=IDBKeyRange.bound([b],[b+1],!1,!0);return c.delete(d)}getMatchingKeysForTargetId(a,b){let c=IDBKeyRange.bound([b],[b+1],!1,!0),d=jt(a),e=fm();return d.iterate({range:c,keysOnly:!0},(a,b,c)=>{let d=new as(bp(a[1]));e=e.add(d)}).next(()=>e)}containsKey(a,b){let c=bm(b.path),d=IDBKeyRange.bound([c],[am(c)],!1,!0),e=0;return jt(a).iterate({index:bS,keysOnly:!0,range:d},([a,b],c,d)=>{0!==a&&(e++,d.done())}).next(()=>e>0)}getTargetDataForTarget(a,b){return jr(a).get(b).next(a=>a?hU(a):null)}}function jr(a){return cw(a,bM)}function js(a){return cw(a,bV)}function jt(a){return cw(a,bQ)}let ju={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},jv=-1,jw=0x2800000;class jx{static withCacheSize(a){return new jx(a,jx.DEFAULT_COLLECTION_PERCENTILE,jx.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(a,b,c){this.cacheSizeCollectionThreshold=a,this.percentileToCollect=b,this.maximumSequenceNumbersToCollect=c}}jx.DEFAULT_COLLECTION_PERCENTILE=10,jx.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,jx.DEFAULT=new jx(jw,jx.DEFAULT_COLLECTION_PERCENTILE,jx.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),jx.DISABLED=new jx(jv,0,0);let jy="LruGarbageCollector",jz=1048576,jA=6e4,jB=3e5;function jC([a,b],[c,d]){let e=ag(a,c);return 0===e?ag(b,d):e}class jD{constructor(a){this.maxElements=a,this.buffer=new cF(jC),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(a){let b=[a,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(b);else{let a=this.buffer.last();0>jC(b,a)&&(this.buffer=this.buffer.delete(a).add(b))}}get maxValue(){return this.buffer.last()[0]}}class jE{constructor(a,b,c){this.garbageCollector=a,this.asyncQueue=b,this.localStore=c,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==jv&&this.scheduleGC(jA)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC(a){w(jy,`Garbage collection scheduled in ${a}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",a,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(a){a6(a)?w(jy,"Ignoring IndexedDB error during garbage collection: ",a):await aZ(a)}await this.scheduleGC(jB)})}}class jF{constructor(a,b){this.delegate=a,this.params=b}calculateTargetCount(a,b){return this.delegate.getSequenceNumberCount(a).next(a=>Math.floor(b/100*a))}nthSequenceNumber(a,b){if(0===b)return a$.resolve(bh.INVALID);let c=new jD(b);return this.delegate.forEachTarget(a,a=>c.addElement(a.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(a,a=>c.addElement(a))).next(()=>c.maxValue)}removeTargets(a,b,c){return this.delegate.removeTargets(a,b,c)}removeOrphanedDocuments(a,b){return this.delegate.removeOrphanedDocuments(a,b)}collect(a,b){return this.params.cacheSizeCollectionThreshold===jv?(w("LruGarbageCollector","Garbage collection skipped; disabled"),a$.resolve(ju)):this.getCacheSize(a).next(c=>c<this.params.cacheSizeCollectionThreshold?(w("LruGarbageCollector",`Garbage collection skipped; Cache size ${c} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ju):this.runGarbageCollection(a,b))}getCacheSize(a){return this.delegate.getCacheSize(a)}runGarbageCollection(a,b){let c,d,e,f,g,h,i,j=Date.now();return this.calculateTargetCount(a,this.params.percentileToCollect).next(b=>(b>this.params.maximumSequenceNumbersToCollect?(w("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${b}`),d=this.params.maximumSequenceNumbersToCollect):d=b,f=Date.now(),this.nthSequenceNumber(a,d))).next(d=>(c=d,g=Date.now(),this.removeTargets(a,c,b))).next(b=>(e=b,h=Date.now(),this.removeOrphanedDocuments(a,c))).next(a=>(i=Date.now(),v()<=l.LogLevel.DEBUG&&w("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${f-j}ms
	Determined least recently used ${d} in ${g-f}ms
	Removed ${e} targets in ${h-g}ms
	Removed ${a} documents in ${i-h}ms
Total Duration: ${i-j}ms`),a$.resolve({didRun:!0,sequenceNumbersCollected:d,targetsRemoved:e,documentsRemoved:a})))}}function jG(a,b){return new jF(a,b)}class jH{constructor(a,b){this.db=a,this.garbageCollector=jG(this,b)}getSequenceNumberCount(a){let b=this.orphanedDocumentCount(a);return this.db.getTargetCache().getTargetCount(a).next(a=>b.next(b=>a+b))}orphanedDocumentCount(a){let b=0;return this.forEachOrphanedDocumentSequenceNumber(a,a=>{b++}).next(()=>b)}forEachTarget(a,b){return this.db.getTargetCache().forEachTarget(a,b)}forEachOrphanedDocumentSequenceNumber(a,b){return this.forEachOrphanedDocument(a,(a,c)=>b(c))}addReference(a,b,c){return jK(a,c)}removeReference(a,b,c){return jK(a,c)}removeTargets(a,b,c){return this.db.getTargetCache().removeTargets(a,b,c)}markPotentiallyOrphaned(a,b){return jK(a,b)}isPinned(a,b){return jk(a,b)}removeOrphanedDocuments(a,b){let c=this.db.getRemoteDocumentCache().newChangeBuffer(),d=[],e=0;return this.forEachOrphanedDocument(a,(f,g)=>{if(g<=b){let b=this.isPinned(a,f).next(b=>{if(!b)return e++,c.getEntry(a,f).next(()=>(c.removeEntry(f,aH.min()),jt(a).delete(jI(f))))});d.push(b)}}).next(()=>a$.waitFor(d)).next(()=>c.apply(a)).next(()=>e)}removeTarget(a,b){let c=b.withSequenceNumber(a.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(a,c)}updateLimboDocument(a,b){return jK(a,b)}forEachOrphanedDocument(a,b){let c,d=jt(a),e=bh.INVALID;return d.iterate({index:bS},([a,d],{path:f,sequenceNumber:g})=>{0===a?(e!==bh.INVALID&&b(new as(bp(c)),e),e=g,c=f):e=bh.INVALID}).next(()=>{e!==bh.INVALID&&b(new as(bp(c)),e)})}getCacheSize(a){return this.db.getRemoteDocumentCache().getSize(a)}}function jI(a){return[0,bm(a.path)]}function jJ(a,b){return{targetId:0,path:bm(a.path),sequenceNumber:b}}function jK(a,b){return jt(a).put(jJ(b,a.currentSequenceNumber))}class jL{constructor(){this.changes=new e9(a=>a.toString(),(a,b)=>a.isEqual(b)),this.changesApplied=!1}addEntry(a){this.assertNotApplied(),this.changes.set(a.key,a)}removeEntry(a,b){this.assertNotApplied(),this.changes.set(a,dY.newInvalidDocument(a).setReadTime(b))}getEntry(a,b){this.assertNotApplied();let c=this.changes.get(b);return void 0!==c?a$.resolve(c):this.getFromCache(a,b)}getEntries(a,b){return this.getAllFromCache(a,b)}apply(a){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(a)}assertNotApplied(){}}class jM{constructor(a){this.serializer=a}setIndexManager(a){this.indexManager=a}addEntry(a,b,c){return jQ(a).put(c)}removeEntry(a,b,c){return jQ(a).delete(jS(b,c))}updateMetadata(a,b){return this.getMetadata(a).next(c=>(c.byteSize+=b,this.setMetadata(a,c)))}getEntry(a,b){let c=dY.newInvalidDocument(b);return jQ(a).iterate({index:bG,range:IDBKeyRange.only(jR(b))},(a,d)=>{c=this.maybeDecodeDocument(b,d)}).next(()=>c)}getSizedEntry(a,b){let c={size:0,document:dY.newInvalidDocument(b)};return jQ(a).iterate({index:bG,range:IDBKeyRange.only(jR(b))},(a,d)=>{c={document:this.maybeDecodeDocument(b,d),size:jh(d)}}).next(()=>c)}getEntries(a,b){let c=fb();return this.forEachDbEntry(a,b,(a,b)=>{let d=this.maybeDecodeDocument(a,b);c=c.insert(a,d)}).next(()=>c)}getSizedEntries(a,b){let c=fb(),d=new cB(as.comparator);return this.forEachDbEntry(a,b,(a,b)=>{let e=this.maybeDecodeDocument(a,b);c=c.insert(a,e),d=d.insert(a,jh(b))}).next(()=>({documents:c,sizeMap:d}))}forEachDbEntry(a,b,c){if(b.isEmpty())return a$.resolve();let d=new cF(jU);b.forEach(a=>d=d.add(a));let e=IDBKeyRange.bound(jR(d.first()),jR(d.last())),f=d.getIterator(),g=f.getNext();return jQ(a).iterate({index:bG,range:e},(a,b,d)=>{let e=as.fromSegments([...b.prefixPath,b.collectionGroup,b.documentId]);for(;g&&0>jU(g,e);)c(g,null),g=f.getNext();g&&g.isEqual(e)&&(c(g,b),g=f.hasNext()?f.getNext():null),g?d.skip(jR(g)):d.done()}).next(()=>{for(;g;)c(g,null),g=f.hasNext()?f.getNext():null})}getDocumentsMatchingQuery(a,b,c,d,e){let f=b.path,g=[f.popLast().toArray(),f.lastSegment(),hO(c.readTime),c.documentKey.path.isEmpty()?"":c.documentKey.path.lastSegment()],h=[f.popLast().toArray(),f.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return jQ(a).loadAll(IDBKeyRange.bound(g,h,!0)).next(a=>{e?.incrementDocumentReadCount(a.length);let c=fb();for(let e of a){let a=this.maybeDecodeDocument(as.fromSegments(e.prefixPath.concat(e.collectionGroup,e.documentId)),e);a.isFoundDocument()&&(e1(b,a)||d.has(a.key))&&(c=c.insert(a.key,a))}return c})}getAllFromCollectionGroup(a,b,c,d){let e=fb(),f=jT(b,c),g=jT(b,aV.max());return jQ(a).iterate({index:bI,range:IDBKeyRange.bound(f,g,!0)},(a,b,c)=>{let f=this.maybeDecodeDocument(as.fromSegments(b.prefixPath.concat(b.collectionGroup,b.documentId)),b);(e=e.insert(f.key,f)).size===d&&c.done()}).next(()=>e)}newChangeBuffer(a){return new jO(this,!!a&&a.trackRemovals)}getSize(a){return this.getMetadata(a).next(a=>a.byteSize)}getMetadata(a){return jP(a).get(bL).next(a=>(C(!!a,20021),a))}setMetadata(a,b){return jP(a).put(bL,b)}maybeDecodeDocument(a,b){if(b){let a=hM(this.serializer,b);if(!(a.isNoDocument()&&a.version.isEqual(aH.min())))return a}return dY.newInvalidDocument(a)}}function jN(a){return new jM(a)}class jO extends jL{constructor(a,b){super(),this.documentCache=a,this.trackRemovals=b,this.documentStates=new e9(a=>a.toString(),(a,b)=>a.isEqual(b))}applyChanges(a){let b=[],c=0,d=new cF((a,b)=>ag(a.canonicalString(),b.canonicalString()));return this.changes.forEach((e,f)=>{let g=this.documentStates.get(e);if(b.push(this.documentCache.removeEntry(a,e,g.readTime)),f.isValidDocument()){let h=hN(this.documentCache.serializer,f);d=d.add(e.path.popLast());let i=jh(h);c+=i-g.size,b.push(this.documentCache.addEntry(a,e,h))}else if(c-=g.size,this.trackRemovals){let c=hN(this.documentCache.serializer,f.convertToNoDocument(aH.min()));b.push(this.documentCache.addEntry(a,e,c))}}),d.forEach(c=>{b.push(this.documentCache.indexManager.addToCollectionParentIndex(a,c))}),b.push(this.documentCache.updateMetadata(a,c)),a$.waitFor(b)}getFromCache(a,b){return this.documentCache.getSizedEntry(a,b).next(a=>(this.documentStates.set(b,{size:a.size,readTime:a.document.readTime}),a.document))}getAllFromCache(a,b){return this.documentCache.getSizedEntries(a,b).next(({documents:a,sizeMap:b})=>(b.forEach((b,c)=>{this.documentStates.set(b,{size:c,readTime:a.get(b).readTime})}),a))}}function jP(a){return cw(a,bK)}function jQ(a){return cw(a,bE)}function jR(a){let b=a.path.toArray();return[b.slice(0,b.length-2),b[b.length-2],b[b.length-1]]}function jS(a,b){let c=a.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],hO(b),c[c.length-1]]}function jT(a,b){let c=b.documentKey.path.toArray();return[a,hO(b.readTime),c.slice(0,c.length-2),c.length>0?c[c.length-1]:""]}function jU(a,b){let c=a.path.toArray(),d=b.path.toArray(),e=0;for(let a=0;a<c.length-2&&a<d.length-2;++a)if(e=ag(c[a],d[a]))return e;return(e=ag(c.length,d.length))||(e=ag(c[c.length-2],d[d.length-2]))?e:ag(c[c.length-1],d[d.length-1])}let jV=18;class jW{constructor(a,b){this.overlayedDocument=a,this.mutatedFields=b}}class jX{constructor(a,b,c,d){this.remoteDocumentCache=a,this.mutationQueue=b,this.documentOverlayCache=c,this.indexManager=d}getDocument(a,b){let c=null;return this.documentOverlayCache.getOverlay(a,b).next(d=>(c=d,this.remoteDocumentCache.getEntry(a,b))).next(a=>(null!==c&&fP(c.mutation,a,cJ.empty(),aG.now()),a))}getDocuments(a,b){return this.remoteDocumentCache.getEntries(a,b).next(b=>this.getLocalViewOfDocuments(a,b,fm()).next(()=>b))}getLocalViewOfDocuments(a,b,c=fm()){let d=fg();return this.populateOverlays(a,d,b).next(()=>this.computeViews(a,b,d,c).next(a=>{let b=fd();return a.forEach((a,c)=>{b=b.insert(a,c.overlayedDocument)}),b}))}getOverlayedDocuments(a,b){let c=fg();return this.populateOverlays(a,c,b).next(()=>this.computeViews(a,b,c,fm()))}populateOverlays(a,b,c){let d=[];return c.forEach(a=>{b.has(a)||d.push(a)}),this.documentOverlayCache.getOverlays(a,d).next(a=>{a.forEach((a,c)=>{b.set(a,c)})})}computeViews(a,b,c,d){let e=fb(),f=fi(),g=fe();return b.forEach((a,b)=>{let g=c.get(b.key);d.has(b.key)&&(void 0===g||g.mutation instanceof fV)?e=e.insert(b.key,b):void 0!==g?(f.set(b.key,g.mutation.getFieldMask()),fP(g.mutation,b,g.mutation.getFieldMask(),aG.now())):f.set(b.key,cJ.empty())}),this.recalculateAndSaveOverlays(a,e).next(a=>(a.forEach((a,b)=>f.set(a,b)),b.forEach((a,b)=>g.set(a,new jW(b,f.get(a)??null))),g))}recalculateAndSaveOverlays(a,b){let c=fi(),d=new cB((a,b)=>a-b),e=fm();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(a,b).next(a=>{for(let e of a)e.keys().forEach(a=>{let f=b.get(a);if(null===f)return;let g=c.get(a)||cJ.empty();g=e.applyToLocalView(f,g),c.set(a,g);let h=(d.get(e.batchId)||fm()).add(a);d=d.insert(e.batchId,h)})}).next(()=>{let f=[],g=d.getReverseIterator();for(;g.hasNext();){let d=g.getNext(),h=d.key,i=d.value,j=fh();i.forEach(a=>{if(!e.has(a)){let d=fN(b.get(a),c.get(a));null!==d&&j.set(a,d),e=e.add(a)}}),f.push(this.documentOverlayCache.saveOverlays(a,h,j))}return a$.waitFor(f)}).next(()=>c)}recalculateAndSaveOverlaysForDocumentKeys(a,b){return this.remoteDocumentCache.getEntries(a,b).next(b=>this.recalculateAndSaveOverlays(a,b))}getDocumentsMatchingQuery(a,b,c,d){return eP(b)?this.getDocumentsMatchingDocumentQuery(a,b.path):eQ(b)?this.getDocumentsMatchingCollectionGroupQuery(a,b,c,d):this.getDocumentsMatchingCollectionQuery(a,b,c,d)}getNextDocuments(a,b,c,d){return this.remoteDocumentCache.getAllFromCollectionGroup(a,b,c,d).next(e=>{let f=d-e.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(a,b,c.largestBatchId,d-e.size):a$.resolve(fg()),g=aI,h=e;return f.next(b=>a$.forEach(b,(b,c)=>(g<c.largestBatchId&&(g=c.largestBatchId),e.get(b))?a$.resolve():this.remoteDocumentCache.getEntry(a,b).next(a=>{h=h.insert(b,a)})).next(()=>this.populateOverlays(a,b,e)).next(()=>this.computeViews(a,h,b,fm())).next(a=>({batchId:g,changes:ff(a)})))})}getDocumentsMatchingDocumentQuery(a,b){return this.getDocument(a,new as(b)).next(a=>{let b=fd();return a.isFoundDocument()&&(b=b.insert(a.key,a)),b})}getDocumentsMatchingCollectionGroupQuery(a,b,c,d){let e=b.collectionGroup,f=fd();return this.indexManager.getCollectionParents(a,e).next(g=>a$.forEach(g,g=>{let h=eM(b,g.child(e));return this.getDocumentsMatchingCollectionQuery(a,h,c,d).next(a=>{a.forEach((a,b)=>{f=f.insert(a,b)})})}).next(()=>f))}getDocumentsMatchingCollectionQuery(a,b,c,d){let e;return this.documentOverlayCache.getOverlaysForCollection(a,b.path,c.largestBatchId).next(f=>(e=f,this.remoteDocumentCache.getDocumentsMatchingQuery(a,b,c,e,d))).next(a=>{e.forEach((b,c)=>{let d=c.getKey();null===a.get(d)&&(a=a.insert(d,dY.newInvalidDocument(d)))});let c=fd();return a.forEach((a,d)=>{let f=e.get(a);void 0!==f&&fP(f.mutation,d,cJ.empty(),aG.now()),e1(b,d)&&(c=c.insert(a,d))}),c})}}class jY{constructor(a){this.serializer=a,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(a,b){return a$.resolve(this.bundles.get(b))}saveBundleMetadata(a,b){return this.bundles.set(b.id,h1(b)),a$.resolve()}getNamedQuery(a,b){return a$.resolve(this.namedQueries.get(b))}saveNamedQuery(a,b){return this.namedQueries.set(b.name,h0(b)),a$.resolve()}}class jZ{constructor(){this.overlays=new cB(as.comparator),this.overlayByBatchId=new Map}getOverlay(a,b){return a$.resolve(this.overlays.get(b))}getOverlays(a,b){let c=fg();return a$.forEach(b,b=>this.getOverlay(a,b).next(a=>{null!==a&&c.set(b,a)})).next(()=>c)}saveOverlays(a,b,c){return c.forEach((c,d)=>{this.saveOverlay(a,b,d)}),a$.resolve()}removeOverlaysForBatchId(a,b,c){let d=this.overlayByBatchId.get(c);return void 0!==d&&(d.forEach(a=>this.overlays=this.overlays.remove(a)),this.overlayByBatchId.delete(c)),a$.resolve()}getOverlaysForCollection(a,b,c){let d=fg(),e=b.length+1,f=new as(b.child("")),g=this.overlays.getIteratorFrom(f);for(;g.hasNext();){let a=g.getNext().value,f=a.getKey();if(!b.isPrefixOf(f.path))break;f.path.length===e&&a.largestBatchId>c&&d.set(a.getKey(),a)}return a$.resolve(d)}getOverlaysForCollectionGroup(a,b,c,d){let e=new cB((a,b)=>a-b),f=this.overlays.getIterator();for(;f.hasNext();){let a=f.getNext().value;if(a.getKey().getCollectionGroup()===b&&a.largestBatchId>c){let b=e.get(a.largestBatchId);null===b&&(b=fg(),e=e.insert(a.largestBatchId,b)),b.set(a.getKey(),a)}}let g=fg(),h=e.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((a,b)=>g.set(a,b)),!(g.size()>=d)););return a$.resolve(g)}saveOverlay(a,b,c){let d=this.overlays.get(c.key);if(null!==d){let a=this.overlayByBatchId.get(d.largestBatchId).delete(c.key);this.overlayByBatchId.set(d.largestBatchId,a)}this.overlays=this.overlays.insert(c.key,new f5(b,c));let e=this.overlayByBatchId.get(b);void 0===e&&(e=fm(),this.overlayByBatchId.set(b,e)),this.overlayByBatchId.set(b,e.add(c.key))}}class j${constructor(){this.sessionToken=cM.EMPTY_BYTE_STRING}getSessionToken(a){return a$.resolve(this.sessionToken)}setSessionToken(a,b){return this.sessionToken=b,a$.resolve()}}class j_{constructor(){this.refsByKey=new cF(j0.compareByKey),this.refsByTarget=new cF(j0.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(a,b){let c=new j0(a,b);this.refsByKey=this.refsByKey.add(c),this.refsByTarget=this.refsByTarget.add(c)}addReferences(a,b){a.forEach(a=>this.addReference(a,b))}removeReference(a,b){this.removeRef(new j0(a,b))}removeReferences(a,b){a.forEach(a=>this.removeReference(a,b))}removeReferencesForId(a){let b=new as(new ap([])),c=new j0(b,a),d=new j0(b,a+1),e=[];return this.refsByTarget.forEachInRange([c,d],a=>{this.removeRef(a),e.push(a.key)}),e}removeAllReferences(){this.refsByKey.forEach(a=>this.removeRef(a))}removeRef(a){this.refsByKey=this.refsByKey.delete(a),this.refsByTarget=this.refsByTarget.delete(a)}referencesForId(a){let b=new as(new ap([])),c=new j0(b,a),d=new j0(b,a+1),e=fm();return this.refsByTarget.forEachInRange([c,d],a=>{e=e.add(a.key)}),e}containsKey(a){let b=new j0(a,0),c=this.refsByKey.firstAfterOrEqual(b);return null!==c&&a.isEqual(c.key)}}class j0{constructor(a,b){this.key=a,this.targetOrBatchId=b}static compareByKey(a,b){return as.comparator(a.key,b.key)||ag(a.targetOrBatchId,b.targetOrBatchId)}static compareByTargetId(a,b){return ag(a.targetOrBatchId,b.targetOrBatchId)||as.comparator(a.key,b.key)}}class j1{constructor(a,b){this.indexManager=a,this.referenceDelegate=b,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new cF(j0.compareByKey)}checkEmpty(a){return a$.resolve(0===this.mutationQueue.length)}addMutationBatch(a,b,c,d){let e=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let f=new f3(e,b,c,d);for(let b of(this.mutationQueue.push(f),d))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new j0(b.key,e)),this.indexManager.addToCollectionParentIndex(a,b.key.path.popLast());return a$.resolve(f)}lookupMutationBatch(a,b){return a$.resolve(this.findMutationBatch(b))}getNextMutationBatchAfterBatchId(a,b){let c=b+1,d=this.indexOfBatchId(c),e=d<0?0:d;return a$.resolve(this.mutationQueue.length>e?this.mutationQueue[e]:null)}getHighestUnacknowledgedBatchId(){return a$.resolve(0===this.mutationQueue.length?c3:this.nextBatchId-1)}getAllMutationBatches(a){return a$.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(a,b){let c=new j0(b,0),d=new j0(b,1/0),e=[];return this.batchesByDocumentKey.forEachInRange([c,d],a=>{let b=this.findMutationBatch(a.targetOrBatchId);e.push(b)}),a$.resolve(e)}getAllMutationBatchesAffectingDocumentKeys(a,b){let c=new cF(ag);return b.forEach(a=>{let b=new j0(a,0),d=new j0(a,1/0);this.batchesByDocumentKey.forEachInRange([b,d],a=>{c=c.add(a.targetOrBatchId)})}),a$.resolve(this.findMutationBatches(c))}getAllMutationBatchesAffectingQuery(a,b){let c=b.path,d=c.length+1,e=c;as.isDocumentKey(e)||(e=e.child(""));let f=new j0(new as(e),0),g=new cF(ag);return this.batchesByDocumentKey.forEachWhile(a=>{let b=a.key.path;return!!c.isPrefixOf(b)&&(b.length===d&&(g=g.add(a.targetOrBatchId)),!0)},f),a$.resolve(this.findMutationBatches(g))}findMutationBatches(a){let b=[];return a.forEach(a=>{let c=this.findMutationBatch(a);null!==c&&b.push(c)}),b}removeMutationBatch(a,b){C(0===this.indexOfExistingBatchId(b.batchId,"removed"),55003),this.mutationQueue.shift();let c=this.batchesByDocumentKey;return a$.forEach(b.mutations,d=>{let e=new j0(d.key,b.batchId);return c=c.delete(e),this.referenceDelegate.markPotentiallyOrphaned(a,d.key)}).next(()=>{this.batchesByDocumentKey=c})}removeCachedMutationKeys(a){}containsKey(a,b){let c=new j0(b,0),d=this.batchesByDocumentKey.firstAfterOrEqual(c);return a$.resolve(b.isEqual(d&&d.key))}performConsistencyCheck(a){return this.mutationQueue.length,a$.resolve()}indexOfExistingBatchId(a,b){return this.indexOfBatchId(a)}indexOfBatchId(a){return 0===this.mutationQueue.length?0:a-this.mutationQueue[0].batchId}findMutationBatch(a){let b=this.indexOfBatchId(a);return b<0||b>=this.mutationQueue.length?null:this.mutationQueue[b]}}let j2="-9223372036854775808";function j3(){return new cB(as.comparator)}class j4{constructor(a){this.sizer=a,this.docs=j3(),this.size=0}setIndexManager(a){this.indexManager=a}addEntry(a,b){let c=b.key,d=this.docs.get(c),e=d?d.size:0,f=this.sizer(b);return this.docs=this.docs.insert(c,{document:b.mutableCopy(),size:f}),this.size+=f-e,this.indexManager.addToCollectionParentIndex(a,c.path.popLast())}removeEntry(a){let b=this.docs.get(a);b&&(this.docs=this.docs.remove(a),this.size-=b.size)}getEntry(a,b){let c=this.docs.get(b);return a$.resolve(c?c.document.mutableCopy():dY.newInvalidDocument(b))}getEntries(a,b){let c=fb();return b.forEach(a=>{let b=this.docs.get(a);c=c.insert(a,b?b.document.mutableCopy():dY.newInvalidDocument(a))}),a$.resolve(c)}getDocumentsMatchingQuery(a,b,c,d){let e=fb(),f=b.path,g=new as(f.child("__id"+j2+"__")),h=this.docs.getIteratorFrom(g);for(;h.hasNext();){let{key:a,value:{document:g}}=h.getNext();if(!f.isPrefixOf(a.path))break;!(a.path.length>f.length+1||0>=aW(aU(g),c))&&(d.has(g.key)||e1(b,g))&&(e=e.insert(g.key,g.mutableCopy()))}return a$.resolve(e)}getAllFromCollectionGroup(a,b,c,d){A(9500)}forEachDocumentKey(a,b){return a$.forEach(this.docs,a=>b(a))}newChangeBuffer(a){return new j6(this)}getSize(a){return a$.resolve(this.size)}}function j5(a){return new j4(a)}class j6 extends jL{constructor(a){super(),this.documentCache=a}applyChanges(a){let b=[];return this.changes.forEach((c,d)=>{d.isValidDocument()?b.push(this.documentCache.addEntry(a,d)):this.documentCache.removeEntry(c)}),a$.waitFor(b)}getFromCache(a,b){return this.documentCache.getEntry(a,b)}getAllFromCache(a,b){return this.documentCache.getEntries(a,b)}}class j7{constructor(a){this.persistence=a,this.targets=new e9(a=>ew(a),ey),this.lastRemoteSnapshotVersion=aH.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new j_,this.targetCount=0,this.targetIdGenerator=jp.forTargetCache()}forEachTarget(a,b){return this.targets.forEach((a,c)=>b(c)),a$.resolve()}getLastRemoteSnapshotVersion(a){return a$.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(a){return a$.resolve(this.highestSequenceNumber)}allocateTargetId(a){return this.highestTargetId=this.targetIdGenerator.next(),a$.resolve(this.highestTargetId)}setTargetsMetadata(a,b,c){return c&&(this.lastRemoteSnapshotVersion=c),b>this.highestSequenceNumber&&(this.highestSequenceNumber=b),a$.resolve()}saveTargetData(a){this.targets.set(a.target,a);let b=a.targetId;b>this.highestTargetId&&(this.targetIdGenerator=new jp(b),this.highestTargetId=b),a.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=a.sequenceNumber)}addTargetData(a,b){return this.saveTargetData(b),this.targetCount+=1,a$.resolve()}updateTargetData(a,b){return this.saveTargetData(b),a$.resolve()}removeTargetData(a,b){return this.targets.delete(b.target),this.references.removeReferencesForId(b.targetId),this.targetCount-=1,a$.resolve()}removeTargets(a,b,c){let d=0,e=[];return this.targets.forEach((f,g)=>{g.sequenceNumber<=b&&null===c.get(g.targetId)&&(this.targets.delete(f),e.push(this.removeMatchingKeysForTargetId(a,g.targetId)),d++)}),a$.waitFor(e).next(()=>d)}getTargetCount(a){return a$.resolve(this.targetCount)}getTargetData(a,b){let c=this.targets.get(b)||null;return a$.resolve(c)}addMatchingKeys(a,b,c){return this.references.addReferences(b,c),a$.resolve()}removeMatchingKeys(a,b,c){this.references.removeReferences(b,c);let d=this.persistence.referenceDelegate,e=[];return d&&b.forEach(b=>{e.push(d.markPotentiallyOrphaned(a,b))}),a$.waitFor(e)}removeMatchingKeysForTargetId(a,b){return this.references.removeReferencesForId(b),a$.resolve()}getMatchingKeysForTargetId(a,b){let c=this.references.referencesForId(b);return a$.resolve(c)}containsKey(a,b){return a$.resolve(this.references.containsKey(b))}}let j8="MemoryPersistence";class j9{constructor(a,b){this.mutationQueues={},this.overlays={},this.listenSequence=new bh(0),this._started=!1,this._started=!0,this.globalsCache=new j$,this.referenceDelegate=a(this),this.targetCache=new j7(this);const c=a=>this.referenceDelegate.documentSize(a);this.indexManager=new i6,this.remoteDocumentCache=j5(c),this.serializer=new hL(b),this.bundleCache=new jY(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(a){return this.indexManager}getDocumentOverlayCache(a){let b=this.overlays[a.toKey()];return b||(b=new jZ,this.overlays[a.toKey()]=b),b}getMutationQueue(a,b){let c=this.mutationQueues[a.toKey()];return c||(c=new j1(b,this.referenceDelegate),this.mutationQueues[a.toKey()]=c),c}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(a,b,c){w(j8,"Starting transaction:",a);let d=new ka(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),c(d).next(a=>this.referenceDelegate.onTransactionCommitted(d).next(()=>a)).toPromise().then(a=>(d.raiseOnCommittedEvent(),a))}mutationQueuesContainKey(a,b){return a$.or(Object.values(this.mutationQueues).map(c=>()=>c.containsKey(a,b)))}}class ka extends aY{constructor(a){super(),this.currentSequenceNumber=a}}class kb{constructor(a){this.persistence=a,this.localViewReferences=new j_,this._orphanedDocuments=null}static factory(a){return new kb(a)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw A(60996)}addReference(a,b,c){return this.localViewReferences.addReference(c,b),this.orphanedDocuments.delete(c.toString()),a$.resolve()}removeReference(a,b,c){return this.localViewReferences.removeReference(c,b),this.orphanedDocuments.add(c.toString()),a$.resolve()}markPotentiallyOrphaned(a,b){return this.orphanedDocuments.add(b.toString()),a$.resolve()}removeTarget(a,b){this.localViewReferences.removeReferencesForId(b.targetId).forEach(a=>this.orphanedDocuments.add(a.toString()));let c=this.persistence.getTargetCache();return c.getMatchingKeysForTargetId(a,b.targetId).next(a=>{a.forEach(a=>this.orphanedDocuments.add(a.toString()))}).next(()=>c.removeTargetData(a,b))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(a){let b=this.persistence.getRemoteDocumentCache().newChangeBuffer();return a$.forEach(this.orphanedDocuments,c=>{let d=as.fromPath(c);return this.isReferenced(a,d).next(a=>{a||b.removeEntry(d,aH.min())})}).next(()=>(this._orphanedDocuments=null,b.apply(a)))}updateLimboDocument(a,b){return this.isReferenced(a,b).next(a=>{a?this.orphanedDocuments.delete(b.toString()):this.orphanedDocuments.add(b.toString())})}documentSize(a){return 0}isReferenced(a,b){return a$.or([()=>a$.resolve(this.localViewReferences.containsKey(b)),()=>this.persistence.getTargetCache().containsKey(a,b),()=>this.persistence.mutationQueuesContainKey(a,b)])}}class kc{constructor(a,b){this.persistence=a,this.orphanedSequenceNumbers=new e9(a=>bm(a.path),(a,b)=>a.isEqual(b)),this.garbageCollector=jG(this,b)}static factory(a,b){return new kc(a,b)}onTransactionStarted(){}onTransactionCommitted(a){return a$.resolve()}forEachTarget(a,b){return this.persistence.getTargetCache().forEachTarget(a,b)}getSequenceNumberCount(a){let b=this.orphanedDocumentCount(a);return this.persistence.getTargetCache().getTargetCount(a).next(a=>b.next(b=>a+b))}orphanedDocumentCount(a){let b=0;return this.forEachOrphanedDocumentSequenceNumber(a,a=>{b++}).next(()=>b)}forEachOrphanedDocumentSequenceNumber(a,b){return a$.forEach(this.orphanedSequenceNumbers,(c,d)=>this.isPinned(a,c,d).next(a=>a?a$.resolve():b(d)))}removeTargets(a,b,c){return this.persistence.getTargetCache().removeTargets(a,b,c)}removeOrphanedDocuments(a,b){let c=0,d=this.persistence.getRemoteDocumentCache(),e=d.newChangeBuffer();return d.forEachDocumentKey(a,d=>this.isPinned(a,d,b).next(a=>{a||(c++,e.removeEntry(d,aH.min()))})).next(()=>e.apply(a)).next(()=>c)}markPotentiallyOrphaned(a,b){return this.orphanedSequenceNumbers.set(b,a.currentSequenceNumber),a$.resolve()}removeTarget(a,b){let c=b.withSequenceNumber(a.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(a,c)}addReference(a,b,c){return this.orphanedSequenceNumbers.set(c,a.currentSequenceNumber),a$.resolve()}removeReference(a,b,c){return this.orphanedSequenceNumbers.set(c,a.currentSequenceNumber),a$.resolve()}updateLimboDocument(a,b){return this.orphanedSequenceNumbers.set(b,a.currentSequenceNumber),a$.resolve()}documentSize(a){let b=a.key.toString().length;return a.isFoundDocument()&&(b+=dD(a.data.value)),b}isPinned(a,b,c){return a$.or([()=>this.persistence.mutationQueuesContainKey(a,b),()=>this.persistence.getTargetCache().containsKey(a,b),()=>{let a=this.orphanedSequenceNumbers.get(b);return a$.resolve(void 0!==a&&a>c)}])}getCacheSize(a){return this.persistence.getRemoteDocumentCache().getSize(a)}}class kd{constructor(a){this.serializer=a}createOrUpgrade(a,b,c,d){let e=new a1("createOrUpgrade",b);c<1&&d>=1&&(kf(a),kg(a),kl(a),ki(a));let f=a$.resolve();return c<3&&d>=3&&(0!==c&&(km(a),kl(a)),f=f.next(()=>ko(e))),c<4&&d>=4&&(0!==c&&(f=f.next(()=>kh(a,e))),f=f.next(()=>{kp(a)})),c<5&&d>=5&&(f=f.next(()=>this.removeAcknowledgedMutations(e))),c<6&&d>=6&&(f=f.next(()=>(kk(a),this.addDocumentGlobal(e)))),c<7&&d>=7&&(f=f.next(()=>this.ensureSequenceNumbers(e))),c<8&&d>=8&&(f=f.next(()=>this.createCollectionParentIndex(a,e))),c<9&&d>=9&&(f=f.next(()=>{kn(a)})),c<10&&d>=10&&(f=f.next(()=>this.rewriteCanonicalIds(e))),c<11&&d>=11&&(f=f.next(()=>{kq(a),kr(a)})),c<12&&d>=12&&(f=f.next(()=>{kt(a)})),c<13&&d>=13&&(f=f.next(()=>kj(a)).next(()=>this.rewriteRemoteDocumentCache(a,e)).next(()=>a.deleteObjectStore(bq))),c<14&&d>=14&&(f=f.next(()=>this.runOverlayMigration(a,e))),c<15&&d>=15&&(f=f.next(()=>ks(a))),c<16&&d>=16&&(f=f.next(()=>{b.objectStore(b6).clear()}).next(()=>{b.objectStore(ca).clear()})),c<17&&d>=17&&(f=f.next(()=>{ku(a)})),c<18&&d>=18&&(0,i.isSafariOrWebkit)()&&(f=f.next(()=>{b.objectStore(b6).clear()}).next(()=>{b.objectStore(ca).clear()})),f}addDocumentGlobal(a){let b=0;return a.store(bq).iterate((a,c)=>{b+=jh(c)}).next(()=>{let c={byteSize:b};return a.store(bK).put(bL,c)})}removeAcknowledgedMutations(a){let b=a.store(bt),c=a.store(bv);return b.loadAll().next(b=>a$.forEach(b,b=>{let d=IDBKeyRange.bound([b.userId,c3],[b.userId,b.lastAcknowledgedBatchId]);return c.loadAll(bx,d).next(c=>a$.forEach(c,c=>{C(c.userId===b.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});let d=hT(this.serializer,c);return jg(a,b.userId,d).next(()=>{})}))}))}ensureSequenceNumbers(a){let b=a.store(bQ),c=a.store(bq);return a.store(bV).get(bU).next(a=>{let d=c=>b.put({targetId:0,path:bm(c),sequenceNumber:a.highestListenSequenceNumber}),e=[];return c.iterate((a,c)=>{let f=new ap(a),g=ke(f);e.push(b.get(g).next(a=>a?a$.resolve():d(f)))}).next(()=>a$.waitFor(e))})}createCollectionParentIndex(a,b){a.createObjectStore(bW,{keyPath:bX});let c=b.store(bW),d=new i7,e=a=>{if(d.add(a)){let b=a.lastSegment(),d=a.popLast();return c.put({collectionId:b,parent:bm(d)})}};return b.store(bq).iterate({keysOnly:!0},(a,b)=>e(new ap(a).popLast())).next(()=>b.store(bD).iterate({keysOnly:!0},([a,b,c],d)=>e(bp(b).popLast())))}rewriteCanonicalIds(a){let b=a.store(bM);return b.iterate((a,c)=>{let d=hU(c),e=hV(this.serializer,d);return b.put(e)})}rewriteRemoteDocumentCache(a,b){let c=b.store(bq),d=[];return c.iterate((a,c)=>{let e=b.store(bE),f=kv(c).path.toArray(),g={prefixPath:f.slice(0,f.length-2),collectionGroup:f[f.length-2],documentId:f[f.length-1],readTime:c.readTime||[0,0],unknownDocument:c.unknownDocument,noDocument:c.noDocument,document:c.document,hasCommittedMutations:!!c.hasCommittedMutations};d.push(e.put(g))}).next(()=>a$.waitFor(d))}runOverlayMigration(a,b){let c=b.store(bv),d=jN(this.serializer),e=new j9(kb.factory,this.serializer.remoteSerializer);return c.loadAll().next(a=>{let c=new Map;return a.forEach(a=>{let b=c.get(a.userId)??fm();hT(this.serializer,a).keys().forEach(a=>b=b.add(a)),c.set(a.userId,b)}),a$.forEach(c,(a,c)=>{let f=new q(c),g=ib.forUser(this.serializer,f),h=e.getIndexManager(f);return new jX(d,ji.forUser(f,this.serializer,h,e.referenceDelegate),g,h).recalculateAndSaveOverlaysForDocumentKeys(new cv(b,bh.INVALID),a).next()})})}}function ke(a){return[0,bm(a)]}function kf(a){a.createObjectStore(br)}function kg(a){a.createObjectStore(bt,{keyPath:bu}),a.createObjectStore(bv,{keyPath:bw,autoIncrement:!0}).createIndex(bx,by,{unique:!0}),a.createObjectStore(bD)}function kh(a,b){return b.store(bv).loadAll().next(c=>{a.deleteObjectStore(bv),a.createObjectStore(bv,{keyPath:bw,autoIncrement:!0}).createIndex(bx,by,{unique:!0});let d=b.store(bv),e=c.map(a=>d.put(a));return a$.waitFor(e)})}function ki(a){a.createObjectStore(bq)}function kj(a){let b=a.createObjectStore(bE,{keyPath:bF});b.createIndex(bG,bH),b.createIndex(bI,bJ)}function kk(a){a.createObjectStore(bK)}function kl(a){a.createObjectStore(bQ,{keyPath:bR}).createIndex(bS,bT,{unique:!0}),a.createObjectStore(bM,{keyPath:bN}).createIndex(bO,bP,{unique:!0}),a.createObjectStore(bV)}function km(a){a.deleteObjectStore(bQ),a.deleteObjectStore(bM),a.deleteObjectStore(bV)}function kn(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")}function ko(a){let b=a.store(bV),c={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:aH.min().toTimestamp(),targetCount:0};return b.put(bU,c)}function kp(a){a.createObjectStore(bY,{keyPath:bZ})}function kq(a){a.createObjectStore(b$,{keyPath:b_})}function kr(a){a.createObjectStore(b0,{keyPath:b1})}function ks(a){a.createObjectStore(b2,{keyPath:b3,autoIncrement:!0}).createIndex(b4,b5,{unique:!1}),a.createObjectStore(b6,{keyPath:b7}).createIndex(b8,b9,{unique:!1}),a.createObjectStore(ca,{keyPath:cb}).createIndex(cc,cd,{unique:!1})}function kt(a){let b=a.createObjectStore(ce,{keyPath:cf});b.createIndex(cg,ch,{unique:!1}),b.createIndex(ci,cj,{unique:!1})}function ku(a){a.createObjectStore(ck,{keyPath:cl})}function kv(a){return a.document?new as(ap.fromString(a.document.name).popFirst(5)):a.noDocument?as.fromSegments(a.noDocument.path):a.unknownDocument?as.fromSegments(a.unknownDocument.path):A(36783)}let kw="IndexedDbPersistence",kx=18e5,ky=5e3,kz=4e3,kA="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",kB="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",kC="firestore_zombie",kD="main";class kE{constructor(a,b,c,d,e,f,g,h,i,j,k=jV){if(this.allowTabSynchronization=a,this.persistenceKey=b,this.clientId=c,this.queue=e,this.window=f,this.document=g,this.sequenceNumberSyncer=i,this.forceOwningTab=j,this.schemaVersion=k,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=-1/0,this.primaryStateListener=a=>Promise.resolve(),!kE.isAvailable())throw new V(R,kB);this.referenceDelegate=new jH(this,d),this.dbName=b+kD,this.serializer=new hL(h),this.simpleDb=new a2(this.dbName,this.schemaVersion,new kd(this.serializer)),this.globalsCache=new id,this.targetCache=new jq(this.referenceDelegate,this.serializer),this.remoteDocumentCache=jN(this.serializer),this.bundleCache=new h8,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===j&&x(kw,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new V(O,kA);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",a=>this.targetCache.getHighestSequenceNumber(a))}).then(a=>{this.listenSequence=new bh(a,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(a=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(a)))}setPrimaryStateListener(a){return this.primaryStateListener=async b=>{if(this.started)return a(b)},a(this.isPrimary)}setDatabaseDeletedListener(a){this.simpleDb.setVersionChangeListener(async b=>{null===b.newVersion&&await a()})}setNetworkEnabled(a){this.networkEnabled!==a&&(this.networkEnabled=a,this.queue.enqueueAndForget(async()=>{this.started&&await this.updateClientMetadataAndTryBecomePrimary()}))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",a=>kG(a).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(a).next(a=>{a||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(a)).next(b=>this.isPrimary&&!b?this.releasePrimaryLeaseIfHeld(a).next(()=>!1):!!b&&this.acquireOrExtendPrimaryLease(a).next(()=>!0))).catch(a=>{if(a6(a))return w(kw,"Failed to extend owner lease: ",a),this.isPrimary;if(!this.allowTabSynchronization)throw a;return w(kw,"Releasing owner lease after error during lease refresh",a),!1}).then(a=>{this.isPrimary!==a&&this.queue.enqueueRetryable(()=>this.primaryStateListener(a)),this.isPrimary=a})}verifyPrimaryLease(a){return kF(a).get(bs).next(a=>a$.resolve(this.isLocalClient(a)))}removeClientMetadata(a){return kG(a).delete(this.clientId)}async maybeGarbageCollectMultiClientState(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,kx)){this.lastGarbageCollectionTime=Date.now();let a=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",a=>{let b=cw(a,bY);return b.loadAll().next(a=>{let c=this.filterActiveClients(a,kx),d=a.filter(a=>-1===c.indexOf(a));return a$.forEach(d,a=>b.delete(a.clientId)).next(()=>d)})}).catch(()=>[]);if(this.webStorage)for(let b of a)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(b.clientId))}}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",kz,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(a){return!!a&&a.ownerId===this.clientId}canActAsPrimary(a){return this.forceOwningTab?a$.resolve(!0):kF(a).get(bs).next(b=>{if(null!==b&&this.isWithinAge(b.leaseTimestampMs,ky)&&!this.isClientZombied(b.ownerId)){if(this.isLocalClient(b)&&this.networkEnabled)return!0;if(!this.isLocalClient(b)){if(!b.allowTabSynchronization)throw new V(O,kA);return!1}}return!!this.networkEnabled&&!!this.inForeground||kG(a).loadAll().next(a=>void 0===this.filterActiveClients(a,ky).find(a=>{if(this.clientId!==a.clientId){let b=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,d=this.networkEnabled===a.networkEnabled;if(b||c&&d)return!0}return!1}))}).next(a=>(this.isPrimary!==a&&w(kw,`Client ${a?"is":"is not"} eligible for a primary lease.`),a))}async shutdown(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),await this.simpleDb.runTransaction("shutdown","readwrite",[br,bY],a=>{let b=new cv(a,bh.INVALID);return this.releasePrimaryLeaseIfHeld(b).next(()=>this.removeClientMetadata(b))}),this.simpleDb.close(),this.removeClientZombiedEntry()}filterActiveClients(a,b){return a.filter(a=>this.isWithinAge(a.updateTimeMs,b)&&!this.isClientZombied(a.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",a=>kG(a).loadAll().next(a=>this.filterActiveClients(a,kx).map(a=>a.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(a,b){return ji.forUser(a,this.serializer,b,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(a){return new ja(a,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(a){return ib.forUser(this.serializer,a)}getBundleCache(){return this.bundleCache}runTransaction(a,b,c){let d;w(kw,"Starting transaction:",a);let e="readonly"===b?"readonly":"readwrite",f=cu(this.schemaVersion);return this.simpleDb.runTransaction(a,e,f,e=>(d=new cv(e,this.listenSequence?this.listenSequence.next():bh.INVALID),"readwrite-primary"===b)?this.verifyPrimaryLease(d).next(a=>!!a||this.canActAsPrimary(d)).next(b=>{if(!b)throw x(`Failed to obtain primary lease for action '${a}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new V(O,aX);return c(d)}).next(a=>this.acquireOrExtendPrimaryLease(d).next(()=>a)):this.verifyAllowTabSynchronization(d).next(()=>c(d))).then(a=>(d.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(a){return kF(a).get(bs).next(a=>{if(null!==a&&this.isWithinAge(a.leaseTimestampMs,ky)&&!this.isClientZombied(a.ownerId)&&!this.isLocalClient(a)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!a.allowTabSynchronization))throw new V(O,kA)})}acquireOrExtendPrimaryLease(a){let b={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return kF(a).put(bs,b)}static isAvailable(){return a2.isAvailable()}releasePrimaryLeaseIfHeld(a){let b=kF(a);return b.get(bs).next(a=>this.isLocalClient(a)?(w(kw,"Releasing primary lease."),b.delete(bs)):a$.resolve())}isWithinAge(a,b){let c=Date.now(),d=c-b,e=c;return!(a<d)&&(!(a>e)||(x(`Detected an update time that is in the future: ${a} > ${e}`),!1))}attachVisibilityHandler(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){"function"==typeof this.window?.addEventListener&&(this.windowUnloadHandler=()=>{this.markClientZombied();let a=/(?:Version|Mobile)\/1[456]/;(0,i.isSafari)()&&(navigator.appVersion.match(a)||navigator.userAgent.match(a))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(a){try{let b=this.webStorage?.getItem(this.zombiedClientLocalStorageKey(a))!==null;return w(kw,`Client '${a}' ${b?"is":"is not"} zombied in LocalStorage`),b}catch(a){return x(kw,"Failed to get zombied client id.",a),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(a){x("Failed to set zombie client id.",a)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(a){}}zombiedClientLocalStorageKey(a){return`${kC}_${this.persistenceKey}_${a}`}}function kF(a){return cw(a,br)}function kG(a){return cw(a,bY)}function kH(a,b){let c=a.projectId;return a.isDefaultDatabase||(c+="."+a.database),"firestore/"+b+"/"+c+"/"}function kI(a,b,c,d,e){b=[...b],(a=[...a]).sort(c),b.sort(c);let f=a.length,g=b.length,h=0,i=0;for(;h<g&&i<f;){let f=c(a[i],b[h]);f<0?e(a[i++]):f>0?d(b[h++]):(h++,i++)}for(;h<g;)d(b[h++]);for(;i<f;)e(a[i++])}function kJ(a,b){if(a.length!==b.length)return!1;for(let c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0}let kK="LocalStore",kL=3e8;class kM{constructor(a,b,c,d){this.persistence=a,this.queryEngine=b,this.serializer=d,this.targetDataByTarget=new cB(ag),this.targetIdByTarget=new e9(a=>ew(a),ey),this.collectionGroupReadTime=new Map,this.remoteDocuments=a.getRemoteDocumentCache(),this.targetCache=a.getTargetCache(),this.bundleCache=a.getBundleCache(),this.initializeUserComponents(c)}initializeUserComponents(a){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(a),this.indexManager=this.persistence.getIndexManager(a),this.mutationQueue=this.persistence.getMutationQueue(a,this.indexManager),this.localDocuments=new jX(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(a){return this.persistence.runTransaction("Collect garbage","readwrite-primary",b=>a.collect(b,this.targetDataByTarget))}}function kN(a,b,c,d){return new kM(a,b,c,d)}async function kO(a,b){let c=D(a);return await c.persistence.runTransaction("Handle user change","readonly",a=>{let d;return c.mutationQueue.getAllMutationBatches(a).next(e=>(d=e,c.initializeUserComponents(b),c.mutationQueue.getAllMutationBatches(a))).next(b=>{let e=[],f=[],g=fm();for(let a of d)for(let b of(e.push(a.batchId),a.mutations))g=g.add(b.key);for(let a of b)for(let b of(f.push(a.batchId),a.mutations))g=g.add(b.key);return c.localDocuments.getDocuments(a,g).next(a=>({affectedDocuments:a,removedBatchIds:e,addedBatchIds:f}))})})}function kP(a,b){let c,d,e=D(a),f=aG.now(),g=b.reduce((a,b)=>a.add(b.key),fm());return e.persistence.runTransaction("Locally write mutations","readwrite",a=>{let h=fb(),i=fm();return e.remoteDocuments.getEntries(a,g).next(a=>{(h=a).forEach((a,b)=>{b.isValidDocument()||(i=i.add(a))})}).next(()=>e.localDocuments.getOverlayedDocuments(a,h)).next(d=>{c=d;let g=[];for(let a of b){let b=fQ(a,c.get(a.key).overlayedDocument);null!=b&&g.push(new fV(a.key,b,dX(b.value.mapValue),fK.exists(!0)))}return e.mutationQueue.addMutationBatch(a,f,g,b)}).next(b=>{d=b;let f=b.applyToLocalDocumentSet(c,i);return e.documentOverlayCache.saveOverlays(a,b.batchId,f)})}).then(()=>({batchId:d.batchId,changes:ff(c)}))}function kQ(a,b){let c=D(a);return c.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{let d=b.batch.keys(),e=c.remoteDocuments.newChangeBuffer({trackRemovals:!0});return k2(c,a,b,e).next(()=>e.apply(a)).next(()=>c.mutationQueue.performConsistencyCheck(a)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(a,d,b.batch.batchId)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,kR(b))).next(()=>c.localDocuments.getDocuments(a,d))})}function kR(a){let b=fm();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(b=b.add(a.batch.mutations[c].key));return b}function kS(a,b){let c=D(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",a=>{let d;return c.mutationQueue.lookupMutationBatch(a,b).next(b=>(C(null!==b,37113),d=b.keys(),c.mutationQueue.removeMutationBatch(a,b))).next(()=>c.mutationQueue.performConsistencyCheck(a)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(a,d,b)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,d)).next(()=>c.localDocuments.getDocuments(a,d))})}function kT(a){let b=D(a);return b.persistence.runTransaction("Get last remote snapshot version","readonly",a=>b.targetCache.getLastRemoteSnapshotVersion(a))}function kU(a,b){let c=D(a),d=b.snapshotVersion,e=c.targetDataByTarget;return c.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{let f=c.remoteDocuments.newChangeBuffer({trackRemovals:!0});e=c.targetDataByTarget;let g=[];b.targetChanges.forEach((f,h)=>{let i=e.get(h);if(!i)return;g.push(c.targetCache.removeMatchingKeys(a,f.removedDocuments,h).next(()=>c.targetCache.addMatchingKeys(a,f.addedDocuments,h)));let j=i.withSequenceNumber(a.currentSequenceNumber);null!==b.targetMismatches.get(h)?j=j.withResumeToken(cM.EMPTY_BYTE_STRING,aH.min()).withLastLimboFreeSnapshotVersion(aH.min()):f.resumeToken.approximateByteSize()>0&&(j=j.withResumeToken(f.resumeToken,d)),e=e.insert(h,j),kW(i,j,f)&&g.push(c.targetCache.updateTargetData(a,j))});let h=fb(),i=fm();if(b.documentUpdates.forEach(d=>{b.resolvedLimboDocuments.has(d)&&g.push(c.persistence.referenceDelegate.updateLimboDocument(a,d))}),g.push(kV(a,f,b.documentUpdates).next(a=>{h=a.changedDocuments,i=a.existenceChangedKeys})),!d.isEqual(aH.min())){let b=c.targetCache.getLastRemoteSnapshotVersion(a).next(b=>c.targetCache.setTargetsMetadata(a,a.currentSequenceNumber,d));g.push(b)}return a$.waitFor(g).next(()=>f.apply(a)).next(()=>c.localDocuments.getLocalViewOfDocuments(a,h,i)).next(()=>h)}).then(a=>(c.targetDataByTarget=e,a))}function kV(a,b,c){let d=fm(),e=fm();return c.forEach(a=>d=d.add(a)),b.getEntries(a,d).next(a=>{let d=fb();return c.forEach((c,f)=>{let g=a.get(c);f.isFoundDocument()!==g.isFoundDocument()&&(e=e.add(c)),f.isNoDocument()&&f.version.isEqual(aH.min())?(b.removeEntry(c,f.readTime),d=d.insert(c,f)):!g.isValidDocument()||f.version.compareTo(g.version)>0||0===f.version.compareTo(g.version)&&g.hasPendingWrites?(b.addEntry(f),d=d.insert(c,f)):w(kK,"Ignoring outdated watch update for ",c,". Current version:",g.version," Watch version:",f.version)}),{changedDocuments:d,existenceChangedKeys:e}})}function kW(a,b,c){return!!(0===a.resumeToken.approximateByteSize()||b.snapshotVersion.toMicroseconds()-a.snapshotVersion.toMicroseconds()>=kL)||c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size>0}async function kX(a,b){let c=D(a);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",a=>a$.forEach(b,b=>a$.forEach(b.addedKeys,d=>c.persistence.referenceDelegate.addReference(a,b.targetId,d)).next(()=>a$.forEach(b.removedKeys,d=>c.persistence.referenceDelegate.removeReference(a,b.targetId,d)))))}catch(a){if(a6(a))w(kK,"Failed to update sequence numbers: "+a);else throw a}for(let a of b){let b=a.targetId;if(!a.fromCache){let a=c.targetDataByTarget.get(b),d=a.snapshotVersion,e=a.withLastLimboFreeSnapshotVersion(d);c.targetDataByTarget=c.targetDataByTarget.insert(b,e)}}}function kY(a,b){let c=D(a);return c.persistence.runTransaction("Get next mutation batch","readonly",a=>(void 0===b&&(b=c3),c.mutationQueue.getNextMutationBatchAfterBatchId(a,b)))}function kZ(a,b){let c=D(a);return c.persistence.runTransaction("read document","readonly",a=>c.localDocuments.getDocument(a,b))}function k$(a,b){let c=D(a);return c.persistence.runTransaction("Allocate target","readwrite",a=>{let d;return c.targetCache.getTargetData(a,b).next(e=>e?(d=e,a$.resolve(d)):c.targetCache.allocateTargetId(a).next(e=>(d=new hK(b,e,"TargetPurposeListen",a.currentSequenceNumber),c.targetCache.addTargetData(a,d).next(()=>d))))}).then(a=>{let d=c.targetDataByTarget.get(a.targetId);return(null===d||a.snapshotVersion.compareTo(d.snapshotVersion)>0)&&(c.targetDataByTarget=c.targetDataByTarget.insert(a.targetId,a),c.targetIdByTarget.set(b,a.targetId)),a})}function k_(a,b,c){let d=D(a),e=d.targetIdByTarget.get(c);return void 0!==e?a$.resolve(d.targetDataByTarget.get(e)):d.targetCache.getTargetData(b,c)}async function k0(a,b,c){let d=D(a),e=d.targetDataByTarget.get(b),f=c?"readwrite":"readwrite-primary";try{c||await d.persistence.runTransaction("Release target",f,a=>d.persistence.referenceDelegate.removeTarget(a,e))}catch(a){if(a6(a))w(kK,`Failed to update sequence numbers for target ${b}: ${a}`);else throw a}d.targetDataByTarget=d.targetDataByTarget.remove(b),d.targetIdByTarget.delete(e.target)}function k1(a,b,c){let d=D(a),e=aH.min(),f=fm();return d.persistence.runTransaction("Execute query","readwrite",a=>k_(d,a,eS(b)).next(b=>{if(b)return e=b.lastLimboFreeSnapshotVersion,d.targetCache.getMatchingKeysForTargetId(a,b.targetId).next(a=>{f=a})}).next(()=>d.queryEngine.getDocumentsMatchingQuery(a,b,c?e:aH.min(),c?f:fm())).next(a=>(k8(d,e6(b),a),{documents:a,remoteKeys:f})))}function k2(a,b,c,d){let e=c.batch,f=e.keys(),g=a$.resolve();return f.forEach(a=>{g=g.next(()=>d.getEntry(b,a)).next(b=>{let f=c.docVersions.get(a);C(null!==f,48541),0>b.version.compareTo(f)&&(e.applyToRemoteDocument(b,c),b.isValidDocument()&&(b.setReadTime(c.commitVersion),d.addEntry(b)))})}),g.next(()=>a.mutationQueue.removeMutationBatch(b,e))}function k3(a,b){let c=D(a),d=D(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",a=>d.lookupMutationKeys(a,b).next(b=>b?c.localDocuments.getDocuments(a,b):a$.resolve(null)))}function k4(a,b){D(D(a,kM).mutationQueue).removeCachedMutationKeys(b)}function k5(a){return D(D(a,kM).persistence).getActiveClients()}function k6(a,b){let c=D(a),d=D(c.targetCache),e=c.targetDataByTarget.get(b);return e?Promise.resolve(e.target):c.persistence.runTransaction("Get target data","readonly",a=>d.getTargetDataForTarget(a,b).next(a=>a?a.target:null))}function k7(a,b){let c=D(a),d=c.collectionGroupReadTime.get(b)||aH.min();return c.persistence.runTransaction("Get new document changes","readonly",a=>c.remoteDocuments.getAllFromCollectionGroup(a,b,aT(d,aI),Number.MAX_SAFE_INTEGER)).then(a=>(k8(c,b,a),a))}function k8(a,b,c){let d=a.collectionGroupReadTime.get(b)||aH.min();c.forEach((a,b)=>{b.readTime.compareTo(d)>0&&(d=b.readTime)}),a.collectionGroupReadTime.set(b,d)}function k9(a){return eS(eL(ap.fromString(`__bundle__/docs/${a}`)))}async function la(a,b,c,d){let e=D(a),f=fm(),g=fb();for(let a of c){let c=b.toDocumentKey(a.metadata.name);a.document&&(f=f.add(c));let d=b.toMutableDocument(a);d.setReadTime(b.toSnapshotVersion(a.metadata.readTime)),g=g.insert(c,d)}let h=e.remoteDocuments.newChangeBuffer({trackRemovals:!0}),i=await k$(e,k9(d));return e.persistence.runTransaction("Apply bundle documents","readwrite",a=>kV(a,h,g).next(b=>(h.apply(a),b)).next(b=>e.targetCache.removeMatchingKeysForTargetId(a,i.targetId).next(()=>e.targetCache.addMatchingKeys(a,f,i.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(a,b.changedDocuments,b.existenceChangedKeys)).next(()=>b.changedDocuments)))}function lb(a,b){let c=D(a),d=gI(b.createTime);return c.persistence.runTransaction("hasNewerBundle","readonly",a=>c.bundleCache.getBundleMetadata(a,b.id)).then(a=>!!a&&a.createTime.compareTo(d)>=0)}function lc(a,b){let c=D(a);return c.persistence.runTransaction("Save bundle","readwrite",a=>c.bundleCache.saveBundleMetadata(a,b))}function ld(a,b){let c=D(a);return c.persistence.runTransaction("Get named query","readonly",a=>c.bundleCache.getNamedQuery(a,b))}async function le(a,b,c=fm()){let d=await k$(a,eS(h_(b.bundledQuery))),e=D(a);return e.persistence.runTransaction("Save named query","readwrite",a=>{let f=gI(b.readTime);if(d.snapshotVersion.compareTo(f)>=0)return e.bundleCache.saveNamedQuery(a,b);let g=d.withResumeToken(cM.EMPTY_BYTE_STRING,f);return e.targetDataByTarget=e.targetDataByTarget.insert(g.targetId,g),e.targetCache.updateTargetData(a,g).next(()=>e.targetCache.removeMatchingKeysForTargetId(a,d.targetId)).next(()=>e.targetCache.addMatchingKeys(a,c,d.targetId)).next(()=>e.bundleCache.saveNamedQuery(a,b))})}async function lf(a,b){let c=D(a),d=c.indexManager,e=[];return c.persistence.runTransaction("Configure indexes","readwrite",a=>d.getFieldIndexes(a).next(c=>kI(c,b,aO,b=>{e.push(d.addFieldIndex(a,b))},b=>{e.push(d.deleteFieldIndex(a,b))})).next(()=>a$.waitFor(e)))}function lg(a,b){D(a).queryEngine.indexAutoCreationEnabled=b}function lh(a){let b=D(a),c=b.indexManager;return b.persistence.runTransaction("Delete All Indexes","readwrite",a=>c.deleteAllFieldIndexes(a))}class li{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(a){this._documentReadCount+=a}}let lj=100;function lk(){return(0,i.isSafari)()?8:a3((0,i.getUA)())>0?6:4}class ll{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=lj,this.relativeIndexReadCostPerDocument=lk()}initialize(a,b){this.localDocumentsView=a,this.indexManager=b,this.initialized=!0}getDocumentsMatchingQuery(a,b,c,d){let e={result:null};return this.performQueryUsingIndex(a,b).next(a=>{e.result=a}).next(()=>{if(!e.result)return this.performQueryUsingRemoteKeys(a,b,d,c).next(a=>{e.result=a})}).next(()=>{if(e.result)return;let c=new li;return this.executeFullCollectionScan(a,b,c).next(d=>{if(e.result=d,this.indexAutoCreationEnabled)return this.createCacheIndexes(a,b,c,d.size)})}).next(()=>e.result)}createCacheIndexes(a,b,c,d){return c.documentReadCount<this.indexAutoCreationMinCollectionSize?(v()<=l.LogLevel.DEBUG&&w("QueryEngine","SDK will not create cache indexes for query:",e0(b),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),a$.resolve()):(v()<=l.LogLevel.DEBUG&&w("QueryEngine","Query:",e0(b),"scans",c.documentReadCount,"local documents and returns",d,"documents as results."),c.documentReadCount>this.relativeIndexReadCostPerDocument*d)?(v()<=l.LogLevel.DEBUG&&w("QueryEngine","The SDK decides to create cache indexes for query:",e0(b),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(a,eS(b))):a$.resolve()}performQueryUsingIndex(a,b){if(eN(b))return a$.resolve(null);let c=eS(b);return this.indexManager.getIndexType(a,c).next(d=>0===d?null:(null!==b.limit&&1===d&&(c=eS(b=eX(b,null,"F"))),this.indexManager.getDocumentsMatchingTarget(a,c).next(d=>{let e=fm(...d);return this.localDocumentsView.getDocuments(a,e).next(d=>this.indexManager.getMinOffset(a,c).next(c=>{let f=this.applyQuery(b,d);return this.needsRefill(b,f,e,c.readTime)?this.performQueryUsingIndex(a,eX(b,null,"F")):this.appendRemainingResults(a,f,b,c)}))})))}performQueryUsingRemoteKeys(a,b,c,d){return eN(b)||d.isEqual(aH.min())?a$.resolve(null):this.localDocumentsView.getDocuments(a,c).next(e=>{let f=this.applyQuery(b,e);return this.needsRefill(b,f,c,d)?a$.resolve(null):(v()<=l.LogLevel.DEBUG&&w("QueryEngine","Re-using previous result from %s to execute query: %s",d.toString(),e0(b)),this.appendRemainingResults(a,f,b,aT(d,aI)).next(a=>a))})}applyQuery(a,b){let c=new cF(e7(a));return b.forEach((b,d)=>{e1(a,d)&&(c=c.add(d))}),c}needsRefill(a,b,c,d){if(null===a.limit)return!1;if(c.size!==b.size)return!0;let e="F"===a.limitType?b.last():b.first();return!!e&&(e.hasPendingWrites||e.version.compareTo(d)>0)}executeFullCollectionScan(a,b,c){return v()<=l.LogLevel.DEBUG&&w("QueryEngine","Using full collection scan to execute query:",e0(b)),this.localDocumentsView.getDocumentsMatchingQuery(a,b,aV.min(),c)}appendRemainingResults(a,b,c,d){return this.localDocumentsView.getDocumentsMatchingQuery(a,c,d).next(a=>(b.forEach(b=>{a=a.insert(b.key,b)}),a))}}let lm="firestore_clients";function ln(a,b){return`${lm}_${a}_${b}`}let lo="firestore_mutations";function lp(a,b,c){let d=`${lo}_${a}_${c}`;return b.isAuthenticated()&&(d+=`_${b.uid}`),d}let lq="firestore_targets";function lr(a,b){return`${lq}_${a}_${b}`}let ls="firestore_online_state";function lt(a){return`${ls}_${a}`}let lu="firestore_bundle_loaded_v2";function lv(a){return`${lu}_${a}`}let lw="firestore_sequence_number";function lx(a){return`${lw}_${a}`}let ly="SharedClientState";class lz{constructor(a,b,c,d){this.user=a,this.batchId=b,this.state=c,this.error=d}static fromWebStorageEntry(a,b,c){let d,e=JSON.parse(c),f="object"==typeof e&&-1!==["pending","acknowledged","rejected"].indexOf(e.state)&&(void 0===e.error||"object"==typeof e.error);return(f&&e.error&&(f="string"==typeof e.error.message&&"string"==typeof e.error.code)&&(d=new V(e.error.code,e.error.message)),f)?new lz(a,b,e.state,d):(x(ly,`Failed to parse mutation state for ID '${b}': ${c}`),null)}toWebStorageJSON(){let a={state:this.state,updateTimeMs:Date.now()};return this.error&&(a.error={code:this.error.code,message:this.error.message}),JSON.stringify(a)}}class lA{constructor(a,b,c){this.targetId=a,this.state=b,this.error=c}static fromWebStorageEntry(a,b){let c,d=JSON.parse(b),e="object"==typeof d&&-1!==["not-current","current","rejected"].indexOf(d.state)&&(void 0===d.error||"object"==typeof d.error);return(e&&d.error&&(e="string"==typeof d.error.message&&"string"==typeof d.error.code)&&(c=new V(d.error.code,d.error.message)),e)?new lA(a,d.state,c):(x(ly,`Failed to parse target state for ID '${a}': ${b}`),null)}toWebStorageJSON(){let a={state:this.state,updateTimeMs:Date.now()};return this.error&&(a.error={code:this.error.code,message:this.error.message}),JSON.stringify(a)}}class lB{constructor(a,b){this.clientId=a,this.activeTargetIds=b}static fromWebStorageEntry(a,b){let c=JSON.parse(b),d="object"==typeof c&&c.activeTargetIds instanceof Array,e=fo();for(let a=0;d&&a<c.activeTargetIds.length;++a)d=c6(c.activeTargetIds[a]),e=e.add(c.activeTargetIds[a]);return d?new lB(a,e):(x(ly,`Failed to parse client data for instance '${a}': ${b}`),null)}}class lC{constructor(a,b){this.clientId=a,this.onlineState=b}static fromWebStorageEntry(a){let b=JSON.parse(a);return"object"==typeof b&&-1!==["Unknown","Online","Offline"].indexOf(b.onlineState)&&"string"==typeof b.clientId?new lC(b.clientId,b.onlineState):(x(ly,`Failed to parse online state: ${a}`),null)}}class lD{constructor(){this.activeTargetIds=fo()}addQueryTarget(a){this.activeTargetIds=this.activeTargetIds.add(a)}removeQueryTarget(a){this.activeTargetIds=this.activeTargetIds.delete(a)}toWebStorageJSON(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class lE{constructor(a,b,c,d,e){this.window=a,this.queue=b,this.persistenceKey=c,this.localClientId=d,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new cB(ag),this.started=!1,this.earlyEvents=[];const f=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=e,this.localClientStorageKey=ln(this.persistenceKey,this.localClientId),this.sequenceNumberKey=lx(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new lD),this.clientStateKeyRe=RegExp(`^${lm}_${f}_([^_]*)$`),this.mutationBatchKeyRe=RegExp(`^${lo}_${f}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=RegExp(`^${lq}_${f}_(\\d+)$`),this.onlineStateKey=lt(this.persistenceKey),this.bundleLoadedKey=lv(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(a){return!!(a&&a.localStorage)}async start(){for(let a of(await this.syncEngine.getActiveClients())){if(a===this.localClientId)continue;let b=this.getItem(ln(this.persistenceKey,a));if(b){let c=lB.fromWebStorageEntry(a,b);c&&(this.activeClients=this.activeClients.insert(c.clientId,c))}}this.persistClientState();let a=this.storage.getItem(this.onlineStateKey);if(a){let b=this.fromWebStorageOnlineState(a);b&&this.handleOnlineStateEvent(b)}for(let a of this.earlyEvents)this.handleWebStorageEvent(a);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(a){this.setItem(this.sequenceNumberKey,JSON.stringify(a))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(a){let b=!1;return this.activeClients.forEach((c,d)=>{d.activeTargetIds.has(a)&&(b=!0)}),b}addPendingMutation(a){this.persistMutationState(a,"pending")}updateMutationState(a,b,c){this.persistMutationState(a,b,c),this.removeMutationState(a)}addLocalQueryTarget(a,b=!0){let c="not-current";if(this.isActiveQueryTarget(a)){let b=this.storage.getItem(lr(this.persistenceKey,a));if(b){let d=lA.fromWebStorageEntry(a,b);d&&(c=d.state)}}return b&&this.localClientState.addQueryTarget(a),this.persistClientState(),c}removeLocalQueryTarget(a){this.localClientState.removeQueryTarget(a),this.persistClientState()}isLocalQueryTarget(a){return this.localClientState.activeTargetIds.has(a)}clearQueryState(a){this.removeItem(lr(this.persistenceKey,a))}updateQueryState(a,b,c){this.persistQueryTargetState(a,b,c)}handleUserChange(a,b,c){b.forEach(a=>{this.removeMutationState(a)}),this.currentUser=a,c.forEach(a=>{this.addPendingMutation(a)})}setOnlineState(a){this.persistOnlineState(a)}notifyBundleLoaded(a){this.persistBundleLoadedState(a)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(a){let b=this.storage.getItem(a);return w(ly,"READ",a,b),b}setItem(a,b){w(ly,"SET",a,b),this.storage.setItem(a,b)}removeItem(a){w(ly,"REMOVE",a),this.storage.removeItem(a)}handleWebStorageEvent(a){let b=a;if(b.storageArea===this.storage){if(w(ly,"EVENT",b.key,b.newValue),b.key===this.localClientStorageKey)return void x("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueRetryable(async()=>{if(!this.started)return void this.earlyEvents.push(b);if(null!==b.key){if(this.clientStateKeyRe.test(b.key))if(null!=b.newValue){let a=this.fromWebStorageClientState(b.key,b.newValue);if(a)return this.handleClientStateEvent(a.clientId,a)}else{let a=this.fromWebStorageClientStateKey(b.key);return this.handleClientStateEvent(a,null)}else if(this.mutationBatchKeyRe.test(b.key)){if(null!==b.newValue){let a=this.fromWebStorageMutationMetadata(b.key,b.newValue);if(a)return this.handleMutationBatchEvent(a)}}else if(this.queryTargetKeyRe.test(b.key)){if(null!==b.newValue){let a=this.fromWebStorageQueryTargetMetadata(b.key,b.newValue);if(a)return this.handleQueryTargetEvent(a)}}else if(b.key===this.onlineStateKey){if(null!==b.newValue){let a=this.fromWebStorageOnlineState(b.newValue);if(a)return this.handleOnlineStateEvent(a)}}else if(b.key===this.sequenceNumberKey){let a=lF(b.newValue);a!==bh.INVALID&&this.sequenceNumberHandler(a)}else if(b.key===this.bundleLoadedKey){let a=this.fromWebStoreBundleLoadedState(b.newValue);await Promise.all(a.map(a=>this.syncEngine.synchronizeWithChangedDocuments(a)))}}})}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(a,b,c){let d=new lz(this.currentUser,a,b,c),e=lp(this.persistenceKey,this.currentUser,a);this.setItem(e,d.toWebStorageJSON())}removeMutationState(a){let b=lp(this.persistenceKey,this.currentUser,a);this.removeItem(b)}persistOnlineState(a){let b={clientId:this.localClientId,onlineState:a};this.storage.setItem(this.onlineStateKey,JSON.stringify(b))}persistQueryTargetState(a,b,c){let d=lr(this.persistenceKey,a),e=new lA(a,b,c);this.setItem(d,e.toWebStorageJSON())}persistBundleLoadedState(a){let b=JSON.stringify(Array.from(a));this.setItem(this.bundleLoadedKey,b)}fromWebStorageClientStateKey(a){let b=this.clientStateKeyRe.exec(a);return b?b[1]:null}fromWebStorageClientState(a,b){let c=this.fromWebStorageClientStateKey(a);return lB.fromWebStorageEntry(c,b)}fromWebStorageMutationMetadata(a,b){let c=this.mutationBatchKeyRe.exec(a),d=Number(c[1]),e=void 0!==c[2]?c[2]:null;return lz.fromWebStorageEntry(new q(e),d,b)}fromWebStorageQueryTargetMetadata(a,b){let c=Number(this.queryTargetKeyRe.exec(a)[1]);return lA.fromWebStorageEntry(c,b)}fromWebStorageOnlineState(a){return lC.fromWebStorageEntry(a)}fromWebStoreBundleLoadedState(a){return JSON.parse(a)}async handleMutationBatchEvent(a){return a.user.uid!==this.currentUser.uid?void w(ly,`Ignoring mutation for non-active user ${a.user.uid}`):this.syncEngine.applyBatchState(a.batchId,a.state,a.error)}handleQueryTargetEvent(a){return this.syncEngine.applyTargetState(a.targetId,a.state,a.error)}handleClientStateEvent(a,b){let c=b?this.activeClients.insert(a,b):this.activeClients.remove(a),d=this.extractActiveQueryTargets(this.activeClients),e=this.extractActiveQueryTargets(c),f=[],g=[];return e.forEach(a=>{d.has(a)||f.push(a)}),d.forEach(a=>{e.has(a)||g.push(a)}),this.syncEngine.applyActiveTargetsChange(f,g).then(()=>{this.activeClients=c})}handleOnlineStateEvent(a){this.activeClients.get(a.clientId)&&this.onlineStateHandler(a.onlineState)}extractActiveQueryTargets(a){let b=fo();return a.forEach((a,c)=>{b=b.unionWith(c.activeTargetIds)}),b}}function lF(a){let b=bh.INVALID;if(null!=a)try{let c=JSON.parse(a);C("number"==typeof c,30636,{seqString:a}),b=c}catch(a){x(ly,"Failed to read sequence number from WebStorage",a)}return b}class lG{constructor(){this.localState=new lD,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(a){}updateMutationState(a,b,c){}addLocalQueryTarget(a,b=!0){return b&&this.localState.addQueryTarget(a),this.queryState[a]||"not-current"}updateQueryState(a,b,c){this.queryState[a]=b}removeLocalQueryTarget(a){this.localState.removeQueryTarget(a)}isLocalQueryTarget(a){return this.localState.activeTargetIds.has(a)}clearQueryState(a){delete this.queryState[a]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(a){return this.localState.activeTargetIds.has(a)}start(){return this.localState=new lD,Promise.resolve()}handleUserChange(a,b,c){}setOnlineState(a){}shutdown(){}writeSequenceNumber(a){}notifyBundleLoaded(a){}}class lH{addCallback(a){}shutdown(){}}class lI{constructor(a){this.sendFn=a.sendFn,this.closeFn=a.closeFn}onConnected(a){this.wrappedOnConnected=a}onOpen(a){this.wrappedOnOpen=a}onClose(a){this.wrappedOnClose=a}onMessage(a){this.wrappedOnMessage=a}close(){this.closeFn()}send(a){this.sendFn(a)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(a){this.wrappedOnClose(a)}callOnMessage(a){this.wrappedOnMessage(a)}}let lJ=null;function lK(){return 0x10000000+Math.round(0x80000000*Math.random())}function lL(){return null===lJ?lJ=lK():lJ++,"0x"+lJ.toString(16)}function lM(a){return new Promise((b,c)=>{a((a,d)=>{a?c(a):b(d)})})}let lN="1.9.15",lO="GrpcConnection",lP=`gl-node/${process.versions.node} fire/${r} grpc/${lN}`;function lQ(a,b,c,d,e){C(null===b||"OAuth"===b.type,36936);let f=new o.Metadata;return b&&b.headers.forEach((a,b)=>f.set(b,a)),c&&c.headers.forEach((a,b)=>f.set(b,a)),d&&f.set("X-Firebase-GMPID",d),f.set("X-Goog-Api-Client",lP),f.set("Google-Cloud-Resource-Prefix",a),f.set("x-goog-request-params",a),e&&f.set("X-Goog-Api-Key",e),f}class lR{get shouldResourcePathBeIncludedInRequest(){return!0}constructor(a,b){this.databaseInfo=b,this.cachedStub=null,this.firestore=a.google.firestore.v1,this.databasePath=`projects/${b.databaseId.projectId}/databases/${b.databaseId.database}`}ensureActiveStub(){if(!this.cachedStub){w(lO,"Creating Firestore stub.");let a=this.databaseInfo.ssl?o.credentials.createSsl():o.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,a)}return this.cachedStub}invokeRPC(a,b,c,d,e){let f=lL(),g=this.ensureActiveStub(),h=lQ(this.databasePath,d,e,this.databaseInfo.appId,this.databaseInfo.apiKey),i={database:this.databasePath,...c};return lM(b=>(w(lO,`RPC '${a}' ${f} invoked with request:`,c),g[a](i,h,(c,d)=>{c?(w(lO,`RPC '${a}' ${f} failed with error:`,c),b(new V(f9(c.code),c.message))):(w(lO,`RPC '${a}' ${f} completed with response:`,d),b(void 0,d))})))}invokeStreamingRPC(a,b,c,d,e,f){let g=lL(),h=[],i=new W;w(lO,`RPC '${a}' ${g} invoked (streaming) with request:`,c);let j=this.ensureActiveStub(),k=lQ(this.databasePath,d,e,this.databaseInfo.appId,this.databaseInfo.apiKey),l={...c,database:this.databasePath},m=j[a](l,k),n=!1;return m.on("data",b=>{w(lO,`RPC ${a} ${g} received result:`,b),h.push(b),void 0!==f&&h.length===f&&(n=!0,i.resolve(h))}),m.on("end",()=>{w(lO,`RPC '${a}' ${g} completed.`),n||(n=!0,i.resolve(h))}),m.on("error",b=>{w(lO,`RPC '${a}' ${g} failed with error:`,b);let c=f9(b.code);i.reject(new V(c,b.message))}),i.promise}openStream(a,b,c){let d=lL(),e=this.ensureActiveStub(),f=lQ(this.databasePath,b,c,this.databaseInfo.appId,this.databaseInfo.apiKey),g=e[a](f),h=!1,i=a=>{h||(h=!0,j.callOnClose(a),g.end())},j=new lI({sendFn:b=>{if(h)w(lO,`RPC '${a}' stream ${d} not sending because gRPC stream is closed:`,b);else{w(lO,`RPC '${a}' stream ${d} sending:`,b);try{g.write(b)}catch(a){throw x("Failure sending:",b),x("Error:",a),a}}},closeFn:()=>{w(lO,`RPC '${a}' stream ${d} closed locally via close().`),i()}}),k=!1;return g.on("data",b=>{h||(w(lO,`RPC '${a}' stream ${d} received:`,b),k||(j.callOnConnected(),k=!0),j.callOnMessage(b))}),g.on("end",()=>{w(lO,`RPC '${a}' stream ${d} ended.`),i()}),g.on("error",b=>{h||(y(lO,`RPC '${a}' stream ${d} error. Code:`,b.code,"Message:",b.message),i(new V(f9(b.code),b.message)))}),w(lO,`Opening RPC '${a}' stream ${d} to ${this.databaseInfo.host}`),setTimeout(()=>{j.callOnOpen()},0),j}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}}let lS={google:{nested:{protobuf:{options:{go_package:"github.com/golang/protobuf/protoc-gen-go/descriptor;descriptor",java_package:"com.google.protobuf",java_outer_classname:"DescriptorProtos",csharp_namespace:"Google.Protobuf.Reflection",objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2},options:{type:"ExtensionRangeOptions",id:3}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},ExtensionRangeOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3},reservedRange:{rule:"repeated",type:"EnumReservedRange",id:4},reservedName:{rule:"repeated",type:"string",id:5}},nested:{EnumReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5,options:{default:!1}},serverStreaming:{type:"bool",id:6,options:{default:!1}}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10,options:{default:!1}},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27,options:{default:!1}},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16,options:{default:!1}},javaGenericServices:{type:"bool",id:17,options:{default:!1}},pyGenericServices:{type:"bool",id:18,options:{default:!1}},phpGenericServices:{type:"bool",id:42,options:{default:!1}},deprecated:{type:"bool",id:23,options:{default:!1}},ccEnableArenas:{type:"bool",id:31,options:{default:!1}},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},swiftPrefix:{type:"string",id:39},phpClassPrefix:{type:"string",id:40},phpNamespace:{type:"string",id:41},phpMetadataNamespace:{type:"string",id:44},rubyPackage:{type:"string",id:45},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1,options:{default:!1}},noStandardDescriptorAccessor:{type:"bool",id:2,options:{default:!1}},deprecated:{type:"bool",id:3,options:{default:!1}},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[8,8],[9,9]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5,options:{default:!1}},deprecated:{type:"bool",id:3,options:{default:!1}},weak:{type:"bool",id:10,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[5,5]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33,options:{default:!1}},idempotencyLevel:{type:"IdempotencyLevel",id:34,options:{default:"IDEMPOTENCY_UNKNOWN"}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],nested:{IdempotencyLevel:{values:{IDEMPOTENCY_UNKNOWN:0,NO_SIDE_EFFECTS:1,IDEMPOTENT:2}}}},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Empty:{fields:{}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},Duration:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"cloud.google.com/go/firestore/apiv1/firestorepb;firestorepb",java_multiple_files:!0,java_outer_classname:"QueryProfileProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue","fieldReferenceValue","functionValue","pipelineValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6},fieldReferenceValue:{type:"string",id:19},functionValue:{type:"Function",id:20},pipelineValue:{type:"Pipeline",id:21}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Function:{fields:{name:{type:"string",id:1},args:{rule:"repeated",type:"Value",id:2},options:{keyType:"string",type:"Value",id:3}}},Pipeline:{fields:{stages:{rule:"repeated",type:"Stage",id:1}},nested:{Stage:{fields:{name:{type:"string",id:1},args:{rule:"repeated",type:"Value",id:2},options:{keyType:"string",type:"Value",id:3}}}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},ExecutePipeline:{requestType:"ExecutePipelineRequest",responseType:"ExecutePipelineResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:executePipeline","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:executePipeline",body:"*"}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},ExecutePipelineRequest:{oneofs:{pipelineType:{oneof:["structuredPipeline"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredPipeline:{type:"StructuredPipeline",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},ExecutePipelineResponse:{fields:{transaction:{type:"bytes",id:1},results:{rule:"repeated",type:"Document",id:2},executionTime:{type:"google.protobuf.Timestamp",id:3}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredPipeline:{fields:{pipeline:{type:"Pipeline",id:1},options:{keyType:"string",type:"Value",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"StructuredQuery.FieldReference",id:1}}},Avg:{fields:{field:{type:"StructuredQuery.FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}},ExplainOptions:{fields:{analyze:{type:"bool",id:1,options:{"(google.api.field_behavior)":"OPTIONAL"}}}},ExplainMetrics:{fields:{planSummary:{type:"PlanSummary",id:1},executionStats:{type:"ExecutionStats",id:2}}},PlanSummary:{fields:{indexesUsed:{rule:"repeated",type:"google.protobuf.Struct",id:1}}},ExecutionStats:{fields:{resultsReturned:{type:"int64",id:1},executionDuration:{type:"google.protobuf.Duration",id:3},readOperations:{type:"int64",id:4},debugStats:{type:"google.protobuf.Struct",id:5}}}}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api;api",java_multiple_files:!0,java_outer_classname:"LaunchStageProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:0x44f2530,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1},fullyDecodeReservedExpansion:{type:"bool",id:2}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{selector:{type:"string",id:1},get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},body:{type:"string",id:7},responseBody:{type:"string",id:12},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}},LaunchStage:{values:{LAUNCH_STAGE_UNSPECIFIED:0,UNIMPLEMENTED:6,PRELAUNCH:7,EARLY_ACCESS:1,ALPHA:2,BETA:3,GA:4,DEPRECATED:5}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};var lT={nested:lS},lU=Object.freeze({__proto__:null,nested:lS,default:lT});let lV={longs:String,enums:String,defaults:!0,oneofs:!1};function lW(){let a=p.fromJSON(lU,lV);return o.loadPackageDefinition(a)}function lX(a){return new lR(lW(),a)}function lY(){return new lH}function lZ(){return"YES"===process.env.USE_MOCK_PERSISTENCE?window:null}function l$(){return null}function l_(a){return new gz(a,!1)}let l0="ExponentialBackoff",l1=1e3,l2=1.5,l3=6e4;class l4{constructor(a,b,c=l1,d=l2,e=l3){this.queue=a,this.timerId=b,this.initialDelayMs=c,this.backoffFactor=d,this.maxDelayMs=e,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(a){this.cancel();let b=Math.floor(this.currentBaseMs+this.jitterDelayMs()),c=Math.max(0,Date.now()-this.lastAttemptTime),d=Math.max(0,b-c);d>0&&w(l0,`Backing off for ${d} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${b} ms, last attempt: ${c} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,d,()=>(this.lastAttemptTime=Date.now(),a())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}}let l5="PersistentStream",l6=6e4,l7=1e4;class l8{constructor(a,b,c,d,e,f,g,h){this.queue=a,this.idleTimerId=c,this.healthTimerId=d,this.connection=e,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=g,this.listener=h,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new l4(a,b)}isStarted(){return 1===this.state||5===this.state||this.isOpen()}isOpen(){return 2===this.state||3===this.state}start(){(this.responseCount=0,4===this.state)?this.performBackoff():this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,l6,()=>this.handleIdleCloseTimer()))}sendRequest(a){this.cancelIdleCheck(),this.stream.send(a)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close(a,b){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,4!==a?this.backoff.reset():b&&b.code===N?(x(b.toString()),x("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):b&&b.code===M&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=a,await this.listener.onClose(b)}tearDown(){}auth(){this.state=1;let a=this.getCloseGuardedDispatcher(this.closeCount),b=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,c])=>{this.closeCount===b&&this.startStream(a,c)},b=>{a(()=>{let a=new V(G,"Fetching auth token failed: "+b.message);return this.handleStreamClose(a)})})}startStream(a,b){let c=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(a,b),this.stream.onConnected(()=>{c(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{c(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,l7,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(a=>{c(()=>this.handleStreamClose(a))}),this.stream.onMessage(a=>{c(()=>1==++this.responseCount?this.onFirst(a):this.onNext(a))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose(a){return w(l5,`close with error: ${a}`),this.stream=null,this.close(4,a)}getCloseGuardedDispatcher(a){return b=>{this.queue.enqueueAndForget(()=>this.closeCount===a?b():(w(l5,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class l9 extends l8{constructor(a,b,c,d,e,f){super(a,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",b,c,d,f),this.serializer=e}startRpc(a,b){return this.connection.openStream("Listen",a,b)}onFirst(a){return this.onNext(a)}onNext(a){this.backoff.reset();let b=gZ(this.serializer,a),c=g_(a);return this.listener.onWatchChange(b,c)}watch(a){let b={};b.database=gQ(this.serializer),b.addTarget=hg(this.serializer,a);let c=he(this.serializer,a);c&&(b.labels=c),this.sendRequest(b)}unwatch(a){let b={};b.database=gQ(this.serializer),b.removeTarget=a,this.sendRequest(b)}}class ma extends l8{constructor(a,b,c,d,e,f){super(a,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",b,c,d,f),this.serializer=e}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(a,b){return this.connection.openStream("Write",a,b)}onFirst(a){return C(!!a.streamToken,31322),this.lastStreamToken=a.streamToken,C(!a.writeResults||0===a.writeResults.length,55816),this.listener.onHandshakeComplete()}onNext(a){C(!!a.streamToken,12678),this.lastStreamToken=a.streamToken,this.backoff.reset();let b=g5(a.writeResults,a.commitTime),c=gI(a.commitTime);return this.listener.onMutationResult(c,b)}writeHandshake(){let a={};a.database=gQ(this.serializer),this.sendRequest(a)}writeMutations(a){let b={streamToken:this.lastStreamToken,writes:a.map(a=>g0(this.serializer,a))};this.sendRequest(b)}}class mb{}class mc extends mb{constructor(a,b,c,d){super(),this.authCredentials=a,this.appCheckCredentials=b,this.connection=c,this.serializer=d,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new V(O,"The client has already been terminated.")}invokeRPC(a,b,c,d){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,f])=>this.connection.invokeRPC(a,gK(b,c),d,e,f)).catch(a=>{if("FirebaseError"===a.name)throw a.code===M&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a;throw new V(G,a.toString())})}invokeStreamingRPC(a,b,c,d,e){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,g])=>this.connection.invokeStreamingRPC(a,gK(b,c),d,f,g,e)).catch(a=>{if("FirebaseError"===a.name)throw a.code===M&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a;throw new V(G,a.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}}function md(a,b,c,d){return new mc(a,b,c,d)}async function me(a,b){let c=D(a),d={writes:b.map(a=>g0(c.serializer,a))};await c.invokeRPC("Commit",c.serializer.databaseId,ap.emptyPath(),d)}async function mf(a,b){let c=D(a),d={documents:b.map(a=>gM(c.serializer,a))},e=await c.invokeStreamingRPC("BatchGetDocuments",c.serializer.databaseId,ap.emptyPath(),d,b.length),f=new Map;e.forEach(a=>{let b=gY(c.serializer,a);f.set(b.key.toString(),b)});let g=[];return b.forEach(a=>{let b=f.get(a.toString());C(!!b,55234,{key:a}),g.push(b)}),g}async function mg(a,b,c){let d=D(a),{request:e,aliasMap:f,parent:g}=hb(d.serializer,eT(b),c);d.connection.shouldResourcePathBeIncludedInRequest||delete e.parent;let h=(await d.invokeStreamingRPC("RunAggregationQuery",d.serializer.databaseId,g,e,1)).filter(a=>!!a.result);C(1===h.length,64727);let i=h[0].result?.aggregateFields;return Object.keys(i).reduce((a,b)=>(a[f[b]]=i[b],a),{})}function mh(a,b,c){let d=D(a);return d.verifyInitialized(),new ma(b,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,c)}function mi(a,b,c){let d=D(a);return d.verifyInitialized(),new l9(b,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,c)}let mj="OnlineStateTracker",mk=1,ml=1e4;class mm{constructor(a,b){this.asyncQueue=a,this.onlineStateHandler=b,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",ml,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${ml/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(a){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=mk&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${mk} times. Most recent error: ${a.toString()}`),this.setAndBroadcast("Offline")))}set(a){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===a&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(a)}setAndBroadcast(a){a!==this.state&&(this.state=a,this.onlineStateHandler(a))}logClientOfflineWarningIfNecessary(a){let b=`Could not reach Cloud Firestore backend. ${a}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(x(b),this.shouldWarnClientIsOffline=!1):w(mj,b)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}}let mn="RemoteStore",mo=10;class mp{constructor(a,b,c,d,e){this.localStore=a,this.datastore=b,this.asyncQueue=c,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=e,this.connectivityMonitor.addCallback(a=>{c.enqueueAndForget(async()=>{mA(this)&&(w(mn,"Restarting streams for network reachability change."),await mU(this))})}),this.onlineStateTracker=new mm(c,d)}}function mq(a,b,c,d,e){return new mp(a,b,c,d,e)}async function mr(a){if(mA(a))for(let b of a.onNetworkStatusChange)await b(!0)}async function ms(a){for(let b of a.onNetworkStatusChange)await b(!1)}async function mt(a){let b=D(a);w(mn,"RemoteStore shutting down."),b.offlineCauses.add(5),await ms(b),b.connectivityMonitor.shutdown(),b.onlineStateTracker.set("Unknown")}function mu(a,b){let c=D(a);!c.listenTargets.has(b.targetId)&&(c.listenTargets.set(b.targetId,b),mz(c)?my(c):mX(c).isOpen()&&mw(c,b))}function mv(a,b){let c=D(a),d=mX(c);c.listenTargets.delete(b),d.isOpen()&&mx(c,b),0===c.listenTargets.size&&(d.isOpen()?d.markIdle():mA(c)&&c.onlineStateTracker.set("Unknown"))}function mw(a,b){if(a.watchChangeAggregator.recordPendingTargetRequest(b.targetId),b.resumeToken.approximateByteSize()>0||b.snapshotVersion.compareTo(aH.min())>0){let c=a.remoteSyncer.getRemoteKeysForTarget(b.targetId).size;b=b.withExpectedCount(c)}mX(a).watch(b)}function mx(a,b){a.watchChangeAggregator.recordPendingTargetRequest(b),mX(a).unwatch(b)}function my(a){a.watchChangeAggregator=new gr({getRemoteKeysForTarget:b=>a.remoteSyncer.getRemoteKeysForTarget(b),getTargetDataForTarget:b=>a.listenTargets.get(b)||null,getDatabaseId:()=>a.datastore.serializer.databaseId}),mX(a).start(),a.onlineStateTracker.handleWatchStreamStart()}function mz(a){return mA(a)&&!mX(a).isStarted()&&a.listenTargets.size>0}function mA(a){return 0===D(a).offlineCauses.size}function mB(a){a.watchChangeAggregator=void 0}async function mC(a){a.onlineStateTracker.set("Online")}async function mD(a){a.listenTargets.forEach((b,c)=>{mw(a,b)})}async function mE(a,b){mB(a),mz(a)?(a.onlineStateTracker.handleWatchStreamFailure(b),my(a)):a.onlineStateTracker.set("Unknown")}async function mF(a,b,c){if(a.onlineStateTracker.set("Online"),b instanceof go&&2===b.state&&b.cause){try{await mJ(a,b)}catch(c){w(mn,"Failed to remove targets %s: %s ",b.targetIds.join(","),c),await mG(a,c)}return}if(b instanceof gm?a.watchChangeAggregator.handleDocumentChange(b):b instanceof gn?a.watchChangeAggregator.handleExistenceFilter(b):a.watchChangeAggregator.handleTargetChange(b),!c.isEqual(aH.min()))try{let b=await kT(a.localStore);c.compareTo(b)>=0&&await mI(a,c)}catch(b){w(mn,"Failed to raise snapshot:",b),await mG(a,b)}}async function mG(a,b,c){if(a6(b))a.offlineCauses.add(1),await ms(a),a.onlineStateTracker.set("Offline"),c||(c=()=>kT(a.localStore)),a.asyncQueue.enqueueRetryable(async()=>{w(mn,"Retrying IndexedDB access"),await c(),a.offlineCauses.delete(1),await mr(a)});else throw b}function mH(a,b){return b().catch(c=>mG(a,c,b))}function mI(a,b){let c=a.watchChangeAggregator.createRemoteEvent(b);return c.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){let e=a.listenTargets.get(d);e&&a.listenTargets.set(d,e.withResumeToken(c.resumeToken,b))}}),c.targetMismatches.forEach((b,c)=>{let d=a.listenTargets.get(b);d&&(a.listenTargets.set(b,d.withResumeToken(cM.EMPTY_BYTE_STRING,d.snapshotVersion)),mx(a,b),mw(a,new hK(d.target,b,c,d.sequenceNumber)))}),a.remoteSyncer.applyRemoteEvent(c)}async function mJ(a,b){let c=b.cause;for(let d of b.targetIds)a.listenTargets.has(d)&&(await a.remoteSyncer.rejectListen(d,c),a.listenTargets.delete(d),a.watchChangeAggregator.removeTarget(d))}async function mK(a){let b=D(a),c=mY(b),d=b.writePipeline.length>0?b.writePipeline[b.writePipeline.length-1].batchId:c3;for(;mL(b);)try{let a=await kY(b.localStore,d);if(null===a){0===b.writePipeline.length&&c.markIdle();break}d=a.batchId,mM(b,a)}catch(a){await mG(b,a)}mN(b)&&mO(b)}function mL(a){return mA(a)&&a.writePipeline.length<mo}function mM(a,b){a.writePipeline.push(b);let c=mY(a);c.isOpen()&&c.handshakeComplete&&c.writeMutations(b.mutations)}function mN(a){return mA(a)&&!mY(a).isStarted()&&a.writePipeline.length>0}function mO(a){mY(a).start()}async function mP(a){mY(a).writeHandshake()}async function mQ(a){let b=mY(a);for(let c of a.writePipeline)b.writeMutations(c.mutations)}async function mR(a,b,c){let d=a.writePipeline.shift(),e=f4.from(d,b,c);await mH(a,()=>a.remoteSyncer.applySuccessfulWrite(e)),await mK(a)}async function mS(a,b){b&&mY(a).handshakeComplete&&await mT(a,b),mN(a)&&mO(a)}async function mT(a,b){if(f8(b.code)){let c=a.writePipeline.shift();mY(a).inhibitBackoff(),await mH(a,()=>a.remoteSyncer.rejectFailedWrite(c.batchId,b)),await mK(a)}}async function mU(a){let b=D(a);b.offlineCauses.add(4),await ms(b),b.onlineStateTracker.set("Unknown"),b.offlineCauses.delete(4),await mr(b)}async function mV(a,b){let c=D(a);c.asyncQueue.verifyOperationInProgress(),w(mn,"RemoteStore received new credentials");let d=mA(c);c.offlineCauses.add(3),await ms(c),d&&c.onlineStateTracker.set("Unknown"),await c.remoteSyncer.handleCredentialChange(b),c.offlineCauses.delete(3),await mr(c)}async function mW(a,b){let c=D(a);b?(c.offlineCauses.delete(2),await mr(c)):b||(c.offlineCauses.add(2),await ms(c),c.onlineStateTracker.set("Unknown"))}function mX(a){return a.watchStream||(a.watchStream=mi(a.datastore,a.asyncQueue,{onConnected:mC.bind(null,a),onOpen:mD.bind(null,a),onClose:mE.bind(null,a),onWatchChange:mF.bind(null,a)}),a.onNetworkStatusChange.push(async b=>{b?(a.watchStream.inhibitBackoff(),mz(a)?my(a):a.onlineStateTracker.set("Unknown")):(await a.watchStream.stop(),mB(a))})),a.watchStream}function mY(a){return a.writeStream||(a.writeStream=mh(a.datastore,a.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:mP.bind(null,a),onClose:mS.bind(null,a),onHandshakeComplete:mQ.bind(null,a),onMutationResult:mR.bind(null,a)}),a.onNetworkStatusChange.push(async b=>{b?(a.writeStream.inhibitBackoff(),await mK(a)):(await a.writeStream.stop(),a.writePipeline.length>0&&(w(mn,`Stopping write stream with ${a.writePipeline.length} pending writes`),a.writePipeline=[]))})),a.writeStream}let mZ="AsyncQueue";class m${constructor(a,b,c,d,e){this.asyncQueue=a,this.timerId=b,this.targetTimeMs=c,this.op=d,this.removalCallback=e,this.deferred=new W,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(a,b,c,d,e){let f=new m$(a,b,Date.now()+c,d,e);return f.start(c),f}start(a){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),a)}skipDelay(){return this.handleDelayElapsed()}cancel(a){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new V(F,"Operation cancelled"+(a?": "+a:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(a=>this.deferred.resolve(a))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function m_(a,b){if(x(mZ,`${b}: ${a}`),a6(a))return new V(T,`${b}: ${a}`);throw a}class m0{static emptySet(a){return new m0(a.comparator)}constructor(a){a?this.comparator=(b,c)=>a(b,c)||as.comparator(b.key,c.key):this.comparator=(a,b)=>as.comparator(a.key,b.key),this.keyedMap=fd(),this.sortedSet=new cB(this.comparator)}has(a){return null!=this.keyedMap.get(a)}get(a){return this.keyedMap.get(a)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(a){let b=this.keyedMap.get(a);return b?this.sortedSet.indexOf(b):-1}get size(){return this.sortedSet.size}forEach(a){this.sortedSet.inorderTraversal((b,c)=>(a(b),!1))}add(a){let b=this.delete(a.key);return b.copy(b.keyedMap.insert(a.key,a),b.sortedSet.insert(a,null))}delete(a){let b=this.get(a);return b?this.copy(this.keyedMap.remove(a),this.sortedSet.remove(b)):this}isEqual(a){if(!(a instanceof m0)||this.size!==a.size)return!1;let b=this.sortedSet.getIterator(),c=a.sortedSet.getIterator();for(;b.hasNext();){let a=b.getNext().key,d=c.getNext().key;if(!a.isEqual(d))return!1}return!0}toString(){let a=[];return(this.forEach(b=>{a.push(b.toString())}),0===a.length)?"DocumentSet ()":"DocumentSet (\n  "+a.join("  \n")+"\n)"}copy(a,b){let c=new m0;return c.comparator=this.comparator,c.keyedMap=a,c.sortedSet=b,c}}class m1{constructor(){this.changeMap=new cB(as.comparator)}track(a){let b=a.doc.key,c=this.changeMap.get(b);if(!c){this.changeMap=this.changeMap.insert(b,a);return}0!==a.type&&3===c.type?this.changeMap=this.changeMap.insert(b,a):3===a.type&&1!==c.type?this.changeMap=this.changeMap.insert(b,{type:c.type,doc:a.doc}):2===a.type&&2===c.type?this.changeMap=this.changeMap.insert(b,{type:2,doc:a.doc}):2===a.type&&0===c.type?this.changeMap=this.changeMap.insert(b,{type:0,doc:a.doc}):1===a.type&&0===c.type?this.changeMap=this.changeMap.remove(b):1===a.type&&2===c.type?this.changeMap=this.changeMap.insert(b,{type:1,doc:c.doc}):0===a.type&&1===c.type?this.changeMap=this.changeMap.insert(b,{type:2,doc:a.doc}):A(63341,{change:a,oldChange:c})}getChanges(){let a=[];return this.changeMap.inorderTraversal((b,c)=>{a.push(c)}),a}}class m2{constructor(a,b,c,d,e,f,g,h,i){this.query=a,this.docs=b,this.oldDocs=c,this.docChanges=d,this.mutatedKeys=e,this.fromCache=f,this.syncStateChanged=g,this.excludesMetadataChanges=h,this.hasCachedResults=i}static fromInitialDocuments(a,b,c,d,e){let f=[];return b.forEach(a=>{f.push({type:0,doc:a})}),new m2(a,b,m0.emptySet(b),f,c,d,!0,!1,e)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(a){if(this.fromCache!==a.fromCache||this.hasCachedResults!==a.hasCachedResults||this.syncStateChanged!==a.syncStateChanged||!this.mutatedKeys.isEqual(a.mutatedKeys)||!e$(this.query,a.query)||!this.docs.isEqual(a.docs)||!this.oldDocs.isEqual(a.oldDocs))return!1;let b=this.docChanges,c=a.docChanges;if(b.length!==c.length)return!1;for(let a=0;a<b.length;a++)if(b[a].type!==c[a].type||!b[a].doc.isEqual(c[a].doc))return!1;return!0}}class m3{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(a=>a.listensToRemoteStore())}}function m4(){return new m5}class m5{constructor(){this.queries=m6(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){ne(this,new V(P,"Firestore shutting down"))}}function m6(){return new e9(a=>e_(a),e$)}async function m7(a,b){let c=D(a),d=3,e=b.query,f=c.queries.get(e);f?!f.hasRemoteListeners()&&b.listensToRemoteStore()&&(d=2):(f=new m3,d=+!b.listensToRemoteStore());try{switch(d){case 0:f.viewSnap=await c.onListen(e,!0);break;case 1:f.viewSnap=await c.onListen(e,!1);break;case 2:await c.onFirstRemoteStoreListen(e)}}catch(c){let a=m_(c,`Initialization of query '${e0(b.query)}' failed`);b.onError(a);return}c.queries.set(e,f),f.listeners.push(b),b.applyOnlineStateChange(c.onlineState),f.viewSnap&&b.onViewSnapshot(f.viewSnap)&&nf(c)}async function m8(a,b){let c=D(a),d=b.query,e=3,f=c.queries.get(d);if(f){let a=f.listeners.indexOf(b);a>=0&&(f.listeners.splice(a,1),0===f.listeners.length?e=+!b.listensToRemoteStore():!f.hasRemoteListeners()&&b.listensToRemoteStore()&&(e=2))}switch(e){case 0:return c.queries.delete(d),c.onUnlisten(d,!0);case 1:return c.queries.delete(d),c.onUnlisten(d,!1);case 2:return c.onLastRemoteStoreUnlisten(d);default:return}}function m9(a,b){let c=D(a),d=!1;for(let a of b){let b=a.query,e=c.queries.get(b);if(e){for(let b of e.listeners)b.onViewSnapshot(a)&&(d=!0);e.viewSnap=a}}d&&nf(c)}function na(a,b,c){let d=D(a),e=d.queries.get(b);if(e)for(let a of e.listeners)a.onError(c);d.queries.delete(b)}function nb(a,b){let c=D(a);c.onlineState=b;let d=!1;c.queries.forEach((a,c)=>{for(let a of c.listeners)a.applyOnlineStateChange(b)&&(d=!0)}),d&&nf(c)}function nc(a,b){D(a).snapshotsInSyncListeners.add(b),b.next()}function nd(a,b){D(a).snapshotsInSyncListeners.delete(b)}function ne(a,b){let c=D(a),d=c.queries;c.queries=m6(),d.forEach((a,c)=>{for(let a of c.listeners)a.onError(b)})}function nf(a){a.snapshotsInSyncListeners.forEach(a=>{a.next()})}!function(a){a.Default="default",a.Cache="cache"}(e||(e={}));class ng{constructor(a,b,c){this.query=a,this.queryObserver=b,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=c||{}}onViewSnapshot(a){if(!this.options.includeMetadataChanges){let b=[];for(let c of a.docChanges)3!==c.type&&b.push(c);a=new m2(a.query,a.docs,a.oldDocs,b,a.mutatedKeys,a.fromCache,a.syncStateChanged,!0,a.hasCachedResults)}let b=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(a)&&(this.queryObserver.next(a),b=!0):this.shouldRaiseInitialEvent(a,this.onlineState)&&(this.raiseInitialEvent(a),b=!0),this.snap=a,b}onError(a){this.queryObserver.error(a)}applyOnlineStateChange(a){this.onlineState=a;let b=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,a)&&(this.raiseInitialEvent(this.snap),b=!0),b}shouldRaiseInitialEvent(a,b){if(!a.fromCache||!this.listensToRemoteStore())return!0;let c="Offline"!==b;return(!this.options.waitForSyncWhenOnline||!c)&&(!a.docs.isEmpty()||a.hasCachedResults||"Offline"===b)}shouldRaiseEvent(a){if(a.docChanges.length>0)return!0;let b=this.snap&&this.snap.hasPendingWrites!==a.hasPendingWrites;return(!!a.syncStateChanged||!!b)&&!0===this.options.includeMetadataChanges}raiseInitialEvent(a){a=m2.fromInitialDocuments(a.query,a.docs,a.mutatedKeys,a.fromCache,a.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(a)}listensToRemoteStore(){return this.options.source!==e.Cache}}class nh{constructor(a,b,c,d){this.targetId=a,this.fromCache=b,this.addedKeys=c,this.removedKeys=d}static fromSnapshot(a,b){let c=fm(),d=fm();for(let a of b.docChanges)switch(a.type){case 0:c=c.add(a.doc.key);break;case 1:d=d.add(a.doc.key)}return new nh(a,b.fromCache,c,d)}}class ni{constructor(a){this.serializer=a}toDocumentKey(a){return gN(this.serializer,a)}toMutableDocument(a){return a.metadata.exists?gV(this.serializer,a.document,!1):dY.newNoDocument(this.toDocumentKey(a.metadata.name),this.toSnapshotVersion(a.metadata.readTime))}toSnapshotVersion(a){return gI(a)}}class nj{constructor(a,b){this.bundleMetadata=a,this.serializer=b,this._queries=[],this._documents=[],this.collectionGroups=new Set,this.progress=nk(a)}get queries(){return this._queries}get documents(){return this._documents}addSizedElement(a){this.progress.bytesLoaded+=a.byteLength;let b=this.progress.documentsLoaded;if(a.payload.namedQuery)this._queries.push(a.payload.namedQuery);else if(a.payload.documentMetadata){this._documents.push({metadata:a.payload.documentMetadata}),!a.payload.documentMetadata.exists&&++b;let c=ap.fromString(a.payload.documentMetadata.name);this.collectionGroups.add(c.get(c.length-2))}else a.payload.document&&(this._documents[this._documents.length-1].document=a.payload.document,++b);return b!==this.progress.documentsLoaded?(this.progress.documentsLoaded=b,{...this.progress}):null}getQueryDocumentMapping(a){let b=new Map,c=new ni(this.serializer);for(let d of a)if(d.metadata.queries){let a=c.toDocumentKey(d.metadata.name);for(let c of d.metadata.queries){let d=(b.get(c)||fm()).add(a);b.set(c,d)}}return b}async completeAndStoreAsync(a){let b=await la(a,new ni(this.serializer),this._documents,this.bundleMetadata.id),c=this.getQueryDocumentMapping(this.documents);for(let b of this._queries)await le(a,b,c.get(b.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:b}}}function nk(a){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}}function nl(a){return{taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}}class nm{constructor(a){this.key=a}}class nn{constructor(a){this.key=a}}class no{constructor(a,b){this.query=a,this._syncedDocuments=b,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=fm(),this.mutatedKeys=fm(),this.docComparator=e7(a),this.documentSet=new m0(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(a,b){let c=b?b.changeSet:new m1,d=b?b.documentSet:this.documentSet,e=b?b.mutatedKeys:this.mutatedKeys,f=d,g=!1,h="F"===this.query.limitType&&d.size===this.query.limit?d.last():null,i="L"===this.query.limitType&&d.size===this.query.limit?d.first():null;if(a.inorderTraversal((a,b)=>{let j=d.get(a),k=e1(this.query,b)?b:null,l=!!j&&this.mutatedKeys.has(j.key),m=!!k&&(k.hasLocalMutations||this.mutatedKeys.has(k.key)&&k.hasCommittedMutations),n=!1;j&&k?j.data.isEqual(k.data)?l!==m&&(c.track({type:3,doc:k}),n=!0):!this.shouldWaitForSyncedDocument(j,k)&&(c.track({type:2,doc:k}),n=!0,(h&&this.docComparator(k,h)>0||i&&0>this.docComparator(k,i))&&(g=!0)):!j&&k?(c.track({type:0,doc:k}),n=!0):j&&!k&&(c.track({type:1,doc:j}),n=!0,(h||i)&&(g=!0)),n&&(k?(f=f.add(k),e=m?e.add(a):e.delete(a)):(f=f.delete(a),e=e.delete(a)))}),null!==this.query.limit)for(;f.size>this.query.limit;){let a="F"===this.query.limitType?f.last():f.first();f=f.delete(a.key),e=e.delete(a.key),c.track({type:1,doc:a})}return{documentSet:f,changeSet:c,needsRefill:g,mutatedKeys:e}}shouldWaitForSyncedDocument(a,b){return a.hasLocalMutations&&b.hasCommittedMutations&&!b.hasLocalMutations}applyChanges(a,b,c,d){let e=this.documentSet;this.documentSet=a.documentSet,this.mutatedKeys=a.mutatedKeys;let f=a.changeSet.getChanges();f.sort((a,b)=>np(a.type,b.type)||this.docComparator(a.doc,b.doc)),this.applyTargetChange(c),d=d??!1;let g=b&&!d?this.updateLimboDocuments():[],h=+!!(0===this.limboDocuments.size&&this.current&&!d),i=h!==this.syncState;return(this.syncState=h,0!==f.length||i)?{snapshot:new m2(this.query,a.documentSet,e,f,a.mutatedKeys,0===h,i,!1,!!c&&c.resumeToken.approximateByteSize()>0),limboChanges:g}:{limboChanges:g}}applyOnlineStateChange(a){return this.current&&"Offline"===a?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new m1,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(a){return!this._syncedDocuments.has(a)&&!!this.documentSet.has(a)&&!this.documentSet.get(a).hasLocalMutations}applyTargetChange(a){a&&(a.addedDocuments.forEach(a=>this._syncedDocuments=this._syncedDocuments.add(a)),a.modifiedDocuments.forEach(a=>{}),a.removedDocuments.forEach(a=>this._syncedDocuments=this._syncedDocuments.delete(a)),this.current=a.current)}updateLimboDocuments(){if(!this.current)return[];let a=this.limboDocuments;this.limboDocuments=fm(),this.documentSet.forEach(a=>{this.shouldBeInLimbo(a.key)&&(this.limboDocuments=this.limboDocuments.add(a.key))});let b=[];return a.forEach(a=>{this.limboDocuments.has(a)||b.push(new nn(a))}),this.limboDocuments.forEach(c=>{a.has(c)||b.push(new nm(c))}),b}synchronizeWithPersistedState(a){this._syncedDocuments=a.remoteKeys,this.limboDocuments=fm();let b=this.computeDocChanges(a.documents);return this.applyChanges(b,!0)}computeInitialSnapshot(){return m2.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState,this.hasCachedResults)}}function np(a,b){let c=a=>{switch(a){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return A(20277,{change:a})}};return c(a)-c(b)}let nq="SyncEngine";class nr{constructor(a,b,c){this.query=a,this.targetId=b,this.view=c}}class ns{constructor(a){this.key=a,this.receivedDocument=!1}}class nt{constructor(a,b,c,d,e,f){this.localStore=a,this.remoteStore=b,this.eventManager=c,this.sharedClientState=d,this.currentUser=e,this.maxConcurrentLimboResolutions=f,this.syncEngineListener={},this.queryViewsByQuery=new e9(a=>e_(a),e$),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new cB(as.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new j_,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=jp.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}}function nu(a,b,c,d,e,f,g){let h=new nt(a,b,c,d,e,f);return g&&(h._isPrimaryClient=!0),h}async function nv(a,b,c=!0){let d,e=n2(a),f=e.queryViewsByQuery.get(b);return f?(e.sharedClientState.addLocalQueryTarget(f.targetId),d=f.view.computeInitialSnapshot()):d=await nx(e,b,c,!0),d}async function nw(a,b){let c=n2(a);await nx(c,b,!0,!1)}async function nx(a,b,c,d){let e,f=await k$(a.localStore,eS(b)),g=f.targetId,h=a.sharedClientState.addLocalQueryTarget(g,c);return d&&(e=await ny(a,b,g,"current"===h,f.resumeToken)),a.isPrimaryClient&&c&&mu(a.remoteStore,f),e}async function ny(a,b,c,d,e){a.applyDocChanges=(b,c,d)=>nR(a,b,c,d);let f=await k1(a.localStore,b,!0),g=new no(b,f.remoteKeys),h=g.computeDocChanges(f.documents),i=gl.createSynthesizedTargetChangeForCurrentChange(c,d&&"Offline"!==a.onlineState,e),j=g.applyChanges(h,a.isPrimaryClient,i);nN(a,c,j.limboChanges);let k=new nr(b,c,g);return a.queryViewsByQuery.set(b,k),a.queriesByTarget.has(c)?a.queriesByTarget.get(c).push(b):a.queriesByTarget.set(c,[b]),j.snapshot}async function nz(a,b,c){let d=D(a),e=d.queryViewsByQuery.get(b),f=d.queriesByTarget.get(e.targetId);if(f.length>1){d.queriesByTarget.set(e.targetId,f.filter(a=>!e$(a,b))),d.queryViewsByQuery.delete(b);return}d.isPrimaryClient?(d.sharedClientState.removeLocalQueryTarget(e.targetId),d.sharedClientState.isActiveQueryTarget(e.targetId)||await k0(d.localStore,e.targetId,!1).then(()=>{d.sharedClientState.clearQueryState(e.targetId),c&&mv(d.remoteStore,e.targetId),nL(d,e.targetId)}).catch(aZ)):(nL(d,e.targetId),await k0(d.localStore,e.targetId,!0))}async function nA(a,b){let c=D(a),d=c.queryViewsByQuery.get(b),e=c.queriesByTarget.get(d.targetId);c.isPrimaryClient&&1===e.length&&(c.sharedClientState.removeLocalQueryTarget(d.targetId),mv(c.remoteStore,d.targetId))}async function nB(a,b,c){let d=n3(a);try{let a=await kP(d.localStore,b);d.sharedClientState.addPendingMutation(a.batchId),nJ(d,a.batchId,c),await nQ(d,a.changes),await mK(d.remoteStore)}catch(b){let a=m_(b,"Failed to persist write");c.reject(a)}}async function nC(a,b){let c=D(a);try{let a=await kU(c.localStore,b);b.targetChanges.forEach((a,b)=>{let d=c.activeLimboResolutionsByTarget.get(b);d&&(C(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1,22616),a.addedDocuments.size>0?d.receivedDocument=!0:a.modifiedDocuments.size>0?C(d.receivedDocument,14607):a.removedDocuments.size>0&&(C(d.receivedDocument,42227),d.receivedDocument=!1))}),await nQ(c,a,b)}catch(a){await aZ(a)}}function nD(a,b,c){let d=D(a);if(d.isPrimaryClient&&0===c||!d.isPrimaryClient&&1===c){let a=[];d.queryViewsByQuery.forEach((c,d)=>{let e=d.view.applyOnlineStateChange(b);e.snapshot&&a.push(e.snapshot)}),nb(d.eventManager,b),a.length&&d.syncEngineListener.onWatchChange(a),d.onlineState=b,d.isPrimaryClient&&d.sharedClientState.setOnlineState(b)}}async function nE(a,b,c){let d=D(a);d.sharedClientState.updateQueryState(b,"rejected",c);let e=d.activeLimboResolutionsByTarget.get(b),f=e&&e.key;if(f){let a=new cB(as.comparator);a=a.insert(f,dY.newNoDocument(f,aH.min()));let c=fm().add(f),e=new gk(aH.min(),new Map,new cB(ag),a,c);await nC(d,e),d.activeLimboTargetsByKey=d.activeLimboTargetsByKey.remove(f),d.activeLimboResolutionsByTarget.delete(b),nP(d)}else await k0(d.localStore,b,!1).then(()=>nL(d,b,c)).catch(aZ)}async function nF(a,b){let c=D(a),d=b.batch.batchId;try{let a=await kQ(c.localStore,b);nK(c,d,null),nH(c,d),c.sharedClientState.updateMutationState(d,"acknowledged"),await nQ(c,a)}catch(a){await aZ(a)}}async function nG(a,b,c){let d=D(a);try{let a=await kS(d.localStore,b);nK(d,b,c),nH(d,b),d.sharedClientState.updateMutationState(b,"rejected",c),await nQ(d,a)}catch(a){await aZ(a)}}function nH(a,b){(a.pendingWritesCallbacks.get(b)||[]).forEach(a=>{a.resolve()}),a.pendingWritesCallbacks.delete(b)}function nI(a,b){a.pendingWritesCallbacks.forEach(a=>{a.forEach(a=>{a.reject(new V(F,b))})}),a.pendingWritesCallbacks.clear()}function nJ(a,b,c){let d=a.mutationUserCallbacks[a.currentUser.toKey()];d||(d=new cB(ag)),d=d.insert(b,c),a.mutationUserCallbacks[a.currentUser.toKey()]=d}function nK(a,b,c){let d=D(a),e=d.mutationUserCallbacks[d.currentUser.toKey()];if(e){let a=e.get(b);a&&(c?a.reject(c):a.resolve(),e=e.remove(b)),d.mutationUserCallbacks[d.currentUser.toKey()]=e}}function nL(a,b,c=null){for(let d of(a.sharedClientState.removeLocalQueryTarget(b),a.queriesByTarget.get(b)))a.queryViewsByQuery.delete(d),c&&a.syncEngineListener.onWatchError(d,c);a.queriesByTarget.delete(b),a.isPrimaryClient&&a.limboDocumentRefs.removeReferencesForId(b).forEach(b=>{a.limboDocumentRefs.containsKey(b)||nM(a,b)})}function nM(a,b){a.enqueuedLimboResolutions.delete(b.path.canonicalString());let c=a.activeLimboTargetsByKey.get(b);null!==c&&(mv(a.remoteStore,c),a.activeLimboTargetsByKey=a.activeLimboTargetsByKey.remove(b),a.activeLimboResolutionsByTarget.delete(c),nP(a))}function nN(a,b,c){for(let d of c)d instanceof nm?(a.limboDocumentRefs.addReference(d.key,b),nO(a,d)):d instanceof nn?(w(nq,"Document no longer in limbo: "+d.key),a.limboDocumentRefs.removeReference(d.key,b),a.limboDocumentRefs.containsKey(d.key)||nM(a,d.key)):A(19791,{limboChange:d})}function nO(a,b){let c=b.key,d=c.path.canonicalString();a.activeLimboTargetsByKey.get(c)||a.enqueuedLimboResolutions.has(d)||(w(nq,"New document in limbo: "+c),a.enqueuedLimboResolutions.add(d),nP(a))}function nP(a){for(;a.enqueuedLimboResolutions.size>0&&a.activeLimboTargetsByKey.size<a.maxConcurrentLimboResolutions;){let b=a.enqueuedLimboResolutions.values().next().value;a.enqueuedLimboResolutions.delete(b);let c=new as(ap.fromString(b)),d=a.limboTargetIdGenerator.next();a.activeLimboResolutionsByTarget.set(d,new ns(c)),a.activeLimboTargetsByKey=a.activeLimboTargetsByKey.insert(c,d),mu(a.remoteStore,new hK(eS(eL(c.path)),d,"TargetPurposeLimboResolution",bh.INVALID))}}async function nQ(a,b,c){let d=D(a),e=[],f=[],g=[];d.queryViewsByQuery.isEmpty()||(d.queryViewsByQuery.forEach((a,h)=>{g.push(d.applyDocChanges(h,b,c).then(a=>{if((a||c)&&d.isPrimaryClient){let b=a?!a.fromCache:c?.targetChanges.get(h.targetId)?.current;d.sharedClientState.updateQueryState(h.targetId,b?"current":"not-current")}if(a){e.push(a);let b=nh.fromSnapshot(h.targetId,a);f.push(b)}}))}),await Promise.all(g),d.syncEngineListener.onWatchChange(e),await kX(d.localStore,f))}async function nR(a,b,c,d){let e=b.view.computeDocChanges(c);e.needsRefill&&(e=await k1(a.localStore,b.query,!1).then(({documents:a})=>b.view.computeDocChanges(a,e)));let f=d&&d.targetChanges.get(b.targetId),g=d&&null!=d.targetMismatches.get(b.targetId),h=b.view.applyChanges(e,a.isPrimaryClient,f,g);return nN(a,b.targetId,h.limboChanges),h.snapshot}async function nS(a,b){let c=D(a);if(!c.currentUser.isEqual(b)){w(nq,"User change. New user:",b.toKey());let a=await kO(c.localStore,b);c.currentUser=b,nI(c,"'waitForPendingWrites' promise is rejected due to a user change."),c.sharedClientState.handleUserChange(b,a.removedBatchIds,a.addedBatchIds),await nQ(c,a.affectedDocuments)}}function nT(a,b){let c=D(a),d=c.activeLimboResolutionsByTarget.get(b);if(d&&d.receivedDocument)return fm().add(d.key);{let a=fm(),d=c.queriesByTarget.get(b);if(!d)return a;for(let b of d){let d=c.queryViewsByQuery.get(b);a=a.unionWith(d.view.syncedDocuments)}return a}}async function nU(a,b){let c=D(a),d=await k1(c.localStore,b.query,!0),e=b.view.synchronizeWithPersistedState(d);return c.isPrimaryClient&&nN(c,b.targetId,e.limboChanges),e}async function nV(a,b){let c=D(a);return k7(c.localStore,b).then(a=>nQ(c,a))}async function nW(a,b,c,d){let e=D(a),f=await k3(e.localStore,b);null===f?w(nq,"Cannot apply mutation batch with id: "+b):("pending"===c?await mK(e.remoteStore):"acknowledged"===c||"rejected"===c?(nK(e,b,d||null),nH(e,b),k4(e.localStore,b)):A(6720,"Unknown batchState",{batchState:c}),await nQ(e,f))}async function nX(a,b){let c=D(a);if(n2(c),n3(c),!0===b&&!0!==c._isPrimaryClient){let a=c.sharedClientState.getAllActiveQueryTargets(),b=await nZ(c,a.toArray());for(let a of(c._isPrimaryClient=!0,await mW(c.remoteStore,!0),b))mu(c.remoteStore,a)}else if(!1===b&&!1!==c._isPrimaryClient){let a=[],b=Promise.resolve();c.queriesByTarget.forEach((d,e)=>{c.sharedClientState.isLocalQueryTarget(e)?a.push(e):b=b.then(()=>(nL(c,e),k0(c.localStore,e,!0))),mv(c.remoteStore,e)}),await b,await nZ(c,a),nY(c),c._isPrimaryClient=!1,await mW(c.remoteStore,!1)}}function nY(a){let b=D(a);b.activeLimboResolutionsByTarget.forEach((a,c)=>{mv(b.remoteStore,c)}),b.limboDocumentRefs.removeAllReferences(),b.activeLimboResolutionsByTarget=new Map,b.activeLimboTargetsByKey=new cB(as.comparator)}async function nZ(a,b,c){let d=D(a),e=[],f=[];for(let a of b){let b,c=d.queriesByTarget.get(a);if(c&&0!==c.length)for(let a of(b=await k$(d.localStore,eS(c[0])),c)){let b=d.queryViewsByQuery.get(a),c=await nU(d,b);c.snapshot&&f.push(c.snapshot)}else{let c=await k6(d.localStore,a);b=await k$(d.localStore,c),await ny(d,n$(c),a,!1,b.resumeToken)}e.push(b)}return d.syncEngineListener.onWatchChange(f),e}function n$(a){return eK(a.path,a.collectionGroup,a.orderBy,a.filters,a.limit,"F",a.startAt,a.endAt)}function n_(a){return k5(D(a).localStore)}async function n0(a,b,c,d){let e=D(a);if(e._isPrimaryClient)return void w(nq,"Ignoring unexpected query state notification.");let f=e.queriesByTarget.get(b);if(f&&f.length>0)switch(c){case"current":case"not-current":{let a=await k7(e.localStore,e6(f[0])),d=gk.createSynthesizedRemoteEventForCurrentChange(b,"current"===c,cM.EMPTY_BYTE_STRING);await nQ(e,a,d);break}case"rejected":await k0(e.localStore,b,!0),nL(e,b,d);break;default:A(64155,c)}}async function n1(a,b,c){let d=n2(a);if(d._isPrimaryClient){for(let a of b){if(d.queriesByTarget.has(a)&&d.sharedClientState.isActiveQueryTarget(a)){w(nq,"Adding an already active target "+a);continue}let b=await k6(d.localStore,a),c=await k$(d.localStore,b);await ny(d,n$(b),c.targetId,!1,c.resumeToken),mu(d.remoteStore,c)}for(let a of c)d.queriesByTarget.has(a)&&await k0(d.localStore,a,!1).then(()=>{mv(d.remoteStore,a),nL(d,a)}).catch(aZ)}}function n2(a){let b=D(a);return b.remoteStore.remoteSyncer.applyRemoteEvent=nC.bind(null,b),b.remoteStore.remoteSyncer.getRemoteKeysForTarget=nT.bind(null,b),b.remoteStore.remoteSyncer.rejectListen=nE.bind(null,b),b.syncEngineListener.onWatchChange=m9.bind(null,b.eventManager),b.syncEngineListener.onWatchError=na.bind(null,b.eventManager),b}function n3(a){let b=D(a);return b.remoteStore.remoteSyncer.applySuccessfulWrite=nF.bind(null,b),b.remoteStore.remoteSyncer.rejectFailedWrite=nG.bind(null,b),b}function n4(a,b,c){let d=D(a);n5(d,b,c).then(a=>{d.sharedClientState.notifyBundleLoaded(a)})}async function n5(a,b,c){try{let d=await b.getMetadata();if(await lb(a.localStore,d))return await b.close(),c._completeWith(nl(d)),Promise.resolve(new Set);c._updateProgress(nk(d));let e=new nj(d,b.serializer),f=await b.nextElement();for(;f;){let a=await e.addSizedElement(f);a&&c._updateProgress(a),f=await b.nextElement()}let g=await e.completeAndStoreAsync(a.localStore);return await nQ(a,g.changedDocs,void 0),await lc(a.localStore,d),c._completeWith(g.progress),Promise.resolve(g.changedCollectionGroups)}catch(a){return y(nq,`Loading bundle failed with ${a}`),c._failWith(a),Promise.resolve(new Set)}}class n6{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(a){this.serializer=l_(a.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(a),this.persistence=this.createPersistence(a),await this.persistence.start(),this.localStore=this.createLocalStore(a),this.gcScheduler=this.createGarbageCollectionScheduler(a,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(a,this.localStore)}createGarbageCollectionScheduler(a,b){return null}createIndexBackfillerScheduler(a,b){return null}createLocalStore(a){return kN(this.persistence,new ll,a.initialUser,this.serializer)}createPersistence(a){return new j9(kb.factory,this.serializer)}createSharedClientState(a){return new lG}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}n6.provider={build:()=>new n6};class n7 extends n6{constructor(a){super(),this.cacheSizeBytes=a}createGarbageCollectionScheduler(a,b){return C(this.persistence.referenceDelegate instanceof kc,46915),new jE(this.persistence.referenceDelegate.garbageCollector,a.asyncQueue,b)}createPersistence(a){let b=void 0!==this.cacheSizeBytes?jx.withCacheSize(this.cacheSizeBytes):jx.DEFAULT;return new j9(a=>kc.factory(a,b),this.serializer)}}class n8 extends n6{constructor(a,b,c){super(),this.onlineComponentProvider=a,this.cacheSizeBytes=b,this.forceOwnership=c,this.kind="persistent",this.synchronizeTabs=!1}async initialize(a){await super.initialize(a),await this.onlineComponentProvider.initialize(this,a),await n3(this.onlineComponentProvider.syncEngine),await mK(this.onlineComponentProvider.remoteStore),await this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(a){return kN(this.persistence,new ll,a.initialUser,this.serializer)}createGarbageCollectionScheduler(a,b){return new jE(this.persistence.referenceDelegate.garbageCollector,a.asyncQueue,b)}createIndexBackfillerScheduler(a,b){let c=new bg(b,this.persistence);return new bf(a.asyncQueue,c)}createPersistence(a){let b=kH(a.databaseInfo.databaseId,a.databaseInfo.persistenceKey),c=void 0!==this.cacheSizeBytes?jx.withCacheSize(this.cacheSizeBytes):jx.DEFAULT;return new kE(this.synchronizeTabs,b,a.clientId,c,a.asyncQueue,lZ(),l$(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(a){return new lG}}class n9 extends n8{constructor(a,b){super(a,b,!1),this.onlineComponentProvider=a,this.cacheSizeBytes=b,this.synchronizeTabs=!0}async initialize(a){await super.initialize(a);let b=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof lE&&(this.sharedClientState.syncEngine={applyBatchState:nW.bind(null,b),applyTargetState:n0.bind(null,b),applyActiveTargetsChange:n1.bind(null,b),getActiveClients:n_.bind(null,b),synchronizeWithChangedDocuments:nV.bind(null,b)},await this.sharedClientState.start()),await this.persistence.setPrimaryStateListener(async a=>{await nX(this.onlineComponentProvider.syncEngine,a),this.gcScheduler&&(a&&!this.gcScheduler.started?this.gcScheduler.start():a||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(a&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():a||this.indexBackfillerScheduler.stop())})}createSharedClientState(a){let b=lZ();if(!lE.isAvailable(b))throw new V(R,"IndexedDB persistence is only available on platforms that support LocalStorage.");let c=kH(a.databaseInfo.databaseId,a.databaseInfo.persistenceKey);return new lE(b,a.asyncQueue,c,a.clientId,a.initialUser)}}class oa{async initialize(a,b){this.localStore||(this.localStore=a.localStore,this.sharedClientState=a.sharedClientState,this.datastore=this.createDatastore(b),this.remoteStore=this.createRemoteStore(b),this.eventManager=this.createEventManager(b),this.syncEngine=this.createSyncEngine(b,!a.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>nD(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=nS.bind(null,this.syncEngine),await mW(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(a){return m4()}createDatastore(a){let b=l_(a.databaseInfo.databaseId),c=lX(a.databaseInfo);return md(a.authCredentials,a.appCheckCredentials,c,b)}createRemoteStore(a){return mq(this.localStore,this.datastore,a.asyncQueue,a=>nD(this.syncEngine,a,0),lY())}createSyncEngine(a,b){return nu(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,a.initialUser,a.maxConcurrentLimboResolutions,b)}async terminate(){await mt(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}oa.provider={build:()=>new oa};let ob=10240;function oc(a,b=ob){let c=0;return{async read(){if(c<a.byteLength){let d={value:a.slice(c,c+b),done:!1};return c+=b,d}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}function od(a,b){if(!(a instanceof Uint8Array))throw new V(H,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${ay(a)}`);return oc(a,b)}class oe{constructor(a){this.observer=a,this.muted=!1}next(a){!this.muted&&this.observer.next&&this.scheduleEvent(this.observer.next,a)}error(a){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,a):x("Uncaught Error in snapshot listener:",a.toString()))}mute(){this.muted=!0}scheduleEvent(a,b){setTimeout(()=>{this.muted||a(b)},0)}}class of{constructor(a,b){this.payload=a,this.byteLength=b}isBundleMetadata(){return"metadata"in this.payload}}class og{constructor(a,b){this.reader=a,this.serializer=b,this.metadata=new W,this.buffer=new Uint8Array,this.textDecoder=ge(),this.nextElementImpl().then(a=>{a&&a.isBundleMetadata()?this.metadata.resolve(a.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(a?.payload)}`))},a=>this.metadata.reject(a))}close(){return this.reader.cancel()}async getMetadata(){return this.metadata.promise}async nextElement(){return await this.getMetadata(),this.nextElementImpl()}async nextElementImpl(){let a=await this.readLength();if(null===a)return null;let b=this.textDecoder.decode(a),c=Number(b);return isNaN(c)&&this.raiseError(`length string (${b}) is not valid number`),new of(JSON.parse(await this.readJsonString(c)),a.length+c)}indexOfOpenBracket(){return this.buffer.findIndex(a=>123===a)}async readLength(){for(;0>this.indexOfOpenBracket()&&!await this.pullMoreDataToBuffer(););if(0===this.buffer.length)return null;let a=this.indexOfOpenBracket();a<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let b=this.buffer.slice(0,a);return this.buffer=this.buffer.slice(a),b}async readJsonString(a){for(;this.buffer.length<a;)await this.pullMoreDataToBuffer()&&this.raiseError("Reached the end of bundle when more is expected.");let b=this.textDecoder.decode(this.buffer.slice(0,a));return this.buffer=this.buffer.slice(a),b}raiseError(a){throw this.reader.cancel(),Error(`Invalid bundle format: ${a}`)}async pullMoreDataToBuffer(){let a=await this.reader.read();if(!a.done){let b=new Uint8Array(this.buffer.length+a.value.length);b.set(this.buffer),b.set(a.value,this.buffer.length),this.buffer=b}return a.done}}function oh(a,b){return new og(a,b)}class oi{constructor(a,b){this.bundleData=a,this.serializer=b,this.cursor=0,this.elements=[];let c=this.nextElement();if(c&&c.isBundleMetadata())this.metadata=c;else throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(c?.payload)}`);do null!==(c=this.nextElement())&&this.elements.push(c);while(null!==c)}getMetadata(){return this.metadata}getElements(){return this.elements}nextElement(){if(this.cursor===this.bundleData.length)return null;let a=this.readLength();return new of(JSON.parse(this.readJsonString(a)),a)}readJsonString(a){if(this.cursor+a>this.bundleData.length)throw new V(S,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=a)}readLength(){let a=this.cursor,b=this.cursor;for(;b<this.bundleData.length;){if("{"===this.bundleData[b]){if(b===a)throw Error("First character is a bracket and not a number");return this.cursor=b,Number(this.bundleData.slice(a,b))}b++}throw Error("Reached the end of bundle when more is expected.")}}function oj(a,b){return new oi(a,b)}class ok{constructor(a){this.datastore=a,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(a){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new V(H,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let b=await mf(this.datastore,a);return b.forEach(a=>this.recordVersion(a)),b}set(a,b){this.write(b.toMutation(a,this.precondition(a))),this.writtenDocs.add(a.toString())}update(a,b){try{this.write(b.toMutation(a,this.preconditionForUpdate(a)))}catch(a){this.lastTransactionError=a}this.writtenDocs.add(a.toString())}delete(a){this.write(new f_(a,this.precondition(a))),this.writtenDocs.add(a.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let a=this.readVersions;this.mutations.forEach(b=>{a.delete(b.key.toString())}),a.forEach((a,b)=>{let c=as.fromPath(b);this.mutations.push(new f2(c,this.precondition(c)))}),await me(this.datastore,this.mutations),this.committed=!0}recordVersion(a){let b;if(a.isFoundDocument())b=a.version;else if(a.isNoDocument())b=aH.min();else throw A(50498,{documentName:a.constructor.name});let c=this.readVersions.get(a.key.toString());if(c){if(!b.isEqual(c))throw new V(P,"Document version changed between two reads.")}else this.readVersions.set(a.key.toString(),b)}precondition(a){let b=this.readVersions.get(a.toString());return this.writtenDocs.has(a.toString())||!b?fK.none():b.isEqual(aH.min())?fK.exists(!1):fK.updateTime(b)}preconditionForUpdate(a){let b=this.readVersions.get(a.toString());if(this.writtenDocs.has(a.toString())||!b)return fK.exists(!0);if(b.isEqual(aH.min()))throw new V(H,"Can't update a document that doesn't exist.");return fK.updateTime(b)}write(a){this.ensureCommitNotCalled(),this.mutations.push(a)}ensureCommitNotCalled(){}}class ol{constructor(a,b,c,d,e){this.asyncQueue=a,this.datastore=b,this.options=c,this.updateFunction=d,this.deferred=e,this.attemptsRemaining=c.maxAttempts,this.backoff=new l4(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(async()=>{let a=new ok(this.datastore),b=this.tryRunUpdateFunction(a);b&&b.then(b=>{this.asyncQueue.enqueueAndForget(()=>a.commit().then(()=>{this.deferred.resolve(b)}).catch(a=>{this.handleTransactionError(a)}))}).catch(a=>{this.handleTransactionError(a)})})}tryRunUpdateFunction(a){try{let b=this.updateFunction(a);if(c4(b)||!b.catch||!b.then)return this.deferred.reject(Error("Transaction callback must return a Promise")),null;return b}catch(a){return this.deferred.reject(a),null}}handleTransactionError(a){this.attemptsRemaining>0&&this.isRetryableTransactionError(a)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(a)}isRetryableTransactionError(a){if(a?.name==="FirebaseError"){let b=a.code;return"aborted"===b||"failed-precondition"===b||"already-exists"===b||!f7(b)}return!1}}let om="FirestoreClient",on=100,oo=11,op=20,oq=22;class or{constructor(a,b,c,d,e){this.authCredentials=a,this.appCheckCredentials=b,this.asyncQueue=c,this._databaseInfo=d,this.user=q.UNAUTHENTICATED,this.clientId=af.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=e,this.authCredentials.start(c,async a=>{w(om,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(c,a=>(w(om,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:on}}setCredentialChangeListener(a){this.authCredentialListener=a}setAppCheckTokenChangeListener(a){this.appCheckCredentialListener=a}terminate(){this.asyncQueue.enterRestrictedMode();let a=new W;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),a.resolve()}catch(c){let b=m_(c,"Failed to shutdown persistence");a.reject(b)}}),a.promise}}async function os(a,b){a.asyncQueue.verifyOperationInProgress(),w(om,"Initializing OfflineComponentProvider");let c=a.configuration;await b.initialize(c);let d=c.initialUser;a.setCredentialChangeListener(async a=>{d.isEqual(a)||(await kO(b.localStore,a),d=a)}),b.persistence.setDatabaseDeletedListener(()=>a.terminate()),a._offlineComponents=b}async function ot(a,b){a.asyncQueue.verifyOperationInProgress();let c=await ov(a);w(om,"Initializing OnlineComponentProvider"),await b.initialize(c,a.configuration),a.setCredentialChangeListener(a=>mV(b.remoteStore,a)),a.setAppCheckTokenChangeListener((a,c)=>mV(b.remoteStore,c)),a._onlineComponents=b}function ou(a){return"FirebaseError"===a.name?a.code===O||a.code===R:!("u">typeof DOMException&&a instanceof DOMException)||a.code===oq||a.code===op||a.code===oo}async function ov(a){if(!a._offlineComponents)if(a._uninitializedComponentsProvider){w(om,"Using user provided OfflineComponentProvider");try{await os(a,a._uninitializedComponentsProvider._offline)}catch(c){let b=c;if(!ou(b))throw b;y("Error using user provided cache. Falling back to memory cache: "+b),await os(a,new n6)}}else w(om,"Using default OfflineComponentProvider"),await os(a,new n7(void 0));return a._offlineComponents}async function ow(a){return a._onlineComponents||(a._uninitializedComponentsProvider?(w(om,"Using user provided OnlineComponentProvider"),await ot(a,a._uninitializedComponentsProvider._online)):(w(om,"Using default OnlineComponentProvider"),await ot(a,new oa))),a._onlineComponents}function ox(a){return ov(a).then(a=>a.localStore)}function oy(a){return ow(a).then(a=>a.syncEngine)}function oz(a){return ow(a).then(a=>a.datastore)}async function oA(a){let b=await ow(a),c=b.eventManager;return c.onListen=nv.bind(null,b.syncEngine),c.onUnlisten=nz.bind(null,b.syncEngine),c.onFirstRemoteStoreListen=nw.bind(null,b.syncEngine),c.onLastRemoteStoreUnlisten=nA.bind(null,b.syncEngine),c}function oB(a,b,c,d){let e=new oe(d),f=new ng(b,e,c);return a.asyncQueue.enqueueAndForget(async()=>m7(await oA(a),f)),()=>{e.mute(),a.asyncQueue.enqueueAndForget(async()=>m8(await oA(a),f))}}function oC(a,b){let c=new W;return a.asyncQueue.enqueueAndForget(async()=>oK(await ox(a),b,c)),c.promise}function oD(a,b,c={}){let d=new W;return a.asyncQueue.enqueueAndForget(async()=>oL(await oA(a),a.asyncQueue,b,c,d)),d.promise}function oE(a,b){let c=new W;return a.asyncQueue.enqueueAndForget(async()=>oM(await ox(a),b,c)),c.promise}function oF(a,b,c={}){let d=new W;return a.asyncQueue.enqueueAndForget(async()=>oN(await oA(a),a.asyncQueue,b,c,d)),d.promise}function oG(a,b,c){let d=new W;return a.asyncQueue.enqueueAndForget(async()=>{try{let e=await oz(a);d.resolve(mg(e,b,c))}catch(a){d.reject(a)}}),d.promise}function oH(a,b){let c=new W;return a.asyncQueue.enqueueAndForget(async()=>nB(await oy(a),b,c)),c.promise}function oI(a,b){let c=new oe(b);return a.asyncQueue.enqueueAndForget(async()=>nc(await oA(a),c)),()=>{c.mute(),a.asyncQueue.enqueueAndForget(async()=>nd(await oA(a),c))}}function oJ(a,b,c){let d=new W;return a.asyncQueue.enqueueAndForget(async()=>{let e=await oz(a);new ol(a.asyncQueue,e,c,b,d).run()}),d.promise}async function oK(a,b,c){try{let d=await kZ(a,b);d.isFoundDocument()?c.resolve(d):d.isNoDocument()?c.resolve(null):c.reject(new V(T,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(d){let a=m_(d,`Failed to get document '${b} from cache`);c.reject(a)}}function oL(a,b,c,d,e){let f=new oe({next:h=>{f.mute(),b.enqueueAndForget(()=>m8(a,g));let i=h.docs.has(c);!i&&h.fromCache?e.reject(new V(T,"Failed to get document because the client is offline.")):i&&h.fromCache&&d&&"server"===d.source?e.reject(new V(T,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e.resolve(h)},error:a=>e.reject(a)}),g=new ng(eL(c.path),f,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return m7(a,g)}async function oM(a,b,c){try{let d=await k1(a,b,!0),e=new no(b,d.remoteKeys),f=e.computeDocChanges(d.documents),g=e.applyChanges(f,!1);c.resolve(g.snapshot)}catch(d){let a=m_(d,`Failed to execute query '${b} against cache`);c.reject(a)}}function oN(a,b,c,d,e){let f=new oe({next:c=>{f.mute(),b.enqueueAndForget(()=>m8(a,g)),c.fromCache&&"server"===d.source?e.reject(new V(T,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e.resolve(c)},error:a=>e.reject(a)}),g=new ng(c,f,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return m7(a,g)}function oO(a,b,c,d){let e=oQ(c,l_(b));a.asyncQueue.enqueueAndForget(async()=>{n4(await oy(a),e,d)})}function oP(a,b){return a.asyncQueue.enqueue(async()=>ld(await ox(a),b))}function oQ(a,b){let c;return oh(od(c="string"==typeof a?gd().encode(a):a),b)}function oR(a,b){return oj(a,b)}function oS(a,b){return a.asyncQueue.enqueue(async()=>lf(await ox(a),b))}function oT(a,b){return a.asyncQueue.enqueue(async()=>lg(await ox(a),b))}function oU(a){return a.asyncQueue.enqueue(async()=>lh(await ox(a)))}function oV(a,b){return a.timeoutSeconds===b.timeoutSeconds}function oW(a){let b={};return void 0!==a.timeoutSeconds&&(b.timeoutSeconds=a.timeoutSeconds),b}let oX="ComponentProvider",oY=new Map;function oZ(a){let b=oY.get(a);b&&(w(oX,"Removing Datastore"),oY.delete(a),b.terminate())}function o$(a,b,c,d,e){return new c_(a,b,c,e.host,e.ssl,e.experimentalForceLongPolling,e.experimentalAutoDetectLongPolling,oW(e.experimentalLongPollingOptions),e.useFetchStreams,e.isUsingEmulator,d)}let o_="firestore.googleapis.com",o0=!0,o1=5,o2=30,o3=!0;class o4{constructor(a){if(void 0===a.host){if(void 0!==a.ssl)throw new V(H,"Can't provide ssl option if host option is not set");this.host=o_,this.ssl=o0}else this.host=a.host,this.ssl=a.ssl??o0;if(this.isUsingEmulator=void 0!==a.emulatorOptions,this.credentials=a.credentials,this.ignoreUndefinedProperties=!!a.ignoreUndefinedProperties,this.localCache=a.localCache,void 0===a.cacheSizeBytes)this.cacheSizeBytes=jw;else if(a.cacheSizeBytes!==jv&&a.cacheSizeBytes<jz)throw new V(H,`cacheSizeBytes must be at least ${jz}`);else this.cacheSizeBytes=a.cacheSizeBytes;au("experimentalForceLongPolling",a.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",a.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!a.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===a.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=o3:this.experimentalAutoDetectLongPolling=!!a.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=oW(a.experimentalLongPollingOptions??{}),o5(this.experimentalLongPollingOptions),this.useFetchStreams=!!a.useFetchStreams}isEqual(a){return this.host===a.host&&this.ssl===a.ssl&&this.credentials===a.credentials&&this.cacheSizeBytes===a.cacheSizeBytes&&this.experimentalForceLongPolling===a.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===a.experimentalAutoDetectLongPolling&&oV(this.experimentalLongPollingOptions,a.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===a.ignoreUndefinedProperties&&this.useFetchStreams===a.useFetchStreams}}function o5(a){if(void 0!==a.timeoutSeconds){if(isNaN(a.timeoutSeconds))throw new V(H,`invalid long polling timeout: ${a.timeoutSeconds} (must not be NaN)`);if(a.timeoutSeconds<o1)throw new V(H,`invalid long polling timeout: ${a.timeoutSeconds} (minimum allowed value is ${o1})`);if(a.timeoutSeconds>o2)throw new V(H,`invalid long polling timeout: ${a.timeoutSeconds} (maximum allowed value is ${o2})`)}}class o6{constructor(a,b,c,d){this._authCredentials=a,this._appCheckCredentials=b,this._databaseId=c,this._app=d,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new o4({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new V(O,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(a){if(this._settingsFrozen)throw new V(O,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new o4(a),this._emulatorOptions=a.emulatorOptions||{},void 0!==a.credentials&&(this._authCredentials=ad(a.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return oZ(this),Promise.resolve()}}function o7(a,b,c,d={}){a=aA(a,o6);let e=(0,i.isCloudWorkstation)(b),f=a._getSettings(),g={...f,emulatorOptions:a._getEmulatorOptions()},h=`${b}:${c}`;e&&((0,i.pingServer)(`https://${h}`),(0,i.updateEmulatorBanner)("Firestore",!0)),f.host!==o_&&f.host!==h&&y("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let j={...f,host:h,ssl:e,emulatorOptions:d};if(!(0,i.deepEqual)(j,g)&&(a._setSettings(j),d.mockUserToken)){let b,c;if("string"==typeof d.mockUserToken)b=d.mockUserToken,c=q.MOCK_USER;else{b=(0,i.createMockUserToken)(d.mockUserToken,a._app?.options.projectId);let e=d.mockUserToken.sub||d.mockUserToken.user_id;if(!e)throw new V(H,"mockUserToken must contain 'sub' or 'user_id' field!");c=new q(e)}a._authCredentials=new Z(new X(b,c))}}class o8{constructor(a,b,c){this.converter=b,this._query=c,this.type="query",this.firestore=a}withConverter(a){return new o8(this.firestore,a,this._query)}}class o9{constructor(a,b,c){this.converter=b,this._key=c,this.type="document",this.firestore=a}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new pa(this.firestore,this.converter,this._key.path.popLast())}withConverter(a){return new o9(this.firestore,a,this._key)}toJSON(){return{type:o9._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(a,b,c){if(aD(b,o9._jsonSchema))return new o9(a,c||null,new as(ap.fromString(b.referencePath)))}}o9._jsonSchemaVersion="firestore/documentReference/1.0",o9._jsonSchema={type:aC("string",o9._jsonSchemaVersion),referencePath:aC("string")};class pa extends o8{constructor(a,b,c){super(a,b,eL(c)),this._path=c,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let a=this._path.popLast();return a.isEmpty()?null:new o9(this.firestore,null,new as(a))}withConverter(a){return new pa(this.firestore,a,this._path)}}function pb(a,b,...c){if(a=(0,i.getModularInstance)(a),at("collection","path",b),a instanceof o6){let d=ap.fromString(b,...c);return aw(d),new pa(a,null,d)}{if(!(a instanceof o9)&&!(a instanceof pa))throw new V(H,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let d=a._path.child(ap.fromString(b,...c));return aw(d),new pa(a.firestore,null,d)}}function pc(a,b,...c){if(a=(0,i.getModularInstance)(a),1==arguments.length&&(b=af.newId()),at("doc","path",b),a instanceof o6){let d=ap.fromString(b,...c);return av(d),new o9(a,null,new as(d))}{if(!(a instanceof o9)&&!(a instanceof pa))throw new V(H,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let d=a._path.child(ap.fromString(b,...c));return av(d),new o9(a.firestore,a instanceof pa?a.converter:null,new as(d))}}function pd(a,b){return a=(0,i.getModularInstance)(a),b=(0,i.getModularInstance)(b),a instanceof o8&&b instanceof o8&&a.firestore===b.firestore&&e$(a._query,b._query)&&a.converter===b.converter}let pe="AsyncQueue";class pf{constructor(a=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new l4(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=a}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(a){this.enqueue(a)}enqueueAndForgetEvenWhileRestricted(a){this.verifyNotFailed(),this.enqueueInternal(a)}enterRestrictedMode(a){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=a||!1)}enqueue(a){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let b=new W;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(a().then(b.resolve,b.reject),b.promise)).then(()=>b.promise)}enqueueRetryable(a){this.enqueueAndForget(()=>(this.retryableOps.push(a),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(a){if(a6(a))w(pe,"Operation failed with retryable error: "+a);else throw a}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(a){let b=this.tail.then(()=>(this.operationInProgress=!0,a().catch(a=>{throw this.failure=a,this.operationInProgress=!1,x("INTERNAL UNHANDLED ERROR: ",pg(a)),a}).then(a=>(this.operationInProgress=!1,a))));return this.tail=b,b}enqueueAfterDelay(a,b,c){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(a)>-1&&(b=0);let d=m$.createAndSchedule(this,a,b,c,a=>this.removeDelayedOperation(a));return this.delayedOperations.push(d),d}verifyNotFailed(){this.failure&&A(47125,{messageOrStack:pg(this.failure)})}verifyOperationInProgress(){}async drain(){let a;do a=this.tail,await a;while(a!==this.tail)}containsDelayedOperation(a){for(let b of this.delayedOperations)if(b.timerId===a)return!0;return!1}runAllDelayedOperationsUntil(a){return this.drain().then(()=>{for(let b of(this.delayedOperations.sort((a,b)=>a.targetTimeMs-b.targetTimeMs),this.delayedOperations))if(b.skipDelay(),"all"!==a&&b.timerId===a)break;return this.drain()})}skipDelaysForTimerId(a){this.timerIdsToSkip.push(a)}removeDelayedOperation(a){let b=this.delayedOperations.indexOf(a);this.delayedOperations.splice(b,1)}}function pg(a){let b=a.message||"";return a.stack&&(b=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),b}class ph{constructor(){this._progressObserver={},this._taskCompletionResolver=new W,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(a,b,c){this._progressObserver={next:a,error:b,complete:c}}catch(a){return this._taskCompletionResolver.promise.catch(a)}then(a,b){return this._taskCompletionResolver.promise.then(a,b)}_completeWith(a){this._updateProgress(a),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(a)}_failWith(a){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(a),this._taskCompletionResolver.reject(a)}_updateProgress(a){this._lastProgress=a,this._progressObserver.next&&this._progressObserver.next(a)}}class pi extends o6{constructor(a,b,c,d){super(a,b,c,d),this.type="firestore",this._queue=new pf,this._persistenceKey=d?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let a=this._firestoreClient.terminate();this._queue=new pf(a),this._firestoreClient=void 0,await a}}}function pj(a,b){let c="object"==typeof a?a:(0,h.getApp)(),d="string"==typeof a?a:b||c0,e=(0,h._getProvider)(c,"firestore").getImmediate({identifier:d});if(!e._initialized){let a=(0,i.getDefaultEmulatorHostnameAndPort)("firestore");a&&o7(e,...a)}return e}function pk(a){if(a._terminated)throw new V(O,"The client has already been terminated.");return a._firestoreClient||pl(a),a._firestoreClient}function pl(a){let b=a._freezeSettings(),c=o$(a._databaseId,a._app?.options.appId||"",a._persistenceKey,a._app?.options.apiKey,b);!a._componentsProvider&&b.localCache?._offlineComponentProvider&&b.localCache?._onlineComponentProvider&&(a._componentsProvider={_offline:b.localCache._offlineComponentProvider,_online:b.localCache._onlineComponentProvider}),a._firestoreClient=new or(a._authCredentials,a._appCheckCredentials,a._queue,c,a._componentsProvider&&pm(a._componentsProvider))}function pm(a){let b=a?._online.build();return{_offline:a?._offline.build(b),_online:b}}function pn(a,b){let c=pk(a=aA(a,pi)),d=new ph;return oO(c,a._databaseId,b,d),d}function po(a,b){return oP(pk(a=aA(a,pi)),b).then(b=>b?new o8(a,null,b.query):null)}class pp{constructor(a,b,c){this.alias=a,this.aggregateType=b,this.fieldPath=c}}class pq{constructor(a){this._byteString=a}static fromBase64String(a){try{return new pq(cM.fromBase64String(a))}catch(a){throw new V(H,"Failed to construct data from Base64 string: "+a)}}static fromUint8Array(a){return new pq(cM.fromUint8Array(a))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(a){return this._byteString.isEqual(a._byteString)}toJSON(){return{type:pq._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(a){if(aD(a,pq._jsonSchema))return pq.fromBase64String(a.bytes)}}pq._jsonSchemaVersion="firestore/bytes/1.0",pq._jsonSchema={type:aC("string",pq._jsonSchemaVersion),bytes:aC("string")};class pr{constructor(...a){for(let b=0;b<a.length;++b)if(0===a[b].length)throw new V(H,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ar(a)}isEqual(a){return this._internalPath.isEqual(a._internalPath)}}class ps{constructor(a){this._methodName=a}}class pt{constructor(a,b){if(!isFinite(a)||a<-90||a>90)throw new V(H,"Latitude must be a number between -90 and 90, but was: "+a);if(!isFinite(b)||b<-180||b>180)throw new V(H,"Longitude must be a number between -180 and 180, but was: "+b);this._lat=a,this._long=b}get latitude(){return this._lat}get longitude(){return this._long}isEqual(a){return this._lat===a._lat&&this._long===a._long}_compareTo(a){return ag(this._lat,a._lat)||ag(this._long,a._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:pt._jsonSchemaVersion}}static fromJSON(a){if(aD(a,pt._jsonSchema))return new pt(a.latitude,a.longitude)}}pt._jsonSchemaVersion="firestore/geoPoint/1.0",pt._jsonSchema={type:aC("string",pt._jsonSchemaVersion),latitude:aC("number"),longitude:aC("number")};class pu{constructor(a){this._values=(a||[]).map(a=>a)}toArray(){return this._values.map(a=>a)}isEqual(a){return kJ(this._values,a._values)}toJSON(){return{type:pu._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(a){if(aD(a,pu._jsonSchema)){if(Array.isArray(a.vectorValues)&&a.vectorValues.every(a=>"number"==typeof a))return new pu(a.vectorValues);throw new V(H,"Expected 'vectorValues' field to be a number array")}}}pu._jsonSchemaVersion="firestore/vectorValue/1.0",pu._jsonSchema={type:aC("string",pu._jsonSchemaVersion),vectorValues:aC("object")};let pv=/^__.*__$/;class pw{constructor(a,b,c){this.data=a,this.fieldMask=b,this.fieldTransforms=c}toMutation(a,b){return null!==this.fieldMask?new fV(a,this.data,this.fieldMask,b,this.fieldTransforms):new fS(a,this.data,b,this.fieldTransforms)}}class px{constructor(a,b,c){this.data=a,this.fieldMask=b,this.fieldTransforms=c}toMutation(a,b){return new fV(a,this.data,this.fieldMask,b,this.fieldTransforms)}}function py(a){switch(a){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw A(40011,{dataSource:a})}}class pz{constructor(a,b,c,d,e,f){this.settings=a,this.databaseId=b,this.serializer=c,this.ignoreUndefinedProperties=d,void 0===e&&this.validatePath(),this.fieldTransforms=e||[],this.fieldMask=f||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(a){return new pz({...this.settings,...a},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(a){let b=this.path?.child(a),c=this.contextWith({path:b,arrayElement:!1});return c.validatePathSegment(a),c}childContextForFieldPath(a){let b=this.path?.child(a),c=this.contextWith({path:b,arrayElement:!1});return c.validatePath(),c}childContextForArray(a){return this.contextWith({path:void 0,arrayElement:!0})}createError(a){return pT(a,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(a){return void 0!==this.fieldMask.find(b=>a.isPrefixOf(b))||void 0!==this.fieldTransforms.find(b=>a.isPrefixOf(b.field))}validatePath(){if(this.path)for(let a=0;a<this.path.length;a++)this.validatePathSegment(this.path.get(a))}validatePathSegment(a){if(0===a.length)throw this.createError("Document fields must not be empty");if(py(this.dataSource)&&pv.test(a))throw this.createError('Document fields cannot begin and end with "__"')}}class pA{constructor(a,b,c){this.databaseId=a,this.ignoreUndefinedProperties=b,this.serializer=c||l_(a)}createContext(a,b,c,d=!1){return new pz({dataSource:a,methodName:b,targetDoc:c,path:ar.emptyPath(),arrayElement:!1,hasConverter:d},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function pB(a){let b=a._freezeSettings(),c=l_(a._databaseId);return new pA(a._databaseId,!!b.ignoreUndefinedProperties,c)}function pC(a,b,c,d,e,f={}){let g,h,i=a.createContext(f.merge||f.mergeFields?2:0,b,c,e);pP("Data must be an object, but it was:",i,d);let j=pJ(d,i);if(f.merge)g=new cJ(i.fieldMask),h=i.fieldTransforms;else if(f.mergeFields){let a=[];for(let d of f.mergeFields){let e=pQ(b,d,c);if(!i.contains(e))throw new V(H,`Field '${e}' is specified in your field mask but missing from your input data.`);pU(a,e)||a.push(e)}g=new cJ(a),h=i.fieldTransforms.filter(a=>g.covers(a.field))}else g=null,h=i.fieldTransforms;return new pw(new dW(j),g,h)}class pD extends ps{_toFieldTransform(a){if(2===a.dataSource)a.fieldMask.push(a.path);else if(1===a.dataSource)throw a.createError(`${this._methodName}() can only appear at the top level of your update data`);else throw a.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(a){return a instanceof pD}}class pE extends ps{_toFieldTransform(a){return new fG(a.path,new fx)}isEqual(a){return a instanceof pE}}function pF(a,b,c,d){let e=a.createContext(1,b,c);pP("Data must be an object, but it was:",e,d);let f=[],g=dW.empty();return cy(d,(a,d)=>{let h=pS(b,a,c);d=(0,i.getModularInstance)(d);let j=e.childContextForFieldPath(h);if(d instanceof pD)f.push(h);else{let a=pI(d,j);null!=a&&(f.push(h),g.set(h,a))}}),new px(g,new cJ(f),e.fieldTransforms)}function pG(a,b,c,d,e,f){let g=a.createContext(1,b,c),h=[pQ(b,d,c)],j=[e];if(f.length%2!=0)throw new V(H,`Function ${b}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let a=0;a<f.length;a+=2)h.push(pQ(b,f[a])),j.push(f[a+1]);let k=[],l=dW.empty();for(let a=h.length-1;a>=0;--a)if(!pU(k,h[a])){let b=h[a],c=j[a];c=(0,i.getModularInstance)(c);let d=g.childContextForFieldPath(b);if(c instanceof pD)k.push(b);else{let a=pI(c,d);null!=a&&(k.push(b),l.set(b,a))}}return new px(l,new cJ(k),g.fieldTransforms)}function pH(a,b,c,d=!1){return pI(c,a.createContext(d?4:3,b))}function pI(a,b){if(pO(a=(0,i.getModularInstance)(a)))return pP("Unsupported field value:",b,a),pJ(a,b);if(a instanceof ps)return pL(a,b),null;if(void 0===a&&b.ignoreUndefinedProperties)return null;if(b.path&&b.fieldMask.push(b.path),!(a instanceof Array))return pM(a,b);if(b.settings.arrayElement&&4!==b.dataSource)throw b.createError("Nested arrays are not supported");return pK(a,b)}function pJ(a,b){let c={};return cA(a)?b.path&&b.path.length>0&&b.fieldMask.push(b.path):cy(a,(a,d)=>{let e=pI(d,b.childContextForField(a));null!=e&&(c[a]=e)}),{mapValue:{fields:c}}}function pK(a,b){let c=[],d=0;for(let e of a){let a=pI(e,b.childContextForArray(d));null==a&&(a={nullValue:"NULL_VALUE"}),c.push(a),d++}return{arrayValue:{values:c}}}function pL(a,b){if(!py(b.dataSource))throw b.createError(`${a._methodName}() can only be used with update() and set()`);if(!b.path)throw b.createError(`${a._methodName}() is not currently supported inside arrays`);let c=a._toFieldTransform(b);c&&b.fieldTransforms.push(c)}function pM(a,b){if(null===(a=(0,i.getModularInstance)(a)))return{nullValue:"NULL_VALUE"};if("number"==typeof a)return fr(b.serializer,a);if("boolean"==typeof a)return{booleanValue:a};if("string"==typeof a)return{stringValue:a};if(a instanceof Date){let c=aG.fromDate(a);return{timestampValue:gD(b.serializer,c)}}else if(a instanceof aG){let c=new aG(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:gD(b.serializer,c)}}else if(a instanceof pt)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};else if(a instanceof pq)return{bytesValue:gF(b.serializer,a._byteString)};else if(a instanceof o9){let c=b.databaseId,d=a.firestore._databaseId;if(!d.isEqual(c))throw b.createError(`Document reference is for database ${d.projectId}/${d.database} but should be for database ${c.projectId}/${c.database}`);return{referenceValue:gJ(a.firestore._databaseId||b.databaseId,a._key.path)}}else if(a instanceof pu)return pN(a,b);else if(hJ(a))return a._toProto(b.serializer);else throw b.createError(`Unsupported field value: ${ay(a)}`)}function pN(a,b){return{mapValue:{fields:{[c7]:{stringValue:da},[db]:{arrayValue:{values:(a instanceof pu?a.toArray():a).map(a=>{if("number"!=typeof a)throw b.createError("VectorValues must only contain numeric values.");return fp(b.serializer,a)})}}}}}}function pO(a){return"object"==typeof a&&null!==a&&!(a instanceof Array)&&!(a instanceof Date)&&!(a instanceof aG)&&!(a instanceof pt)&&!(a instanceof pq)&&!(a instanceof o9)&&!(a instanceof ps)&&!(a instanceof pu)&&!hJ(a)}function pP(a,b,c){if(!pO(c)||!ax(c)){let d=ay(c);if("an object"===d)throw b.createError(a+" a custom object");throw b.createError(a+" "+d)}}function pQ(a,b,c){if((b=(0,i.getModularInstance)(b))instanceof pr)return b._internalPath;if("string"==typeof b)return pS(a,b);throw pT("Field path arguments must be of type string or ",a,!1,void 0,c)}let pR=RegExp("[~\\*/\\[\\]]");function pS(a,b,c){if(b.search(pR)>=0)throw pT(`Invalid field path (${b}). Paths must not contain '~', '*', '/', '[', or ']'`,a,!1,void 0,c);try{return new pr(...b.split("."))._internalPath}catch(d){throw pT(`Invalid field path (${b}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,a,!1,void 0,c)}}function pT(a,b,c,d,e){let f=d&&!d.isEmpty(),g=void 0!==e,h=`Function ${b}() called with invalid data`;c&&(h+=" (via `toFirestore()`)"),h+=". ";let i="";return(f||g)&&(i+=" (found",f&&(i+=` in field ${d}`),g&&(i+=` in document ${e}`),i+=")"),new V(H,h+a+i)}function pU(a,b){return a.some(a=>a.isEqual(b))}class pV{convertValue(a,b="none"){switch(dd(a)){case 0:return null;case 1:return a.booleanValue;case 2:return cR(a.integerValue||a.doubleValue);case 3:return this.convertTimestamp(a.timestampValue);case 4:return this.convertServerTimestamp(a,b);case 5:return a.stringValue;case 6:return this.convertBytes(cS(a.bytesValue));case 7:return this.convertReference(a.referenceValue);case 8:return this.convertGeoPoint(a.geoPointValue);case 9:return this.convertArray(a.arrayValue,b);case 11:return this.convertObject(a.mapValue,b);case 10:return this.convertVectorValue(a.mapValue);default:throw A(62114,{value:a})}}convertObject(a,b){return this.convertObjectMap(a.fields,b)}convertObjectMap(a,b="none"){let c={};return cy(a,(a,d)=>{c[a]=this.convertValue(d,b)}),c}convertVectorValue(a){return new pu(a.fields?.[db].arrayValue?.values?.map(a=>cR(a.doubleValue)))}convertGeoPoint(a){return new pt(cR(a.latitude),cR(a.longitude))}convertArray(a,b){return(a.values||[]).map(a=>this.convertValue(a,b))}convertServerTimestamp(a,b){switch(b){case"previous":let c=cZ(a);if(null==c)return null;return this.convertValue(c,b);case"estimate":return this.convertTimestamp(c$(a));default:return null}}convertTimestamp(a){let b=cQ(a);return new aG(b.seconds,b.nanos)}convertDocumentKey(a,b){let c=ap.fromString(a);C(hI(c),9688,{name:a});let d=new c1(c.get(1),c.get(3)),e=new as(c.popFirst(5));return d.isEqual(b)||x(`Document ${e} contains a document reference within a different database (${d.projectId}/${d.database}) which is not supported. It will be treated as a reference in the current database (${b.projectId}/${b.database}) instead.`),e}}class pW extends pV{constructor(a){super(),this.firestore=a}convertBytes(a){return new pq(a)}convertReference(a){let b=this.convertDocumentKey(a,this.firestore._databaseId);return new o9(this.firestore,null,b)}}function pX(){return new pE("serverTimestamp")}var pY=i;let pZ="@firebase/firestore",p$="4.11.0";function p_(a,b=!0){s(f.SDK_VERSION),(0,f._registerComponent)(new g.Component("firestore",(a,{instanceIdentifier:c,options:d})=>{let e=a.getProvider("app").getImmediate(),f=new pi(new $(a.getProvider("auth-internal")),new ac(e,a.getProvider("app-check-internal")),c2(e,c),e);return d={useFetchStreams:b,...d},f._setSettings(d),f},"PUBLIC").setMultipleInstances(!0)),(0,f.registerVersion)(pZ,p$,a),(0,f.registerVersion)(pZ,p$,"esm2020")}class p0{constructor(a="count",b){this._internalFieldPath=b,this.type="AggregateField",this.aggregateType=a}}class p1{constructor(a,b,c){this._userDataWriter=b,this._data=c,this.type="AggregateQuerySnapshot",this.query=a}data(){return this._userDataWriter.convertObjectMap(this._data)}_fieldsProto(){return new dW({mapValue:{fields:this._data}}).clone().value.mapValue.fields}}class p2{constructor(a,b,c,d,e){this._firestore=a,this._userDataWriter=b,this._key=c,this._document=d,this._converter=e}get id(){return this._key.path.lastSegment()}get ref(){return new o9(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{let a=new p3(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(a)}}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(a){if(this._document){let b=this._document.data.field(pQ("DocumentSnapshot.get",a));if(null!==b)return this._userDataWriter.convertValue(b)}}}class p3 extends p2{data(){return super.data()}}function p4(a){if("L"===a.limitType&&0===a.explicitOrderBy.length)throw new V(R,"limitToLast() queries require specifying at least one orderBy() clause")}class p5{}class p6 extends p5{}function p7(a,b,...c){let d=[];for(let e of(b instanceof p5&&d.push(b),qA(d=d.concat(c)),d))a=e._apply(a);return a}class p8 extends p6{constructor(a,b,c){super(),this._field=a,this._op=b,this._value=c,this.type="where"}static _create(a,b,c){return new p8(a,b,c)}_apply(a){let b=this._parse(a);return qw(a._query,b),new o8(a.firestore,a.converter,eV(a._query,b))}_parse(a){let b=pB(a.firestore);return qp(a._query,"where",b,a.firestore._databaseId,this._field,this._op,this._value)}}function p9(a,b,c){let d=b,e=pQ("where",a);return p8._create(e,d,c)}class qa extends p5{constructor(a,b){super(),this.type=a,this._queryConstraints=b}static _create(a,b){return new qa(a,b)}_parse(a){let b=this._queryConstraints.map(b=>b._parse(a)).filter(a=>a.getFilters().length>0);return 1===b.length?b[0]:d9.create(b,this._getOperator())}_apply(a){let b=this._parse(a);return 0===b.getFilters().length?a:(qx(a._query,b),new o8(a.firestore,a.converter,eV(a._query,b)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function qb(...a){return a.forEach(a=>qz("or",a)),qa._create("or",a)}function qc(...a){return a.forEach(a=>qz("and",a)),qa._create("and",a)}class qd extends p6{constructor(a,b){super(),this._field=a,this._direction=b,this.type="orderBy"}static _create(a,b){return new qd(a,b)}_apply(a){let b=qq(a._query,this._field,this._direction);return new o8(a.firestore,a.converter,eW(a._query,b))}}function qe(a,b="asc"){let c=b,d=pQ("orderBy",a);return qd._create(d,c)}class qf extends p6{constructor(a,b,c){super(),this.type=a,this._limit=b,this._limitType=c}static _create(a,b,c){return new qf(a,b,c)}_apply(a){return new o8(a.firestore,a.converter,eX(a._query,this._limit,this._limitType))}}function qg(a){return aB("limit",a),qf._create("limit",a,"F")}function qh(a){return aB("limitToLast",a),qf._create("limitToLast",a,"L")}class qi extends p6{constructor(a,b,c){super(),this.type=a,this._docOrFields=b,this._inclusive=c}static _create(a,b,c){return new qi(a,b,c)}_apply(a){let b=qo(a,this.type,this._docOrFields,this._inclusive);return new o8(a.firestore,a.converter,eY(a._query,b))}}function qj(...a){return qi._create("startAt",a,!0)}function qk(...a){return qi._create("startAfter",a,!1)}class ql extends p6{constructor(a,b,c){super(),this.type=a,this._docOrFields=b,this._inclusive=c}static _create(a,b,c){return new ql(a,b,c)}_apply(a){let b=qo(a,this.type,this._docOrFields,this._inclusive);return new o8(a.firestore,a.converter,eZ(a._query,b))}}function qm(...a){return ql._create("endBefore",a,!1)}function qn(...a){return ql._create("endAt",a,!0)}function qo(a,b,c,d){if(c[0]=(0,pY.getModularInstance)(c[0]),c[0]instanceof p2)return qr(a._query,a.firestore._databaseId,b,c[0]._document,d);{let e=pB(a.firestore);return qs(a._query,a.firestore._databaseId,e,b,c,d)}}function qp(a,b,c,d,e,f,g){let h;if(e.isKeyField())if("array-contains"===f||"array-contains-any"===f)throw new V(H,`Invalid Query. You can't perform '${f}' queries on documentId().`);else if("in"===f||"not-in"===f){qu(g,f);let b=[];for(let c of g)b.push(qt(d,a,c));h={arrayValue:{values:b}}}else h=qt(d,a,g);else("in"===f||"not-in"===f||"array-contains-any"===f)&&qu(g,f),h=pH(c,b,g,"in"===f||"not-in"===f);return d8.create(e,f,h)}function qq(a,b,c){if(null!==a.startAt)throw new V(H,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==a.endAt)throw new V(H,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new d3(b,c)}function qr(a,b,c,d,e){if(!d)throw new V(J,`Can't use a DocumentSnapshot that doesn't exist for ${c}().`);let f=[];for(let c of eR(a))if(c.field.isKeyField())f.push(dG(b,d.key));else{let a=d.data.field(c.field);if(cX(a))throw new V(H,'Invalid query. You are trying to start or end a query using a document for which the field "'+c.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null!==a)f.push(a);else{let a=c.field.canonicalString();throw new V(H,`Invalid query. You are trying to start or end a query using a document for which the field '${a}' (used as the orderBy) does not exist.`)}}return new d$(f,e)}function qs(a,b,c,d,e,f){let g=a.explicitOrderBy;if(e.length>g.length)throw new V(H,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let h=[];for(let f=0;f<e.length;f++){let i=e[f];if(g[f].field.isKeyField()){if("string"!=typeof i)throw new V(H,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof i}`);if(!eQ(a)&&-1!==i.indexOf("/"))throw new V(H,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${i}' contains a slash.`);let c=a.path.child(ap.fromString(i));if(!as.isDocumentKey(c))throw new V(H,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${c}' is not because it contains an odd number of segments.`);let e=new as(c);h.push(dG(b,e))}else{let a=pH(c,d,i);h.push(a)}}return new d$(h,f)}function qt(a,b,c){if("string"==typeof(c=(0,pY.getModularInstance)(c))){if(""===c)throw new V(H,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!eQ(b)&&-1!==c.indexOf("/"))throw new V(H,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${c}' contains a '/' character.`);let d=b.path.child(ap.fromString(c));if(!as.isDocumentKey(d))throw new V(H,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${d}' is not because it has an odd number of segments (${d.length}).`);return dG(a,new as(d))}if(c instanceof o9)return dG(a,c._key);throw new V(H,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ay(c)}.`)}function qu(a,b){if(!Array.isArray(a)||0===a.length)throw new V(H,`Invalid Query. A non-empty array is required for '${b.toString()}' filters.`)}function qv(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function qw(a,b){let c=qy(a.filters,qv(b.op));if(null!==c)if(c===b.op)throw new V(H,`Invalid query. You cannot use more than one '${b.op.toString()}' filter.`);else throw new V(H,`Invalid query. You cannot use '${b.op.toString()}' filters with '${c.toString()}' filters.`)}function qx(a,b){let c=a;for(let a of b.getFlattenedFilters())qw(c,a),c=eV(c,a)}function qy(a,b){for(let c of a)for(let a of c.getFlattenedFilters())if(b.indexOf(a.op)>=0)return a.op;return null}function qz(a,b){if(!(b instanceof p8)&&!(b instanceof qa))throw new V(H,`Function ${a}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function qA(a){let b=a.filter(a=>a instanceof qa).length,c=a.filter(a=>a instanceof p8).length;if(b>1||b>0&&c>0)throw new V(H,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}function qB(a,b,c){return a?c&&(c.merge||c.mergeFields)?a.toFirestore(b,c):a.toFirestore(b):b}class qC extends pV{constructor(a){super(),this.firestore=a}convertBytes(a){return new pq(a)}convertReference(a){let b=this.convertDocumentKey(a,this.firestore._databaseId);return new o9(this.firestore,null,b)}}function qD(a){return new p0("sum",pQ("sum",a))}function qE(a){return new p0("avg",pQ("average",a))}function qF(){return new p0("count")}function qG(a,b){return a instanceof p0&&b instanceof p0&&a.aggregateType===b.aggregateType&&a._internalFieldPath?.canonicalString()===b._internalFieldPath?.canonicalString()}function qH(a,b){return pd(a.query,b.query)&&(0,pY.deepEqual)(a.data(),b.data())}function qI(a){return qJ(a,{count:qF()})}function qJ(a,b){let c=aA(a.firestore,pi),d=pk(c),e=cz(b,(a,b)=>new pp(b,a.aggregateType,a._internalFieldPath));return oG(d,a._query,e).then(b=>qK(c,a,b))}function qK(a,b,c){return new p1(b,new pW(a),c)}class qL{constructor(a){this.kind="memory",this._onlineComponentProvider=oa.provider,a?.garbageCollector?this._offlineComponentProvider=a.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new n7(void 0)}}toJSON(){return{kind:this.kind}}}class qM{constructor(a){let b;this.kind="persistent",a?.tabManager?(a.tabManager._initialize(a),b=a.tabManager):(b=qV(void 0))._initialize(a),this._onlineComponentProvider=b._onlineComponentProvider,this._offlineComponentProvider=b._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class qN{constructor(){this.kind="memoryEager",this._offlineComponentProvider=n6.provider}toJSON(){return{kind:this.kind}}}class qO{constructor(a){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new n7(a)}}toJSON(){return{kind:this.kind}}}function qP(){return new qN}function qQ(a){return new qO(a?.cacheSizeBytes)}function qR(a){return new qL(a)}function qS(a){return new qM(a)}class qT{constructor(a){this.forceOwnership=a,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(a){this._onlineComponentProvider=oa.provider,this._offlineComponentProvider={build:b=>new n8(b,a?.cacheSizeBytes,this.forceOwnership)}}}class qU{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(a){this._onlineComponentProvider=oa.provider,this._offlineComponentProvider={build:b=>new n9(b,a?.cacheSizeBytes)}}}function qV(a){return new qT(a?.forceOwnership)}function qW(){return new qU}let qX=gd();function qY(a){let b=JSON.stringify(a),c=qX.encode(b).byteLength;return`${c}${b}`}qY({metadata:{id:"test-bundle",createTime:{seconds:0x5e0be105,nanos:6},version:1,totalDocuments:1,totalBytes:416}}),qY({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",readTime:{seconds:5,nanos:6},exists:!0}}),qY({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value"},bar:{integerValue:-42}}}}),qY({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",readTime:{seconds:5,nanos:6},exists:!0}}),qY({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value1"},bar:{integerValue:42},emptyArray:{arrayValue:{}},emptyMap:{mapValue:{}}}}}),qY({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/nodoc",readTime:{seconds:5,nanos:6},exists:!1}}),qY({namedQuery:{name:"limitQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"DESCENDING"}],limit:{value:1}},limitType:"FIRST"},readTime:{seconds:0x5ec5a5f3,nanos:191164e3}}}),qY({namedQuery:{name:"limitToLastQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"ASCENDING"}],limit:{value:1}},limitType:"LAST"},readTime:{seconds:0x5ec5a5f3,nanos:543063e3}}});let qZ=1;class q${constructor(a,b){this.firestore=a,this.bundleId=b,this.documents=new Map,this.namedQueries=new Map,this.latestReadTime=new aG(0,0),this.databaseId=a._databaseId,this.serializer=new gz(this.databaseId,!0),this.userDataReader=new pA(this.databaseId,!0,this.serializer)}addBundleDocument(a,b){let c=this.documents.get(a.documentPath),d=c?.metadata.queries,e=a.readTime,f=c?.metadata.readTime?gE(c.metadata.readTime):null,g=!e&&null==f,h=void 0!==e&&(null==f||f<e);if((g||h)&&this.documents.set(a.documentPath,{document:this.toBundleDocument(a),metadata:{name:gM(this.serializer,a.documentKey),readTime:e?gD(this.serializer,e):void 0,exists:a.documentExists}}),e&&e>this.latestReadTime&&(this.latestReadTime=e),b){let c=this.documents.get(a.documentPath);c.metadata.queries=d||[],c.metadata.queries.push(b)}}addBundleQuery(a){if(this.namedQueries.has(a.name))throw Error(`Query name conflict: ${name} has already been added.`);let b=new aG(0,0);for(let c of a.docBundleDataArray)this.addBundleDocument(c,a.name),c.readTime&&c.readTime>b&&(b=c.readTime);let c=ha(this.serializer,eS(a.query)),d={parent:a.parent,structuredQuery:c.queryTarget.structuredQuery};this.namedQueries.set(a.name,{name:a.name,bundledQuery:d,readTime:gD(this.serializer,b)})}toBundleDocument(a){let b=this.userDataReader.createContext(4,"internal toBundledDocument"),c=pJ(a.documentData,b);return{name:gM(this.serializer,a.documentKey),fields:c.mapValue.fields,updateTime:gD(this.serializer,a.versionTime),createTime:gD(this.serializer,a.createdTime)}}lengthPrefixedString(a){let b=JSON.stringify(a),c=qX.encode(b).byteLength;return`${c}${b}`}build(){let a="";for(let b of this.namedQueries.values())a+=this.lengthPrefixedString({namedQuery:b});for(let b of this.documents.values()){let c=b.metadata;a+=this.lengthPrefixedString({documentMetadata:c});let d=b.document;d&&(a+=this.lengthPrefixedString({document:d}))}let b={id:this.bundleId,createTime:gD(this.serializer,this.latestReadTime),version:qZ,totalDocuments:this.documents.size,totalBytes:qX.encode(a).length};return this.lengthPrefixedString({metadata:b})+a}}function q_(a,b,c,d){let e=new q$(a,af.newId());return e.addBundleDocument(q1(d,c,b)),e.build()}function q0(a,b,c,d,e,f,g){let h=[];for(let a=0;a<f.length;a++)h.push(q1(e[a],g[a],f[a]));let i={name:c,query:b,parent:d,docBundleDataArray:h},j=new q$(a,c);return j.addBundleQuery(i),j.build()}function q1(a,b,c){return{documentData:b,documentKey:c.mutableCopy().key,documentPath:a,documentExists:!0,createdTime:c.createTime.toTimestamp(),readTime:c.readTime.toTimestamp(),versionTime:c.version.toTimestamp()}}let q2="NOT SUPPORTED";class q3{constructor(a,b){this.hasPendingWrites=a,this.fromCache=b}isEqual(a){return this.hasPendingWrites===a.hasPendingWrites&&this.fromCache===a.fromCache}}class q4 extends p2{constructor(a,b,c,d,e,f){super(a,b,c,d,f),this._firestore=a,this._firestoreImpl=a,this.metadata=e}exists(){return super.exists()}data(a={}){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value,a.serverTimestamps);{let b=new q6(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(b,a)}}}get(a,b={}){if(this._document){let c=this._document.data.field(pQ("DocumentSnapshot.get",a));if(null!==c)return this._userDataWriter.convertValue(c,b.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new V(O,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let a=this._document,b={};if(b.type=q4._jsonSchemaVersion,b.bundle="",b.bundleSource="DocumentSnapshot",b.bundleName=this._key.toString(),!a||!a.isValidDocument()||!a.isFoundDocument())return b;let c=this._userDataWriter.convertObjectMap(a.data.value.mapValue.fields,"previous");return b.bundle=q_(this._firestore,a,c,this.ref.path),b}}function q5(a,b,c){if(aD(b,q4._jsonSchema)){if(b.bundle===q2)throw new V(H,"The provided JSON object was created in a client environment, which is not supported.");let d=l_(a._databaseId),e=oR(b.bundle,d),f=e.getElements(),g=new nj(e.getMetadata(),d);for(let a of f)g.addSizedElement(a);let h=g.documents;if(1!==h.length)throw new V(H,`Expected bundle data to contain 1 document, but it contains ${h.length} documents.`);let i=gV(d,h[0].document),j=new as(ap.fromString(b.bundleName));return new q4(a,new qC(a),j,i,new q3(!1,!1),c||null)}}q4._jsonSchemaVersion="firestore/documentSnapshot/1.0",q4._jsonSchema={type:aC("string",q4._jsonSchemaVersion),bundleSource:aC("string","DocumentSnapshot"),bundleName:aC("string"),bundle:aC("string")};class q6 extends q4{data(a={}){return super.data(a)}}class q7{constructor(a,b,c,d){this._firestore=a,this._userDataWriter=b,this._snapshot=d,this.metadata=new q3(d.hasPendingWrites,d.fromCache),this.query=c}get docs(){let a=[];return this.forEach(b=>a.push(b)),a}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(a,b){this._snapshot.docs.forEach(c=>{a.call(b,new q6(this._firestore,this._userDataWriter,c.key,c,new q3(this._snapshot.mutatedKeys.has(c.key),this._snapshot.fromCache),this.query.converter))})}docChanges(a={}){let b=!!a.includeMetadataChanges;if(b&&this._snapshot.excludesMetadataChanges)throw new V(H,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===b||(this._cachedChanges=q9(this,b),this._cachedChangesIncludeMetadataChanges=b),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new V(O,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let a={};a.type=q7._jsonSchemaVersion,a.bundleSource="QuerySnapshot",a.bundleName=af.newId();let b=this._firestore._databaseId.database,c=this._firestore._databaseId.projectId,d=`projects/${c}/databases/${b}/documents`,e=[],f=[],g=[];return this.docs.forEach(a=>{null!==a._document&&(e.push(a._document),f.push(this._userDataWriter.convertObjectMap(a._document.data.value.mapValue.fields,"previous")),g.push(a.ref.path))}),a.bundle=q0(this._firestore,this.query._query,a.bundleName,d,g,e,f),a}}function q8(a,b,c){if(aD(b,q7._jsonSchema)){if(b.bundle===q2)throw new V(H,"The provided JSON object was created in a client environment, which is not supported.");let d=l_(a._databaseId),e=oR(b.bundle,d),f=e.getElements(),g=new nj(e.getMetadata(),d);for(let a of f)g.addSizedElement(a);if(1!==g.queries.length)throw new V(H,`Snapshot data expected 1 query but found ${g.queries.length} queries.`);let h=h_(g.queries[0].bundledQuery),i=g.documents,j=new m0;i.map(a=>{let b=gV(d,a.document);j=j.add(b)});let k=m2.fromInitialDocuments(h,j,fm(),!1,!1),l=new o8(a,c||null,h);return new q7(a,new qC(a),l,k)}}function q9(a,b){if(a._snapshot.oldDocs.isEmpty()){let b=0;return a._snapshot.docChanges.map(c=>{let d=new q6(a._firestore,a._userDataWriter,c.doc.key,c.doc,new q3(a._snapshot.mutatedKeys.has(c.doc.key),a._snapshot.fromCache),a.query.converter);return c.doc,{type:"added",doc:d,oldIndex:-1,newIndex:b++}})}{let c=a._snapshot.oldDocs;return a._snapshot.docChanges.filter(a=>b||3!==a.type).map(b=>{let d=new q6(a._firestore,a._userDataWriter,b.doc.key,b.doc,new q3(a._snapshot.mutatedKeys.has(b.doc.key),a._snapshot.fromCache),a.query.converter),e=-1,f=-1;return 0!==b.type&&(e=c.indexOf(b.doc.key),c=c.delete(b.doc.key)),1!==b.type&&(f=(c=c.add(b.doc)).indexOf(b.doc.key)),{type:ra(b.type),doc:d,oldIndex:e,newIndex:f}})}}function ra(a){switch(a){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return A(61501,{type:a})}}function rb(a,b){return a instanceof q4&&b instanceof q4?a._firestore===b._firestore&&a._key.isEqual(b._key)&&(null===a._document?null===b._document:a._document.isEqual(b._document))&&a._converter===b._converter:a instanceof q7&&b instanceof q7&&a._firestore===b._firestore&&pd(a.query,b.query)&&a.metadata.isEqual(b.metadata)&&a._snapshot.isEqual(b._snapshot)}q7._jsonSchemaVersion="firestore/querySnapshot/1.0",q7._jsonSchema={type:aC("string",q7._jsonSchemaVersion),bundleSource:aC("string","QuerySnapshot"),bundleName:aC("string"),bundle:aC("string")};let rc={maxAttempts:5};function rd(a){if(a.maxAttempts<1)throw new V(H,"Max attempts must be at least 1")}class re{constructor(a,b){this._firestore=a,this._commitHandler=b,this._mutations=[],this._committed=!1,this._dataReader=pB(a)}set(a,b,c){this._verifyNotCommitted();let d=rf(a,this._firestore),e=qB(d.converter,b,c),f=pC(this._dataReader,"WriteBatch.set",d._key,e,null!==d.converter,c);return this._mutations.push(f.toMutation(d._key,fK.none())),this}update(a,b,c,...d){let e;this._verifyNotCommitted();let f=rf(a,this._firestore);return e="string"==typeof(b=(0,pY.getModularInstance)(b))||b instanceof pr?pG(this._dataReader,"WriteBatch.update",f._key,b,c,d):pF(this._dataReader,"WriteBatch.update",f._key,b),this._mutations.push(e.toMutation(f._key,fK.exists(!0))),this}delete(a){this._verifyNotCommitted();let b=rf(a,this._firestore);return this._mutations=this._mutations.concat(new f_(b._key,fK.none())),this}commit(){return(this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0)?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new V(O,"A write batch can no longer be used after commit() has been called.")}}function rf(a,b){if((a=(0,pY.getModularInstance)(a)).firestore===b)return a;throw new V(H,"Provided document reference is from a different Firestore instance.")}class rg{constructor(a,b){this._firestore=a,this._transaction=b,this._dataReader=pB(a)}get(a){let b=rf(a,this._firestore),c=new qC(this._firestore);return this._transaction.lookup([b._key]).then(a=>{if(!a||1!==a.length)return A(24041);let d=a[0];if(d.isFoundDocument())return new p2(this._firestore,c,d.key,d,b.converter);if(d.isNoDocument())return new p2(this._firestore,c,b._key,null,b.converter);throw A(18433,{doc:d})})}set(a,b,c){let d=rf(a,this._firestore),e=qB(d.converter,b,c),f=pC(this._dataReader,"Transaction.set",d._key,e,null!==d.converter,c);return this._transaction.set(d._key,f),this}update(a,b,c,...d){let e,f=rf(a,this._firestore);return e="string"==typeof(b=(0,pY.getModularInstance)(b))||b instanceof pr?pG(this._dataReader,"Transaction.update",f._key,b,c,d):pF(this._dataReader,"Transaction.update",f._key,b),this._transaction.update(f._key,e),this}delete(a){let b=rf(a,this._firestore);return this._transaction.delete(b._key),this}}class rh extends rg{constructor(a,b){super(a,b),this._firestore=a}get(a){let b=rf(a,this._firestore),c=new pW(this._firestore);return super.get(a).then(a=>new q4(this._firestore,c,b._key,a._document,new q3(!1,!1),b.converter))}}function ri(a,b,c){a=aA(a,pi);let d={...rc,...c};return rd(d),oJ(pk(a),c=>b(new rh(a,c)),d)}function rj(a){return rk(a,["next","error","complete"])}function rk(a,b){if("object"!=typeof a||null===a)return!1;let c=a;for(let a of b)if(a in c&&"function"==typeof c[a])return!0;return!1}function rl(a){a=aA(a,o9);let b=aA(a.firestore,pi);return oD(pk(b),a._key).then(c=>rz(b,a,c))}function rm(a){a=aA(a,o9);let b=aA(a.firestore,pi),c=pk(b),d=new pW(b);return oC(c,a._key).then(c=>new q4(b,d,a._key,c,new q3(null!==c&&c.hasLocalMutations,!0),a.converter))}function rn(a){a=aA(a,o9);let b=aA(a.firestore,pi);return oD(pk(b),a._key,{source:"server"}).then(c=>rz(b,a,c))}function ro(a){a=aA(a,o8);let b=aA(a.firestore,pi),c=pk(b),d=new pW(b);return p4(a._query),oF(c,a._query).then(c=>new q7(b,d,a,c))}function rp(a){a=aA(a,o8);let b=aA(a.firestore,pi),c=pk(b),d=new pW(b);return oE(c,a._query).then(c=>new q7(b,d,a,c))}function rq(a){a=aA(a,o8);let b=aA(a.firestore,pi),c=pk(b),d=new pW(b);return oF(c,a._query,{source:"server"}).then(c=>new q7(b,d,a,c))}function rr(a,b,c){a=aA(a,o9);let d=aA(a.firestore,pi),e=qB(a.converter,b,c),f=pC(pB(d),"setDoc",a._key,e,null!==a.converter,c).toMutation(a._key,fK.none());return ry(d,[f])}function rs(a,b,c,...d){let e;a=aA(a,o9);let f=aA(a.firestore,pi),g=pB(f);return ry(f,[(e="string"==typeof(b=(0,pY.getModularInstance)(b))||b instanceof pr?pG(g,"updateDoc",a._key,b,c,d):pF(g,"updateDoc",a._key,b)).toMutation(a._key,fK.exists(!0))])}function rt(a){return ry(aA(a.firestore,pi),[new f_(a._key,fK.none())])}function ru(a,b){let c=aA(a.firestore,pi),d=pc(a),e=qB(a.converter,b);return ry(c,[pC(pB(a.firestore),"addDoc",d._key,e,null!==a.converter,{}).toMutation(d._key,fK.exists(!1))]).then(()=>d)}function rv(a,...b){let c,d,e;a=(0,pY.getModularInstance)(a);let f={includeMetadataChanges:!1,source:"default"},g=0;"object"!=typeof b[0]||rj(b[g])||(f=b[g++]);let h={includeMetadataChanges:f.includeMetadataChanges,source:f.source};if(rj(b[g])){let a=b[g];b[g]=a.next?.bind(a),b[g+1]=a.error?.bind(a),b[g+2]=a.complete?.bind(a)}if(a instanceof o9)d=aA(a.firestore,pi),e=eL(a._key.path),c={next:c=>{b[g]&&b[g](rz(d,a,c))},error:b[g+1],complete:b[g+2]};else{let f=aA(a,o8);d=aA(f.firestore,pi),e=f._query;let h=new pW(d);c={next:a=>{b[g]&&b[g](new q7(d,h,f,a))},error:b[g+1],complete:b[g+2]},p4(a._query)}return oB(pk(d),e,h,c)}function rw(a,b,...c){let d,e=(0,pY.getModularInstance)(a),f=rA(b);if(f.error)throw new V(H,f.error);let g=0;if("object"!=typeof c[0]||rj(c[g])||(d=c[g++]),"QuerySnapshot"===f.bundleSource){let a=null;if("object"==typeof c[g]&&rj(c[g])){let b=c[g++];a={next:b.next,error:b.error,complete:b.complete}}else a={next:c[g++],error:c[g++],complete:c[g++]};return rC(e,f,d,a,c[g])}if("DocumentSnapshot"===f.bundleSource){let a=null;if("object"==typeof c[g]&&rj(c[g])){let b=c[g++];a={next:b.next,error:b.error,complete:b.complete}}else a={next:c[g++],error:c[g++],complete:c[g++]};return rB(e,f,d,a,c[g])}throw new V(H,`unsupported bundle source: ${f.bundleSource}`)}function rx(a,b){return oI(pk(a=aA(a,pi)),rj(b)?b:{next:b})}function ry(a,b){return oH(pk(a),b)}function rz(a,b,c){let d=c.docs.get(b._key),e=new pW(a);return new q4(a,e,b._key,d,new q3(c.hasPendingWrites,c.fromCache),b.converter)}function rA(a){let b={bundle:"",bundleName:"",bundleSource:""};for(let c of["bundle","bundleName","bundleSource"]){if(!(c in a)){b.error=`snapshotJson missing required field: ${c}`;break}let d=a[c];if("string"!=typeof d){b.error=`snapshotJson field '${c}' must be a string.`;break}if(0===d.length){b.error=`snapshotJson field '${c}' cannot be an empty string.`;break}"bundle"===c?b.bundle=d:"bundleName"===c?b.bundleName=d:"bundleSource"===c&&(b.bundleSource=d)}return b}function rB(a,b,c,d,e){let f,g=!1;return pn(a,b.bundle).then(()=>{g||(f=rv(new o9(a,e||null,as.fromPath(b.bundleName)),c||{},d))}).catch(a=>(d.error&&d.error(a),()=>{})),()=>{!g&&(g=!0,f&&f())}}function rC(a,b,c,d,e){let f,g=!1;return pn(a,b.bundle).then(()=>po(a,b.bundleName)).then(a=>{if(a&&!g){let b=a;e&&b.withConverter(e),f=rv(a,c||{},d)}}).catch(a=>(d.error&&d.error(a),()=>{})),()=>{!g&&(g=!0,f&&f())}}function rD(a){return pk(a=aA(a,pi)),new re(a,b=>ry(a,b))}function rE(a,b){let c=pk(a=aA(a,pi));return c._uninitializedComponentsProvider&&"memory"!==c._uninitializedComponentsProvider._offline.kind?oS(c,rF(b)):(y("Cannot enable indexes when persistence is disabled"),Promise.resolve())}function rF(a){let b="string"==typeof a?rG(a):a,c=[];if(Array.isArray(b.indexes))for(let a of b.indexes){let b=rH(a,"collectionGroup"),d=[];if(Array.isArray(a.fields))for(let b of a.fields){let a=pS("setIndexConfiguration",rH(b,"fieldPath"));"CONTAINS"===b.arrayConfig?d.push(new aQ(a,2)):"ASCENDING"===b.order?d.push(new aQ(a,0)):"DESCENDING"===b.order&&d.push(new aQ(a,1))}c.push(new aK(aK.UNKNOWN_ID,b,d,aS.empty()))}return c}function rG(a){try{return JSON.parse(a)}catch(a){throw new V(H,"Failed to parse JSON: "+a?.message)}}function rH(a,b){if("string"!=typeof a[b])throw new V(H,"Missing string value for: "+b);return a[b]}class rI{constructor(a){this._firestore=a,this.type="PersistentCacheIndexManager"}}function rJ(a){a=aA(a,pi);let b=rO.get(a);if(b)return b;let c=pk(a);if(c._uninitializedComponentsProvider?._offline.kind!=="persistent")return null;let d=new rI(a);return rO.set(a,d),d}function rK(a){rN(a,!0)}function rL(a){rN(a,!1)}function rM(a){oU(pk(a._firestore)).then(a=>w("deleting all persistent cache indexes succeeded")).catch(a=>y("deleting all persistent cache indexes failed",a))}function rN(a,b){oT(pk(a._firestore),b).then(a=>w(`setting persistent cache index auto creation isEnabled=${b} succeeded`)).catch(a=>y(`setting persistent cache index auto creation isEnabled=${b} failed`,a))}let rO=new WeakMap;class rP{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(a){return rQ.instance.onExistenceFilterMismatch(a)}}class rQ{constructor(){this.existenceFilterMismatchCallbacksById=new Map}static get instance(){return rR||gc(rR=new rQ),rR}notifyOnExistenceFilterMismatch(a){this.existenceFilterMismatchCallbacksById.forEach(b=>b(a))}onExistenceFilterMismatch(a){let b=Symbol(),c=this.existenceFilterMismatchCallbacksById;return c.set(b,a),()=>c.delete(b)}}let rR=null;p_("node"),a.s(["AggregateField",()=>p0,"AggregateQuerySnapshot",()=>p1,"DocumentSnapshot",()=>q4,"PersistentCacheIndexManager",()=>rI,"QueryCompositeFilterConstraint",()=>qa,"QueryConstraint",()=>p6,"QueryDocumentSnapshot",()=>q6,"QueryEndAtConstraint",()=>ql,"QueryFieldFilterConstraint",()=>p8,"QueryLimitConstraint",()=>qf,"QueryOrderByConstraint",()=>qd,"QuerySnapshot",()=>q7,"QueryStartAtConstraint",()=>qi,"SnapshotMetadata",()=>q3,"Transaction",()=>rh,"WriteBatch",()=>re,"_TestingHooks",()=>rP,"addDoc",()=>ru,"aggregateFieldEqual",()=>qG,"aggregateQuerySnapshotEqual",()=>qH,"and",()=>qc,"average",()=>qE,"count",()=>qF,"deleteAllPersistentCacheIndexes",()=>rM,"deleteDoc",()=>rt,"disablePersistentCacheIndexAutoCreation",()=>rL,"documentSnapshotFromJSON",()=>q5,"enablePersistentCacheIndexAutoCreation",()=>rK,"endAt",()=>qn,"endBefore",()=>qm,"executeWrite",()=>ry,"getAggregateFromServer",()=>qJ,"getCountFromServer",()=>qI,"getDoc",()=>rl,"getDocFromCache",()=>rm,"getDocFromServer",()=>rn,"getDocs",()=>ro,"getDocsFromCache",()=>rp,"getDocsFromServer",()=>rq,"getPersistentCacheIndexManager",()=>rJ,"limit",()=>qg,"limitToLast",()=>qh,"memoryEagerGarbageCollector",()=>qP,"memoryLocalCache",()=>qR,"memoryLruGarbageCollector",()=>qQ,"onSnapshot",()=>rv,"onSnapshotResume",()=>rw,"onSnapshotsInSync",()=>rx,"or",()=>qb,"orderBy",()=>qe,"persistentLocalCache",()=>qS,"persistentMultipleTabManager",()=>qW,"persistentSingleTabManager",()=>qV,"query",()=>p7,"querySnapshotFromJSON",()=>q8,"runTransaction",()=>ri,"setDoc",()=>rr,"setIndexConfiguration",()=>rE,"snapshotEqual",()=>rb,"startAfter",()=>qk,"startAt",()=>qj,"sum",()=>qD,"updateDoc",()=>rs,"where",()=>p9,"writeBatch",()=>rD],1787),a.s([],69387),a.i(1787),a.s(["addDoc",()=>ru,"collection",()=>pb,"deleteDoc",()=>rt,"doc",()=>pc,"getDoc",()=>rl,"getDocs",()=>ro,"getFirestore",()=>pj,"limit",()=>qg,"orderBy",()=>qe,"query",()=>p7,"serverTimestamp",()=>pX],60574)},20237,5420,60121,a=>{"use strict";a.i(1611);var b,c,d=a.i(14692);a.i(69387);var e=a.i(60574),f=a.i(88156),g=a.i(69304),h=a.i(57179);let i="firebasestorage.googleapis.com",j="storageBucket",k=12e4,l=6e5;class m extends g.FirebaseError{constructor(a,b,c=0){super(n(a),`Firebase Storage: ${b} (${n(a)})`),this.status_=c,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,m.prototype)}get status(){return this.status_}set status(a){this.status_=a}_codeEquals(a){return n(a)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(a){this.customData.serverResponse=a,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function n(a){return"storage/"+a}function o(){let a="An unknown error occurred, please check the error payload for server response.";return new m(b.UNKNOWN,a)}function p(a){return new m(b.OBJECT_NOT_FOUND,"Object '"+a+"' does not exist.")}function q(a){return new m(b.QUOTA_EXCEEDED,"Quota for bucket '"+a+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function r(){let a="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new m(b.UNAUTHENTICATED,a)}function s(){return new m(b.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function t(a){return new m(b.UNAUTHORIZED,"User does not have permission to access '"+a+"'.")}function u(){return new m(b.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function v(){return new m(b.CANCELED,"User canceled the upload/download.")}function w(a){return new m(b.INVALID_URL,"Invalid URL '"+a+"'.")}function x(a){return new m(b.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+a+"'.")}function y(){return new m(b.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+j+"' property when initializing the app?")}function z(){return new m(b.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function A(){return new m(b.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function B(a){return new m(b.INVALID_ARGUMENT,a)}function C(){return new m(b.APP_DELETED,"The Firebase app was deleted.")}function D(a){return new m(b.INVALID_ROOT_OPERATION,"The operation '"+a+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function E(a,c){return new m(b.INVALID_FORMAT,"String does not match format '"+a+"': "+c)}function F(a){throw new m(b.INTERNAL_ERROR,"Internal error: "+a)}!function(a){a.UNKNOWN="unknown",a.OBJECT_NOT_FOUND="object-not-found",a.BUCKET_NOT_FOUND="bucket-not-found",a.PROJECT_NOT_FOUND="project-not-found",a.QUOTA_EXCEEDED="quota-exceeded",a.UNAUTHENTICATED="unauthenticated",a.UNAUTHORIZED="unauthorized",a.UNAUTHORIZED_APP="unauthorized-app",a.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",a.INVALID_CHECKSUM="invalid-checksum",a.CANCELED="canceled",a.INVALID_EVENT_NAME="invalid-event-name",a.INVALID_URL="invalid-url",a.INVALID_DEFAULT_BUCKET="invalid-default-bucket",a.NO_DEFAULT_BUCKET="no-default-bucket",a.CANNOT_SLICE_BLOB="cannot-slice-blob",a.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",a.NO_DOWNLOAD_URL="no-download-url",a.INVALID_ARGUMENT="invalid-argument",a.INVALID_ARGUMENT_COUNT="invalid-argument-count",a.APP_DELETED="app-deleted",a.INVALID_ROOT_OPERATION="invalid-root-operation",a.INVALID_FORMAT="invalid-format",a.INTERNAL_ERROR="internal-error",a.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(b||(b={}));class G{constructor(a,b){this.bucket=a,this.path_=b}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){let a=encodeURIComponent;return"/b/"+a(this.bucket)+"/o/"+a(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(a,b){let c;try{c=G.makeFromUrl(a,b)}catch(b){return new G(a,"")}if(""===c.path)return c;throw x(a)}static makeFromUrl(a,b){let c=null,d="([A-Za-z0-9.\\-_]+)";function e(a){"/"===a.path.charAt(a.path.length-1)&&(a.path_=a.path_.slice(0,-1))}let f=RegExp("^gs://"+d+"(/(.*))?$","i"),g={bucket:1,path:3};function h(a){a.path_=decodeURIComponent(a.path)}let j="v[A-Za-z0-9_]+",k=b.replace(/[.]/g,"\\."),l="(/([^?#]*).*)?$",m=RegExp(`^https?://${k}/${j}/b/${d}/o${l}`,"i"),n=b===i?"(?:storage.googleapis.com|storage.cloud.google.com)":b,o="([^?#]*)",p=[{regex:f,indices:g,postModify:e},{regex:m,indices:{bucket:1,path:3},postModify:h},{regex:RegExp(`^https?://${n}/${d}/${o}`,"i"),indices:{bucket:1,path:2},postModify:h}];for(let b=0;b<p.length;b++){let d=p[b],e=d.regex.exec(a);if(e){let a=e[d.indices.bucket],b=e[d.indices.path];b||(b=""),c=new G(a,b),d.postModify(c);break}}if(null==c)throw w(a);return c}}class H{constructor(a){this.promise_=Promise.reject(a)}getPromise(){return this.promise_}cancel(a=!1){}}function I(a,b,c){let d=1,e=null,f=null,g=!1,h=0;function i(){return 2===h}let j=!1;function k(...a){j||(j=!0,b.apply(null,a))}function l(b){e=setTimeout(()=>{e=null,a(n,i())},b)}function m(){f&&clearTimeout(f)}function n(a,...b){let c;if(j)return void m();if(a||i()||g){m(),k.call(null,a,...b);return}d<64&&(d*=2),1===h?(h=2,c=0):c=(d+Math.random())*1e3,l(c)}let o=!1;function p(a){o||(o=!0,m(),!j&&(null!==e?(a||(h=2),clearTimeout(e),l(0)):a||(h=1)))}return l(0),f=setTimeout(()=>{g=!0,p(!0)},c),p}function J(a){a(!1)}function K(a){return void 0!==a}function L(a){return"object"==typeof a&&!Array.isArray(a)}function M(a){return"string"==typeof a||a instanceof String}function N(a){return O()&&a instanceof Blob}function O(){return"u">typeof Blob}function P(a,b,c,d){if(d<b)throw B(`Invalid value for '${a}'. Expected ${b} or greater.`);if(d>c)throw B(`Invalid value for '${a}'. Expected ${c} or less.`)}function Q(a,b,c){let d=b;return null==c&&(d=`https://${b}`),`${c}://${d}/v0${a}`}function R(a){let b=encodeURIComponent,c="?";for(let d in a)a.hasOwnProperty(d)&&(c=c+(b(d)+"=")+b(a[d])+"&");return c.slice(0,-1)}function S(a,b){let c=a>=500&&a<600,d=-1!==[408,429].indexOf(a),e=-1!==b.indexOf(a);return c||d||e}!function(a){a[a.NO_ERROR=0]="NO_ERROR",a[a.NETWORK_ERROR=1]="NETWORK_ERROR",a[a.ABORT=2]="ABORT"}(c||(c={}));class T{constructor(a,b,c,d,e,f,g,h,i,j,k,l=!0,m=!1){this.url_=a,this.method_=b,this.headers_=c,this.body_=d,this.successCodes_=e,this.additionalRetryCodes_=f,this.callback_=g,this.errorCallback_=h,this.timeout_=i,this.progressCallback_=j,this.connectionFactory_=k,this.retry=l,this.isUsingEmulator=m,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((a,b)=>{this.resolve_=a,this.reject_=b,this.start_()})}start_(){let a=(a,b)=>{if(b)return void a(!1,new U(!1,null,!0));let d=this.connectionFactory_();this.pendingConnection_=d;let e=a=>{let b=a.loaded,c=a.lengthComputable?a.total:-1;null!==this.progressCallback_&&this.progressCallback_(b,c)};null!==this.progressCallback_&&d.addUploadProgressListener(e),d.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&d.removeUploadProgressListener(e),this.pendingConnection_=null;let b=d.getErrorCode()===c.NO_ERROR,f=d.getStatus();!b||S(f,this.additionalRetryCodes_)&&this.retry?a(!1,new U(!1,null,d.getErrorCode()===c.ABORT)):a(!0,new U(-1!==this.successCodes_.indexOf(f),d))})},b=(a,b)=>{let c=this.resolve_,d=this.reject_,e=b.connection;if(b.wasSuccessCode)try{let a=this.callback_(e,e.getResponse());K(a)?c(a):c()}catch(a){d(a)}else if(null!==e){let a=o();a.serverResponse=e.getErrorText(),d(this.errorCallback_?this.errorCallback_(e,a):a)}else d(b.canceled?this.appDelete_?C():v():u())};this.canceled_?b(!1,new U(!1,null,!0)):this.backoffId_=I(a,b,this.timeout_)}getPromise(){return this.promise_}cancel(a){this.canceled_=!0,this.appDelete_=a||!1,null!==this.backoffId_&&J(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class U{constructor(a,b,c){this.wasSuccessCode=a,this.connection=b,this.canceled=!!c}}function V(a,b){null!==b&&b.length>0&&(a.Authorization="Firebase "+b)}function W(a,b){a["X-Firebase-Storage-Version"]="webjs/"+(b??"AppManager")}function X(a,b){b&&(a["X-Firebase-GMPID"]=b)}function Y(a,b){null!==b&&(a["X-Firebase-AppCheck"]=b)}function Z(a,b,c,d,e,f,g=!0,h=!1){let i=R(a.urlParams),j=a.url+i,k=Object.assign({},a.headers);return X(k,b),V(k,c),W(k,f),Y(k,d),new T(j,a.method,k,a.body,a.successCodes,a.additionalRetryCodes,a.handler,a.errorHandler,a.timeout,a.progressCallback,e,g,h)}function $(){return"u">typeof BlobBuilder?BlobBuilder:"u">typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function _(...a){let c=$();if(void 0!==c){let b=new c;for(let c=0;c<a.length;c++)b.append(a[c]);return b.getBlob()}if(O())return new Blob(a);throw new m(b.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function aa(a,b,c){return a.webkitSlice?a.webkitSlice(b,c):a.mozSlice?a.mozSlice(b,c):a.slice?a.slice(b,c):null}function ab(a){if(/[^-A-Za-z0-9+/=]/.test(a))throw E("base64","Invalid character found");return Buffer.from(a,"base64").toString("binary")}let ac="raw",ad="base64",ae="base64url",af="data_url";class ag{constructor(a,b){this.data=a,this.contentType=b||null}}function ah(a,b){switch(a){case ac:return new ag(ai(b));case ad:case ae:return new ag(ak(a,b));case af:return new ag(am(b),an(b))}throw o()}function ai(a){let b=[];for(let c=0;c<a.length;c++){let d=a.charCodeAt(c);d<=127?b.push(d):d<=2047?b.push(192|d>>6,128|63&d):(64512&d)==55296?c<a.length-1&&(64512&a.charCodeAt(c+1))==56320?(d=65536|(1023&d)<<10|1023&a.charCodeAt(++c),b.push(240|d>>18,128|d>>12&63,128|d>>6&63,128|63&d)):b.push(239,191,189):(64512&d)==56320?b.push(239,191,189):b.push(224|d>>12,128|d>>6&63,128|63&d)}return new Uint8Array(b)}function aj(a){let b;try{b=decodeURIComponent(a)}catch(a){throw E(af,"Malformed data URL.")}return ai(b)}function ak(a,b){let c;switch(a){case ad:{let c=-1!==b.indexOf("-"),d=-1!==b.indexOf("_");if(c||d)throw E(a,"Invalid character '"+(c?"-":"_")+"' found: is it base64url encoded?");break}case ae:{let c=-1!==b.indexOf("+"),d=-1!==b.indexOf("/");if(c||d)throw E(a,"Invalid character '"+(c?"+":"/")+"' found: is it base64 encoded?");b=b.replace(/-/g,"+").replace(/_/g,"/")}}try{c=ab(b)}catch(b){if(b.message.includes("polyfill"))throw b;throw E(a,"Invalid character found")}let d=new Uint8Array(c.length);for(let a=0;a<c.length;a++)d[a]=c.charCodeAt(a);return d}class al{constructor(a){this.base64=!1,this.contentType=null;const b=a.match(/^data:([^,]+)?,/);if(null===b)throw E(af,"Must be formatted 'data:[<mediatype>][;base64],<data>");const c=b[1]||null;null!=c&&(this.base64=ao(c,";base64"),this.contentType=this.base64?c.substring(0,c.length-7):c),this.rest=a.substring(a.indexOf(",")+1)}}function am(a){let b=new al(a);return b.base64?ak(ad,b.rest):aj(b.rest)}function an(a){return new al(a).contentType}function ao(a,b){return a.length>=b.length&&a.substring(a.length-b.length)===b}class ap{constructor(a,b){let c=0,d="";N(a)?(this.data_=a,c=a.size,d=a.type):a instanceof ArrayBuffer?(b?this.data_=new Uint8Array(a):(this.data_=new Uint8Array(a.byteLength),this.data_.set(new Uint8Array(a))),c=this.data_.length):a instanceof Uint8Array&&(b?this.data_=a:(this.data_=new Uint8Array(a.length),this.data_.set(a)),c=a.length),this.size_=c,this.type_=d}size(){return this.size_}type(){return this.type_}slice(a,b){if(!N(this.data_))return new ap(new Uint8Array(this.data_.buffer,a,b-a),!0);{let c=aa(this.data_,a,b);return null===c?null:new ap(c)}}static getBlob(...a){if(O()){let b=a.map(a=>a instanceof ap?a.data_:a);return new ap(_.apply(null,b))}{let b=a.map(a=>M(a)?ah(ac,a).data:a.data_),c=0;b.forEach(a=>{c+=a.byteLength});let d=new Uint8Array(c),e=0;return b.forEach(a=>{for(let b=0;b<a.length;b++)d[e++]=a[b]}),new ap(d,!0)}}uploadData(){return this.data_}}function aq(a){let b;try{b=JSON.parse(a)}catch(a){return null}return L(b)?b:null}function ar(a){if(0===a.length)return null;let b=a.lastIndexOf("/");return -1===b?"":a.slice(0,b)}function as(a,b){let c=b.split("/").filter(a=>a.length>0).join("/");return 0===a.length?c:a+"/"+c}function at(a){let b=a.lastIndexOf("/",a.length-2);return -1===b?a:a.slice(b+1)}function au(a,b){return b}class av{constructor(a,b,c,d){this.server=a,this.local=b||a,this.writable=!!c,this.xform=d||au}}let aw=null;function ax(a){return!M(a)||a.length<2?a:at(a)}function ay(){if(aw)return aw;let a=[];function b(a,b){return ax(b)}a.push(new av("bucket")),a.push(new av("generation")),a.push(new av("metageneration")),a.push(new av("name","fullPath",!0));let c=new av("name");function d(a,b){return void 0!==b?Number(b):b}c.xform=b,a.push(c);let e=new av("size");return e.xform=d,a.push(e),a.push(new av("timeCreated")),a.push(new av("updated")),a.push(new av("md5Hash",null,!0)),a.push(new av("cacheControl",null,!0)),a.push(new av("contentDisposition",null,!0)),a.push(new av("contentEncoding",null,!0)),a.push(new av("contentLanguage",null,!0)),a.push(new av("contentType",null,!0)),a.push(new av("metadata","customMetadata",!0)),aw=a}function az(a,b){function c(){let c=new G(a.bucket,a.fullPath);return b._makeStorageReference(c)}Object.defineProperty(a,"ref",{get:c})}function aA(a,b,c){let d={};d.type="file";let e=c.length;for(let a=0;a<e;a++){let e=c[a];d[e.local]=e.xform(d,b[e.server])}return az(d,a),d}function aB(a,b,c){let d=aq(b);return null===d?null:aA(a,d,c)}function aC(a,b,c,d){let e=aq(b);if(null===e||!M(e.downloadTokens))return null;let f=e.downloadTokens;if(0===f.length)return null;let g=encodeURIComponent;return f.split(",").map(b=>{let e=a.bucket,f=a.fullPath;return Q("/b/"+g(e)+"/o/"+g(f),c,d)+R({alt:"media",token:b})})[0]}function aD(a,b){let c={},d=b.length;for(let e=0;e<d;e++){let d=b[e];d.writable&&(c[d.server]=a[d.local])}return JSON.stringify(c)}class aE{constructor(a,b,c,d){this.url=a,this.method=b,this.handler=c,this.timeout=d,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function aF(a){if(!a)throw o()}function aG(a,b){return function(c,d){let e=aB(a,d,b);return aF(null!==e),e}}function aH(a,b){return function(c,d){let e=aB(a,d,b);return aF(null!==e),aC(e,d,a.host,a._protocol)}}function aI(a){return function(b,c){let d;return(d=401===b.getStatus()?b.getErrorText().includes("Firebase App Check token is invalid")?s():r():402===b.getStatus()?q(a.bucket):403===b.getStatus()?t(a.path):c).status=b.getStatus(),d.serverResponse=c.serverResponse,d}}function aJ(a){let b=aI(a);return function(c,d){let e=b(c,d);return 404===c.getStatus()&&(e=p(a.path)),e.serverResponse=d.serverResponse,e}}function aK(a,b,c){let d=Q(b.fullServerUrl(),a.host,a._protocol),e="GET",f=a.maxOperationRetryTime,g=new aE(d,e,aH(a,c),f);return g.errorHandler=aJ(b),g}function aL(a,b){return a&&a.contentType||b&&b.type()||"application/octet-stream"}function aM(a,b,c){let d=Object.assign({},c);return d.fullPath=a.path,d.size=b.size(),d.contentType||(d.contentType=aL(null,b)),d}function aN(a,b,c,d,e){let f=b.bucketOnlyServerUrl(),g={"X-Goog-Upload-Protocol":"multipart"},h=function(){let a="";for(let b=0;b<2;b++)a+=Math.random().toString().slice(2);return a}();g["Content-Type"]="multipart/related; boundary="+h;let i=aM(b,d,e),j="--"+h+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+aD(i,c)+"\r\n--"+h+"\r\nContent-Type: "+i.contentType+"\r\n\r\n",k="\r\n--"+h+"--",l=ap.getBlob(j,d,k);if(null===l)throw z();let m={name:i.fullPath},n=Q(f,a.host,a._protocol),o="POST",p=a.maxUploadRetryTime,q=new aE(n,o,aG(a,c),p);return q.urlParams=m,q.headers=g,q.body=l.uploadData(),q.errorHandler=aI(b),q}class aO{constructor(){this.errorText_="",this.sent_=!1,this.errorCode_=c.NO_ERROR}async send(a,b,d,e,f){if(this.sent_)throw F("cannot .send() more than once");this.sent_=!0;try{let g=await aR(a,b,d,f,e);this.headers_=g.headers,this.statusCode_=g.status,this.errorCode_=c.NO_ERROR,this.body_=await g.arrayBuffer()}catch(a){this.errorText_=a?.message,this.statusCode_=0,this.errorCode_=c.NETWORK_ERROR}}getErrorCode(){if(void 0===this.errorCode_)throw F("cannot .getErrorCode() before receiving response");return this.errorCode_}getStatus(){if(void 0===this.statusCode_)throw F("cannot .getStatus() before receiving response");return this.statusCode_}getErrorText(){return this.errorText_}abort(){}getResponseHeader(a){if(!this.headers_)throw F("cannot .getResponseHeader() before receiving response");return this.headers_.get(a)}addUploadProgressListener(a){}removeUploadProgressListener(a){}}class aP extends aO{getResponse(){if(!this.body_)throw F("cannot .getResponse() before receiving response");return Buffer.from(this.body_).toString("utf-8")}}function aQ(){return new aP}function aR(a,b,c,d,e){let f={method:b,headers:d||{},body:e};return(0,g.isCloudWorkstation)(a)&&c&&(f.credentials="include"),fetch(a,f)}class aS{constructor(a,b){this._service=a,b instanceof G?this._location=b:this._location=G.makeFromUrl(b,a.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(a,b){return new aS(a,b)}get root(){let a=new G(this._location.bucket,"");return this._newRef(this._service,a)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return at(this._location.path)}get storage(){return this._service}get parent(){let a=ar(this._location.path);if(null===a)return null;let b=new G(this._location.bucket,a);return new aS(this._service,b)}_throwIfRoot(a){if(""===this._location.path)throw D(a)}}function aT(a,b,c){a._throwIfRoot("uploadBytes");let d=aN(a.storage,a._location,ay(),new ap(b,!0),c);return a.storage.makeRequestWithTokens(d,aQ).then(b=>({metadata:b,ref:a}))}function aU(a){a._throwIfRoot("getDownloadURL");let b=aK(a.storage,a._location,ay());return a.storage.makeRequestWithTokens(b,aQ).then(a=>{if(null===a)throw A();return a})}function aV(a,b){let c=as(a._location.path,b),d=new G(a._location.bucket,c);return new aS(a.storage,d)}function aW(a){return/^[A-Za-z]+:\/\//.test(a)}function aX(a,b){return new aS(a,b)}function aY(a,b){if(a instanceof a0){let c=a;if(null==c._bucket)throw y();let d=new aS(c,c._bucket);return null!=b?aY(d,b):d}return void 0!==b?aV(a,b):a}function aZ(a,b){if(!(b&&aW(b)))return aY(a,b);if(a instanceof a0)return aX(a,b);throw B("To use ref(service, url), the first argument must be a Storage instance.")}function a$(a,b){let c=b?.[j];return null==c?null:G.makeFromBucketSpec(c,a)}function a_(a,b,c,d={}){a.host=`${b}:${c}`;let e=(0,g.isCloudWorkstation)(b);e&&((0,g.pingServer)(`https://${a.host}/b`),(0,g.updateEmulatorBanner)("Storage",!0)),a._isUsingEmulator=!0,a._protocol=e?"https":"http";let{mockUserToken:f}=d;f&&(a._overrideAuthToken="string"==typeof f?f:(0,g.createMockUserToken)(f,a.app.options.projectId))}class a0{constructor(a,b,c,d,e,f=!1){this.app=a,this._authProvider=b,this._appCheckProvider=c,this._url=d,this._firebaseVersion=e,this._isUsingEmulator=f,this._bucket=null,this._host=i,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=k,this._maxUploadRetryTime=l,this._requests=new Set,null!=d?this._bucket=G.makeFromBucketSpec(d,this._host):this._bucket=a$(this._host,this.app.options)}get host(){return this._host}set host(a){this._host=a,null!=this._url?this._bucket=G.makeFromBucketSpec(this._url,a):this._bucket=a$(a,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(a){P("time",0,1/0,a),this._maxUploadRetryTime=a}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(a){P("time",0,1/0,a),this._maxOperationRetryTime=a}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;let a=this._authProvider.getImmediate({optional:!0});if(a){let b=await a.getToken();if(null!==b)return b.accessToken}return null}async _getAppCheckToken(){if((0,f._isFirebaseServerApp)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let a=this._appCheckProvider.getImmediate({optional:!0});return a?(await a.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(a=>a.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(a){return new aS(this,a)}_makeRequest(a,b,c,d,e=!0){if(this._deleted)return new H(C());{let f=Z(a,this._appId,c,d,b,this._firebaseVersion,e,this._isUsingEmulator);return this._requests.add(f),f.getPromise().then(()=>this._requests.delete(f),()=>this._requests.delete(f)),f}}async makeRequestWithTokens(a,b){let[c,d]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(a,b,c,d).getPromise()}}let a1="@firebase/storage",a2="0.14.0",a3="storage";function a4(a,b,c){return aT(a=(0,g.getModularInstance)(a),b,c)}function a5(a){return aU(a=(0,g.getModularInstance)(a))}function a6(a,b){return aZ(a=(0,g.getModularInstance)(a),b)}function a7(a=(0,f.getApp)(),b){a=(0,g.getModularInstance)(a);let c=(0,f._getProvider)(a,a3).getImmediate({identifier:b}),d=(0,g.getDefaultEmulatorHostnameAndPort)("storage");return d&&a8(c,...d),c}function a8(a,b,c,d={}){a_(a,b,c,d)}function a9(a,{instanceIdentifier:b}){return new a0(a.getProvider("app").getImmediate(),a.getProvider("auth-internal"),a.getProvider("app-check-internal"),b,f.SDK_VERSION)}(function(){(0,f._registerComponent)(new h.Component(a3,a9,"PUBLIC").setMultipleInstances(!0)),(0,f.registerVersion)(a1,a2)})(),a.s(["getDownloadURL",()=>a5,"getStorage",()=>a7,"ref",()=>a6,"uploadBytes",()=>a4],5420),a.s([],60121);var ba=f,bb=g,bc=h,bd=a.i(14834);function be(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}let bf=be,bg=new bb.ErrorFactory("auth","Firebase",be()),bh=new bd.Logger("@firebase/auth");function bi(a,...b){bh.logLevel<=bd.LogLevel.WARN&&bh.warn(`Auth (${ba.SDK_VERSION}): ${a}`,...b)}function bj(a,...b){bh.logLevel<=bd.LogLevel.ERROR&&bh.error(`Auth (${ba.SDK_VERSION}): ${a}`,...b)}function bk(a,...b){throw bo(a,...b)}function bl(a,...b){return bo(a,...b)}function bm(a,b,c){let d={...bf(),[b]:c};return new bb.ErrorFactory("auth","Firebase",d).create(b,{appName:a.name})}function bn(a){return bm(a,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function bo(a,...b){if("string"!=typeof a){let c=b[0],d=[...b.slice(1)];return d[0]&&(d[0].appName=a.name),a._errorFactory.create(c,...d)}return bg.create(a,...b)}function bp(a,b,...c){if(!a)throw bo(b,...c)}function bq(a){let b="INTERNAL ASSERTION FAILED: "+a;throw bj(b),Error(b)}function br(a,b){a||bq(b)}function bs(){return"http:"===bt()||"https:"===bt()}function bt(){return"u">typeof self&&self.location?.protocol||null}function bu(){return!("u">typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(bs()||(0,bb.isBrowserExtension)()||"connection"in navigator))||navigator.onLine}function bv(){if("u"<typeof navigator)return null;let a=navigator;return a.languages&&a.languages[0]||a.language||null}class bw{constructor(a,b){this.shortDelay=a,this.longDelay=b,br(b>a,"Short delay should be less than long delay!"),this.isMobile=(0,bb.isMobileCordova)()||(0,bb.isReactNative)()}get(){return bu()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function bx(a,b){br(a.emulator,"Emulator should always be set here");let{url:c}=a.emulator;return b?`${c}${b.startsWith("/")?b.slice(1):b}`:c}class by{static initialize(a,b,c){this.fetchImpl=a,b&&(this.headersImpl=b),c&&(this.responseImpl=c)}static fetch(){return this.fetchImpl?this.fetchImpl:"u">typeof self&&"fetch"in self?self.fetch:"u">typeof globalThis&&globalThis.fetch?globalThis.fetch:"u">typeof fetch?fetch:void bq("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"u">typeof self&&"Headers"in self?self.Headers:"u">typeof globalThis&&globalThis.Headers?globalThis.Headers:"u">typeof Headers?Headers:void bq("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"u">typeof self&&"Response"in self?self.Response:"u">typeof globalThis&&globalThis.Response?globalThis.Response:"u">typeof Response?Response:void bq("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let bz={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},bA=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],bB=new bw(3e4,6e4);function bC(a,b){return a.tenantId&&!b.tenantId?{...b,tenantId:a.tenantId}:b}async function bD(a,b,c,d,e={}){return bE(a,e,async()=>{let e={},f={};d&&("GET"===b?f=d:e={body:JSON.stringify(d)});let g=(0,bb.querystring)({key:a.config.apiKey,...f}).slice(1),h=await a._getAdditionalHeaders();h["Content-Type"]="application/json",a.languageCode&&(h["X-Firebase-Locale"]=a.languageCode);let i={method:b,headers:h,...e};return(0,bb.isCloudflareWorker)()||(i.referrerPolicy="no-referrer"),a.emulatorConfig&&(0,bb.isCloudWorkstation)(a.emulatorConfig.host)&&(i.credentials="include"),by.fetch()(await bG(a,a.config.apiHost,c,g),i)})}async function bE(a,b,c){a._canInitEmulator=!1;let d={...bz,...b};try{let b=new bI(a),e=await Promise.race([c(),b.promise]);b.clearNetworkTimeout();let f=await e.json();if("needConfirmation"in f)throw bJ(a,"account-exists-with-different-credential",f);if(e.ok&&!("errorMessage"in f))return f;{let[b,c]=(e.ok?f.errorMessage:f.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===b)throw bJ(a,"credential-already-in-use",f);if("EMAIL_EXISTS"===b)throw bJ(a,"email-already-in-use",f);if("USER_DISABLED"===b)throw bJ(a,"user-disabled",f);let g=d[b]||b.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw bm(a,g,c);bk(a,g)}}catch(b){if(b instanceof bb.FirebaseError)throw b;bk(a,"network-request-failed",{message:String(b)})}}async function bF(a,b,c,d,e={}){let f=await bD(a,b,c,d,e);return"mfaPendingCredential"in f&&bk(a,"multi-factor-auth-required",{_serverResponse:f}),f}async function bG(a,b,c,d){let e=`${b}${c}?${d}`,f=a,g=f.config.emulator?bx(a.config,e):`${a.config.apiScheme}://${e}`;return bA.includes(c)&&(await f._persistenceManagerAvailable,"COOKIE"===f._getPersistenceType())?f._getPersistence()._getFinalTarget(g).toString():g}function bH(a){switch(a){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class bI{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(a){this.auth=a,this.timer=null,this.promise=new Promise((a,b)=>{this.timer=setTimeout(()=>b(bl(this.auth,"network-request-failed")),bB.get())})}}function bJ(a,b,c){let d={appName:a.name};c.email&&(d.email=c.email),c.phoneNumber&&(d.phoneNumber=c.phoneNumber);let e=bl(a,b,d);return e.customData._tokenResponse=c,e}function bK(a){return void 0!==a&&void 0!==a.enterprise}class bL{constructor(a){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===a.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=a.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=a.recaptchaEnforcementState}getProviderEnforcementState(a){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let b of this.recaptchaEnforcementState)if(b.provider&&b.provider===a)return bH(b.enforcementState);return null}isProviderEnabled(a){return"ENFORCE"===this.getProviderEnforcementState(a)||"AUDIT"===this.getProviderEnforcementState(a)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function bM(a,b){return bD(a,"GET","/v2/recaptchaConfig",bC(a,b))}async function bN(a,b){return bD(a,"POST","/v1/accounts:delete",b)}async function bO(a,b){return bD(a,"POST","/v1/accounts:lookup",b)}function bP(a){if(a)try{let b=new Date(Number(a));if(!isNaN(b.getTime()))return b.toUTCString()}catch(a){}}async function bQ(a,b=!1){let c=(0,bb.getModularInstance)(a),d=await c.getIdToken(b),e=bS(d);bp(e&&e.exp&&e.auth_time&&e.iat,c.auth,"internal-error");let f="object"==typeof e.firebase?e.firebase:void 0,g=f?.sign_in_provider;return{claims:e,token:d,authTime:bP(bR(e.auth_time)),issuedAtTime:bP(bR(e.iat)),expirationTime:bP(bR(e.exp)),signInProvider:g||null,signInSecondFactor:f?.sign_in_second_factor||null}}function bR(a){return 1e3*Number(a)}function bS(a){let[b,c,d]=a.split(".");if(void 0===b||void 0===c||void 0===d)return bj("JWT malformed, contained fewer than 3 sections"),null;try{let a=(0,bb.base64Decode)(c);if(!a)return bj("Failed to decode base64 JWT payload"),null;return JSON.parse(a)}catch(a){return bj("Caught error parsing JWT payload as JSON",a?.toString()),null}}function bT(a){let b=bS(a);return bp(b,"internal-error"),bp(void 0!==b.exp,"internal-error"),bp(void 0!==b.iat,"internal-error"),Number(b.exp)-Number(b.iat)}async function bU(a,b,c=!1){if(c)return b;try{return await b}catch(b){throw b instanceof bb.FirebaseError&&bV(b)&&a.auth.currentUser===a&&await a.auth.signOut(),b}}function bV({code:a}){return"auth/user-disabled"===a||"auth/user-token-expired"===a}class bW{constructor(a){this.user=a,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(a){if(!a)return this.errorBackoff=3e4,Math.max(0,(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5);{let a=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),a}}schedule(a=!1){if(!this.isRunning)return;let b=this.getInterval(a);this.timerId=setTimeout(async()=>{await this.iteration()},b)}async iteration(){try{await this.user.getIdToken(!0)}catch(a){a?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class bX{constructor(a,b){this.createdAt=a,this.lastLoginAt=b,this._initializeTime()}_initializeTime(){this.lastSignInTime=bP(this.lastLoginAt),this.creationTime=bP(this.createdAt)}_copy(a){this.createdAt=a.createdAt,this.lastLoginAt=a.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function bY(a){let b=a.auth,c=await a.getIdToken(),d=await bU(a,bO(b,{idToken:c}));bp(d?.users.length,b,"internal-error");let e=d.users[0];a._notifyReloadListener(e);let f=e.providerUserInfo?.length?b_(e.providerUserInfo):[],g=b$(a.providerData,f),h=a.isAnonymous,i=!(a.email&&e.passwordHash)&&!g?.length,j=!!h&&i;Object.assign(a,{uid:e.localId,displayName:e.displayName||null,photoURL:e.photoUrl||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,tenantId:e.tenantId||null,providerData:g,metadata:new bX(e.createdAt,e.lastLoginAt),isAnonymous:j})}async function bZ(a){let b=(0,bb.getModularInstance)(a);await bY(b),await b.auth._persistUserIfCurrent(b),b.auth._notifyListenersIfCurrent(b)}function b$(a,b){return[...a.filter(a=>!b.some(b=>b.providerId===a.providerId)),...b]}function b_(a){return a.map(({providerId:a,...b})=>({providerId:a,uid:b.rawId||"",displayName:b.displayName||null,email:b.email||null,phoneNumber:b.phoneNumber||null,photoURL:b.photoUrl||null}))}async function b0(a,b){let c=await bE(a,{},async()=>{let c=(0,bb.querystring)({grant_type:"refresh_token",refresh_token:b}).slice(1),{tokenApiHost:d,apiKey:e}=a.config,f=await bG(a,d,"/v1/token",`key=${e}`),g=await a._getAdditionalHeaders();g["Content-Type"]="application/x-www-form-urlencoded";let h={method:"POST",headers:g,body:c};return a.emulatorConfig&&(0,bb.isCloudWorkstation)(a.emulatorConfig.host)&&(h.credentials="include"),by.fetch()(f,h)});return{accessToken:c.access_token,expiresIn:c.expires_in,refreshToken:c.refresh_token}}async function b1(a,b){return bD(a,"POST","/v2/accounts:revokeToken",bC(a,b))}class b2{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(a){bp(a.idToken,"internal-error"),bp(void 0!==a.idToken,"internal-error"),bp(void 0!==a.refreshToken,"internal-error");let b="expiresIn"in a&&void 0!==a.expiresIn?Number(a.expiresIn):bT(a.idToken);this.updateTokensAndExpiration(a.idToken,a.refreshToken,b)}updateFromIdToken(a){bp(0!==a.length,"internal-error");let b=bT(a);this.updateTokensAndExpiration(a,null,b)}async getToken(a,b=!1){return b||!this.accessToken||this.isExpired?(bp(this.refreshToken,a,"user-token-expired"),this.refreshToken)?(await this.refresh(a,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(a,b){let{accessToken:c,refreshToken:d,expiresIn:e}=await b0(a,b);this.updateTokensAndExpiration(c,d,Number(e))}updateTokensAndExpiration(a,b,c){this.refreshToken=b||null,this.accessToken=a||null,this.expirationTime=Date.now()+1e3*c}static fromJSON(a,b){let{refreshToken:c,accessToken:d,expirationTime:e}=b,f=new b2;return c&&(bp("string"==typeof c,"internal-error",{appName:a}),f.refreshToken=c),d&&(bp("string"==typeof d,"internal-error",{appName:a}),f.accessToken=d),e&&(bp("number"==typeof e,"internal-error",{appName:a}),f.expirationTime=e),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(a){this.accessToken=a.accessToken,this.refreshToken=a.refreshToken,this.expirationTime=a.expirationTime}_clone(){return Object.assign(new b2,this.toJSON())}_performRefresh(){return bq("not implemented")}}function b3(a,b){bp("string"==typeof a||void 0===a,"internal-error",{appName:b})}class b4{constructor({uid:a,auth:b,stsTokenManager:c,...d}){this.providerId="firebase",this.proactiveRefresh=new bW(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=a,this.auth=b,this.stsTokenManager=c,this.accessToken=c.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new bX(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(a){let b=await bU(this,this.stsTokenManager.getToken(this.auth,a));return bp(b,this.auth,"internal-error"),this.accessToken!==b&&(this.accessToken=b,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),b}getIdTokenResult(a){return bQ(this,a)}reload(){return bZ(this)}_assign(a){this!==a&&(bp(this.uid===a.uid,this.auth,"internal-error"),this.displayName=a.displayName,this.photoURL=a.photoURL,this.email=a.email,this.emailVerified=a.emailVerified,this.phoneNumber=a.phoneNumber,this.isAnonymous=a.isAnonymous,this.tenantId=a.tenantId,this.providerData=a.providerData.map(a=>({...a})),this.metadata._copy(a.metadata),this.stsTokenManager._assign(a.stsTokenManager))}_clone(a){let b=new b4({...this,auth:a,stsTokenManager:this.stsTokenManager._clone()});return b.metadata._copy(this.metadata),b}_onReload(a){bp(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=a,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(a){this.reloadListener?this.reloadListener(a):this.reloadUserInfo=a}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(a,b=!1){let c=!1;a.idToken&&a.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(a),c=!0),b&&await bY(this),await this.auth._persistUserIfCurrent(this),c&&this.auth._notifyListenersIfCurrent(this)}async delete(){if((0,ba._isFirebaseServerApp)(this.auth.app))return Promise.reject(bn(this.auth));let a=await this.getIdToken();return await bU(this,bN(this.auth,{idToken:a})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(a=>({...a})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(a,b){let c=b.displayName??void 0,d=b.email??void 0,e=b.phoneNumber??void 0,f=b.photoURL??void 0,g=b.tenantId??void 0,h=b._redirectEventId??void 0,i=b.createdAt??void 0,j=b.lastLoginAt??void 0,{uid:k,emailVerified:l,isAnonymous:m,providerData:n,stsTokenManager:o}=b;bp(k&&o,a,"internal-error");let p=b2.fromJSON(this.name,o);bp("string"==typeof k,a,"internal-error"),b3(c,a.name),b3(d,a.name),bp("boolean"==typeof l,a,"internal-error"),bp("boolean"==typeof m,a,"internal-error"),b3(e,a.name),b3(f,a.name),b3(g,a.name),b3(h,a.name),b3(i,a.name),b3(j,a.name);let q=new b4({uid:k,auth:a,email:d,emailVerified:l,displayName:c,isAnonymous:m,photoURL:f,phoneNumber:e,tenantId:g,stsTokenManager:p,createdAt:i,lastLoginAt:j});return n&&Array.isArray(n)&&(q.providerData=n.map(a=>({...a}))),h&&(q._redirectEventId=h),q}static async _fromIdTokenResponse(a,b,c=!1){let d=new b2;d.updateFromServerResponse(b);let e=new b4({uid:b.localId,auth:a,stsTokenManager:d,isAnonymous:c});return await bY(e),e}static async _fromGetAccountInfoResponse(a,b,c){let d=b.users[0];bp(void 0!==d.localId,"internal-error");let e=void 0!==d.providerUserInfo?b_(d.providerUserInfo):[],f=!(d.email&&d.passwordHash)&&!e?.length,g=new b2;g.updateFromIdToken(c);let h=new b4({uid:d.localId,auth:a,stsTokenManager:g,isAnonymous:f});return Object.assign(h,{uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:e,metadata:new bX(d.createdAt,d.lastLoginAt),isAnonymous:!(d.email&&d.passwordHash)&&!e?.length}),h}}let b5=new Map;function b6(a){br(a instanceof Function,"Expected a class definition");let b=b5.get(a);return b?br(b instanceof a,"Instance stored in cache mismatched with class"):(b=new a,b5.set(a,b)),b}class b7{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(a,b){this.storage[a]=b}async _get(a){let b=this.storage[a];return void 0===b?null:b}async _remove(a){delete this.storage[a]}_addListener(a,b){}_removeListener(a,b){}}b7.type="NONE";let b8=b7;function b9(a,b,c){return`firebase:${a}:${b}:${c}`}class ca{constructor(a,b,c){this.persistence=a,this.auth=b,this.userKey=c;const{config:d,name:e}=this.auth;this.fullUserKey=b9(this.userKey,d.apiKey,e),this.fullPersistenceKey=b9("persistence",d.apiKey,e),this.boundEventHandler=b._onStorageEvent.bind(b),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(a){return this.persistence._set(this.fullUserKey,a.toJSON())}async getCurrentUser(){let a=await this.persistence._get(this.fullUserKey);if(!a)return null;if("string"==typeof a){let b=await bO(this.auth,{idToken:a}).catch(()=>void 0);return b?b4._fromGetAccountInfoResponse(this.auth,b,a):null}return b4._fromJSON(this.auth,a)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(a){if(this.persistence===a)return;let b=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=a,b)return this.setCurrentUser(b)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(a,b,c="authUser"){if(!b.length)return new ca(b6(b8),a,c);let d=(await Promise.all(b.map(async a=>{if(await a._isAvailable())return a}))).filter(a=>a),e=d[0]||b6(b8),f=b9(c,a.config.apiKey,a.name),g=null;for(let c of b)try{let b=await c._get(f);if(b){let d;if("string"==typeof b){let c=await bO(a,{idToken:b}).catch(()=>void 0);if(!c)break;d=await b4._fromGetAccountInfoResponse(a,c,b)}else d=b4._fromJSON(a,b);c!==e&&(g=d),e=c;break}}catch{}let h=d.filter(a=>a._shouldAllowMigration);return e._shouldAllowMigration&&h.length&&(e=h[0],g&&await e._set(f,g.toJSON()),await Promise.all(b.map(async a=>{if(a!==e)try{await a._remove(f)}catch{}}))),new ca(e,a,c)}}function cb(a){let b=a.toLowerCase();if(b.includes("opera/")||b.includes("opr/")||b.includes("opios/"))return"Opera";{if(cf(b))return"IEMobile";if(b.includes("msie")||b.includes("trident/"))return"IE";if(b.includes("edge/"))return"Edge";if(cc(b))return"Firefox";if(b.includes("silk/"))return"Silk";if(ch(b))return"Blackberry";if(ci(b))return"Webos";if(cd(b))return"Safari";if((b.includes("chrome/")||ce(b))&&!b.includes("edge/"))return"Chrome";if(cg(b))return"Android";let c=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,d=a.match(c);if(d?.length===2)return d[1]}return"Other"}function cc(a=(0,bb.getUA)()){return/firefox\//i.test(a)}function cd(a=(0,bb.getUA)()){let b=a.toLowerCase();return b.includes("safari/")&&!b.includes("chrome/")&&!b.includes("crios/")&&!b.includes("android")}function ce(a=(0,bb.getUA)()){return/crios\//i.test(a)}function cf(a=(0,bb.getUA)()){return/iemobile/i.test(a)}function cg(a=(0,bb.getUA)()){return/android/i.test(a)}function ch(a=(0,bb.getUA)()){return/blackberry/i.test(a)}function ci(a=(0,bb.getUA)()){return/webos/i.test(a)}function cj(a,b=[]){let c;switch(a){case"Browser":c=cb((0,bb.getUA)());break;case"Worker":c=`${cb((0,bb.getUA)())}-${a}`;break;default:c=a}let d=b.length?b.join(","):"FirebaseCore-web";return`${c}/JsCore/${ba.SDK_VERSION}/${d}`}class ck{constructor(a){this.auth=a,this.queue=[]}pushCallback(a,b){let c=b=>new Promise((c,d)=>{try{let d=a(b);c(d)}catch(a){d(a)}});c.onAbort=b,this.queue.push(c);let d=this.queue.length-1;return()=>{this.queue[d]=()=>Promise.resolve()}}async runMiddleware(a){if(this.auth.currentUser===a)return;let b=[];try{for(let c of this.queue)await c(a),c.onAbort&&b.push(c.onAbort)}catch(a){for(let a of(b.reverse(),b))try{a()}catch(a){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a?.message})}}}async function cl(a,b={}){return bD(a,"GET","/v2/passwordPolicy",bC(a,b))}let cm=6;class cn{constructor(a){const b=a.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=b.minPasswordLength??cm,b.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=b.maxPasswordLength),void 0!==b.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=b.containsLowercaseCharacter),void 0!==b.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=b.containsUppercaseCharacter),void 0!==b.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=b.containsNumericCharacter),void 0!==b.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=b.containsNonAlphanumericCharacter),this.enforcementState=a.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=a.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=a.forceUpgradeOnSignin??!1,this.schemaVersion=a.schemaVersion}validatePassword(a){let b={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(a,b),this.validatePasswordCharacterOptions(a,b),b.isValid&&(b.isValid=b.meetsMinPasswordLength??!0),b.isValid&&(b.isValid=b.meetsMaxPasswordLength??!0),b.isValid&&(b.isValid=b.containsLowercaseLetter??!0),b.isValid&&(b.isValid=b.containsUppercaseLetter??!0),b.isValid&&(b.isValid=b.containsNumericCharacter??!0),b.isValid&&(b.isValid=b.containsNonAlphanumericCharacter??!0),b}validatePasswordLengthOptions(a,b){let c=this.customStrengthOptions.minPasswordLength,d=this.customStrengthOptions.maxPasswordLength;c&&(b.meetsMinPasswordLength=a.length>=c),d&&(b.meetsMaxPasswordLength=a.length<=d)}validatePasswordCharacterOptions(a,b){let c;this.updatePasswordCharacterOptionsStatuses(b,!1,!1,!1,!1);for(let d=0;d<a.length;d++)c=a.charAt(d),this.updatePasswordCharacterOptionsStatuses(b,c>="a"&&c<="z",c>="A"&&c<="Z",c>="0"&&c<="9",this.allowedNonAlphanumericCharacters.includes(c))}updatePasswordCharacterOptionsStatuses(a,b,c,d,e){this.customStrengthOptions.containsLowercaseLetter&&(a.containsLowercaseLetter||(a.containsLowercaseLetter=b)),this.customStrengthOptions.containsUppercaseLetter&&(a.containsUppercaseLetter||(a.containsUppercaseLetter=c)),this.customStrengthOptions.containsNumericCharacter&&(a.containsNumericCharacter||(a.containsNumericCharacter=d)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(a.containsNonAlphanumericCharacter||(a.containsNonAlphanumericCharacter=e))}}class co{constructor(a,b,c,d){this.app=a,this.heartbeatServiceProvider=b,this.appCheckServiceProvider=c,this.config=d,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new cq(this),this.idTokenSubscription=new cq(this),this.beforeStateQueue=new ck(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=bg,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=a.name,this.clientVersion=d.sdkClientVersion,this._persistenceManagerAvailable=new Promise(a=>this._resolvePersistenceManagerAvailable=a)}_initializeWithPersistence(a,b){return b&&(this._popupRedirectResolver=b6(b)),this._initializationPromise=this.queue(async()=>{if(!this._deleted){if(this.persistenceManager=await ca.create(this,a),this._resolvePersistenceManagerAvailable?.(),!this._deleted){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(a){}await this.initializeCurrentUser(b),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let a=await this.assertedPersistence.getCurrentUser();if(this.currentUser||a){if(this.currentUser&&a&&this.currentUser.uid===a.uid){this._currentUser._assign(a),await this.currentUser.getIdToken();return}await this._updateCurrentUser(a,!0)}}async initializeCurrentUserFromIdToken(a){try{let b=await bO(this,{idToken:a}),c=await b4._fromGetAccountInfoResponse(this,b,a);await this.directlySetCurrentUser(c)}catch(a){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",a),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(a){if((0,ba._isFirebaseServerApp)(this.app)){let a=this.app.settings.authIdToken;return a?new Promise(b=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(b,b))}):this.directlySetCurrentUser(null)}let b=await this.assertedPersistence.getCurrentUser(),c=b,d=!1;if(a&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let b=this.redirectUser?._redirectEventId,e=c?._redirectEventId,f=await this.tryRedirectSignIn(a);(!b||b===e)&&f?.user&&(c=f.user,d=!0)}if(!c)return this.directlySetCurrentUser(null);if(!c._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(c)}catch(a){c=b,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return c?this.reloadAndSetCurrentUserOrClear(c):this.directlySetCurrentUser(null)}return(bp(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===c._redirectEventId)?this.directlySetCurrentUser(c):this.reloadAndSetCurrentUserOrClear(c)}async tryRedirectSignIn(a){let b=null;try{b=await this._popupRedirectResolver._completeRedirectFn(this,a,!0)}catch(a){await this._setRedirectUser(null)}return b}async reloadAndSetCurrentUserOrClear(a){try{await bY(a)}catch(a){if(a?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(a)}useDeviceLanguage(){this.languageCode=bv()}async _delete(){this._deleted=!0}async updateCurrentUser(a){if((0,ba._isFirebaseServerApp)(this.app))return Promise.reject(bn(this));let b=a?(0,bb.getModularInstance)(a):null;return b&&bp(b.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(b&&b._clone(this))}async _updateCurrentUser(a,b=!1){if(!this._deleted)return a&&bp(this.tenantId===a.tenantId,this,"tenant-id-mismatch"),b||await this.beforeStateQueue.runMiddleware(a),this.queue(async()=>{await this.directlySetCurrentUser(a),this.notifyAuthListeners()})}async signOut(){return(0,ba._isFirebaseServerApp)(this.app)?Promise.reject(bn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(a){return(0,ba._isFirebaseServerApp)(this.app)?Promise.reject(bn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(b6(a))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(a){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let b=this._getPasswordPolicyInternal();return b.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):b.validatePassword(a)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let a=new cn(await cl(this));null===this.tenantId?this._projectPasswordPolicy=a:this._tenantPasswordPolicies[this.tenantId]=a}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(a){this._errorFactory=new bb.ErrorFactory("auth","Firebase",a())}onAuthStateChanged(a,b,c){return this.registerStateListener(this.authStateSubscription,a,b,c)}beforeAuthStateChanged(a,b){return this.beforeStateQueue.pushCallback(a,b)}onIdTokenChanged(a,b,c){return this.registerStateListener(this.idTokenSubscription,a,b,c)}authStateReady(){return new Promise((a,b)=>{if(this.currentUser)a();else{let c=this.onAuthStateChanged(()=>{c(),a()},b)}})}async revokeAccessToken(a){if(this.currentUser){let b={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:a,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(b.tenantId=this.tenantId),await b1(this,b)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(a,b){let c=await this.getOrInitRedirectPersistenceManager(b);return null===a?c.removeCurrentUser():c.setCurrentUser(a)}async getOrInitRedirectPersistenceManager(a){if(!this.redirectPersistenceManager){let b=a&&b6(a)||this._popupRedirectResolver;bp(b,this,"argument-error"),this.redirectPersistenceManager=await ca.create(this,[b6(b._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(a){return(this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===a)?this._currentUser:this.redirectUser?._redirectEventId===a?this.redirectUser:null}async _persistUserIfCurrent(a){if(a===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(a))}_notifyListenersIfCurrent(a){a===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let a=this.currentUser?.uid??null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(a,b,c,d){if(this._deleted)return()=>{};let e="function"==typeof b?b:b.next.bind(b),f=!1,g=this._isInitialized?Promise.resolve():this._initializationPromise;if(bp(g,this,"internal-error"),g.then(()=>{f||e(this.currentUser)}),"function"==typeof b){let e=a.addObserver(b,c,d);return()=>{f=!0,e()}}{let c=a.addObserver(b);return()=>{f=!0,c()}}}async directlySetCurrentUser(a){this.currentUser&&this.currentUser!==a&&this._currentUser._stopProactiveRefresh(),a&&this.isProactiveRefreshEnabled&&a._startProactiveRefresh(),this.currentUser=a,a?await this.assertedPersistence.setCurrentUser(a):await this.assertedPersistence.removeCurrentUser()}queue(a){return this.operations=this.operations.then(a,a),this.operations}get assertedPersistence(){return bp(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(a){!a||this.frameworks.includes(a)||(this.frameworks.push(a),this.frameworks.sort(),this.clientVersion=cj(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let a={"X-Client-Version":this.clientVersion};this.app.options.appId&&(a["X-Firebase-gmpid"]=this.app.options.appId);let b=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();b&&(a["X-Firebase-Client"]=b);let c=await this._getAppCheckToken();return c&&(a["X-Firebase-AppCheck"]=c),a}async _getAppCheckToken(){if((0,ba._isFirebaseServerApp)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let a=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return a?.error&&bi(`Error while retrieving App Check token: ${a.error}`),a?.token}}function cp(a){return(0,bb.getModularInstance)(a)}class cq{constructor(a){this.auth=a,this.observer=null,this.addObserver=(0,bb.createSubscribe)(a=>this.observer=a)}get next(){return bp(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}class cr{constructor(){this.enterprise=new cs}ready(a){a()}execute(a,b){return Promise.resolve("token")}render(a,b){return""}}class cs{ready(a){a()}execute(a,b){return Promise.resolve("token")}render(a,b){return""}}let ct="recaptcha-enterprise",cu="NO_RECAPTCHA";class cv{constructor(a){this.type=ct,this.auth=cp(a)}async verify(a="verify",b=!1){async function c(a){if(!b){if(null==a.tenantId&&null!=a._agentRecaptchaConfig)return a._agentRecaptchaConfig.siteKey;if(null!=a.tenantId&&void 0!==a._tenantRecaptchaConfigs[a.tenantId])return a._tenantRecaptchaConfigs[a.tenantId].siteKey}return new Promise(async(b,c)=>{bM(a,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(d=>{if(void 0===d.recaptchaKey)c(Error("recaptcha Enterprise site key undefined"));else{let c=new bL(d);return null==a.tenantId?a._agentRecaptchaConfig=c:a._tenantRecaptchaConfigs[a.tenantId]=c,b(c.siteKey)}}).catch(a=>{c(a)})})}function d(b,c,d){let e=window.grecaptcha;bK(e)?e.enterprise.ready(()=>{e.enterprise.execute(b,{action:a}).then(a=>{c(a)}).catch(()=>{c(cu)})}):d(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new cr().execute("siteKey",{action:"verify"}):new Promise((a,e)=>{c(this.auth).then(c=>{!b&&bK(window.grecaptcha)?d(c,a,e):e(Error("RecaptchaVerifier is only supported in browser"))}).catch(a=>{e(a)})})}}async function cw(a,b,c,d=!1,e=!1){let f,g=new cv(a);if(e)f=cu;else try{f=await g.verify(c)}catch(a){f=await g.verify(c,!0)}let h={...b};if("mfaSmsEnrollment"===c||"mfaSmsSignIn"===c){if("phoneEnrollmentInfo"in h){let a=h.phoneEnrollmentInfo.phoneNumber,b=h.phoneEnrollmentInfo.recaptchaToken;Object.assign(h,{phoneEnrollmentInfo:{phoneNumber:a,recaptchaToken:b,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in h){let a=h.phoneSignInInfo.recaptchaToken;Object.assign(h,{phoneSignInInfo:{recaptchaToken:a,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return h}return d?Object.assign(h,{captchaResp:f}):Object.assign(h,{captchaResponse:f}),Object.assign(h,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(h,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),h}async function cx(a,b,c,d,e){if("EMAIL_PASSWORD_PROVIDER"===e)if(!a._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return d(a,b).catch(async e=>{if("auth/missing-recaptcha-token"!==e.code)return Promise.reject(e);{console.log(`${c} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let e=await cw(a,b,c,"getOobCode"===c);return d(a,e)}});else{let e=await cw(a,b,c,"getOobCode"===c);return d(a,e)}if("PHONE_PROVIDER"!==e)return Promise.reject(e+" provider is not supported.");if(a._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let e=await cw(a,b,c);return d(a,e).catch(async e=>{if(a._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&("auth/missing-recaptcha-token"===e.code||"auth/invalid-app-credential"===e.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${c} flow.`);let e=await cw(a,b,c,!1,!0);return d(a,e)}return Promise.reject(e)})}{let e=await cw(a,b,c,!1,!0);return d(a,e)}}function cy(a,b){let c=(0,ba._getProvider)(a,"auth");if(c.isInitialized()){let a=c.getImmediate(),d=c.getOptions();if((0,bb.deepEqual)(d,b??{}))return a;bk(a,"already-initialized")}return c.initialize({options:b})}function cz(a,b){let c=b?.persistence||[],d=(Array.isArray(c)?c:[c]).map(b6);b?.errorMap&&a._updateErrorMap(b.errorMap),a._initializeWithPersistence(d,b?.popupRedirectResolver)}function cA(a,b,c){let d=cp(a);bp(/^https?:\/\//.test(b),d,"invalid-emulator-scheme");let e=!!c?.disableWarnings,f=cB(b),{host:g,port:h}=cC(b),i=null===h?"":`:${h}`,j={url:`${f}//${g}${i}/`},k=Object.freeze({host:g,port:h,protocol:f.replace(":",""),options:Object.freeze({disableWarnings:e})});if(!d._canInitEmulator){bp(d.config.emulator&&d.emulatorConfig,d,"emulator-config-failed"),bp((0,bb.deepEqual)(j,d.config.emulator)&&(0,bb.deepEqual)(k,d.emulatorConfig),d,"emulator-config-failed");return}d.config.emulator=j,d.emulatorConfig=k,d.settings.appVerificationDisabledForTesting=!0,(0,bb.isCloudWorkstation)(g)?((0,bb.pingServer)(`${f}//${g}${i}`),(0,bb.updateEmulatorBanner)("Auth",!0)):e||cE()}function cB(a){let b=a.indexOf(":");return b<0?"":a.substr(0,b+1)}function cC(a){let b=cB(a),c=/(\/\/)?([^?#/]+)/.exec(a.substr(b.length));if(!c)return{host:"",port:null};let d=c[2].split("@").pop()||"",e=/^(\[[^\]]+\])(:|$)/.exec(d);if(e){let a=e[1];return{host:a,port:cD(d.substr(a.length+1))}}{let[a,b]=d.split(":");return{host:a,port:cD(b)}}}function cD(a){if(!a)return null;let b=Number(a);return isNaN(b)?null:b}function cE(){"u">typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.")}class cF{constructor(a,b){this.providerId=a,this.signInMethod=b}toJSON(){return bq("not implemented")}_getIdTokenResponse(a){return bq("not implemented")}_linkToIdToken(a,b){return bq("not implemented")}_getReauthenticationResolver(a){return bq("not implemented")}}async function cG(a,b){return bD(a,"POST","/v1/accounts:signUp",b)}async function cH(a,b){return bF(a,"POST","/v1/accounts:signInWithPassword",bC(a,b))}async function cI(a,b){return bF(a,"POST","/v1/accounts:signInWithEmailLink",bC(a,b))}async function cJ(a,b){return bF(a,"POST","/v1/accounts:signInWithEmailLink",bC(a,b))}class cK extends cF{constructor(a,b,c,d=null){super("password",c),this._email=a,this._password=b,this._tenantId=d}static _fromEmailAndPassword(a,b){return new cK(a,b,"password")}static _fromEmailAndCode(a,b,c=null){return new cK(a,b,"emailLink",c)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(a){let b="string"==typeof a?JSON.parse(a):a;if(b?.email&&b?.password){if("password"===b.signInMethod)return this._fromEmailAndPassword(b.email,b.password);else if("emailLink"===b.signInMethod)return this._fromEmailAndCode(b.email,b.password,b.tenantId)}return null}async _getIdTokenResponse(a){switch(this.signInMethod){case"password":return cx(a,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",cH,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return cI(a,{email:this._email,oobCode:this._password});default:bk(a,"internal-error")}}async _linkToIdToken(a,b){switch(this.signInMethod){case"password":return cx(a,{idToken:b,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",cG,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return cJ(a,{idToken:b,email:this._email,oobCode:this._password});default:bk(a,"internal-error")}}_getReauthenticationResolver(a){return this._getIdTokenResponse(a)}}async function cL(a,b){return bF(a,"POST","/v1/accounts:signInWithIdp",bC(a,b))}let cM="http://localhost";class cN extends cF{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(a){let b=new cN(a.providerId,a.signInMethod);return a.idToken||a.accessToken?(a.idToken&&(b.idToken=a.idToken),a.accessToken&&(b.accessToken=a.accessToken),a.nonce&&!a.pendingToken&&(b.nonce=a.nonce),a.pendingToken&&(b.pendingToken=a.pendingToken)):a.oauthToken&&a.oauthTokenSecret?(b.accessToken=a.oauthToken,b.secret=a.oauthTokenSecret):bk("argument-error"),b}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(a){let{providerId:b,signInMethod:c,...d}="string"==typeof a?JSON.parse(a):a;if(!b||!c)return null;let e=new cN(b,c);return e.idToken=d.idToken||void 0,e.accessToken=d.accessToken||void 0,e.secret=d.secret,e.nonce=d.nonce,e.pendingToken=d.pendingToken||null,e}_getIdTokenResponse(a){return cL(a,this.buildRequest())}_linkToIdToken(a,b){let c=this.buildRequest();return c.idToken=b,cL(a,c)}_getReauthenticationResolver(a){let b=this.buildRequest();return b.autoCreate=!1,cL(a,b)}buildRequest(){let a={requestUri:cM,returnSecureToken:!0};if(this.pendingToken)a.pendingToken=this.pendingToken;else{let b={};this.idToken&&(b.id_token=this.idToken),this.accessToken&&(b.access_token=this.accessToken),this.secret&&(b.oauth_token_secret=this.secret),b.providerId=this.providerId,this.nonce&&!this.pendingToken&&(b.nonce=this.nonce),a.postBody=(0,bb.querystring)(b)}return a}}function cO(a){switch(a){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function cP(a){let b=(0,bb.querystringDecode)((0,bb.extractQuerystring)(a)).link,c=b?(0,bb.querystringDecode)((0,bb.extractQuerystring)(b)).deep_link_id:null,d=(0,bb.querystringDecode)((0,bb.extractQuerystring)(a)).deep_link_id;return(d?(0,bb.querystringDecode)((0,bb.extractQuerystring)(d)).link:null)||d||c||b||a}class cQ{constructor(a){const b=(0,bb.querystringDecode)((0,bb.extractQuerystring)(a)),c=b.apiKey??null,d=b.oobCode??null,e=cO(b.mode??null);bp(c&&d&&e,"argument-error"),this.apiKey=c,this.operation=e,this.code=d,this.continueUrl=b.continueUrl??null,this.languageCode=b.lang??null,this.tenantId=b.tenantId??null}static parseLink(a){let b=cP(a);try{return new cQ(b)}catch{return null}}}class cR{constructor(){this.providerId=cR.PROVIDER_ID}static credential(a,b){return cK._fromEmailAndPassword(a,b)}static credentialWithLink(a,b){let c=cQ.parseLink(b);return bp(c,"argument-error"),cK._fromEmailAndCode(a,c.code,c.tenantId)}}cR.PROVIDER_ID="password",cR.EMAIL_PASSWORD_SIGN_IN_METHOD="password",cR.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class cS{constructor(a){this.providerId=a,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(a){this.defaultLanguageCode=a}setCustomParameters(a){return this.customParameters=a,this}getCustomParameters(){return this.customParameters}}class cT extends cS{constructor(){super(...arguments),this.scopes=[]}addScope(a){return this.scopes.includes(a)||this.scopes.push(a),this}getScopes(){return[...this.scopes]}}class cU extends cT{constructor(){super("facebook.com")}static credential(a){return cN._fromParams({providerId:cU.PROVIDER_ID,signInMethod:cU.FACEBOOK_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return cU.credentialFromTaggedObject(a)}static credentialFromError(a){return cU.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return cU.credential(a.oauthAccessToken)}catch{return null}}}cU.FACEBOOK_SIGN_IN_METHOD="facebook.com",cU.PROVIDER_ID="facebook.com";class cV extends cT{constructor(){super("google.com"),this.addScope("profile")}static credential(a,b){return cN._fromParams({providerId:cV.PROVIDER_ID,signInMethod:cV.GOOGLE_SIGN_IN_METHOD,idToken:a,accessToken:b})}static credentialFromResult(a){return cV.credentialFromTaggedObject(a)}static credentialFromError(a){return cV.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;let{oauthIdToken:b,oauthAccessToken:c}=a;if(!b&&!c)return null;try{return cV.credential(b,c)}catch{return null}}}cV.GOOGLE_SIGN_IN_METHOD="google.com",cV.PROVIDER_ID="google.com";class cW extends cT{constructor(){super("github.com")}static credential(a){return cN._fromParams({providerId:cW.PROVIDER_ID,signInMethod:cW.GITHUB_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return cW.credentialFromTaggedObject(a)}static credentialFromError(a){return cW.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return cW.credential(a.oauthAccessToken)}catch{return null}}}cW.GITHUB_SIGN_IN_METHOD="github.com",cW.PROVIDER_ID="github.com";class cX extends cT{constructor(){super("twitter.com")}static credential(a,b){return cN._fromParams({providerId:cX.PROVIDER_ID,signInMethod:cX.TWITTER_SIGN_IN_METHOD,oauthToken:a,oauthTokenSecret:b})}static credentialFromResult(a){return cX.credentialFromTaggedObject(a)}static credentialFromError(a){return cX.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;let{oauthAccessToken:b,oauthTokenSecret:c}=a;if(!b||!c)return null;try{return cX.credential(b,c)}catch{return null}}}cX.TWITTER_SIGN_IN_METHOD="twitter.com",cX.PROVIDER_ID="twitter.com";class cY extends bb.FirebaseError{constructor(a,b,c,d){super(b.code,b.message),this.operationType=c,this.user=d,Object.setPrototypeOf(this,cY.prototype),this.customData={appName:a.name,tenantId:a.tenantId??void 0,_serverResponse:b.customData._serverResponse,operationType:c}}static _fromErrorAndOperation(a,b,c,d){return new cY(a,b,c,d)}}class cZ{constructor(a,b){this.factorId=a,this.uid=b.mfaEnrollmentId,this.enrollmentTime=new Date(b.enrolledAt).toUTCString(),this.displayName=b.displayName}static _fromServerResponse(a,b){return"phoneInfo"in b?c$._fromServerResponse(a,b):"totpInfo"in b?c_._fromServerResponse(a,b):bk(a,"internal-error")}}class c$ extends cZ{constructor(a){super("phone",a),this.phoneNumber=a.phoneInfo}static _fromServerResponse(a,b){return new c$(b)}}class c_ extends cZ{constructor(a){super("totp",a)}static _fromServerResponse(a,b){return new c_(b)}}function c0(a,b){return bD(a,"POST","/v2/accounts/mfaEnrollment:start",bC(a,b))}function c1(a,b){return bD(a,"POST","/v2/accounts/mfaEnrollment:finalize",bC(a,b))}new WeakMap;var c2="@firebase/auth",c3="1.12.0";class c4{constructor(a){this.auth=a,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(a){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(a)}:null}addAuthTokenListener(a){if(this.assertAuthConfigured(),this.internalListeners.has(a))return;let b=this.auth.onIdTokenChanged(b=>{a(b?.stsTokenManager.accessToken||null)});this.internalListeners.set(a,b),this.updateProactiveRefresh()}removeAuthTokenListener(a){this.assertAuthConfigured();let b=this.internalListeners.get(a);b&&(this.internalListeners.delete(a),b(),this.updateProactiveRefresh())}assertAuthConfigured(){bp(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function c5(a){switch(a){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function c6(a){(0,ba._registerComponent)(new bc.Component("auth",(b,{options:c})=>{let d=b.getProvider("app").getImmediate(),e=b.getProvider("heartbeat"),f=b.getProvider("app-check-internal"),{apiKey:g,authDomain:h}=d.options;bp(g&&!g.includes(":"),"invalid-api-key",{appName:d.name});let i=new co(d,e,f,{apiKey:g,authDomain:h,clientPlatform:a,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:cj(a)});return cz(i,c),i},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((a,b,c)=>{a.getProvider("auth-internal").initialize()})),(0,ba._registerComponent)(new bc.Component("auth-internal",a=>new c4(cp(a.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,ba.registerVersion)(c2,c3,c5(a)),(0,ba.registerVersion)(c2,c3,"esm2020")}function c7(a=(0,ba.getApp)()){let b=(0,ba._getProvider)(a,"auth");if(b.isInitialized())return b.getImmediate();let c=cy(a),d=(0,bb.getDefaultEmulatorHost)("auth");return d&&cA(c,`http://${d}`),c}function c8(a,b){return bD(a,"POST","/v2/accounts/mfaSignIn:finalize",bC(a,b))}by.initialize(fetch,Headers,Response),c6("Node"),bl("operation-not-supported-in-this-environment"),co.prototype.setPersistence=async()=>{};class c9{constructor(a){this.factorId=a}_process(a,b,c){switch(b.type){case"enroll":return this._finalizeEnroll(a,b.credential,c);case"signin":return this._finalizeSignIn(a,b.credential);default:return bq("unexpected MultiFactorSessionType")}}}class da{static assertionForEnrollment(a,b){return db._fromSecret(a,b)}static assertionForSignIn(a,b){return db._fromEnrollmentId(a,b)}static async generateSecret(a){let b=a;bp(void 0!==b.user?.auth,"internal-error");let c=await c0(b.user.auth,{idToken:b.credential,totpEnrollmentInfo:{}});return dc._fromStartTotpMfaEnrollmentResponse(c,b.user.auth)}}da.FACTOR_ID="totp";class db extends c9{constructor(a,b,c){super("totp"),this.otp=a,this.enrollmentId=b,this.secret=c}static _fromSecret(a,b){return new db(b,void 0,a)}static _fromEnrollmentId(a,b){return new db(b,a)}async _finalizeEnroll(a,b,c){return bp(void 0!==this.secret,a,"argument-error"),c1(a,{idToken:b,displayName:c,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(a,b){bp(void 0!==this.enrollmentId&&void 0!==this.otp,a,"argument-error");let c={verificationCode:this.otp};return c8(a,{mfaPendingCredential:b,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:c})}}class dc{constructor(a,b,c,d,e,f,g){this.sessionInfo=f,this.auth=g,this.secretKey=a,this.hashingAlgorithm=b,this.codeLength=c,this.codeIntervalSeconds=d,this.enrollmentCompletionDeadline=e}static _fromStartTotpMfaEnrollmentResponse(a,b){return new dc(a.totpSessionInfo.sharedSecretKey,a.totpSessionInfo.hashingAlgorithm,a.totpSessionInfo.verificationCodeLength,a.totpSessionInfo.periodSec,new Date(a.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),a.totpSessionInfo.sessionInfo,b)}_makeTotpVerificationInfo(a){return{sessionInfo:this.sessionInfo,verificationCode:a}}generateQrCodeUrl(a,b){let c=!1;return(dd(a)||dd(b))&&(c=!0),c&&(dd(a)&&(a=this.auth.currentUser?.email||"unknownuser"),dd(b)&&(b=this.auth.name)),`otpauth://totp/${b}:${a}?secret=${this.secretKey}&issuer=${b}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function dd(a){return void 0===a||a?.length===0}a.s([],48641),a.i(48641);let de={apiKey:"AIzaSyC1QUDQpnMEd9pzevUDtb1vXjYwsv_QrXo",authDomain:"obacelikyapi.firebaseapp.com",projectId:"obacelikyapi",storageBucket:"obacelikyapi.firebasestorage.app",messagingSenderId:"423823946531",appId:"1:423823946531:web:55e6bb936f520274b89296",measurementId:"G-00SYQ5RFF7"},df=(0,d.getApps)().length?(0,d.getApp)():(0,d.initializeApp)(de),dg=(0,e.getFirestore)(df),dh=a7(df);c7(df),a.s(["db",()=>dg,"storage",()=>dh],20237)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__c0a6a910._.js.map